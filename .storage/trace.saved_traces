{
    "version": 1,
    "minor_version": 1,
    "key": "trace.saved_traces",
    "data": {
        "automation.1648712039256": [
            {
                "extended_dict": {
                    "last_step": "action/0/choose/1/sequence/0/choose/0/sequence/0",
                    "run_id": "60c18ed53d47e535aa4efe9eabf44914",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-05-27T04:06:00.005100+00:00",
                        "finish": "2022-05-27T04:06:00.015675+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1648712039256",
                    "trigger": "time pattern",
                    "trace": {
                        "trigger/0": [
                            {
                                "path": "trigger/0",
                                "timestamp": "2022-05-27T04:06:00.005188+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.water_heating",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-05-27T04:01:00.005851+00:00",
                                            "mode": "single",
                                            "current": 0,
                                            "id": "1648712039256",
                                            "friendly_name": "Water Heating"
                                        },
                                        "last_changed": "2022-05-27T04:05:22.474359+00:00",
                                        "last_updated": "2022-05-27T04:05:22.474359+00:00",
                                        "context": {
                                            "id": "efb3b8ab9047b7f08e4f7be17e8c8efd",
                                            "parent_id": null,
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "0",
                                        "idx": "0",
                                        "platform": "time_pattern",
                                        "now": "2022-05-27T12:06:00.004758+08:00",
                                        "description": "time pattern"
                                    }
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-05-27T04:06:00.006855+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "5c1f1d97b425fbe1c37500005c50315b",
                                        "parent_id": null,
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "choice": 1
                                }
                            }
                        ],
                        "action/0/choose/0": [
                            {
                                "path": "action/0/choose/0",
                                "timestamp": "2022-05-27T04:06:00.008021+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/0/conditions/0",
                                "timestamp": "2022-05-27T04:06:00.008063+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/0/conditions/0/entity_id/0": [
                            {
                                "path": "action/0/choose/0/conditions/0/entity_id/0",
                                "timestamp": "2022-05-27T04:06:00.008087+00:00",
                                "result": {
                                    "result": false,
                                    "state": "off",
                                    "wanted_state": "on"
                                }
                            }
                        ],
                        "action/0/choose/1": [
                            {
                                "path": "action/0/choose/1",
                                "timestamp": "2022-05-27T04:06:00.008157+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/1/conditions/0": [
                            {
                                "path": "action/0/choose/1/conditions/0",
                                "timestamp": "2022-05-27T04:06:00.008180+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/1/conditions/0/entity_id/0": [
                            {
                                "path": "action/0/choose/1/conditions/0/entity_id/0",
                                "timestamp": "2022-05-27T04:06:00.008193+00:00",
                                "result": {
                                    "result": true,
                                    "state": "off",
                                    "wanted_state": "off"
                                }
                            }
                        ],
                        "action/0/choose/1/sequence/0": [
                            {
                                "path": "action/0/choose/1/sequence/0",
                                "timestamp": "2022-05-27T04:06:00.010551+00:00",
                                "result": {
                                    "choice": 0
                                }
                            }
                        ],
                        "action/0/choose/1/sequence/0/choose/0": [
                            {
                                "path": "action/0/choose/1/sequence/0/choose/0",
                                "timestamp": "2022-05-27T04:06:00.010741+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/1/sequence/0/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/1/sequence/0/choose/0/conditions/0",
                                "timestamp": "2022-05-27T04:06:00.010765+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/1/sequence/0/choose/0/conditions/0/entity_id/0": [
                            {
                                "path": "action/0/choose/1/sequence/0/choose/0/conditions/0/entity_id/0",
                                "timestamp": "2022-05-27T04:06:00.010821+00:00",
                                "result": {
                                    "result": true,
                                    "state": -0.8333333333333334
                                }
                            }
                        ],
                        "action/0/choose/1/sequence/0/choose/0/sequence/0": [
                            {
                                "path": "action/0/choose/1/sequence/0/choose/0/sequence/0",
                                "timestamp": "2022-05-27T04:06:00.011401+00:00",
                                "result": {
                                    "params": {
                                        "domain": "input_number",
                                        "service": "set_value",
                                        "service_data": {
                                            "value": 0,
                                            "entity_id": [
                                                "input_number.water_heating"
                                            ]
                                        },
                                        "target": {
                                            "entity_id": [
                                                "input_number.water_heating"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ]
                    },
                    "config": {
                        "id": "1648712039256",
                        "alias": "Water Heating",
                        "description": "Track the heating status of the water in the heater",
                        "trigger": [
                            {
                                "platform": "time_pattern",
                                "minutes": "/1"
                            }
                        ],
                        "condition": [],
                        "action": [
                            {
                                "choose": [
                                    {
                                        "conditions": [
                                            {
                                                "condition": "state",
                                                "entity_id": "switch.water_heater",
                                                "state": "on"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [
                                                            {
                                                                "condition": "numeric_state",
                                                                "entity_id": "input_number.water_heating",
                                                                "above": "100",
                                                                "value_template": "{{ state.state | float + 100 / states('input_number.hot_water_preheat') | float }}"
                                                            }
                                                        ],
                                                        "sequence": [
                                                            {
                                                                "service": "input_number.set_value",
                                                                "data": {
                                                                    "value": 100
                                                                },
                                                                "target": {
                                                                    "entity_id": "input_number.water_heating"
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "input_number.set_value",
                                                        "data_template": {
                                                            "entity_id": "input_number.water_heating",
                                                            "value": "{{ states('input_number.water_heating') | int + 100 / states('input_number.hot_water_preheat') | int }}"
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "state",
                                                "entity_id": "switch.water_heater",
                                                "state": "off"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [
                                                            {
                                                                "condition": "numeric_state",
                                                                "entity_id": "input_number.water_heating",
                                                                "value_template": "{{ state.state | float - 100 / 120 }}",
                                                                "below": "0"
                                                            }
                                                        ],
                                                        "sequence": [
                                                            {
                                                                "service": "input_number.set_value",
                                                                "data": {
                                                                    "value": 0
                                                                },
                                                                "target": {
                                                                    "entity_id": "input_number.water_heating"
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "input_number.set_value",
                                                        "data_template": {
                                                            "entity_id": "input_number.water_heating",
                                                            "value": "{{ states('input_number.water_heating') | float - 100 / 120 }}"
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ],
                                "default": []
                            }
                        ],
                        "mode": "single"
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "5c1f1d97b425fbe1c37500005c50315b",
                        "parent_id": null,
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/0/choose/1/sequence/0/choose/0/sequence/0",
                    "run_id": "60c18ed53d47e535aa4efe9eabf44914",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-05-27T04:06:00.005100+00:00",
                        "finish": "2022-05-27T04:06:00.015675+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1648712039256",
                    "trigger": "time pattern"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/0/choose/1/sequence/0/choose/0/sequence/0",
                    "run_id": "db2c867a839812274232712b6d05bba8",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-05-27T04:07:00.005936+00:00",
                        "finish": "2022-05-27T04:07:00.011249+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1648712039256",
                    "trigger": "time pattern",
                    "trace": {
                        "trigger/0": [
                            {
                                "path": "trigger/0",
                                "timestamp": "2022-05-27T04:07:00.005984+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.water_heating",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-05-27T04:06:00.005491+00:00",
                                            "mode": "single",
                                            "current": 0,
                                            "id": "1648712039256",
                                            "friendly_name": "Water Heating"
                                        },
                                        "last_changed": "2022-05-27T04:05:22.474359+00:00",
                                        "last_updated": "2022-05-27T04:06:00.014570+00:00",
                                        "context": {
                                            "id": "5c1f1d97b425fbe1c37500005c50315b",
                                            "parent_id": null,
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "0",
                                        "idx": "0",
                                        "platform": "time_pattern",
                                        "now": "2022-05-27T12:07:00.001479+08:00",
                                        "description": "time pattern"
                                    }
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-05-27T04:07:00.007575+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "7e2fcef02393cd9e601ca240fb206658",
                                        "parent_id": null,
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "choice": 1
                                }
                            }
                        ],
                        "action/0/choose/0": [
                            {
                                "path": "action/0/choose/0",
                                "timestamp": "2022-05-27T04:07:00.007628+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/0/conditions/0",
                                "timestamp": "2022-05-27T04:07:00.007650+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/0/conditions/0/entity_id/0": [
                            {
                                "path": "action/0/choose/0/conditions/0/entity_id/0",
                                "timestamp": "2022-05-27T04:07:00.007665+00:00",
                                "result": {
                                    "result": false,
                                    "state": "off",
                                    "wanted_state": "on"
                                }
                            }
                        ],
                        "action/0/choose/1": [
                            {
                                "path": "action/0/choose/1",
                                "timestamp": "2022-05-27T04:07:00.007715+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/1/conditions/0": [
                            {
                                "path": "action/0/choose/1/conditions/0",
                                "timestamp": "2022-05-27T04:07:00.007730+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/1/conditions/0/entity_id/0": [
                            {
                                "path": "action/0/choose/1/conditions/0/entity_id/0",
                                "timestamp": "2022-05-27T04:07:00.007741+00:00",
                                "result": {
                                    "result": true,
                                    "state": "off",
                                    "wanted_state": "off"
                                }
                            }
                        ],
                        "action/0/choose/1/sequence/0": [
                            {
                                "path": "action/0/choose/1/sequence/0",
                                "timestamp": "2022-05-27T04:07:00.008307+00:00",
                                "result": {
                                    "choice": 0
                                }
                            }
                        ],
                        "action/0/choose/1/sequence/0/choose/0": [
                            {
                                "path": "action/0/choose/1/sequence/0/choose/0",
                                "timestamp": "2022-05-27T04:07:00.008350+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/1/sequence/0/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/1/sequence/0/choose/0/conditions/0",
                                "timestamp": "2022-05-27T04:07:00.008367+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/1/sequence/0/choose/0/conditions/0/entity_id/0": [
                            {
                                "path": "action/0/choose/1/sequence/0/choose/0/conditions/0/entity_id/0",
                                "timestamp": "2022-05-27T04:07:00.008382+00:00",
                                "result": {
                                    "result": true,
                                    "state": -0.8333333333333334
                                }
                            }
                        ],
                        "action/0/choose/1/sequence/0/choose/0/sequence/0": [
                            {
                                "path": "action/0/choose/1/sequence/0/choose/0/sequence/0",
                                "timestamp": "2022-05-27T04:07:00.008710+00:00",
                                "result": {
                                    "params": {
                                        "domain": "input_number",
                                        "service": "set_value",
                                        "service_data": {
                                            "value": 0,
                                            "entity_id": [
                                                "input_number.water_heating"
                                            ]
                                        },
                                        "target": {
                                            "entity_id": [
                                                "input_number.water_heating"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ]
                    },
                    "config": {
                        "id": "1648712039256",
                        "alias": "Water Heating",
                        "description": "Track the heating status of the water in the heater",
                        "trigger": [
                            {
                                "platform": "time_pattern",
                                "minutes": "/1"
                            }
                        ],
                        "condition": [],
                        "action": [
                            {
                                "choose": [
                                    {
                                        "conditions": [
                                            {
                                                "condition": "state",
                                                "entity_id": "switch.water_heater",
                                                "state": "on"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [
                                                            {
                                                                "condition": "numeric_state",
                                                                "entity_id": "input_number.water_heating",
                                                                "above": "100",
                                                                "value_template": "{{ state.state | float + 100 / states('input_number.hot_water_preheat') | float }}"
                                                            }
                                                        ],
                                                        "sequence": [
                                                            {
                                                                "service": "input_number.set_value",
                                                                "data": {
                                                                    "value": 100
                                                                },
                                                                "target": {
                                                                    "entity_id": "input_number.water_heating"
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "input_number.set_value",
                                                        "data_template": {
                                                            "entity_id": "input_number.water_heating",
                                                            "value": "{{ states('input_number.water_heating') | int + 100 / states('input_number.hot_water_preheat') | int }}"
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "state",
                                                "entity_id": "switch.water_heater",
                                                "state": "off"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [
                                                            {
                                                                "condition": "numeric_state",
                                                                "entity_id": "input_number.water_heating",
                                                                "value_template": "{{ state.state | float - 100 / 120 }}",
                                                                "below": "0"
                                                            }
                                                        ],
                                                        "sequence": [
                                                            {
                                                                "service": "input_number.set_value",
                                                                "data": {
                                                                    "value": 0
                                                                },
                                                                "target": {
                                                                    "entity_id": "input_number.water_heating"
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "input_number.set_value",
                                                        "data_template": {
                                                            "entity_id": "input_number.water_heating",
                                                            "value": "{{ states('input_number.water_heating') | float - 100 / 120 }}"
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ],
                                "default": []
                            }
                        ],
                        "mode": "single"
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "7e2fcef02393cd9e601ca240fb206658",
                        "parent_id": null,
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/0/choose/1/sequence/0/choose/0/sequence/0",
                    "run_id": "db2c867a839812274232712b6d05bba8",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-05-27T04:07:00.005936+00:00",
                        "finish": "2022-05-27T04:07:00.011249+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1648712039256",
                    "trigger": "time pattern"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/0/choose/1/sequence/0/choose/0/sequence/0",
                    "run_id": "29564bf968d3ed4bf67a6fbcc2a88d6e",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-05-27T04:08:00.003949+00:00",
                        "finish": "2022-05-27T04:08:00.008261+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1648712039256",
                    "trigger": "time pattern",
                    "trace": {
                        "trigger/0": [
                            {
                                "path": "trigger/0",
                                "timestamp": "2022-05-27T04:08:00.004002+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.water_heating",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-05-27T04:07:00.006201+00:00",
                                            "mode": "single",
                                            "current": 0,
                                            "id": "1648712039256",
                                            "friendly_name": "Water Heating"
                                        },
                                        "last_changed": "2022-05-27T04:05:22.474359+00:00",
                                        "last_updated": "2022-05-27T04:07:00.010168+00:00",
                                        "context": {
                                            "id": "7e2fcef02393cd9e601ca240fb206658",
                                            "parent_id": null,
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "0",
                                        "idx": "0",
                                        "platform": "time_pattern",
                                        "now": "2022-05-27T12:08:00.003193+08:00",
                                        "description": "time pattern"
                                    }
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-05-27T04:08:00.005265+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "971c8290f90bbc78d4fb65bb485dba98",
                                        "parent_id": null,
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "choice": 1
                                }
                            }
                        ],
                        "action/0/choose/0": [
                            {
                                "path": "action/0/choose/0",
                                "timestamp": "2022-05-27T04:08:00.005314+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/0/conditions/0",
                                "timestamp": "2022-05-27T04:08:00.005335+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/0/conditions/0/entity_id/0": [
                            {
                                "path": "action/0/choose/0/conditions/0/entity_id/0",
                                "timestamp": "2022-05-27T04:08:00.005350+00:00",
                                "result": {
                                    "result": false,
                                    "state": "off",
                                    "wanted_state": "on"
                                }
                            }
                        ],
                        "action/0/choose/1": [
                            {
                                "path": "action/0/choose/1",
                                "timestamp": "2022-05-27T04:08:00.005395+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/1/conditions/0": [
                            {
                                "path": "action/0/choose/1/conditions/0",
                                "timestamp": "2022-05-27T04:08:00.005409+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/1/conditions/0/entity_id/0": [
                            {
                                "path": "action/0/choose/1/conditions/0/entity_id/0",
                                "timestamp": "2022-05-27T04:08:00.005420+00:00",
                                "result": {
                                    "result": true,
                                    "state": "off",
                                    "wanted_state": "off"
                                }
                            }
                        ],
                        "action/0/choose/1/sequence/0": [
                            {
                                "path": "action/0/choose/1/sequence/0",
                                "timestamp": "2022-05-27T04:08:00.005890+00:00",
                                "result": {
                                    "choice": 0
                                }
                            }
                        ],
                        "action/0/choose/1/sequence/0/choose/0": [
                            {
                                "path": "action/0/choose/1/sequence/0/choose/0",
                                "timestamp": "2022-05-27T04:08:00.005935+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/1/sequence/0/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/1/sequence/0/choose/0/conditions/0",
                                "timestamp": "2022-05-27T04:08:00.005952+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/1/sequence/0/choose/0/conditions/0/entity_id/0": [
                            {
                                "path": "action/0/choose/1/sequence/0/choose/0/conditions/0/entity_id/0",
                                "timestamp": "2022-05-27T04:08:00.005968+00:00",
                                "result": {
                                    "result": true,
                                    "state": -0.8333333333333334
                                }
                            }
                        ],
                        "action/0/choose/1/sequence/0/choose/0/sequence/0": [
                            {
                                "path": "action/0/choose/1/sequence/0/choose/0/sequence/0",
                                "timestamp": "2022-05-27T04:08:00.006254+00:00",
                                "result": {
                                    "params": {
                                        "domain": "input_number",
                                        "service": "set_value",
                                        "service_data": {
                                            "value": 0,
                                            "entity_id": [
                                                "input_number.water_heating"
                                            ]
                                        },
                                        "target": {
                                            "entity_id": [
                                                "input_number.water_heating"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ]
                    },
                    "config": {
                        "id": "1648712039256",
                        "alias": "Water Heating",
                        "description": "Track the heating status of the water in the heater",
                        "trigger": [
                            {
                                "platform": "time_pattern",
                                "minutes": "/1"
                            }
                        ],
                        "condition": [],
                        "action": [
                            {
                                "choose": [
                                    {
                                        "conditions": [
                                            {
                                                "condition": "state",
                                                "entity_id": "switch.water_heater",
                                                "state": "on"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [
                                                            {
                                                                "condition": "numeric_state",
                                                                "entity_id": "input_number.water_heating",
                                                                "above": "100",
                                                                "value_template": "{{ state.state | float + 100 / states('input_number.hot_water_preheat') | float }}"
                                                            }
                                                        ],
                                                        "sequence": [
                                                            {
                                                                "service": "input_number.set_value",
                                                                "data": {
                                                                    "value": 100
                                                                },
                                                                "target": {
                                                                    "entity_id": "input_number.water_heating"
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "input_number.set_value",
                                                        "data_template": {
                                                            "entity_id": "input_number.water_heating",
                                                            "value": "{{ states('input_number.water_heating') | int + 100 / states('input_number.hot_water_preheat') | int }}"
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "state",
                                                "entity_id": "switch.water_heater",
                                                "state": "off"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [
                                                            {
                                                                "condition": "numeric_state",
                                                                "entity_id": "input_number.water_heating",
                                                                "value_template": "{{ state.state | float - 100 / 120 }}",
                                                                "below": "0"
                                                            }
                                                        ],
                                                        "sequence": [
                                                            {
                                                                "service": "input_number.set_value",
                                                                "data": {
                                                                    "value": 0
                                                                },
                                                                "target": {
                                                                    "entity_id": "input_number.water_heating"
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "input_number.set_value",
                                                        "data_template": {
                                                            "entity_id": "input_number.water_heating",
                                                            "value": "{{ states('input_number.water_heating') | float - 100 / 120 }}"
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ],
                                "default": []
                            }
                        ],
                        "mode": "single"
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "971c8290f90bbc78d4fb65bb485dba98",
                        "parent_id": null,
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/0/choose/1/sequence/0/choose/0/sequence/0",
                    "run_id": "29564bf968d3ed4bf67a6fbcc2a88d6e",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-05-27T04:08:00.003949+00:00",
                        "finish": "2022-05-27T04:08:00.008261+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1648712039256",
                    "trigger": "time pattern"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/0/choose/1/sequence/0/choose/0/sequence/0",
                    "run_id": "45d9697102c5f9765dc375f793a77819",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-05-27T04:09:00.003740+00:00",
                        "finish": "2022-05-27T04:09:00.010339+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1648712039256",
                    "trigger": "time pattern",
                    "trace": {
                        "trigger/0": [
                            {
                                "path": "trigger/0",
                                "timestamp": "2022-05-27T04:09:00.003801+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.water_heating",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-05-27T04:08:00.004259+00:00",
                                            "mode": "single",
                                            "current": 0,
                                            "id": "1648712039256",
                                            "friendly_name": "Water Heating"
                                        },
                                        "last_changed": "2022-05-27T04:05:22.474359+00:00",
                                        "last_updated": "2022-05-27T04:08:00.007438+00:00",
                                        "context": {
                                            "id": "971c8290f90bbc78d4fb65bb485dba98",
                                            "parent_id": null,
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "0",
                                        "idx": "0",
                                        "platform": "time_pattern",
                                        "now": "2022-05-27T12:09:00.001275+08:00",
                                        "description": "time pattern"
                                    }
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-05-27T04:09:00.006138+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "61257f91a5be8d1c7019854b35fea7ed",
                                        "parent_id": null,
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "choice": 1
                                }
                            }
                        ],
                        "action/0/choose/0": [
                            {
                                "path": "action/0/choose/0",
                                "timestamp": "2022-05-27T04:09:00.006190+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/0/conditions/0",
                                "timestamp": "2022-05-27T04:09:00.006211+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/0/conditions/0/entity_id/0": [
                            {
                                "path": "action/0/choose/0/conditions/0/entity_id/0",
                                "timestamp": "2022-05-27T04:09:00.006226+00:00",
                                "result": {
                                    "result": false,
                                    "state": "off",
                                    "wanted_state": "on"
                                }
                            }
                        ],
                        "action/0/choose/1": [
                            {
                                "path": "action/0/choose/1",
                                "timestamp": "2022-05-27T04:09:00.006273+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/1/conditions/0": [
                            {
                                "path": "action/0/choose/1/conditions/0",
                                "timestamp": "2022-05-27T04:09:00.006297+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/1/conditions/0/entity_id/0": [
                            {
                                "path": "action/0/choose/1/conditions/0/entity_id/0",
                                "timestamp": "2022-05-27T04:09:00.006309+00:00",
                                "result": {
                                    "result": true,
                                    "state": "off",
                                    "wanted_state": "off"
                                }
                            }
                        ],
                        "action/0/choose/1/sequence/0": [
                            {
                                "path": "action/0/choose/1/sequence/0",
                                "timestamp": "2022-05-27T04:09:00.006891+00:00",
                                "result": {
                                    "choice": 0
                                }
                            }
                        ],
                        "action/0/choose/1/sequence/0/choose/0": [
                            {
                                "path": "action/0/choose/1/sequence/0/choose/0",
                                "timestamp": "2022-05-27T04:09:00.006928+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/1/sequence/0/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/1/sequence/0/choose/0/conditions/0",
                                "timestamp": "2022-05-27T04:09:00.006945+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/1/sequence/0/choose/0/conditions/0/entity_id/0": [
                            {
                                "path": "action/0/choose/1/sequence/0/choose/0/conditions/0/entity_id/0",
                                "timestamp": "2022-05-27T04:09:00.006960+00:00",
                                "result": {
                                    "result": true,
                                    "state": -0.8333333333333334
                                }
                            }
                        ],
                        "action/0/choose/1/sequence/0/choose/0/sequence/0": [
                            {
                                "path": "action/0/choose/1/sequence/0/choose/0/sequence/0",
                                "timestamp": "2022-05-27T04:09:00.007296+00:00",
                                "result": {
                                    "params": {
                                        "domain": "input_number",
                                        "service": "set_value",
                                        "service_data": {
                                            "value": 0,
                                            "entity_id": [
                                                "input_number.water_heating"
                                            ]
                                        },
                                        "target": {
                                            "entity_id": [
                                                "input_number.water_heating"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ]
                    },
                    "config": {
                        "id": "1648712039256",
                        "alias": "Water Heating",
                        "description": "Track the heating status of the water in the heater",
                        "trigger": [
                            {
                                "platform": "time_pattern",
                                "minutes": "/1"
                            }
                        ],
                        "condition": [],
                        "action": [
                            {
                                "choose": [
                                    {
                                        "conditions": [
                                            {
                                                "condition": "state",
                                                "entity_id": "switch.water_heater",
                                                "state": "on"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [
                                                            {
                                                                "condition": "numeric_state",
                                                                "entity_id": "input_number.water_heating",
                                                                "above": "100",
                                                                "value_template": "{{ state.state | float + 100 / states('input_number.hot_water_preheat') | float }}"
                                                            }
                                                        ],
                                                        "sequence": [
                                                            {
                                                                "service": "input_number.set_value",
                                                                "data": {
                                                                    "value": 100
                                                                },
                                                                "target": {
                                                                    "entity_id": "input_number.water_heating"
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "input_number.set_value",
                                                        "data_template": {
                                                            "entity_id": "input_number.water_heating",
                                                            "value": "{{ states('input_number.water_heating') | int + 100 / states('input_number.hot_water_preheat') | int }}"
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "state",
                                                "entity_id": "switch.water_heater",
                                                "state": "off"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [
                                                            {
                                                                "condition": "numeric_state",
                                                                "entity_id": "input_number.water_heating",
                                                                "value_template": "{{ state.state | float - 100 / 120 }}",
                                                                "below": "0"
                                                            }
                                                        ],
                                                        "sequence": [
                                                            {
                                                                "service": "input_number.set_value",
                                                                "data": {
                                                                    "value": 0
                                                                },
                                                                "target": {
                                                                    "entity_id": "input_number.water_heating"
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "input_number.set_value",
                                                        "data_template": {
                                                            "entity_id": "input_number.water_heating",
                                                            "value": "{{ states('input_number.water_heating') | float - 100 / 120 }}"
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ],
                                "default": []
                            }
                        ],
                        "mode": "single"
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "61257f91a5be8d1c7019854b35fea7ed",
                        "parent_id": null,
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/0/choose/1/sequence/0/choose/0/sequence/0",
                    "run_id": "45d9697102c5f9765dc375f793a77819",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-05-27T04:09:00.003740+00:00",
                        "finish": "2022-05-27T04:09:00.010339+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1648712039256",
                    "trigger": "time pattern"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/0/choose/1/sequence/0/choose/0/sequence/0",
                    "run_id": "1ddf43815dd01600bfaeebbf5b36d2f0",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-05-27T04:10:00.003556+00:00",
                        "finish": "2022-05-27T04:10:00.010705+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1648712039256",
                    "trigger": "time pattern",
                    "trace": {
                        "trigger/0": [
                            {
                                "path": "trigger/0",
                                "timestamp": "2022-05-27T04:10:00.003603+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.water_heating",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-05-27T04:09:00.004622+00:00",
                                            "mode": "single",
                                            "current": 0,
                                            "id": "1648712039256",
                                            "friendly_name": "Water Heating"
                                        },
                                        "last_changed": "2022-05-27T04:05:22.474359+00:00",
                                        "last_updated": "2022-05-27T04:09:00.008885+00:00",
                                        "context": {
                                            "id": "61257f91a5be8d1c7019854b35fea7ed",
                                            "parent_id": null,
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "0",
                                        "idx": "0",
                                        "platform": "time_pattern",
                                        "now": "2022-05-27T12:10:00.002406+08:00",
                                        "description": "time pattern"
                                    }
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-05-27T04:10:00.004961+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "c6a8c60d9607b3028e1cf874540485ad",
                                        "parent_id": null,
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "choice": 1
                                }
                            }
                        ],
                        "action/0/choose/0": [
                            {
                                "path": "action/0/choose/0",
                                "timestamp": "2022-05-27T04:10:00.005008+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/0/conditions/0",
                                "timestamp": "2022-05-27T04:10:00.005028+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/0/conditions/0/entity_id/0": [
                            {
                                "path": "action/0/choose/0/conditions/0/entity_id/0",
                                "timestamp": "2022-05-27T04:10:00.005041+00:00",
                                "result": {
                                    "result": false,
                                    "state": "off",
                                    "wanted_state": "on"
                                }
                            }
                        ],
                        "action/0/choose/1": [
                            {
                                "path": "action/0/choose/1",
                                "timestamp": "2022-05-27T04:10:00.005084+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/1/conditions/0": [
                            {
                                "path": "action/0/choose/1/conditions/0",
                                "timestamp": "2022-05-27T04:10:00.005099+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/1/conditions/0/entity_id/0": [
                            {
                                "path": "action/0/choose/1/conditions/0/entity_id/0",
                                "timestamp": "2022-05-27T04:10:00.005110+00:00",
                                "result": {
                                    "result": true,
                                    "state": "off",
                                    "wanted_state": "off"
                                }
                            }
                        ],
                        "action/0/choose/1/sequence/0": [
                            {
                                "path": "action/0/choose/1/sequence/0",
                                "timestamp": "2022-05-27T04:10:00.005924+00:00",
                                "result": {
                                    "choice": 0
                                }
                            }
                        ],
                        "action/0/choose/1/sequence/0/choose/0": [
                            {
                                "path": "action/0/choose/1/sequence/0/choose/0",
                                "timestamp": "2022-05-27T04:10:00.005975+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/1/sequence/0/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/1/sequence/0/choose/0/conditions/0",
                                "timestamp": "2022-05-27T04:10:00.006010+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/1/sequence/0/choose/0/conditions/0/entity_id/0": [
                            {
                                "path": "action/0/choose/1/sequence/0/choose/0/conditions/0/entity_id/0",
                                "timestamp": "2022-05-27T04:10:00.006031+00:00",
                                "result": {
                                    "result": true,
                                    "state": -0.8333333333333334
                                }
                            }
                        ],
                        "action/0/choose/1/sequence/0/choose/0/sequence/0": [
                            {
                                "path": "action/0/choose/1/sequence/0/choose/0/sequence/0",
                                "timestamp": "2022-05-27T04:10:00.006504+00:00",
                                "result": {
                                    "params": {
                                        "domain": "input_number",
                                        "service": "set_value",
                                        "service_data": {
                                            "value": 0,
                                            "entity_id": [
                                                "input_number.water_heating"
                                            ]
                                        },
                                        "target": {
                                            "entity_id": [
                                                "input_number.water_heating"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ]
                    },
                    "config": {
                        "id": "1648712039256",
                        "alias": "Water Heating",
                        "description": "Track the heating status of the water in the heater",
                        "trigger": [
                            {
                                "platform": "time_pattern",
                                "minutes": "/1"
                            }
                        ],
                        "condition": [],
                        "action": [
                            {
                                "choose": [
                                    {
                                        "conditions": [
                                            {
                                                "condition": "state",
                                                "entity_id": "switch.water_heater",
                                                "state": "on"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [
                                                            {
                                                                "condition": "numeric_state",
                                                                "entity_id": "input_number.water_heating",
                                                                "above": "100",
                                                                "value_template": "{{ state.state | float + 100 / states('input_number.hot_water_preheat') | float }}"
                                                            }
                                                        ],
                                                        "sequence": [
                                                            {
                                                                "service": "input_number.set_value",
                                                                "data": {
                                                                    "value": 100
                                                                },
                                                                "target": {
                                                                    "entity_id": "input_number.water_heating"
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "input_number.set_value",
                                                        "data_template": {
                                                            "entity_id": "input_number.water_heating",
                                                            "value": "{{ states('input_number.water_heating') | int + 100 / states('input_number.hot_water_preheat') | int }}"
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "state",
                                                "entity_id": "switch.water_heater",
                                                "state": "off"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [
                                                            {
                                                                "condition": "numeric_state",
                                                                "entity_id": "input_number.water_heating",
                                                                "value_template": "{{ state.state | float - 100 / 120 }}",
                                                                "below": "0"
                                                            }
                                                        ],
                                                        "sequence": [
                                                            {
                                                                "service": "input_number.set_value",
                                                                "data": {
                                                                    "value": 0
                                                                },
                                                                "target": {
                                                                    "entity_id": "input_number.water_heating"
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "input_number.set_value",
                                                        "data_template": {
                                                            "entity_id": "input_number.water_heating",
                                                            "value": "{{ states('input_number.water_heating') | float - 100 / 120 }}"
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ],
                                "default": []
                            }
                        ],
                        "mode": "single"
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "c6a8c60d9607b3028e1cf874540485ad",
                        "parent_id": null,
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/0/choose/1/sequence/0/choose/0/sequence/0",
                    "run_id": "1ddf43815dd01600bfaeebbf5b36d2f0",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-05-27T04:10:00.003556+00:00",
                        "finish": "2022-05-27T04:10:00.010705+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1648712039256",
                    "trigger": "time pattern"
                }
            }
        ],
        "automation.1644145378905": [
            {
                "extended_dict": {
                    "last_step": "action/0/choose/1/sequence/0",
                    "run_id": "d37f21f1e6e1de5215d3ea3ff20f77d4",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-05-27T04:06:38.565571+00:00",
                        "finish": "2022-05-27T04:06:38.676131+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1644145378905",
                    "trigger": "state of binary_sensor.powder_room_motion",
                    "trace": {
                        "trigger/1": [
                            {
                                "path": "trigger/1",
                                "timestamp": "2022-05-27T04:06:38.565620+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.powder_room_motion",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-05-27T03:52:04.048971+00:00",
                                            "mode": "single",
                                            "current": 0,
                                            "id": "1644145378905",
                                            "friendly_name": "Powder Room Motion"
                                        },
                                        "last_changed": "2022-05-27T04:05:22.473014+00:00",
                                        "last_updated": "2022-05-27T04:05:22.473014+00:00",
                                        "context": {
                                            "id": "5a4a292d1e1ea12bd3ba04652b4e1285",
                                            "parent_id": null,
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "no_motion",
                                        "idx": "1",
                                        "platform": "state",
                                        "entity_id": "binary_sensor.powder_room_motion",
                                        "from_state": {
                                            "entity_id": "binary_sensor.powder_room_motion",
                                            "state": "unavailable",
                                            "attributes": {
                                                "restored": true,
                                                "device_class": "motion",
                                                "icon": "mdi:walk",
                                                "friendly_name": "Powder Room Motion",
                                                "supported_features": 0
                                            },
                                            "last_changed": "2022-05-27T04:05:29.944122+00:00",
                                            "last_updated": "2022-05-27T04:05:29.944122+00:00",
                                            "context": {
                                                "id": "9cfde4eb0e77e4b56812b61f44888949",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "to_state": {
                                            "entity_id": "binary_sensor.powder_room_motion",
                                            "state": "off",
                                            "attributes": {
                                                "device_class": "motion",
                                                "icon": "mdi:walk",
                                                "friendly_name": "Powder Room Motion"
                                            },
                                            "last_changed": "2022-05-27T04:05:38.542331+00:00",
                                            "last_updated": "2022-05-27T04:05:38.542331+00:00",
                                            "context": {
                                                "id": "da6e901bb27e82d253cfc0a42ff6b272",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "for": {
                                            "__type": "<class 'datetime.timedelta'>",
                                            "total_seconds": 60.0
                                        },
                                        "attribute": null,
                                        "description": "state of binary_sensor.powder_room_motion"
                                    }
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-05-27T04:06:38.567264+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "7fa5867bce07619fa31de6b2e0241f47",
                                        "parent_id": "da6e901bb27e82d253cfc0a42ff6b272",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "choice": 1
                                }
                            }
                        ],
                        "action/0/choose/0": [
                            {
                                "path": "action/0/choose/0",
                                "timestamp": "2022-05-27T04:06:38.567947+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/0/conditions/0",
                                "timestamp": "2022-05-27T04:06:38.567972+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/1": [
                            {
                                "path": "action/0/choose/1",
                                "timestamp": "2022-05-27T04:06:38.568009+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/1/conditions/0": [
                            {
                                "path": "action/0/choose/1/conditions/0",
                                "timestamp": "2022-05-27T04:06:38.568022+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/1/sequence/0": [
                            {
                                "path": "action/0/choose/1/sequence/0",
                                "timestamp": "2022-05-27T04:06:38.571526+00:00",
                                "result": {
                                    "params": {
                                        "domain": "light",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "light.powder_room_pendant_light_entity"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ]
                    },
                    "config": {
                        "id": "1644145378905",
                        "alias": "Powder Room Motion",
                        "description": "Control the Powder Room Lights with motion",
                        "trigger": [
                            {
                                "platform": "state",
                                "entity_id": "binary_sensor.powder_room_motion",
                                "id": "motion",
                                "to": "on"
                            },
                            {
                                "platform": "state",
                                "entity_id": "binary_sensor.powder_room_motion",
                                "id": "no_motion",
                                "to": "off",
                                "for": {
                                    "hours": 0,
                                    "minutes": 1,
                                    "seconds": 0
                                }
                            }
                        ],
                        "condition": [],
                        "action": [
                            {
                                "choose": [
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "motion"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [
                                                            {
                                                                "condition": "time",
                                                                "before": "input_datetime.lights_auto_control_end",
                                                                "after": "input_datetime.sleep_hours_start"
                                                            }
                                                        ],
                                                        "sequence": [
                                                            {
                                                                "condition": "state",
                                                                "entity_id": "light.powder_room_pendant_light_entity",
                                                                "state": "off",
                                                                "for": {
                                                                    "hours": 0,
                                                                    "minutes": 0,
                                                                    "seconds": 2
                                                                }
                                                            },
                                                            {
                                                                "service": "light.turn_on",
                                                                "target": {
                                                                    "entity_id": "light.powder_room_pendant_light_entity"
                                                                },
                                                                "data": {
                                                                    "brightness_pct": 5
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "condition": "state",
                                                        "entity_id": "light.powder_room_pendant_light_entity",
                                                        "state": "off",
                                                        "for": {
                                                            "hours": 0,
                                                            "minutes": 0,
                                                            "seconds": 2
                                                        }
                                                    },
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.powder_room_pendant_light_entity"
                                                        },
                                                        "data": {
                                                            "brightness_pct": 100
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "no_motion"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "light.turn_off",
                                                "target": {
                                                    "entity_id": "light.powder_room_pendant_light_entity"
                                                },
                                                "data": {}
                                            }
                                        ]
                                    }
                                ],
                                "default": []
                            }
                        ],
                        "mode": "single"
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "7fa5867bce07619fa31de6b2e0241f47",
                        "parent_id": "da6e901bb27e82d253cfc0a42ff6b272",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/0/choose/1/sequence/0",
                    "run_id": "d37f21f1e6e1de5215d3ea3ff20f77d4",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-05-27T04:06:38.565571+00:00",
                        "finish": "2022-05-27T04:06:38.676131+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1644145378905",
                    "trigger": "state of binary_sensor.powder_room_motion"
                }
            }
        ],
        "automation.1643644997118": [
            {
                "extended_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "e8bc3b8a3aa66d48c2a3cbc95e4b83a3",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-05-27T04:07:02.103916+00:00",
                        "finish": "2022-05-27T04:07:02.118177+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643644997118",
                    "trigger": "event 'zha_event'",
                    "trace": {
                        "trigger/1": [
                            {
                                "path": "trigger/1",
                                "timestamp": "2022-05-27T04:07:02.105242+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.elis_room_fan_controller",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-05-27T03:21:26.432641+00:00",
                                            "mode": "restart",
                                            "current": 0,
                                            "id": "1643644997118",
                                            "friendly_name": "Eli's Room Fan Controller"
                                        },
                                        "last_changed": "2022-05-27T04:05:22.469864+00:00",
                                        "last_updated": "2022-05-27T04:05:22.469864+00:00",
                                        "context": {
                                            "id": "68185a9d22c4bf543daa8163724cc8ca",
                                            "parent_id": null,
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "1",
                                        "idx": "1",
                                        "platform": "event",
                                        "event": {
                                            "event_type": "zha_event",
                                            "data": {
                                                "device_ieee": "84:fd:27:ff:fe:9c:06:da",
                                                "unique_id": "84:fd:27:ff:fe:9c:06:da:1:0x0020",
                                                "device_id": "f70176647fea31ee95539e565e16e9be",
                                                "endpoint_id": 1,
                                                "cluster_id": 32,
                                                "command": "checkin",
                                                "args": [],
                                                "params": {}
                                            },
                                            "origin": "LOCAL",
                                            "time_fired": "2022-05-27T04:07:02.097728+00:00",
                                            "context": {
                                                "id": "4270717ee64437bf87251259ae241a31",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "description": "event 'zha_event'"
                                    },
                                    "integration": "ZHA",
                                    "button_up_long_loop": false,
                                    "button_up_long_max_loop_repeats": 500,
                                    "button_up_double_press": false,
                                    "button_down_long_loop": false,
                                    "button_down_long_max_loop_repeats": 500,
                                    "button_down_double_press": false,
                                    "helper_last_controller_event": "input_text.zz_eli_s_room_fan_controller_last_event",
                                    "helper_double_press_delay": 500,
                                    "helper_debounce_delay": 0,
                                    "integration_id": "zha",
                                    "adjusted_double_press_delay": 500,
                                    "actions_mapping": {
                                        "deconz": {
                                            "button_up_short": [
                                                "1002"
                                            ],
                                            "button_up_long": [
                                                "1001"
                                            ],
                                            "button_up_release": [
                                                "1003"
                                            ],
                                            "button_down_short": [
                                                "2002"
                                            ],
                                            "button_down_long": [
                                                "2001"
                                            ],
                                            "button_down_release": [
                                                "2003"
                                            ]
                                        },
                                        "zha": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "move_with_on_off_0_83"
                                            ],
                                            "button_up_release": [
                                                "stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "move_1_83"
                                            ],
                                            "button_down_release": [
                                                "stop"
                                            ]
                                        },
                                        "zigbee2mqtt": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "brightness_move_up"
                                            ],
                                            "button_up_release": [
                                                "brightness_stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "brightness_move_down"
                                            ],
                                            "button_down_release": [
                                                "brightness_stop"
                                            ]
                                        }
                                    },
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ],
                                    "integrations_with_prev_event_storage": [
                                        "zha",
                                        "zigbee2mqtt"
                                    ],
                                    "controller_entity": "",
                                    "controller_device": "f70176647fea31ee95539e565e16e9be",
                                    "controller_id": "f70176647fea31ee95539e565e16e9be"
                                }
                            }
                        ],
                        "condition/0": [
                            {
                                "path": "condition/0",
                                "timestamp": "2022-05-27T04:07:02.105283+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "condition/0/conditions/0": [
                            {
                                "path": "condition/0/conditions/0",
                                "timestamp": "2022-05-27T04:07:02.105307+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "condition/0/conditions/1": [
                            {
                                "path": "condition/0/conditions/1",
                                "timestamp": "2022-05-27T04:07:02.105542+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-05-27T04:07:02.107160+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "a3356b1a21a0e83c79a3cd2650989917",
                                        "parent_id": "4270717ee64437bf87251259ae241a31",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "delay": 0.0,
                                    "done": true
                                }
                            }
                        ],
                        "action/1": [
                            {
                                "path": "action/1",
                                "timestamp": "2022-05-27T04:07:02.111440+00:00"
                            }
                        ],
                        "action/2": [
                            {
                                "path": "action/2",
                                "timestamp": "2022-05-27T04:07:02.112456+00:00",
                                "changed_variables": {
                                    "trigger_action": "checkin",
                                    "trigger_delta": 2735677.410840988,
                                    "last_controller_event": "off"
                                },
                                "result": {
                                    "params": {
                                        "domain": "input_text",
                                        "service": "set_value",
                                        "service_data": {
                                            "entity_id": "input_text.zz_eli_s_room_fan_controller_last_event",
                                            "value": {
                                                "trigger_action": "checkin",
                                                "last_triggered": "2022-05-27 12:07:02.112574+08:00"
                                            }
                                        },
                                        "target": {}
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "action/3": [
                            {
                                "path": "action/3",
                                "timestamp": "2022-05-27T04:07:02.115168+00:00"
                            }
                        ],
                        "action/3/choose/0": [
                            {
                                "path": "action/3/choose/0",
                                "timestamp": "2022-05-27T04:07:02.115931+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/0/conditions/0": [
                            {
                                "path": "action/3/choose/0/conditions/0",
                                "timestamp": "2022-05-27T04:07:02.115964+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/1": [
                            {
                                "path": "action/3/choose/1",
                                "timestamp": "2022-05-27T04:07:02.116114+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/1/conditions/0": [
                            {
                                "path": "action/3/choose/1/conditions/0",
                                "timestamp": "2022-05-27T04:07:02.116136+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/2": [
                            {
                                "path": "action/3/choose/2",
                                "timestamp": "2022-05-27T04:07:02.116480+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/2/conditions/0": [
                            {
                                "path": "action/3/choose/2/conditions/0",
                                "timestamp": "2022-05-27T04:07:02.116503+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/3": [
                            {
                                "path": "action/3/choose/3",
                                "timestamp": "2022-05-27T04:07:02.116591+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/3/conditions/0": [
                            {
                                "path": "action/3/choose/3/conditions/0",
                                "timestamp": "2022-05-27T04:07:02.116609+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/4": [
                            {
                                "path": "action/3/choose/4",
                                "timestamp": "2022-05-27T04:07:02.116693+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/4/conditions/0": [
                            {
                                "path": "action/3/choose/4/conditions/0",
                                "timestamp": "2022-05-27T04:07:02.116712+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/5": [
                            {
                                "path": "action/3/choose/5",
                                "timestamp": "2022-05-27T04:07:02.116866+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/5/conditions/0": [
                            {
                                "path": "action/3/choose/5/conditions/0",
                                "timestamp": "2022-05-27T04:07:02.116892+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ]
                    },
                    "config": {
                        "variables": {
                            "integration": "ZHA",
                            "button_up_long_loop": false,
                            "button_up_long_max_loop_repeats": 500,
                            "button_up_double_press": false,
                            "button_down_long_loop": false,
                            "button_down_long_max_loop_repeats": 500,
                            "button_down_double_press": false,
                            "helper_last_controller_event": "input_text.zz_eli_s_room_fan_controller_last_event",
                            "helper_double_press_delay": 500,
                            "helper_debounce_delay": 0,
                            "integration_id": "{{ integration | lower }}",
                            "adjusted_double_press_delay": "{{ [helper_double_press_delay - helper_debounce_delay, 100] | max }}",
                            "actions_mapping": {
                                "deconz": {
                                    "button_up_short": [
                                        "1002"
                                    ],
                                    "button_up_long": [
                                        "1001"
                                    ],
                                    "button_up_release": [
                                        "1003"
                                    ],
                                    "button_down_short": [
                                        "2002"
                                    ],
                                    "button_down_long": [
                                        "2001"
                                    ],
                                    "button_down_release": [
                                        "2003"
                                    ]
                                },
                                "zha": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ]
                                },
                                "zigbee2mqtt": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "brightness_move_up"
                                    ],
                                    "button_up_release": [
                                        "brightness_stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "brightness_move_down"
                                    ],
                                    "button_down_release": [
                                        "brightness_stop"
                                    ]
                                }
                            },
                            "button_up_short": "{{ actions_mapping[integration_id][\"button_up_short\"] }}",
                            "button_up_long": "{{ actions_mapping[integration_id][\"button_up_long\"] }}",
                            "button_up_release": "{{ actions_mapping[integration_id][\"button_up_release\"] }}",
                            "button_down_short": "{{ actions_mapping[integration_id][\"button_down_short\"] }}",
                            "button_down_long": "{{ actions_mapping[integration_id][\"button_down_long\"] }}",
                            "button_down_release": "{{ actions_mapping[integration_id][\"button_down_release\"] }}",
                            "integrations_with_prev_event_storage": [
                                "zha",
                                "zigbee2mqtt"
                            ],
                            "controller_entity": "",
                            "controller_device": "f70176647fea31ee95539e565e16e9be",
                            "controller_id": "{% if integration_id==\"zigbee2mqtt\" %}{{controller_entity}}{% else %}{{controller_device}}{% endif %}"
                        },
                        "mode": "restart",
                        "max_exceeded": "silent",
                        "trigger": [
                            {
                                "platform": "event",
                                "event_type": "state_changed",
                                "event_data": {
                                    "entity_id": ""
                                }
                            },
                            {
                                "platform": "event",
                                "event_type": [
                                    "deconz_event",
                                    "zha_event"
                                ],
                                "event_data": {
                                    "device_id": "f70176647fea31ee95539e565e16e9be"
                                }
                            }
                        ],
                        "condition": [
                            {
                                "condition": "and",
                                "conditions": [
                                    "{%- set trigger_action -%} {%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%} {%- endset -%} {{ trigger_action not in [\"\",\"None\"] }}",
                                    "{{ integration_id != \"zigbee2mqtt\" or trigger.event.data.new_state.state != trigger.event.data.old_state.state }}"
                                ]
                            }
                        ],
                        "action": [
                            {
                                "delay": {
                                    "milliseconds": 0
                                }
                            },
                            {
                                "variables": {
                                    "trigger_action": "{%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%}",
                                    "trigger_delta": "{{ (as_timestamp(now()) - as_timestamp((states(helper_last_controller_event) | from_json).last_triggered if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"1970-01-01 00:00:00\")) * 1000 }}",
                                    "last_controller_event": "{{ (states(helper_last_controller_event) | from_json).trigger_action if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"\" }}"
                                }
                            },
                            {
                                "service": "input_text.set_value",
                                "data": {
                                    "entity_id": "input_text.zz_eli_s_room_fan_controller_last_event",
                                    "value": "{{ {\"trigger_action\":trigger_action,\"last_triggered\":now()|string} | to_json }}"
                                }
                            },
                            {
                                "choose": [
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_eli_s_room_fan_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_up_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_up_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "fan.turn_on",
                                                                                        "target": {
                                                                                            "entity_id": "fan.elis_room_fan"
                                                                                        },
                                                                                        "data": {}
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_up_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "fan.turn_on",
                                                                        "target": {
                                                                            "entity_id": "fan.elis_room_fan"
                                                                        },
                                                                        "data": {}
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_up_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "fan.increase_speed",
                                                                            "target": {
                                                                                "entity_id": "fan.elis_room_fan"
                                                                            },
                                                                            "data": {}
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "fan.increase_speed",
                                                        "target": {
                                                            "entity_id": "fan.elis_room_fan"
                                                        },
                                                        "data": {}
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_up_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_up_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_eli_s_room_fan_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_down_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_down_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "fan.turn_off",
                                                                                        "target": {
                                                                                            "entity_id": "fan.elis_room_fan"
                                                                                        },
                                                                                        "data": {}
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_down_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "fan.turn_off",
                                                                        "target": {
                                                                            "entity_id": "fan.elis_room_fan"
                                                                        },
                                                                        "data": {}
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_down_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "choose": [
                                                                                {
                                                                                    "conditions": [
                                                                                        {
                                                                                            "condition": "numeric_state",
                                                                                            "entity_id": "fan.elis_room_fan",
                                                                                            "attribute": "percentage",
                                                                                            "below": "20"
                                                                                        }
                                                                                    ],
                                                                                    "sequence": [
                                                                                        {
                                                                                            "service": "fan.turn_off",
                                                                                            "data": {},
                                                                                            "target": {
                                                                                                "entity_id": "fan.elis_room_fan"
                                                                                            }
                                                                                        }
                                                                                    ]
                                                                                }
                                                                            ],
                                                                            "default": [
                                                                                {
                                                                                    "service": "fan.decrease_speed",
                                                                                    "data": {},
                                                                                    "target": {
                                                                                        "entity_id": "fan.elis_room_fan"
                                                                                    }
                                                                                }
                                                                            ]
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [
                                                                    {
                                                                        "condition": "numeric_state",
                                                                        "entity_id": "fan.elis_room_fan",
                                                                        "attribute": "percentage",
                                                                        "below": "20"
                                                                    }
                                                                ],
                                                                "sequence": [
                                                                    {
                                                                        "service": "fan.turn_off",
                                                                        "data": {},
                                                                        "target": {
                                                                            "entity_id": "fan.elis_room_fan"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ],
                                                        "default": [
                                                            {
                                                                "service": "fan.decrease_speed",
                                                                "data": {},
                                                                "target": {
                                                                    "entity_id": "fan.elis_room_fan"
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_down_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_down_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            }
                        ],
                        "id": "1643644997118",
                        "alias": "Eli's Room Fan Controller",
                        "description": "Control Eli's Room Fan"
                    },
                    "blueprint_inputs": {
                        "id": "1643644997118",
                        "alias": "Eli's Room Fan Controller",
                        "description": "Control Eli's Room Fan",
                        "use_blueprint": {
                            "path": "EPMatt/ikea_e1743.yaml",
                            "input": {
                                "integration": "ZHA",
                                "controller_device": "f70176647fea31ee95539e565e16e9be",
                                "helper_last_controller_event": "input_text.zz_eli_s_room_fan_controller_last_event",
                                "action_button_up_short": [
                                    {
                                        "service": "fan.turn_on",
                                        "target": {
                                            "entity_id": "fan.elis_room_fan"
                                        },
                                        "data": {}
                                    }
                                ],
                                "action_button_up_long": [
                                    {
                                        "service": "fan.increase_speed",
                                        "target": {
                                            "entity_id": "fan.elis_room_fan"
                                        },
                                        "data": {}
                                    }
                                ],
                                "action_button_down_short": [
                                    {
                                        "service": "fan.turn_off",
                                        "target": {
                                            "entity_id": "fan.elis_room_fan"
                                        },
                                        "data": {}
                                    }
                                ],
                                "action_button_down_long": [
                                    {
                                        "choose": [
                                            {
                                                "conditions": [
                                                    {
                                                        "condition": "numeric_state",
                                                        "entity_id": "fan.elis_room_fan",
                                                        "attribute": "percentage",
                                                        "below": "20"
                                                    }
                                                ],
                                                "sequence": [
                                                    {
                                                        "service": "fan.turn_off",
                                                        "data": {},
                                                        "target": {
                                                            "entity_id": "fan.elis_room_fan"
                                                        }
                                                    }
                                                ]
                                            }
                                        ],
                                        "default": [
                                            {
                                                "service": "fan.decrease_speed",
                                                "data": {},
                                                "target": {
                                                    "entity_id": "fan.elis_room_fan"
                                                }
                                            }
                                        ]
                                    }
                                ]
                            }
                        }
                    },
                    "context": {
                        "id": "a3356b1a21a0e83c79a3cd2650989917",
                        "parent_id": "4270717ee64437bf87251259ae241a31",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "e8bc3b8a3aa66d48c2a3cbc95e4b83a3",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-05-27T04:07:02.103916+00:00",
                        "finish": "2022-05-27T04:07:02.118177+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643644997118",
                    "trigger": "event 'zha_event'"
                }
            }
        ],
        "automation.1643640720985": [
            {
                "extended_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "52069a2ce787f48305c95418fb19d697",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-05-27T04:07:06.910239+00:00",
                        "finish": "2022-05-27T04:07:06.928592+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643640720985",
                    "trigger": "event 'zha_event'",
                    "trace": {
                        "trigger/1": [
                            {
                                "path": "trigger/1",
                                "timestamp": "2022-05-27T04:07:06.911729+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.dining_room_light_controller_1",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-05-27T03:10:24.544832+00:00",
                                            "mode": "restart",
                                            "current": 0,
                                            "id": "1643640720985",
                                            "friendly_name": "Dining Room Lights Controller 1"
                                        },
                                        "last_changed": "2022-05-27T04:05:22.468015+00:00",
                                        "last_updated": "2022-05-27T04:05:22.468015+00:00",
                                        "context": {
                                            "id": "2f381d6c5d179b98b2fbded67f82c140",
                                            "parent_id": null,
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "1",
                                        "idx": "1",
                                        "platform": "event",
                                        "event": {
                                            "event_type": "zha_event",
                                            "data": {
                                                "device_ieee": "84:fd:27:ff:fe:9f:0f:e0",
                                                "unique_id": "84:fd:27:ff:fe:9f:0f:e0:1:0x0020",
                                                "device_id": "0df2cd0b0fa9112188778c56db622911",
                                                "endpoint_id": 1,
                                                "cluster_id": 32,
                                                "command": "checkin",
                                                "args": [],
                                                "params": {}
                                            },
                                            "origin": "LOCAL",
                                            "time_fired": "2022-05-27T04:07:06.904853+00:00",
                                            "context": {
                                                "id": "9e6fb04daa719ee95eab80b9f927077b",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "description": "event 'zha_event'"
                                    },
                                    "integration": "ZHA",
                                    "button_up_long_loop": true,
                                    "button_up_long_max_loop_repeats": 50,
                                    "button_up_double_press": false,
                                    "button_down_long_loop": true,
                                    "button_down_long_max_loop_repeats": 50,
                                    "button_down_double_press": true,
                                    "helper_last_controller_event": "input_text.zz_dining_room_lights_controller_1_last_event",
                                    "helper_double_press_delay": 1000,
                                    "helper_debounce_delay": 0,
                                    "integration_id": "zha",
                                    "adjusted_double_press_delay": 1000,
                                    "actions_mapping": {
                                        "deconz": {
                                            "button_up_short": [
                                                "1002"
                                            ],
                                            "button_up_long": [
                                                "1001"
                                            ],
                                            "button_up_release": [
                                                "1003"
                                            ],
                                            "button_down_short": [
                                                "2002"
                                            ],
                                            "button_down_long": [
                                                "2001"
                                            ],
                                            "button_down_release": [
                                                "2003"
                                            ]
                                        },
                                        "zha": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "move_with_on_off_0_83"
                                            ],
                                            "button_up_release": [
                                                "stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "move_1_83"
                                            ],
                                            "button_down_release": [
                                                "stop"
                                            ]
                                        },
                                        "zigbee2mqtt": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "brightness_move_up"
                                            ],
                                            "button_up_release": [
                                                "brightness_stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "brightness_move_down"
                                            ],
                                            "button_down_release": [
                                                "brightness_stop"
                                            ]
                                        }
                                    },
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ],
                                    "integrations_with_prev_event_storage": [
                                        "zha",
                                        "zigbee2mqtt"
                                    ],
                                    "controller_entity": "",
                                    "controller_device": "0df2cd0b0fa9112188778c56db622911",
                                    "controller_id": "0df2cd0b0fa9112188778c56db622911"
                                }
                            }
                        ],
                        "condition/0": [
                            {
                                "path": "condition/0",
                                "timestamp": "2022-05-27T04:07:06.911796+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "condition/0/conditions/0": [
                            {
                                "path": "condition/0/conditions/0",
                                "timestamp": "2022-05-27T04:07:06.911847+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "condition/0/conditions/1": [
                            {
                                "path": "condition/0/conditions/1",
                                "timestamp": "2022-05-27T04:07:06.912105+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-05-27T04:07:06.914706+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "22054e870a0bfc8046cd421e0def0e4c",
                                        "parent_id": "9e6fb04daa719ee95eab80b9f927077b",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "delay": 0.0,
                                    "done": true
                                }
                            }
                        ],
                        "action/1": [
                            {
                                "path": "action/1",
                                "timestamp": "2022-05-27T04:07:06.919292+00:00"
                            }
                        ],
                        "action/2": [
                            {
                                "path": "action/2",
                                "timestamp": "2022-05-27T04:07:06.920461+00:00",
                                "changed_variables": {
                                    "trigger_action": "checkin",
                                    "trigger_delta": 3402372.351884842,
                                    "last_controller_event": "checkin"
                                },
                                "result": {
                                    "params": {
                                        "domain": "input_text",
                                        "service": "set_value",
                                        "service_data": {
                                            "entity_id": "input_text.zz_dining_room_lights_controller_1_last_event",
                                            "value": {
                                                "trigger_action": "checkin",
                                                "last_triggered": "2022-05-27 12:07:06.920612+08:00"
                                            }
                                        },
                                        "target": {}
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "action/3": [
                            {
                                "path": "action/3",
                                "timestamp": "2022-05-27T04:07:06.924011+00:00"
                            }
                        ],
                        "action/3/choose/0": [
                            {
                                "path": "action/3/choose/0",
                                "timestamp": "2022-05-27T04:07:06.925353+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/0/conditions/0": [
                            {
                                "path": "action/3/choose/0/conditions/0",
                                "timestamp": "2022-05-27T04:07:06.925428+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/1": [
                            {
                                "path": "action/3/choose/1",
                                "timestamp": "2022-05-27T04:07:06.925711+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/1/conditions/0": [
                            {
                                "path": "action/3/choose/1/conditions/0",
                                "timestamp": "2022-05-27T04:07:06.925749+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/2": [
                            {
                                "path": "action/3/choose/2",
                                "timestamp": "2022-05-27T04:07:06.925969+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/2/conditions/0": [
                            {
                                "path": "action/3/choose/2/conditions/0",
                                "timestamp": "2022-05-27T04:07:06.926011+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/3": [
                            {
                                "path": "action/3/choose/3",
                                "timestamp": "2022-05-27T04:07:06.926186+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/3/conditions/0": [
                            {
                                "path": "action/3/choose/3/conditions/0",
                                "timestamp": "2022-05-27T04:07:06.926228+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/4": [
                            {
                                "path": "action/3/choose/4",
                                "timestamp": "2022-05-27T04:07:06.926414+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/4/conditions/0": [
                            {
                                "path": "action/3/choose/4/conditions/0",
                                "timestamp": "2022-05-27T04:07:06.926455+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/5": [
                            {
                                "path": "action/3/choose/5",
                                "timestamp": "2022-05-27T04:07:06.926630+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/5/conditions/0": [
                            {
                                "path": "action/3/choose/5/conditions/0",
                                "timestamp": "2022-05-27T04:07:06.926674+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ]
                    },
                    "config": {
                        "variables": {
                            "integration": "ZHA",
                            "button_up_long_loop": true,
                            "button_up_long_max_loop_repeats": 50,
                            "button_up_double_press": false,
                            "button_down_long_loop": true,
                            "button_down_long_max_loop_repeats": 50,
                            "button_down_double_press": true,
                            "helper_last_controller_event": "input_text.zz_dining_room_lights_controller_1_last_event",
                            "helper_double_press_delay": 1000,
                            "helper_debounce_delay": 0,
                            "integration_id": "{{ integration | lower }}",
                            "adjusted_double_press_delay": "{{ [helper_double_press_delay - helper_debounce_delay, 100] | max }}",
                            "actions_mapping": {
                                "deconz": {
                                    "button_up_short": [
                                        "1002"
                                    ],
                                    "button_up_long": [
                                        "1001"
                                    ],
                                    "button_up_release": [
                                        "1003"
                                    ],
                                    "button_down_short": [
                                        "2002"
                                    ],
                                    "button_down_long": [
                                        "2001"
                                    ],
                                    "button_down_release": [
                                        "2003"
                                    ]
                                },
                                "zha": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ]
                                },
                                "zigbee2mqtt": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "brightness_move_up"
                                    ],
                                    "button_up_release": [
                                        "brightness_stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "brightness_move_down"
                                    ],
                                    "button_down_release": [
                                        "brightness_stop"
                                    ]
                                }
                            },
                            "button_up_short": "{{ actions_mapping[integration_id][\"button_up_short\"] }}",
                            "button_up_long": "{{ actions_mapping[integration_id][\"button_up_long\"] }}",
                            "button_up_release": "{{ actions_mapping[integration_id][\"button_up_release\"] }}",
                            "button_down_short": "{{ actions_mapping[integration_id][\"button_down_short\"] }}",
                            "button_down_long": "{{ actions_mapping[integration_id][\"button_down_long\"] }}",
                            "button_down_release": "{{ actions_mapping[integration_id][\"button_down_release\"] }}",
                            "integrations_with_prev_event_storage": [
                                "zha",
                                "zigbee2mqtt"
                            ],
                            "controller_entity": "",
                            "controller_device": "0df2cd0b0fa9112188778c56db622911",
                            "controller_id": "{% if integration_id==\"zigbee2mqtt\" %}{{controller_entity}}{% else %}{{controller_device}}{% endif %}"
                        },
                        "mode": "restart",
                        "max_exceeded": "silent",
                        "trigger": [
                            {
                                "platform": "event",
                                "event_type": "state_changed",
                                "event_data": {
                                    "entity_id": ""
                                }
                            },
                            {
                                "platform": "event",
                                "event_type": [
                                    "deconz_event",
                                    "zha_event"
                                ],
                                "event_data": {
                                    "device_id": "0df2cd0b0fa9112188778c56db622911"
                                }
                            }
                        ],
                        "condition": [
                            {
                                "condition": "and",
                                "conditions": [
                                    "{%- set trigger_action -%} {%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%} {%- endset -%} {{ trigger_action not in [\"\",\"None\"] }}",
                                    "{{ integration_id != \"zigbee2mqtt\" or trigger.event.data.new_state.state != trigger.event.data.old_state.state }}"
                                ]
                            }
                        ],
                        "action": [
                            {
                                "delay": {
                                    "milliseconds": 0
                                }
                            },
                            {
                                "variables": {
                                    "trigger_action": "{%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%}",
                                    "trigger_delta": "{{ (as_timestamp(now()) - as_timestamp((states(helper_last_controller_event) | from_json).last_triggered if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"1970-01-01 00:00:00\")) * 1000 }}",
                                    "last_controller_event": "{{ (states(helper_last_controller_event) | from_json).trigger_action if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"\" }}"
                                }
                            },
                            {
                                "service": "input_text.set_value",
                                "data": {
                                    "entity_id": "input_text.zz_dining_room_lights_controller_1_last_event",
                                    "value": "{{ {\"trigger_action\":trigger_action,\"last_triggered\":now()|string} | to_json }}"
                                }
                            },
                            {
                                "choose": [
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_dining_room_lights_controller_1_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_up_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_up_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "light.turn_on",
                                                                                        "target": {
                                                                                            "entity_id": [
                                                                                                "light.dining_room_lights",
                                                                                                "light.dining_room_pendant_light_entity"
                                                                                            ]
                                                                                        },
                                                                                        "data": {
                                                                                            "brightness_pct": 100
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_up_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "light.turn_on",
                                                                        "target": {
                                                                            "entity_id": [
                                                                                "light.dining_room_lights",
                                                                                "light.dining_room_pendant_light_entity"
                                                                            ]
                                                                        },
                                                                        "data": {
                                                                            "brightness_pct": 100
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_up_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "light.turn_on",
                                                                            "target": {
                                                                                "entity_id": [
                                                                                    "light.dining_room_lights",
                                                                                    "light.dining_room_pendant_light_entity"
                                                                                ]
                                                                            },
                                                                            "data": {
                                                                                "brightness_step_pct": 10
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": [
                                                                "light.dining_room_lights",
                                                                "light.dining_room_pendant_light_entity"
                                                            ]
                                                        },
                                                        "data": {
                                                            "brightness_step_pct": 10
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_up_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_up_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_dining_room_lights_controller_1_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_down_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": [
                                                                                            {
                                                                                                "service": "script.turn_off_all",
                                                                                                "data": {}
                                                                                            }
                                                                                        ]
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_down_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "light.turn_off",
                                                                                        "target": {
                                                                                            "entity_id": [
                                                                                                "light.dining_room_lights",
                                                                                                "light.dining_room_pendant_light_entity"
                                                                                            ]
                                                                                        },
                                                                                        "data": {}
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_down_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "light.turn_off",
                                                                        "target": {
                                                                            "entity_id": [
                                                                                "light.dining_room_lights",
                                                                                "light.dining_room_pendant_light_entity"
                                                                            ]
                                                                        },
                                                                        "data": {}
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_down_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "light.turn_on",
                                                                            "target": {
                                                                                "entity_id": [
                                                                                    "light.dining_room_lights",
                                                                                    "light.dining_room_pendant_light_entity"
                                                                                ]
                                                                            },
                                                                            "data": {
                                                                                "brightness_step_pct": -10
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": [
                                                                "light.dining_room_lights",
                                                                "light.dining_room_pendant_light_entity"
                                                            ]
                                                        },
                                                        "data": {
                                                            "brightness_step_pct": -10
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_down_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_down_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            }
                        ],
                        "id": "1643640720985",
                        "alias": "Dining Room Lights Controller 1",
                        "description": "Control the Dining Room Lights"
                    },
                    "blueprint_inputs": {
                        "id": "1643640720985",
                        "alias": "Dining Room Lights Controller 1",
                        "description": "Control the Dining Room Lights",
                        "use_blueprint": {
                            "path": "EPMatt/ikea_e1743.yaml",
                            "input": {
                                "integration": "ZHA",
                                "controller_device": "0df2cd0b0fa9112188778c56db622911",
                                "helper_last_controller_event": "input_text.zz_dining_room_lights_controller_1_last_event",
                                "action_button_up_short": [
                                    {
                                        "service": "light.turn_on",
                                        "target": {
                                            "entity_id": [
                                                "light.dining_room_lights",
                                                "light.dining_room_pendant_light_entity"
                                            ]
                                        },
                                        "data": {
                                            "brightness_pct": 100
                                        }
                                    }
                                ],
                                "action_button_up_long": [
                                    {
                                        "service": "light.turn_on",
                                        "target": {
                                            "entity_id": [
                                                "light.dining_room_lights",
                                                "light.dining_room_pendant_light_entity"
                                            ]
                                        },
                                        "data": {
                                            "brightness_step_pct": 10
                                        }
                                    }
                                ],
                                "action_button_down_short": [
                                    {
                                        "service": "light.turn_off",
                                        "target": {
                                            "entity_id": [
                                                "light.dining_room_lights",
                                                "light.dining_room_pendant_light_entity"
                                            ]
                                        },
                                        "data": {}
                                    }
                                ],
                                "action_button_down_long": [
                                    {
                                        "service": "light.turn_on",
                                        "target": {
                                            "entity_id": [
                                                "light.dining_room_lights",
                                                "light.dining_room_pendant_light_entity"
                                            ]
                                        },
                                        "data": {
                                            "brightness_step_pct": -10
                                        }
                                    }
                                ],
                                "button_up_long_loop": true,
                                "button_up_long_max_loop_repeats": 50,
                                "button_down_long_loop": true,
                                "button_down_long_max_loop_repeats": 50,
                                "action_button_down_double": [
                                    {
                                        "service": "script.turn_off_all",
                                        "data": {}
                                    }
                                ],
                                "button_down_double_press": true,
                                "helper_double_press_delay": 1000
                            }
                        }
                    },
                    "context": {
                        "id": "22054e870a0bfc8046cd421e0def0e4c",
                        "parent_id": "9e6fb04daa719ee95eab80b9f927077b",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "52069a2ce787f48305c95418fb19d697",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-05-27T04:07:06.910239+00:00",
                        "finish": "2022-05-27T04:07:06.928592+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643640720985",
                    "trigger": "event 'zha_event'"
                }
            }
        ],
        "automation.1643641285314": [
            {
                "extended_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "ed93f43e5cf95b0254e65b141cbf476e",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-05-27T04:07:42.477652+00:00",
                        "finish": "2022-05-27T04:07:42.494661+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643641285314",
                    "trigger": "event 'zha_event'",
                    "trace": {
                        "trigger/1": [
                            {
                                "path": "trigger/1",
                                "timestamp": "2022-05-27T04:07:42.478583+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.dining_room_lights_controller_2",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-05-27T03:10:55.576916+00:00",
                                            "mode": "restart",
                                            "current": 0,
                                            "id": "1643641285314",
                                            "friendly_name": "Dining Room Lights Controller 2"
                                        },
                                        "last_changed": "2022-05-27T04:05:22.468237+00:00",
                                        "last_updated": "2022-05-27T04:05:22.468237+00:00",
                                        "context": {
                                            "id": "efe4ba8037fef89a98b6fa57fcdb63a4",
                                            "parent_id": null,
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "1",
                                        "idx": "1",
                                        "platform": "event",
                                        "event": {
                                            "event_type": "zha_event",
                                            "data": {
                                                "device_ieee": "84:fd:27:ff:fe:95:bc:5c",
                                                "unique_id": "84:fd:27:ff:fe:95:bc:5c:1:0x0020",
                                                "device_id": "cea5083fc6a1972a0b57048ffa03cfd8",
                                                "endpoint_id": 1,
                                                "cluster_id": 32,
                                                "command": "checkin",
                                                "args": [],
                                                "params": {}
                                            },
                                            "origin": "LOCAL",
                                            "time_fired": "2022-05-27T04:07:42.476218+00:00",
                                            "context": {
                                                "id": "905c8488033e916022753a9d9e360fc8",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "description": "event 'zha_event'"
                                    },
                                    "integration": "ZHA",
                                    "button_up_long_loop": true,
                                    "button_up_long_max_loop_repeats": 50,
                                    "button_up_double_press": false,
                                    "button_down_long_loop": true,
                                    "button_down_long_max_loop_repeats": 50,
                                    "button_down_double_press": false,
                                    "helper_last_controller_event": "input_text.zz_dining_room_lights_controller_2_last_event",
                                    "helper_double_press_delay": 500,
                                    "helper_debounce_delay": 0,
                                    "integration_id": "zha",
                                    "adjusted_double_press_delay": 500,
                                    "actions_mapping": {
                                        "deconz": {
                                            "button_up_short": [
                                                "1002"
                                            ],
                                            "button_up_long": [
                                                "1001"
                                            ],
                                            "button_up_release": [
                                                "1003"
                                            ],
                                            "button_down_short": [
                                                "2002"
                                            ],
                                            "button_down_long": [
                                                "2001"
                                            ],
                                            "button_down_release": [
                                                "2003"
                                            ]
                                        },
                                        "zha": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "move_with_on_off_0_83"
                                            ],
                                            "button_up_release": [
                                                "stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "move_1_83"
                                            ],
                                            "button_down_release": [
                                                "stop"
                                            ]
                                        },
                                        "zigbee2mqtt": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "brightness_move_up"
                                            ],
                                            "button_up_release": [
                                                "brightness_stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "brightness_move_down"
                                            ],
                                            "button_down_release": [
                                                "brightness_stop"
                                            ]
                                        }
                                    },
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ],
                                    "integrations_with_prev_event_storage": [
                                        "zha",
                                        "zigbee2mqtt"
                                    ],
                                    "controller_entity": "",
                                    "controller_device": "cea5083fc6a1972a0b57048ffa03cfd8",
                                    "controller_id": "cea5083fc6a1972a0b57048ffa03cfd8"
                                }
                            }
                        ],
                        "condition/0": [
                            {
                                "path": "condition/0",
                                "timestamp": "2022-05-27T04:07:42.478615+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "condition/0/conditions/0": [
                            {
                                "path": "condition/0/conditions/0",
                                "timestamp": "2022-05-27T04:07:42.478635+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "condition/0/conditions/1": [
                            {
                                "path": "condition/0/conditions/1",
                                "timestamp": "2022-05-27T04:07:42.478814+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-05-27T04:07:42.481669+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "2771f6c738f8cbb6c9221e3cc2ba6a5d",
                                        "parent_id": "905c8488033e916022753a9d9e360fc8",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "delay": 0.0,
                                    "done": true
                                }
                            }
                        ],
                        "action/1": [
                            {
                                "path": "action/1",
                                "timestamp": "2022-05-27T04:07:42.485691+00:00"
                            }
                        ],
                        "action/2": [
                            {
                                "path": "action/2",
                                "timestamp": "2022-05-27T04:07:42.486636+00:00",
                                "changed_variables": {
                                    "trigger_action": "checkin",
                                    "trigger_delta": 3406905.375957489,
                                    "last_controller_event": "checkin"
                                },
                                "result": {
                                    "params": {
                                        "domain": "input_text",
                                        "service": "set_value",
                                        "service_data": {
                                            "entity_id": "input_text.zz_dining_room_lights_controller_2_last_event",
                                            "value": {
                                                "trigger_action": "checkin",
                                                "last_triggered": "2022-05-27 12:07:42.486784+08:00"
                                            }
                                        },
                                        "target": {}
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "action/3": [
                            {
                                "path": "action/3",
                                "timestamp": "2022-05-27T04:07:42.488741+00:00"
                            }
                        ],
                        "action/3/choose/0": [
                            {
                                "path": "action/3/choose/0",
                                "timestamp": "2022-05-27T04:07:42.489946+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/0/conditions/0": [
                            {
                                "path": "action/3/choose/0/conditions/0",
                                "timestamp": "2022-05-27T04:07:42.489999+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/1": [
                            {
                                "path": "action/3/choose/1",
                                "timestamp": "2022-05-27T04:07:42.490248+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/1/conditions/0": [
                            {
                                "path": "action/3/choose/1/conditions/0",
                                "timestamp": "2022-05-27T04:07:42.490290+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/2": [
                            {
                                "path": "action/3/choose/2",
                                "timestamp": "2022-05-27T04:07:42.490474+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/2/conditions/0": [
                            {
                                "path": "action/3/choose/2/conditions/0",
                                "timestamp": "2022-05-27T04:07:42.490531+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/3": [
                            {
                                "path": "action/3/choose/3",
                                "timestamp": "2022-05-27T04:07:42.490699+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/3/conditions/0": [
                            {
                                "path": "action/3/choose/3/conditions/0",
                                "timestamp": "2022-05-27T04:07:42.490739+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/4": [
                            {
                                "path": "action/3/choose/4",
                                "timestamp": "2022-05-27T04:07:42.490944+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/4/conditions/0": [
                            {
                                "path": "action/3/choose/4/conditions/0",
                                "timestamp": "2022-05-27T04:07:42.490988+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/5": [
                            {
                                "path": "action/3/choose/5",
                                "timestamp": "2022-05-27T04:07:42.491172+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/5/conditions/0": [
                            {
                                "path": "action/3/choose/5/conditions/0",
                                "timestamp": "2022-05-27T04:07:42.491214+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ]
                    },
                    "config": {
                        "variables": {
                            "integration": "ZHA",
                            "button_up_long_loop": true,
                            "button_up_long_max_loop_repeats": 50,
                            "button_up_double_press": false,
                            "button_down_long_loop": true,
                            "button_down_long_max_loop_repeats": 50,
                            "button_down_double_press": false,
                            "helper_last_controller_event": "input_text.zz_dining_room_lights_controller_2_last_event",
                            "helper_double_press_delay": 500,
                            "helper_debounce_delay": 0,
                            "integration_id": "{{ integration | lower }}",
                            "adjusted_double_press_delay": "{{ [helper_double_press_delay - helper_debounce_delay, 100] | max }}",
                            "actions_mapping": {
                                "deconz": {
                                    "button_up_short": [
                                        "1002"
                                    ],
                                    "button_up_long": [
                                        "1001"
                                    ],
                                    "button_up_release": [
                                        "1003"
                                    ],
                                    "button_down_short": [
                                        "2002"
                                    ],
                                    "button_down_long": [
                                        "2001"
                                    ],
                                    "button_down_release": [
                                        "2003"
                                    ]
                                },
                                "zha": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ]
                                },
                                "zigbee2mqtt": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "brightness_move_up"
                                    ],
                                    "button_up_release": [
                                        "brightness_stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "brightness_move_down"
                                    ],
                                    "button_down_release": [
                                        "brightness_stop"
                                    ]
                                }
                            },
                            "button_up_short": "{{ actions_mapping[integration_id][\"button_up_short\"] }}",
                            "button_up_long": "{{ actions_mapping[integration_id][\"button_up_long\"] }}",
                            "button_up_release": "{{ actions_mapping[integration_id][\"button_up_release\"] }}",
                            "button_down_short": "{{ actions_mapping[integration_id][\"button_down_short\"] }}",
                            "button_down_long": "{{ actions_mapping[integration_id][\"button_down_long\"] }}",
                            "button_down_release": "{{ actions_mapping[integration_id][\"button_down_release\"] }}",
                            "integrations_with_prev_event_storage": [
                                "zha",
                                "zigbee2mqtt"
                            ],
                            "controller_entity": "",
                            "controller_device": "cea5083fc6a1972a0b57048ffa03cfd8",
                            "controller_id": "{% if integration_id==\"zigbee2mqtt\" %}{{controller_entity}}{% else %}{{controller_device}}{% endif %}"
                        },
                        "mode": "restart",
                        "max_exceeded": "silent",
                        "trigger": [
                            {
                                "platform": "event",
                                "event_type": "state_changed",
                                "event_data": {
                                    "entity_id": ""
                                }
                            },
                            {
                                "platform": "event",
                                "event_type": [
                                    "deconz_event",
                                    "zha_event"
                                ],
                                "event_data": {
                                    "device_id": "cea5083fc6a1972a0b57048ffa03cfd8"
                                }
                            }
                        ],
                        "condition": [
                            {
                                "condition": "and",
                                "conditions": [
                                    "{%- set trigger_action -%} {%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%} {%- endset -%} {{ trigger_action not in [\"\",\"None\"] }}",
                                    "{{ integration_id != \"zigbee2mqtt\" or trigger.event.data.new_state.state != trigger.event.data.old_state.state }}"
                                ]
                            }
                        ],
                        "action": [
                            {
                                "delay": {
                                    "milliseconds": 0
                                }
                            },
                            {
                                "variables": {
                                    "trigger_action": "{%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%}",
                                    "trigger_delta": "{{ (as_timestamp(now()) - as_timestamp((states(helper_last_controller_event) | from_json).last_triggered if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"1970-01-01 00:00:00\")) * 1000 }}",
                                    "last_controller_event": "{{ (states(helper_last_controller_event) | from_json).trigger_action if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"\" }}"
                                }
                            },
                            {
                                "service": "input_text.set_value",
                                "data": {
                                    "entity_id": "input_text.zz_dining_room_lights_controller_2_last_event",
                                    "value": "{{ {\"trigger_action\":trigger_action,\"last_triggered\":now()|string} | to_json }}"
                                }
                            },
                            {
                                "choose": [
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_dining_room_lights_controller_2_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_up_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_up_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "choose": [
                                                                                            {
                                                                                                "conditions": [
                                                                                                    {
                                                                                                        "condition": "time",
                                                                                                        "after": "input_datetime.wind_down",
                                                                                                        "before": "input_datetime.lights_auto_control_end"
                                                                                                    }
                                                                                                ],
                                                                                                "sequence": [
                                                                                                    {
                                                                                                        "service": "light.turn_on",
                                                                                                        "target": {
                                                                                                            "entity_id": [
                                                                                                                "light.dining_room_lights",
                                                                                                                "light.dining_room_pendant_light_entity"
                                                                                                            ]
                                                                                                        },
                                                                                                        "data": {
                                                                                                            "brightness_pct": 5
                                                                                                        }
                                                                                                    }
                                                                                                ]
                                                                                            }
                                                                                        ],
                                                                                        "default": [
                                                                                            {
                                                                                                "service": "light.turn_on",
                                                                                                "target": {
                                                                                                    "entity_id": [
                                                                                                        "light.dining_room_lights",
                                                                                                        "light.dining_room_pendant_light_entity"
                                                                                                    ]
                                                                                                },
                                                                                                "data": {
                                                                                                    "brightness_pct": 98
                                                                                                }
                                                                                            }
                                                                                        ]
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_up_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [
                                                                                    {
                                                                                        "condition": "time",
                                                                                        "after": "input_datetime.wind_down",
                                                                                        "before": "input_datetime.lights_auto_control_end"
                                                                                    }
                                                                                ],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "light.turn_on",
                                                                                        "target": {
                                                                                            "entity_id": [
                                                                                                "light.dining_room_lights",
                                                                                                "light.dining_room_pendant_light_entity"
                                                                                            ]
                                                                                        },
                                                                                        "data": {
                                                                                            "brightness_pct": 5
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ],
                                                                        "default": [
                                                                            {
                                                                                "service": "light.turn_on",
                                                                                "target": {
                                                                                    "entity_id": [
                                                                                        "light.dining_room_lights",
                                                                                        "light.dining_room_pendant_light_entity"
                                                                                    ]
                                                                                },
                                                                                "data": {
                                                                                    "brightness_pct": 98
                                                                                }
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_up_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "light.turn_on",
                                                                            "target": {
                                                                                "entity_id": [
                                                                                    "light.dining_room_lights",
                                                                                    "light.dining_room_pendant_light_entity"
                                                                                ]
                                                                            },
                                                                            "data": {
                                                                                "brightness_step_pct": 10
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": [
                                                                "light.dining_room_lights",
                                                                "light.dining_room_pendant_light_entity"
                                                            ]
                                                        },
                                                        "data": {
                                                            "brightness_step_pct": 10
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_up_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_up_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_dining_room_lights_controller_2_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_down_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_down_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "light.turn_off",
                                                                                        "target": {
                                                                                            "entity_id": [
                                                                                                "light.dining_room_lights",
                                                                                                "light.dining_room_pendant_light_entity"
                                                                                            ]
                                                                                        },
                                                                                        "data": {}
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_down_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "light.turn_off",
                                                                        "target": {
                                                                            "entity_id": [
                                                                                "light.dining_room_lights",
                                                                                "light.dining_room_pendant_light_entity"
                                                                            ]
                                                                        },
                                                                        "data": {}
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_down_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "light.turn_on",
                                                                            "target": {
                                                                                "entity_id": [
                                                                                    "light.dining_room_lights",
                                                                                    "light.dining_room_pendant_light_entity"
                                                                                ]
                                                                            },
                                                                            "data": {
                                                                                "brightness_step_pct": -10
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": [
                                                                "light.dining_room_lights",
                                                                "light.dining_room_pendant_light_entity"
                                                            ]
                                                        },
                                                        "data": {
                                                            "brightness_step_pct": -10
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_down_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_down_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            }
                        ],
                        "id": "1643641285314",
                        "alias": "Dining Room Lights Controller 2",
                        "description": "Control the Dining Room Lights"
                    },
                    "blueprint_inputs": {
                        "id": "1643641285314",
                        "alias": "Dining Room Lights Controller 2",
                        "description": "Control the Dining Room Lights",
                        "use_blueprint": {
                            "path": "EPMatt/ikea_e1743.yaml",
                            "input": {
                                "integration": "ZHA",
                                "controller_device": "cea5083fc6a1972a0b57048ffa03cfd8",
                                "helper_last_controller_event": "input_text.zz_dining_room_lights_controller_2_last_event",
                                "action_button_up_short": [
                                    {
                                        "choose": [
                                            {
                                                "conditions": [
                                                    {
                                                        "condition": "time",
                                                        "after": "input_datetime.wind_down",
                                                        "before": "input_datetime.lights_auto_control_end"
                                                    }
                                                ],
                                                "sequence": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": [
                                                                "light.dining_room_lights",
                                                                "light.dining_room_pendant_light_entity"
                                                            ]
                                                        },
                                                        "data": {
                                                            "brightness_pct": 5
                                                        }
                                                    }
                                                ]
                                            }
                                        ],
                                        "default": [
                                            {
                                                "service": "light.turn_on",
                                                "target": {
                                                    "entity_id": [
                                                        "light.dining_room_lights",
                                                        "light.dining_room_pendant_light_entity"
                                                    ]
                                                },
                                                "data": {
                                                    "brightness_pct": 98
                                                }
                                            }
                                        ]
                                    }
                                ],
                                "action_button_up_long": [
                                    {
                                        "service": "light.turn_on",
                                        "target": {
                                            "entity_id": [
                                                "light.dining_room_lights",
                                                "light.dining_room_pendant_light_entity"
                                            ]
                                        },
                                        "data": {
                                            "brightness_step_pct": 10
                                        }
                                    }
                                ],
                                "action_button_down_short": [
                                    {
                                        "service": "light.turn_off",
                                        "target": {
                                            "entity_id": [
                                                "light.dining_room_lights",
                                                "light.dining_room_pendant_light_entity"
                                            ]
                                        },
                                        "data": {}
                                    }
                                ],
                                "action_button_down_long": [
                                    {
                                        "service": "light.turn_on",
                                        "target": {
                                            "entity_id": [
                                                "light.dining_room_lights",
                                                "light.dining_room_pendant_light_entity"
                                            ]
                                        },
                                        "data": {
                                            "brightness_step_pct": -10
                                        }
                                    }
                                ],
                                "button_up_long_max_loop_repeats": 50,
                                "button_down_long_max_loop_repeats": 50,
                                "button_down_long_loop": true,
                                "button_up_long_loop": true
                            }
                        }
                    },
                    "context": {
                        "id": "2771f6c738f8cbb6c9221e3cc2ba6a5d",
                        "parent_id": "905c8488033e916022753a9d9e360fc8",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "ed93f43e5cf95b0254e65b141cbf476e",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-05-27T04:07:42.477652+00:00",
                        "finish": "2022-05-27T04:07:42.494661+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643641285314",
                    "trigger": "event 'zha_event'"
                }
            }
        ]
    }
}