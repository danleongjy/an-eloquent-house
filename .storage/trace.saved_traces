{
    "version": 1,
    "minor_version": 1,
    "key": "trace.saved_traces",
    "data": {
        "automation.1643000778073": [
            {
                "extended_dict": {
                    "last_step": "action/0/choose/0/sequence/0",
                    "run_id": "1a8161d1193a322c0e0f4c7e1538ab35",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T00:43:16.265752+00:00",
                        "finish": "2022-03-03T00:43:16.773111+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643000778073",
                    "trigger": "state of fan.elenas_room_fan",
                    "trace": {
                        "trigger/0": [
                            {
                                "path": "trigger/0",
                                "timestamp": "2022-03-03T00:43:16.265825+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.elenas_room_fan_set_state",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T00:42:52.506758+00:00",
                                            "mode": "single",
                                            "current": 0,
                                            "id": "1643000778073",
                                            "friendly_name": "Elena's Room Fan Set State"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.797823+00:00",
                                        "last_updated": "2022-03-03T00:42:53.430783+00:00",
                                        "context": {
                                            "id": "90f2c7499a282fcfee1edee2aa02e505",
                                            "parent_id": "aac27d411c1835bfea87a6851f1d8703",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "power_off",
                                        "idx": "0",
                                        "platform": "state",
                                        "entity_id": "fan.elenas_room_fan",
                                        "from_state": {
                                            "entity_id": "fan.elenas_room_fan",
                                            "state": "on",
                                            "attributes": {
                                                "speed_list": [
                                                    "off",
                                                    "low",
                                                    "medium",
                                                    "high"
                                                ],
                                                "preset_modes": null,
                                                "speed": "medium",
                                                "percentage": 50,
                                                "percentage_step": 16.666666666666668,
                                                "preset_mode": null,
                                                "friendly_name": "Elena's Room Fan",
                                                "supported_features": 1
                                            },
                                            "last_changed": "2022-03-03T00:42:52.502547+00:00",
                                            "last_updated": "2022-03-03T00:42:52.511412+00:00",
                                            "context": {
                                                "id": "aac27d411c1835bfea87a6851f1d8703",
                                                "parent_id": "c754c8a1f40c237822098e8d3f475a27",
                                                "user_id": null
                                            }
                                        },
                                        "to_state": {
                                            "entity_id": "fan.elenas_room_fan",
                                            "state": "off",
                                            "attributes": {
                                                "speed_list": [
                                                    "off",
                                                    "low",
                                                    "medium",
                                                    "high"
                                                ],
                                                "preset_modes": null,
                                                "speed": "medium",
                                                "percentage": 50,
                                                "percentage_step": 16.666666666666668,
                                                "preset_mode": null,
                                                "friendly_name": "Elena's Room Fan",
                                                "supported_features": 1
                                            },
                                            "last_changed": "2022-03-03T00:43:16.263148+00:00",
                                            "last_updated": "2022-03-03T00:43:16.263148+00:00",
                                            "context": {
                                                "id": "d543117ad50afa81dbb9822987ec51f9",
                                                "parent_id": null,
                                                "user_id": "ad2bcce775894550affb6dfef93a2a36"
                                            }
                                        },
                                        "for": null,
                                        "attribute": null,
                                        "description": "state of fan.elenas_room_fan"
                                    }
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T00:43:16.267380+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "ad2f83707e1d815eafdf364f031cb3ad",
                                        "parent_id": "d543117ad50afa81dbb9822987ec51f9",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "choice": 0
                                }
                            }
                        ],
                        "action/0/choose/0": [
                            {
                                "path": "action/0/choose/0",
                                "timestamp": "2022-03-03T00:43:16.267439+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/0/conditions/0",
                                "timestamp": "2022-03-03T00:43:16.267458+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/0": [
                            {
                                "path": "action/0/choose/0/sequence/0",
                                "timestamp": "2022-03-03T00:43:16.268620+00:00",
                                "child_id": {
                                    "domain": "script",
                                    "item_id": "1642846136869",
                                    "run_id": "a8c4eb7ce02a973f3ac146a797dcd32f"
                                },
                                "result": {
                                    "params": {
                                        "domain": "script",
                                        "service": "1642846136869",
                                        "service_data": {
                                            "target_fan": "Elena's Room Fan",
                                            "target_fan_power": false
                                        },
                                        "target": {}
                                    },
                                    "running_script": true,
                                    "limit": null
                                }
                            }
                        ]
                    },
                    "config": {
                        "id": "1643000778073",
                        "alias": "Elena's Room Fan Set State",
                        "description": "Set Elena's Room Fan power and speed",
                        "trigger": [
                            {
                                "platform": "state",
                                "entity_id": "fan.elenas_room_fan",
                                "id": "power_off",
                                "from": "on",
                                "to": "off"
                            },
                            {
                                "platform": "state",
                                "entity_id": "fan.elenas_room_fan",
                                "id": "power_on",
                                "from": "off",
                                "to": "on"
                            },
                            {
                                "platform": "state",
                                "entity_id": "fan.elenas_room_fan",
                                "id": "speed",
                                "attribute": "percentage"
                            }
                        ],
                        "condition": [],
                        "action": [
                            {
                                "choose": [
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "power_off"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "script.1642846136869",
                                                "data": {
                                                    "target_fan": "Elena's Room Fan",
                                                    "target_fan_power": false
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "power_on"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "fan.set_percentage",
                                                "data": {
                                                    "percentage": "{{ state_attr('binary_sensor.recommended_scene_in_elenas_room', 'fan_speed') | int }}\n"
                                                },
                                                "target": {
                                                    "entity_id": "fan.elenas_room_fan"
                                                }
                                            },
                                            {
                                                "delay": {
                                                    "hours": 0,
                                                    "minutes": 0,
                                                    "seconds": 0,
                                                    "milliseconds": 20
                                                }
                                            },
                                            {
                                                "service": "script.1642846136869",
                                                "data": {
                                                    "target_fan": "Elena's Room Fan",
                                                    "target_fan_speed": "{{ state_attr(\"fan.elenas_room_fan\", \"percentage\") }}"
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "speed"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [
                                                            {
                                                                "condition": "numeric_state",
                                                                "entity_id": "fan.elenas_room_fan",
                                                                "attribute": "percentage",
                                                                "below": "10"
                                                            }
                                                        ],
                                                        "sequence": [
                                                            {
                                                                "service": "fan.turn_off",
                                                                "data": {},
                                                                "target": {
                                                                    "entity_id": "fan.elenas_room_fan"
                                                                }
                                                            },
                                                            {
                                                                "service": "script.1642846136869",
                                                                "data": {
                                                                    "target_fan": "Elena's Room Fan",
                                                                    "target_fan_power": false
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "script.1642846136869",
                                                        "data": {
                                                            "target_fan": "Elena's Room Fan",
                                                            "target_fan_power": true,
                                                            "target_fan_speed": "{{ state_attr(\"fan.elenas_room_fan\", \"percentage\") }}"
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ],
                                "default": []
                            }
                        ],
                        "mode": "single",
                        "max_exceeded": "silent"
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "ad2f83707e1d815eafdf364f031cb3ad",
                        "parent_id": "d543117ad50afa81dbb9822987ec51f9",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/0/choose/0/sequence/0",
                    "run_id": "1a8161d1193a322c0e0f4c7e1538ab35",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T00:43:16.265752+00:00",
                        "finish": "2022-03-03T00:43:16.773111+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643000778073",
                    "trigger": "state of fan.elenas_room_fan"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/0/choose/2/sequence/0/default/0",
                    "run_id": "ffb94f035f1b7acea262d220c3fa2a7d",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T00:48:35.590070+00:00",
                        "finish": "2022-03-03T00:48:36.522829+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643000778073",
                    "trigger": "state of fan.elenas_room_fan",
                    "trace": {
                        "trigger/2": [
                            {
                                "path": "trigger/2",
                                "timestamp": "2022-03-03T00:48:35.590112+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.elenas_room_fan_set_state",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T00:43:16.265940+00:00",
                                            "mode": "single",
                                            "current": 0,
                                            "id": "1643000778073",
                                            "friendly_name": "Elena's Room Fan Set State"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.797823+00:00",
                                        "last_updated": "2022-03-03T00:43:16.772092+00:00",
                                        "context": {
                                            "id": "ad2f83707e1d815eafdf364f031cb3ad",
                                            "parent_id": "d543117ad50afa81dbb9822987ec51f9",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "speed",
                                        "idx": "2",
                                        "platform": "state",
                                        "entity_id": "fan.elenas_room_fan",
                                        "from_state": {
                                            "entity_id": "fan.elenas_room_fan",
                                            "state": "off",
                                            "attributes": {
                                                "speed_list": [
                                                    "off",
                                                    "low",
                                                    "medium",
                                                    "high"
                                                ],
                                                "preset_modes": null,
                                                "speed": "medium",
                                                "percentage": 50,
                                                "percentage_step": 16.666666666666668,
                                                "preset_mode": null,
                                                "friendly_name": "Elena's Room Fan",
                                                "supported_features": 1
                                            },
                                            "last_changed": "2022-03-03T00:43:16.263148+00:00",
                                            "last_updated": "2022-03-03T00:43:16.263148+00:00",
                                            "context": {
                                                "id": "d543117ad50afa81dbb9822987ec51f9",
                                                "parent_id": null,
                                                "user_id": "ad2bcce775894550affb6dfef93a2a36"
                                            }
                                        },
                                        "to_state": {
                                            "entity_id": "fan.elenas_room_fan",
                                            "state": "unavailable",
                                            "attributes": {
                                                "restored": true,
                                                "speed_list": [
                                                    "off",
                                                    "low",
                                                    "medium",
                                                    "high"
                                                ],
                                                "preset_modes": null,
                                                "friendly_name": "Elena's Room Fan",
                                                "supported_features": 1
                                            },
                                            "last_changed": "2022-03-03T00:48:35.579760+00:00",
                                            "last_updated": "2022-03-03T00:48:35.579760+00:00",
                                            "context": {
                                                "id": "f3071c487796b4489dd0fc0fc26a62dd",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "for": null,
                                        "attribute": "percentage",
                                        "description": "state of fan.elenas_room_fan"
                                    }
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T00:48:35.592545+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "29bbc627da9466f2ec8c3f2ea54b280a",
                                        "parent_id": "f3071c487796b4489dd0fc0fc26a62dd",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "choice": 2
                                }
                            }
                        ],
                        "action/0/choose/0": [
                            {
                                "path": "action/0/choose/0",
                                "timestamp": "2022-03-03T00:48:35.592595+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/0/conditions/0",
                                "timestamp": "2022-03-03T00:48:35.592616+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/1": [
                            {
                                "path": "action/0/choose/1",
                                "timestamp": "2022-03-03T00:48:35.592654+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/1/conditions/0": [
                            {
                                "path": "action/0/choose/1/conditions/0",
                                "timestamp": "2022-03-03T00:48:35.592668+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/2": [
                            {
                                "path": "action/0/choose/2",
                                "timestamp": "2022-03-03T00:48:35.592723+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/2/conditions/0": [
                            {
                                "path": "action/0/choose/2/conditions/0",
                                "timestamp": "2022-03-03T00:48:35.592741+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/2/sequence/0": [
                            {
                                "path": "action/0/choose/2/sequence/0",
                                "timestamp": "2022-03-03T00:48:35.598355+00:00",
                                "result": {
                                    "choice": "default"
                                }
                            }
                        ],
                        "action/0/choose/2/sequence/0/choose/0": [
                            {
                                "path": "action/0/choose/2/sequence/0/choose/0",
                                "timestamp": "2022-03-03T00:48:35.598405+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/2/sequence/0/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/2/sequence/0/choose/0/conditions/0",
                                "timestamp": "2022-03-03T00:48:35.598423+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/2/sequence/0/choose/0/conditions/0/entity_id/0": [
                            {
                                "path": "action/0/choose/2/sequence/0/choose/0/conditions/0/entity_id/0",
                                "timestamp": "2022-03-03T00:48:35.598437+00:00",
                                "result": {
                                    "result": false,
                                    "message": "attribute 'percentage' of entity fan.elenas_room_fan does not exist"
                                }
                            }
                        ],
                        "action/0/choose/2/sequence/0/default/0": [
                            {
                                "path": "action/0/choose/2/sequence/0/default/0",
                                "timestamp": "2022-03-03T00:48:35.603480+00:00",
                                "child_id": {
                                    "domain": "script",
                                    "item_id": "1642846136869",
                                    "run_id": "50e5169678a71e78d54173d08a3b8165"
                                },
                                "result": {
                                    "params": {
                                        "domain": "script",
                                        "service": "1642846136869",
                                        "service_data": {
                                            "target_fan": "Elena's Room Fan",
                                            "target_fan_power": true,
                                            "target_fan_speed": 50
                                        },
                                        "target": {}
                                    },
                                    "running_script": true,
                                    "limit": null
                                }
                            }
                        ]
                    },
                    "config": {
                        "id": "1643000778073",
                        "alias": "Elena's Room Fan Set State",
                        "description": "Set Elena's Room Fan power and speed",
                        "trigger": [
                            {
                                "platform": "state",
                                "entity_id": "fan.elenas_room_fan",
                                "id": "power_off",
                                "from": "on",
                                "to": "off"
                            },
                            {
                                "platform": "state",
                                "entity_id": "fan.elenas_room_fan",
                                "id": "power_on",
                                "from": "off",
                                "to": "on"
                            },
                            {
                                "platform": "state",
                                "entity_id": "fan.elenas_room_fan",
                                "id": "speed",
                                "attribute": "percentage"
                            }
                        ],
                        "condition": [],
                        "action": [
                            {
                                "choose": [
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "power_off"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "script.1642846136869",
                                                "data": {
                                                    "target_fan": "Elena's Room Fan",
                                                    "target_fan_power": false
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "power_on"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "fan.set_percentage",
                                                "data": {
                                                    "percentage": "{{ state_attr('binary_sensor.recommended_scene_in_elenas_room', 'fan_speed') | int }}\n"
                                                },
                                                "target": {
                                                    "entity_id": "fan.elenas_room_fan"
                                                }
                                            },
                                            {
                                                "delay": {
                                                    "hours": 0,
                                                    "minutes": 0,
                                                    "seconds": 0,
                                                    "milliseconds": 20
                                                }
                                            },
                                            {
                                                "service": "script.1642846136869",
                                                "data": {
                                                    "target_fan": "Elena's Room Fan",
                                                    "target_fan_speed": "{{ state_attr(\"fan.elenas_room_fan\", \"percentage\") }}"
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "speed"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [
                                                            {
                                                                "condition": "numeric_state",
                                                                "entity_id": "fan.elenas_room_fan",
                                                                "attribute": "percentage",
                                                                "below": "10"
                                                            }
                                                        ],
                                                        "sequence": [
                                                            {
                                                                "service": "fan.turn_off",
                                                                "data": {},
                                                                "target": {
                                                                    "entity_id": "fan.elenas_room_fan"
                                                                }
                                                            },
                                                            {
                                                                "service": "script.1642846136869",
                                                                "data": {
                                                                    "target_fan": "Elena's Room Fan",
                                                                    "target_fan_power": false
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "script.1642846136869",
                                                        "data": {
                                                            "target_fan": "Elena's Room Fan",
                                                            "target_fan_power": true,
                                                            "target_fan_speed": "{{ state_attr(\"fan.elenas_room_fan\", \"percentage\") }}"
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ],
                                "default": []
                            }
                        ],
                        "mode": "single",
                        "max_exceeded": "silent"
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "29bbc627da9466f2ec8c3f2ea54b280a",
                        "parent_id": "f3071c487796b4489dd0fc0fc26a62dd",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/0/choose/2/sequence/0/default/0",
                    "run_id": "ffb94f035f1b7acea262d220c3fa2a7d",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T00:48:35.590070+00:00",
                        "finish": "2022-03-03T00:48:36.522829+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643000778073",
                    "trigger": "state of fan.elenas_room_fan"
                }
            },
            {
                "extended_dict": {
                    "last_step": "trigger/2",
                    "run_id": "d9ab1e0cd03f493e70d20653b4ea8849",
                    "state": "stopped",
                    "script_execution": "failed_single",
                    "timestamp": {
                        "start": "2022-03-03T00:48:35.609401+00:00",
                        "finish": "2022-03-03T00:48:35.609477+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643000778073",
                    "trigger": "state of fan.elenas_room_fan",
                    "trace": {
                        "trigger/2": [
                            {
                                "path": "trigger/2",
                                "timestamp": "2022-03-03T00:48:35.609448+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.elenas_room_fan_set_state",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T00:48:35.590183+00:00",
                                            "mode": "single",
                                            "current": 1,
                                            "id": "1643000778073",
                                            "friendly_name": "Elena's Room Fan Set State"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.797823+00:00",
                                        "last_updated": "2022-03-03T00:48:35.590209+00:00",
                                        "context": {
                                            "id": "29bbc627da9466f2ec8c3f2ea54b280a",
                                            "parent_id": "f3071c487796b4489dd0fc0fc26a62dd",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "speed",
                                        "idx": "2",
                                        "platform": "state",
                                        "entity_id": "fan.elenas_room_fan",
                                        "from_state": {
                                            "entity_id": "fan.elenas_room_fan",
                                            "state": "unavailable",
                                            "attributes": {
                                                "restored": true,
                                                "speed_list": [
                                                    "off",
                                                    "low",
                                                    "medium",
                                                    "high"
                                                ],
                                                "preset_modes": null,
                                                "friendly_name": "Elena's Room Fan",
                                                "supported_features": 1
                                            },
                                            "last_changed": "2022-03-03T00:48:35.579760+00:00",
                                            "last_updated": "2022-03-03T00:48:35.579760+00:00",
                                            "context": {
                                                "id": "f3071c487796b4489dd0fc0fc26a62dd",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "to_state": {
                                            "entity_id": "fan.elenas_room_fan",
                                            "state": "off",
                                            "attributes": {
                                                "speed_list": [
                                                    "off",
                                                    "low",
                                                    "medium",
                                                    "high"
                                                ],
                                                "preset_modes": null,
                                                "speed": "medium",
                                                "percentage": 50,
                                                "percentage_step": 16.666666666666668,
                                                "preset_mode": null,
                                                "friendly_name": "Elena's Room Fan",
                                                "supported_features": 1
                                            },
                                            "last_changed": "2022-03-03T00:48:35.602997+00:00",
                                            "last_updated": "2022-03-03T00:48:35.602997+00:00",
                                            "context": {
                                                "id": "8186c40a0d0006dfa58812706fd405a5",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "for": null,
                                        "attribute": "percentage",
                                        "description": "state of fan.elenas_room_fan"
                                    }
                                }
                            }
                        ]
                    },
                    "config": {
                        "id": "1643000778073",
                        "alias": "Elena's Room Fan Set State",
                        "description": "Set Elena's Room Fan power and speed",
                        "trigger": [
                            {
                                "platform": "state",
                                "entity_id": "fan.elenas_room_fan",
                                "id": "power_off",
                                "from": "on",
                                "to": "off"
                            },
                            {
                                "platform": "state",
                                "entity_id": "fan.elenas_room_fan",
                                "id": "power_on",
                                "from": "off",
                                "to": "on"
                            },
                            {
                                "platform": "state",
                                "entity_id": "fan.elenas_room_fan",
                                "id": "speed",
                                "attribute": "percentage"
                            }
                        ],
                        "condition": [],
                        "action": [
                            {
                                "choose": [
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "power_off"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "script.1642846136869",
                                                "data": {
                                                    "target_fan": "Elena's Room Fan",
                                                    "target_fan_power": false
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "power_on"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "fan.set_percentage",
                                                "data": {
                                                    "percentage": "{{ state_attr('binary_sensor.recommended_scene_in_elenas_room', 'fan_speed') | int }}\n"
                                                },
                                                "target": {
                                                    "entity_id": "fan.elenas_room_fan"
                                                }
                                            },
                                            {
                                                "delay": {
                                                    "hours": 0,
                                                    "minutes": 0,
                                                    "seconds": 0,
                                                    "milliseconds": 20
                                                }
                                            },
                                            {
                                                "service": "script.1642846136869",
                                                "data": {
                                                    "target_fan": "Elena's Room Fan",
                                                    "target_fan_speed": "{{ state_attr(\"fan.elenas_room_fan\", \"percentage\") }}"
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "speed"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [
                                                            {
                                                                "condition": "numeric_state",
                                                                "entity_id": "fan.elenas_room_fan",
                                                                "attribute": "percentage",
                                                                "below": "10"
                                                            }
                                                        ],
                                                        "sequence": [
                                                            {
                                                                "service": "fan.turn_off",
                                                                "data": {},
                                                                "target": {
                                                                    "entity_id": "fan.elenas_room_fan"
                                                                }
                                                            },
                                                            {
                                                                "service": "script.1642846136869",
                                                                "data": {
                                                                    "target_fan": "Elena's Room Fan",
                                                                    "target_fan_power": false
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "script.1642846136869",
                                                        "data": {
                                                            "target_fan": "Elena's Room Fan",
                                                            "target_fan_power": true,
                                                            "target_fan_speed": "{{ state_attr(\"fan.elenas_room_fan\", \"percentage\") }}"
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ],
                                "default": []
                            }
                        ],
                        "mode": "single",
                        "max_exceeded": "silent"
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "534753c4908653a76938c05247211d36",
                        "parent_id": "8186c40a0d0006dfa58812706fd405a5",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "trigger/2",
                    "run_id": "d9ab1e0cd03f493e70d20653b4ea8849",
                    "state": "stopped",
                    "script_execution": "failed_single",
                    "timestamp": {
                        "start": "2022-03-03T00:48:35.609401+00:00",
                        "finish": "2022-03-03T00:48:35.609477+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643000778073",
                    "trigger": "state of fan.elenas_room_fan"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/0/choose/1/sequence/2",
                    "run_id": "ef624077c288e91aa57359d0e573b0f6",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T00:48:54.116296+00:00",
                        "finish": "2022-03-03T00:48:55.037230+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643000778073",
                    "trigger": "state of fan.elenas_room_fan",
                    "trace": {
                        "trigger/1": [
                            {
                                "path": "trigger/1",
                                "timestamp": "2022-03-03T00:48:54.116352+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.elenas_room_fan_set_state",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T00:48:35.590183+00:00",
                                            "mode": "single",
                                            "current": 0,
                                            "id": "1643000778073",
                                            "friendly_name": "Elena's Room Fan Set State"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.797823+00:00",
                                        "last_updated": "2022-03-03T00:48:36.521045+00:00",
                                        "context": {
                                            "id": "534753c4908653a76938c05247211d36",
                                            "parent_id": "8186c40a0d0006dfa58812706fd405a5",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "power_on",
                                        "idx": "1",
                                        "platform": "state",
                                        "entity_id": "fan.elenas_room_fan",
                                        "from_state": {
                                            "entity_id": "fan.elenas_room_fan",
                                            "state": "off",
                                            "attributes": {
                                                "speed_list": [
                                                    "off",
                                                    "low",
                                                    "medium",
                                                    "high"
                                                ],
                                                "preset_modes": null,
                                                "speed": "medium",
                                                "percentage": 50,
                                                "percentage_step": 16.666666666666668,
                                                "preset_mode": null,
                                                "friendly_name": "Elena's Room Fan",
                                                "supported_features": 1
                                            },
                                            "last_changed": "2022-03-03T00:48:35.602997+00:00",
                                            "last_updated": "2022-03-03T00:48:35.602997+00:00",
                                            "context": {
                                                "id": "8186c40a0d0006dfa58812706fd405a5",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "to_state": {
                                            "entity_id": "fan.elenas_room_fan",
                                            "state": "on",
                                            "attributes": {
                                                "speed_list": [
                                                    "off",
                                                    "low",
                                                    "medium",
                                                    "high"
                                                ],
                                                "preset_modes": null,
                                                "speed": "medium",
                                                "percentage": 50,
                                                "percentage_step": 16.666666666666668,
                                                "preset_mode": null,
                                                "friendly_name": "Elena's Room Fan",
                                                "supported_features": 1
                                            },
                                            "last_changed": "2022-03-03T00:48:54.113850+00:00",
                                            "last_updated": "2022-03-03T00:48:54.113850+00:00",
                                            "context": {
                                                "id": "432e7b874f0cc9c9f8be7530886685a6",
                                                "parent_id": null,
                                                "user_id": "ad2bcce775894550affb6dfef93a2a36"
                                            }
                                        },
                                        "for": null,
                                        "attribute": null,
                                        "description": "state of fan.elenas_room_fan"
                                    }
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T00:48:54.118072+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "830e93b2b982695253bb9b36bcf45f99",
                                        "parent_id": "432e7b874f0cc9c9f8be7530886685a6",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "choice": 1
                                }
                            }
                        ],
                        "action/0/choose/0": [
                            {
                                "path": "action/0/choose/0",
                                "timestamp": "2022-03-03T00:48:54.118120+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/0/conditions/0",
                                "timestamp": "2022-03-03T00:48:54.118139+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/1": [
                            {
                                "path": "action/0/choose/1",
                                "timestamp": "2022-03-03T00:48:54.118172+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/1/conditions/0": [
                            {
                                "path": "action/0/choose/1/conditions/0",
                                "timestamp": "2022-03-03T00:48:54.118186+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/1/sequence/0": [
                            {
                                "path": "action/0/choose/1/sequence/0",
                                "timestamp": "2022-03-03T00:48:54.119809+00:00",
                                "result": {
                                    "params": {
                                        "domain": "fan",
                                        "service": "set_percentage",
                                        "service_data": {
                                            "percentage": 50,
                                            "entity_id": [
                                                "fan.elenas_room_fan"
                                            ]
                                        },
                                        "target": {
                                            "entity_id": [
                                                "fan.elenas_room_fan"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "action/0/choose/1/sequence/0/0": [
                            {
                                "path": "action/0/choose/1/sequence/0/0",
                                "timestamp": "2022-03-03T00:48:54.120947+00:00",
                                "changed_variables": {
                                    "percentage": 50
                                },
                                "result": {
                                    "params": {
                                        "domain": "input_number",
                                        "service": "set_value",
                                        "service_data": {
                                            "value": 50,
                                            "entity_id": [
                                                "input_number.elenas_room_fan_speed"
                                            ]
                                        },
                                        "target": {
                                            "entity_id": [
                                                "input_number.elenas_room_fan_speed"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "action/0/choose/1/sequence/1": [
                            {
                                "path": "action/0/choose/1/sequence/1",
                                "timestamp": "2022-03-03T00:48:54.122448+00:00",
                                "result": {
                                    "delay": 0.02,
                                    "done": true
                                }
                            }
                        ],
                        "action/0/choose/1/sequence/2": [
                            {
                                "path": "action/0/choose/1/sequence/2",
                                "timestamp": "2022-03-03T00:48:54.142895+00:00",
                                "child_id": {
                                    "domain": "script",
                                    "item_id": "1642846136869",
                                    "run_id": "b76edf2c611ba4782488e53c475e1796"
                                },
                                "result": {
                                    "params": {
                                        "domain": "script",
                                        "service": "1642846136869",
                                        "service_data": {
                                            "target_fan": "Elena's Room Fan",
                                            "target_fan_speed": 50
                                        },
                                        "target": {}
                                    },
                                    "running_script": true,
                                    "limit": null
                                }
                            }
                        ]
                    },
                    "config": {
                        "id": "1643000778073",
                        "alias": "Elena's Room Fan Set State",
                        "description": "Set Elena's Room Fan power and speed",
                        "trigger": [
                            {
                                "platform": "state",
                                "entity_id": "fan.elenas_room_fan",
                                "id": "power_off",
                                "from": "on",
                                "to": "off"
                            },
                            {
                                "platform": "state",
                                "entity_id": "fan.elenas_room_fan",
                                "id": "power_on",
                                "from": "off",
                                "to": "on"
                            },
                            {
                                "platform": "state",
                                "entity_id": "fan.elenas_room_fan",
                                "id": "speed",
                                "attribute": "percentage"
                            }
                        ],
                        "condition": [],
                        "action": [
                            {
                                "choose": [
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "power_off"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "script.1642846136869",
                                                "data": {
                                                    "target_fan": "Elena's Room Fan",
                                                    "target_fan_power": false
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "power_on"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "fan.set_percentage",
                                                "data": {
                                                    "percentage": "{{ state_attr('binary_sensor.recommended_scene_in_elenas_room', 'fan_speed') | int }}\n"
                                                },
                                                "target": {
                                                    "entity_id": "fan.elenas_room_fan"
                                                }
                                            },
                                            {
                                                "delay": {
                                                    "hours": 0,
                                                    "minutes": 0,
                                                    "seconds": 0,
                                                    "milliseconds": 20
                                                }
                                            },
                                            {
                                                "service": "script.1642846136869",
                                                "data": {
                                                    "target_fan": "Elena's Room Fan",
                                                    "target_fan_speed": "{{ state_attr(\"fan.elenas_room_fan\", \"percentage\") }}"
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "speed"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [
                                                            {
                                                                "condition": "numeric_state",
                                                                "entity_id": "fan.elenas_room_fan",
                                                                "attribute": "percentage",
                                                                "below": "10"
                                                            }
                                                        ],
                                                        "sequence": [
                                                            {
                                                                "service": "fan.turn_off",
                                                                "data": {},
                                                                "target": {
                                                                    "entity_id": "fan.elenas_room_fan"
                                                                }
                                                            },
                                                            {
                                                                "service": "script.1642846136869",
                                                                "data": {
                                                                    "target_fan": "Elena's Room Fan",
                                                                    "target_fan_power": false
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "script.1642846136869",
                                                        "data": {
                                                            "target_fan": "Elena's Room Fan",
                                                            "target_fan_power": true,
                                                            "target_fan_speed": "{{ state_attr(\"fan.elenas_room_fan\", \"percentage\") }}"
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ],
                                "default": []
                            }
                        ],
                        "mode": "single",
                        "max_exceeded": "silent"
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "830e93b2b982695253bb9b36bcf45f99",
                        "parent_id": "432e7b874f0cc9c9f8be7530886685a6",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/0/choose/1/sequence/2",
                    "run_id": "ef624077c288e91aa57359d0e573b0f6",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T00:48:54.116296+00:00",
                        "finish": "2022-03-03T00:48:55.037230+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643000778073",
                    "trigger": "state of fan.elenas_room_fan"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/0/choose/0/sequence/0",
                    "run_id": "a8ba28d8cd65798fbcd405f370bad0dd",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T00:49:05.437803+00:00",
                        "finish": "2022-03-03T00:49:06.335900+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643000778073",
                    "trigger": "state of fan.elenas_room_fan",
                    "trace": {
                        "trigger/0": [
                            {
                                "path": "trigger/0",
                                "timestamp": "2022-03-03T00:49:05.437850+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.elenas_room_fan_set_state",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T00:48:54.116472+00:00",
                                            "mode": "single",
                                            "current": 0,
                                            "id": "1643000778073",
                                            "friendly_name": "Elena's Room Fan Set State"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.797823+00:00",
                                        "last_updated": "2022-03-03T00:48:55.036558+00:00",
                                        "context": {
                                            "id": "830e93b2b982695253bb9b36bcf45f99",
                                            "parent_id": "432e7b874f0cc9c9f8be7530886685a6",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "power_off",
                                        "idx": "0",
                                        "platform": "state",
                                        "entity_id": "fan.elenas_room_fan",
                                        "from_state": {
                                            "entity_id": "fan.elenas_room_fan",
                                            "state": "on",
                                            "attributes": {
                                                "speed_list": [
                                                    "off",
                                                    "low",
                                                    "medium",
                                                    "high"
                                                ],
                                                "preset_modes": null,
                                                "speed": "medium",
                                                "percentage": 50,
                                                "percentage_step": 16.666666666666668,
                                                "preset_mode": null,
                                                "friendly_name": "Elena's Room Fan",
                                                "supported_features": 1
                                            },
                                            "last_changed": "2022-03-03T00:48:54.113850+00:00",
                                            "last_updated": "2022-03-03T00:48:54.113850+00:00",
                                            "context": {
                                                "id": "432e7b874f0cc9c9f8be7530886685a6",
                                                "parent_id": null,
                                                "user_id": "ad2bcce775894550affb6dfef93a2a36"
                                            }
                                        },
                                        "to_state": {
                                            "entity_id": "fan.elenas_room_fan",
                                            "state": "off",
                                            "attributes": {
                                                "speed_list": [
                                                    "off",
                                                    "low",
                                                    "medium",
                                                    "high"
                                                ],
                                                "preset_modes": null,
                                                "speed": "medium",
                                                "percentage": 50,
                                                "percentage_step": 16.666666666666668,
                                                "preset_mode": null,
                                                "friendly_name": "Elena's Room Fan",
                                                "supported_features": 1
                                            },
                                            "last_changed": "2022-03-03T00:49:05.434755+00:00",
                                            "last_updated": "2022-03-03T00:49:05.434755+00:00",
                                            "context": {
                                                "id": "02909dc07e5b138cddc8677b8d9361fd",
                                                "parent_id": null,
                                                "user_id": "ad2bcce775894550affb6dfef93a2a36"
                                            }
                                        },
                                        "for": null,
                                        "attribute": null,
                                        "description": "state of fan.elenas_room_fan"
                                    }
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T00:49:05.439151+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "d82d8cfdd92f30ea6ee3855313350e1a",
                                        "parent_id": "02909dc07e5b138cddc8677b8d9361fd",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "choice": 0
                                }
                            }
                        ],
                        "action/0/choose/0": [
                            {
                                "path": "action/0/choose/0",
                                "timestamp": "2022-03-03T00:49:05.439196+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/0/conditions/0",
                                "timestamp": "2022-03-03T00:49:05.439244+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/0": [
                            {
                                "path": "action/0/choose/0/sequence/0",
                                "timestamp": "2022-03-03T00:49:05.440673+00:00",
                                "child_id": {
                                    "domain": "script",
                                    "item_id": "1642846136869",
                                    "run_id": "8ce00a9db31cdc9d4c797cde3f02828d"
                                },
                                "result": {
                                    "params": {
                                        "domain": "script",
                                        "service": "1642846136869",
                                        "service_data": {
                                            "target_fan": "Elena's Room Fan",
                                            "target_fan_power": false
                                        },
                                        "target": {}
                                    },
                                    "running_script": true,
                                    "limit": null
                                }
                            }
                        ]
                    },
                    "config": {
                        "id": "1643000778073",
                        "alias": "Elena's Room Fan Set State",
                        "description": "Set Elena's Room Fan power and speed",
                        "trigger": [
                            {
                                "platform": "state",
                                "entity_id": "fan.elenas_room_fan",
                                "id": "power_off",
                                "from": "on",
                                "to": "off"
                            },
                            {
                                "platform": "state",
                                "entity_id": "fan.elenas_room_fan",
                                "id": "power_on",
                                "from": "off",
                                "to": "on"
                            },
                            {
                                "platform": "state",
                                "entity_id": "fan.elenas_room_fan",
                                "id": "speed",
                                "attribute": "percentage"
                            }
                        ],
                        "condition": [],
                        "action": [
                            {
                                "choose": [
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "power_off"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "script.1642846136869",
                                                "data": {
                                                    "target_fan": "Elena's Room Fan",
                                                    "target_fan_power": false
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "power_on"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "fan.set_percentage",
                                                "data": {
                                                    "percentage": "{{ state_attr('binary_sensor.recommended_scene_in_elenas_room', 'fan_speed') | int }}\n"
                                                },
                                                "target": {
                                                    "entity_id": "fan.elenas_room_fan"
                                                }
                                            },
                                            {
                                                "delay": {
                                                    "hours": 0,
                                                    "minutes": 0,
                                                    "seconds": 0,
                                                    "milliseconds": 20
                                                }
                                            },
                                            {
                                                "service": "script.1642846136869",
                                                "data": {
                                                    "target_fan": "Elena's Room Fan",
                                                    "target_fan_speed": "{{ state_attr(\"fan.elenas_room_fan\", \"percentage\") }}"
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "speed"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [
                                                            {
                                                                "condition": "numeric_state",
                                                                "entity_id": "fan.elenas_room_fan",
                                                                "attribute": "percentage",
                                                                "below": "10"
                                                            }
                                                        ],
                                                        "sequence": [
                                                            {
                                                                "service": "fan.turn_off",
                                                                "data": {},
                                                                "target": {
                                                                    "entity_id": "fan.elenas_room_fan"
                                                                }
                                                            },
                                                            {
                                                                "service": "script.1642846136869",
                                                                "data": {
                                                                    "target_fan": "Elena's Room Fan",
                                                                    "target_fan_power": false
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "script.1642846136869",
                                                        "data": {
                                                            "target_fan": "Elena's Room Fan",
                                                            "target_fan_power": true,
                                                            "target_fan_speed": "{{ state_attr(\"fan.elenas_room_fan\", \"percentage\") }}"
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ],
                                "default": []
                            }
                        ],
                        "mode": "single",
                        "max_exceeded": "silent"
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "d82d8cfdd92f30ea6ee3855313350e1a",
                        "parent_id": "02909dc07e5b138cddc8677b8d9361fd",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/0/choose/0/sequence/0",
                    "run_id": "a8ba28d8cd65798fbcd405f370bad0dd",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T00:49:05.437803+00:00",
                        "finish": "2022-03-03T00:49:06.335900+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643000778073",
                    "trigger": "state of fan.elenas_room_fan"
                }
            }
        ],
        "script.1642846136869": [
            {
                "extended_dict": {
                    "last_step": "sequence/0",
                    "run_id": "a79ce77100a3e5c252cad6f96ccbc58d",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:44:45.262193+00:00",
                        "finish": "2022-03-03T05:44:45.693208+00:00"
                    },
                    "domain": "script",
                    "item_id": "1642846136869",
                    "trace": {
                        "sequence/0": [
                            {
                                "path": "sequence/0",
                                "timestamp": "2022-03-03T05:44:45.264275+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "script.1642846136869",
                                        "state": "off",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T05:44:44.426308+00:00",
                                            "mode": "queued",
                                            "current": 0,
                                            "max": 10,
                                            "icon": "mdi:speedometer",
                                            "friendly_name": "Fan Set State"
                                        },
                                        "last_changed": "2022-03-03T05:44:45.257599+00:00",
                                        "last_updated": "2022-03-03T05:44:45.257599+00:00",
                                        "context": {
                                            "id": "9383225a2028ccf0a2bff6aee0e1a07d",
                                            "parent_id": "4de2f4d60fa5bfc044f0b7e479e169f0",
                                            "user_id": null
                                        }
                                    },
                                    "target_fan": "Dining Room Fan",
                                    "target_fan_power": true,
                                    "target_fan_speed": 0,
                                    "context": {
                                        "id": "89396d303c4b1290339e1442584efa7e",
                                        "parent_id": "4de2f4d60fa5bfc044f0b7e479e169f0",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "params": {
                                        "domain": "remote",
                                        "service": "send_command",
                                        "service_data": {
                                            "device": "Dining Room Fan",
                                            "command": "Off",
                                            "entity_id": [
                                                "remote.elis_room_universal_remote"
                                            ]
                                        },
                                        "target": {
                                            "entity_id": [
                                                "remote.elis_room_universal_remote"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ]
                    },
                    "config": {
                        "alias": "Fan Set State",
                        "fields": {
                            "target_fan": {
                                "name": "Target Fan",
                                "description": "The fan for which to set the state",
                                "selector": {
                                    "select": {
                                        "options": [
                                            "Dining Room Fan",
                                            "Elena's Room Fan",
                                            "Eli's Room Fan"
                                        ]
                                    }
                                },
                                "required": true,
                                "default": "Dining Room Fan"
                            },
                            "target_fan_power": {
                                "name": "Target Fan Power",
                                "description": "Whether the fan is on or off",
                                "selector": {
                                    "boolean": null
                                },
                                "required": true,
                                "default": true
                            },
                            "target_fan_speed": {
                                "name": "Target Fan Speed",
                                "description": "The speed of the fan",
                                "selector": {
                                    "number": {
                                        "min": 0,
                                        "max": 100,
                                        "step": 16,
                                        "mode": "slider"
                                    }
                                },
                                "required": false,
                                "default": 33
                            }
                        },
                        "sequence": [
                            {
                                "service": "remote.send_command",
                                "target": {
                                    "entity_id": "remote.elis_room_universal_remote"
                                },
                                "data": {
                                    "device": "{{ target_fan }}\n",
                                    "command": "{% if target_fan_power == false %}\n  Off\n{% elif ((target_fan_speed | int) / 100 * 6) | round(0) | int == 0 %}\n  Off\n{% else %}\n  {{ ((target_fan_speed | int) / 100 * 6) | round(0) | int }}\n{% endif %}"
                                }
                            }
                        ],
                        "mode": "queued",
                        "icon": "mdi:speedometer",
                        "max": 10
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "89396d303c4b1290339e1442584efa7e",
                        "parent_id": "4de2f4d60fa5bfc044f0b7e479e169f0",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "sequence/0",
                    "run_id": "a79ce77100a3e5c252cad6f96ccbc58d",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:44:45.262193+00:00",
                        "finish": "2022-03-03T05:44:45.693208+00:00"
                    },
                    "domain": "script",
                    "item_id": "1642846136869"
                }
            },
            {
                "extended_dict": {
                    "last_step": "sequence/0",
                    "run_id": "31973ff7ef9e089af806214ca43d2eef",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:45:26.457119+00:00",
                        "finish": "2022-03-03T05:45:27.218242+00:00"
                    },
                    "domain": "script",
                    "item_id": "1642846136869",
                    "trace": {
                        "sequence/0": [
                            {
                                "path": "sequence/0",
                                "timestamp": "2022-03-03T05:45:26.458054+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "script.1642846136869",
                                        "state": "off",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T05:44:45.262271+00:00",
                                            "mode": "queued",
                                            "current": 0,
                                            "max": 10,
                                            "icon": "mdi:speedometer",
                                            "friendly_name": "Fan Set State"
                                        },
                                        "last_changed": "2022-03-03T05:44:45.692779+00:00",
                                        "last_updated": "2022-03-03T05:44:45.692779+00:00",
                                        "context": {
                                            "id": "89396d303c4b1290339e1442584efa7e",
                                            "parent_id": "4de2f4d60fa5bfc044f0b7e479e169f0",
                                            "user_id": null
                                        }
                                    },
                                    "target_fan": "Dining Room Fan",
                                    "target_fan_power": true,
                                    "target_fan_speed": 16,
                                    "context": {
                                        "id": "12ab56b5f7ebc825e5044adfd45b484e",
                                        "parent_id": "a3d5692cc337adfaca64783a1281f5cb",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "params": {
                                        "domain": "remote",
                                        "service": "send_command",
                                        "service_data": {
                                            "device": "Dining Room Fan",
                                            "command": 1,
                                            "entity_id": [
                                                "remote.elis_room_universal_remote"
                                            ]
                                        },
                                        "target": {
                                            "entity_id": [
                                                "remote.elis_room_universal_remote"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ]
                    },
                    "config": {
                        "alias": "Fan Set State",
                        "fields": {
                            "target_fan": {
                                "name": "Target Fan",
                                "description": "The fan for which to set the state",
                                "selector": {
                                    "select": {
                                        "options": [
                                            "Dining Room Fan",
                                            "Elena's Room Fan",
                                            "Eli's Room Fan"
                                        ]
                                    }
                                },
                                "required": true,
                                "default": "Dining Room Fan"
                            },
                            "target_fan_power": {
                                "name": "Target Fan Power",
                                "description": "Whether the fan is on or off",
                                "selector": {
                                    "boolean": null
                                },
                                "required": true,
                                "default": true
                            },
                            "target_fan_speed": {
                                "name": "Target Fan Speed",
                                "description": "The speed of the fan",
                                "selector": {
                                    "number": {
                                        "min": 0,
                                        "max": 100,
                                        "step": 16,
                                        "mode": "slider"
                                    }
                                },
                                "required": false,
                                "default": 33
                            }
                        },
                        "sequence": [
                            {
                                "service": "remote.send_command",
                                "target": {
                                    "entity_id": "remote.elis_room_universal_remote"
                                },
                                "data": {
                                    "device": "{{ target_fan }}\n",
                                    "command": "{% if target_fan_power == false %}\n  Off\n{% elif ((target_fan_speed | int) / 100 * 6) | round(0) | int == 0 %}\n  Off\n{% else %}\n  {{ ((target_fan_speed | int) / 100 * 6) | round(0) | int }}\n{% endif %}"
                                }
                            }
                        ],
                        "mode": "queued",
                        "icon": "mdi:speedometer",
                        "max": 10
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "12ab56b5f7ebc825e5044adfd45b484e",
                        "parent_id": "a3d5692cc337adfaca64783a1281f5cb",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "sequence/0",
                    "run_id": "31973ff7ef9e089af806214ca43d2eef",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:45:26.457119+00:00",
                        "finish": "2022-03-03T05:45:27.218242+00:00"
                    },
                    "domain": "script",
                    "item_id": "1642846136869"
                }
            },
            {
                "extended_dict": {
                    "last_step": "sequence/0",
                    "run_id": "0b74789bc8cf5c0ae4cab86ae800b9a6",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:45:27.222551+00:00",
                        "finish": "2022-03-03T05:45:27.987470+00:00"
                    },
                    "domain": "script",
                    "item_id": "1642846136869",
                    "trace": {
                        "sequence/0": [
                            {
                                "path": "sequence/0",
                                "timestamp": "2022-03-03T05:45:27.223185+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "script.1642846136869",
                                        "state": "off",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T05:45:26.457181+00:00",
                                            "mode": "queued",
                                            "current": 0,
                                            "max": 10,
                                            "icon": "mdi:speedometer",
                                            "friendly_name": "Fan Set State"
                                        },
                                        "last_changed": "2022-03-03T05:45:27.217777+00:00",
                                        "last_updated": "2022-03-03T05:45:27.217777+00:00",
                                        "context": {
                                            "id": "12ab56b5f7ebc825e5044adfd45b484e",
                                            "parent_id": "a3d5692cc337adfaca64783a1281f5cb",
                                            "user_id": null
                                        }
                                    },
                                    "target_fan": "Dining Room Fan",
                                    "target_fan_power": true,
                                    "target_fan_speed": 16,
                                    "context": {
                                        "id": "9cc92ad7eeb0b9ffa72d831f7b5a8e69",
                                        "parent_id": "a3d5692cc337adfaca64783a1281f5cb",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "params": {
                                        "domain": "remote",
                                        "service": "send_command",
                                        "service_data": {
                                            "device": "Dining Room Fan",
                                            "command": 1,
                                            "entity_id": [
                                                "remote.elis_room_universal_remote"
                                            ]
                                        },
                                        "target": {
                                            "entity_id": [
                                                "remote.elis_room_universal_remote"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ]
                    },
                    "config": {
                        "alias": "Fan Set State",
                        "fields": {
                            "target_fan": {
                                "name": "Target Fan",
                                "description": "The fan for which to set the state",
                                "selector": {
                                    "select": {
                                        "options": [
                                            "Dining Room Fan",
                                            "Elena's Room Fan",
                                            "Eli's Room Fan"
                                        ]
                                    }
                                },
                                "required": true,
                                "default": "Dining Room Fan"
                            },
                            "target_fan_power": {
                                "name": "Target Fan Power",
                                "description": "Whether the fan is on or off",
                                "selector": {
                                    "boolean": null
                                },
                                "required": true,
                                "default": true
                            },
                            "target_fan_speed": {
                                "name": "Target Fan Speed",
                                "description": "The speed of the fan",
                                "selector": {
                                    "number": {
                                        "min": 0,
                                        "max": 100,
                                        "step": 16,
                                        "mode": "slider"
                                    }
                                },
                                "required": false,
                                "default": 33
                            }
                        },
                        "sequence": [
                            {
                                "service": "remote.send_command",
                                "target": {
                                    "entity_id": "remote.elis_room_universal_remote"
                                },
                                "data": {
                                    "device": "{{ target_fan }}\n",
                                    "command": "{% if target_fan_power == false %}\n  Off\n{% elif ((target_fan_speed | int) / 100 * 6) | round(0) | int == 0 %}\n  Off\n{% else %}\n  {{ ((target_fan_speed | int) / 100 * 6) | round(0) | int }}\n{% endif %}"
                                }
                            }
                        ],
                        "mode": "queued",
                        "icon": "mdi:speedometer",
                        "max": 10
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "9cc92ad7eeb0b9ffa72d831f7b5a8e69",
                        "parent_id": "a3d5692cc337adfaca64783a1281f5cb",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "sequence/0",
                    "run_id": "0b74789bc8cf5c0ae4cab86ae800b9a6",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:45:27.222551+00:00",
                        "finish": "2022-03-03T05:45:27.987470+00:00"
                    },
                    "domain": "script",
                    "item_id": "1642846136869"
                }
            },
            {
                "extended_dict": {
                    "last_step": "sequence/0",
                    "run_id": "e2dbb68c2a1dd332b8904b134645cb31",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:45:37.333675+00:00",
                        "finish": "2022-03-03T05:45:38.095359+00:00"
                    },
                    "domain": "script",
                    "item_id": "1642846136869",
                    "trace": {
                        "sequence/0": [
                            {
                                "path": "sequence/0",
                                "timestamp": "2022-03-03T05:45:37.335031+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "script.1642846136869",
                                        "state": "off",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T05:45:27.222639+00:00",
                                            "mode": "queued",
                                            "current": 0,
                                            "max": 10,
                                            "icon": "mdi:speedometer",
                                            "friendly_name": "Fan Set State"
                                        },
                                        "last_changed": "2022-03-03T05:45:27.986753+00:00",
                                        "last_updated": "2022-03-03T05:45:27.986753+00:00",
                                        "context": {
                                            "id": "9cc92ad7eeb0b9ffa72d831f7b5a8e69",
                                            "parent_id": "a3d5692cc337adfaca64783a1281f5cb",
                                            "user_id": null
                                        }
                                    },
                                    "target_fan": "Dining Room Fan",
                                    "target_fan_power": true,
                                    "target_fan_speed": 66,
                                    "context": {
                                        "id": "6c595b8c3b24290d344dfa49d889e5f8",
                                        "parent_id": "ff751dc646454987acc07db9d12c7f00",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "params": {
                                        "domain": "remote",
                                        "service": "send_command",
                                        "service_data": {
                                            "device": "Dining Room Fan",
                                            "command": 4,
                                            "entity_id": [
                                                "remote.elis_room_universal_remote"
                                            ]
                                        },
                                        "target": {
                                            "entity_id": [
                                                "remote.elis_room_universal_remote"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ]
                    },
                    "config": {
                        "alias": "Fan Set State",
                        "fields": {
                            "target_fan": {
                                "name": "Target Fan",
                                "description": "The fan for which to set the state",
                                "selector": {
                                    "select": {
                                        "options": [
                                            "Dining Room Fan",
                                            "Elena's Room Fan",
                                            "Eli's Room Fan"
                                        ]
                                    }
                                },
                                "required": true,
                                "default": "Dining Room Fan"
                            },
                            "target_fan_power": {
                                "name": "Target Fan Power",
                                "description": "Whether the fan is on or off",
                                "selector": {
                                    "boolean": null
                                },
                                "required": true,
                                "default": true
                            },
                            "target_fan_speed": {
                                "name": "Target Fan Speed",
                                "description": "The speed of the fan",
                                "selector": {
                                    "number": {
                                        "min": 0,
                                        "max": 100,
                                        "step": 16,
                                        "mode": "slider"
                                    }
                                },
                                "required": false,
                                "default": 33
                            }
                        },
                        "sequence": [
                            {
                                "service": "remote.send_command",
                                "target": {
                                    "entity_id": "remote.elis_room_universal_remote"
                                },
                                "data": {
                                    "device": "{{ target_fan }}\n",
                                    "command": "{% if target_fan_power == false %}\n  Off\n{% elif ((target_fan_speed | int) / 100 * 6) | round(0) | int == 0 %}\n  Off\n{% else %}\n  {{ ((target_fan_speed | int) / 100 * 6) | round(0) | int }}\n{% endif %}"
                                }
                            }
                        ],
                        "mode": "queued",
                        "icon": "mdi:speedometer",
                        "max": 10
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "6c595b8c3b24290d344dfa49d889e5f8",
                        "parent_id": "ff751dc646454987acc07db9d12c7f00",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "sequence/0",
                    "run_id": "e2dbb68c2a1dd332b8904b134645cb31",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:45:37.333675+00:00",
                        "finish": "2022-03-03T05:45:38.095359+00:00"
                    },
                    "domain": "script",
                    "item_id": "1642846136869"
                }
            },
            {
                "extended_dict": {
                    "last_step": "sequence/0",
                    "run_id": "7b943f7a42a9f4986e183061aaa9b3aa",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:45:38.099520+00:00",
                        "finish": "2022-03-03T05:45:38.463624+00:00"
                    },
                    "domain": "script",
                    "item_id": "1642846136869",
                    "trace": {
                        "sequence/0": [
                            {
                                "path": "sequence/0",
                                "timestamp": "2022-03-03T05:45:38.101476+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "script.1642846136869",
                                        "state": "off",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T05:45:37.333761+00:00",
                                            "mode": "queued",
                                            "current": 0,
                                            "max": 10,
                                            "icon": "mdi:speedometer",
                                            "friendly_name": "Fan Set State"
                                        },
                                        "last_changed": "2022-03-03T05:45:38.094153+00:00",
                                        "last_updated": "2022-03-03T05:45:38.094153+00:00",
                                        "context": {
                                            "id": "6c595b8c3b24290d344dfa49d889e5f8",
                                            "parent_id": "ff751dc646454987acc07db9d12c7f00",
                                            "user_id": null
                                        }
                                    },
                                    "target_fan": "Dining Room Fan",
                                    "target_fan_power": true,
                                    "target_fan_speed": 66,
                                    "context": {
                                        "id": "b3d52e9c0add0149b197ce79436fc2ca",
                                        "parent_id": "ff751dc646454987acc07db9d12c7f00",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "params": {
                                        "domain": "remote",
                                        "service": "send_command",
                                        "service_data": {
                                            "device": "Dining Room Fan",
                                            "command": 4,
                                            "entity_id": [
                                                "remote.elis_room_universal_remote"
                                            ]
                                        },
                                        "target": {
                                            "entity_id": [
                                                "remote.elis_room_universal_remote"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ]
                    },
                    "config": {
                        "alias": "Fan Set State",
                        "fields": {
                            "target_fan": {
                                "name": "Target Fan",
                                "description": "The fan for which to set the state",
                                "selector": {
                                    "select": {
                                        "options": [
                                            "Dining Room Fan",
                                            "Elena's Room Fan",
                                            "Eli's Room Fan"
                                        ]
                                    }
                                },
                                "required": true,
                                "default": "Dining Room Fan"
                            },
                            "target_fan_power": {
                                "name": "Target Fan Power",
                                "description": "Whether the fan is on or off",
                                "selector": {
                                    "boolean": null
                                },
                                "required": true,
                                "default": true
                            },
                            "target_fan_speed": {
                                "name": "Target Fan Speed",
                                "description": "The speed of the fan",
                                "selector": {
                                    "number": {
                                        "min": 0,
                                        "max": 100,
                                        "step": 16,
                                        "mode": "slider"
                                    }
                                },
                                "required": false,
                                "default": 33
                            }
                        },
                        "sequence": [
                            {
                                "service": "remote.send_command",
                                "target": {
                                    "entity_id": "remote.elis_room_universal_remote"
                                },
                                "data": {
                                    "device": "{{ target_fan }}\n",
                                    "command": "{% if target_fan_power == false %}\n  Off\n{% elif ((target_fan_speed | int) / 100 * 6) | round(0) | int == 0 %}\n  Off\n{% else %}\n  {{ ((target_fan_speed | int) / 100 * 6) | round(0) | int }}\n{% endif %}"
                                }
                            }
                        ],
                        "mode": "queued",
                        "icon": "mdi:speedometer",
                        "max": 10
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "b3d52e9c0add0149b197ce79436fc2ca",
                        "parent_id": "ff751dc646454987acc07db9d12c7f00",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "sequence/0",
                    "run_id": "7b943f7a42a9f4986e183061aaa9b3aa",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:45:38.099520+00:00",
                        "finish": "2022-03-03T05:45:38.463624+00:00"
                    },
                    "domain": "script",
                    "item_id": "1642846136869"
                }
            }
        ],
        "automation.1643642651826": [
            {
                "extended_dict": {
                    "last_step": "action/0/choose/0/sequence/1/default/0",
                    "run_id": "61bf44f517601d42cbfe636134247b52",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T07:46:47.556782+00:00",
                        "finish": "2022-03-03T07:46:47.670310+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643642651826",
                    "trigger": "state of binary_sensor.hallway_motion",
                    "trace": {
                        "trigger/0": [
                            {
                                "path": "trigger/0",
                                "timestamp": "2022-03-03T07:46:47.556878+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.hallway_motion",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T07:40:27.919770+00:00",
                                            "mode": "single",
                                            "current": 0,
                                            "id": "1643642651826",
                                            "friendly_name": "Hallway Motion"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.798403+00:00",
                                        "last_updated": "2022-03-03T07:40:28.033544+00:00",
                                        "context": {
                                            "id": "0140fedd40bc79d230179fdd2211a1fc",
                                            "parent_id": "0ea7c776d20eb16504ec034d98a43a91",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "motion",
                                        "idx": "0",
                                        "platform": "state",
                                        "entity_id": "binary_sensor.hallway_motion",
                                        "from_state": {
                                            "entity_id": "binary_sensor.hallway_motion",
                                            "state": "off",
                                            "attributes": {
                                                "device_class": "motion",
                                                "friendly_name": "Hallway Motion"
                                            },
                                            "last_changed": "2022-03-03T07:40:27.918979+00:00",
                                            "last_updated": "2022-03-03T07:40:27.918979+00:00",
                                            "context": {
                                                "id": "0ea7c776d20eb16504ec034d98a43a91",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "to_state": {
                                            "entity_id": "binary_sensor.hallway_motion",
                                            "state": "on",
                                            "attributes": {
                                                "device_class": "motion",
                                                "friendly_name": "Hallway Motion"
                                            },
                                            "last_changed": "2022-03-03T07:46:47.555989+00:00",
                                            "last_updated": "2022-03-03T07:46:47.555989+00:00",
                                            "context": {
                                                "id": "4ae553dba72c9c608e75460b7386cee4",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "for": null,
                                        "attribute": null,
                                        "description": "state of binary_sensor.hallway_motion"
                                    }
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T07:46:47.558309+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "640aea758b8b79a2bb9bdc587bb57c58",
                                        "parent_id": "4ae553dba72c9c608e75460b7386cee4",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "choice": 0
                                }
                            }
                        ],
                        "action/0/choose/0": [
                            {
                                "path": "action/0/choose/0",
                                "timestamp": "2022-03-03T07:46:47.558381+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/0/conditions/0",
                                "timestamp": "2022-03-03T07:46:47.558407+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/0": [
                            {
                                "path": "action/0/choose/0/sequence/0",
                                "timestamp": "2022-03-03T07:46:47.560033+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/0/entity_id/0": [
                            {
                                "path": "action/0/choose/0/sequence/0/entity_id/0",
                                "timestamp": "2022-03-03T07:46:47.560086+00:00",
                                "result": {
                                    "result": true,
                                    "state": "on",
                                    "wanted_state": "on"
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/1": [
                            {
                                "path": "action/0/choose/0/sequence/1",
                                "timestamp": "2022-03-03T07:46:47.560145+00:00",
                                "result": {
                                    "choice": "default"
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/1/choose/0": [
                            {
                                "path": "action/0/choose/0/sequence/1/choose/0",
                                "timestamp": "2022-03-03T07:46:47.560342+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/1/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/0/sequence/1/choose/0/conditions/0",
                                "timestamp": "2022-03-03T07:46:47.560373+00:00",
                                "result": {
                                    "after": {
                                        "__type": "<class 'datetime.time'>",
                                        "isoformat": "21:00:00"
                                    },
                                    "now_time": {
                                        "__type": "<class 'datetime.time'>",
                                        "isoformat": "15:46:47.560384"
                                    },
                                    "before": {
                                        "__type": "<class 'datetime.time'>",
                                        "isoformat": "07:00:00"
                                    },
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/1/default/0": [
                            {
                                "path": "action/0/choose/0/sequence/1/default/0",
                                "timestamp": "2022-03-03T07:46:47.560660+00:00",
                                "result": {
                                    "params": {
                                        "domain": "light",
                                        "service": "turn_on",
                                        "service_data": {
                                            "brightness_pct": 100,
                                            "entity_id": [
                                                "light.hallway_lights"
                                            ]
                                        },
                                        "target": {
                                            "entity_id": [
                                                "light.hallway_lights"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ]
                    },
                    "config": {
                        "id": "1643642651826",
                        "alias": "Hallway Motion",
                        "description": "Control the Hallway Lights with motion",
                        "trigger": [
                            {
                                "platform": "state",
                                "entity_id": "binary_sensor.hallway_motion",
                                "id": "motion",
                                "from": "off",
                                "to": "on"
                            },
                            {
                                "platform": "state",
                                "entity_id": "binary_sensor.hallway_motion",
                                "id": "no_motion",
                                "from": "on",
                                "to": "off"
                            }
                        ],
                        "condition": [],
                        "action": [
                            {
                                "choose": [
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "motion"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "condition": "state",
                                                "entity_id": "switch.lights_auto_control",
                                                "state": "on"
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [
                                                            {
                                                                "condition": "time",
                                                                "after": "input_datetime.elenas_wind_down",
                                                                "before": "input_datetime.lights_auto_control_end"
                                                            }
                                                        ],
                                                        "sequence": [
                                                            {
                                                                "service": "light.turn_on",
                                                                "target": {
                                                                    "entity_id": "light.hallway_lights"
                                                                },
                                                                "data": {
                                                                    "brightness_pct": 5
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.hallway_lights"
                                                        },
                                                        "data": {
                                                            "brightness_pct": 100
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "no_motion"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "light.turn_off",
                                                "target": {
                                                    "entity_id": "light.hallway_lights"
                                                }
                                            }
                                        ]
                                    }
                                ],
                                "default": []
                            }
                        ],
                        "mode": "single"
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "640aea758b8b79a2bb9bdc587bb57c58",
                        "parent_id": "4ae553dba72c9c608e75460b7386cee4",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/0/choose/0/sequence/1/default/0",
                    "run_id": "61bf44f517601d42cbfe636134247b52",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T07:46:47.556782+00:00",
                        "finish": "2022-03-03T07:46:47.670310+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643642651826",
                    "trigger": "state of binary_sensor.hallway_motion"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/0/choose/1/sequence/0",
                    "run_id": "954b78d67b194617899adf9658912c7a",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T07:48:26.514497+00:00",
                        "finish": "2022-03-03T07:48:26.630866+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643642651826",
                    "trigger": "state of binary_sensor.hallway_motion",
                    "trace": {
                        "trigger/1": [
                            {
                                "path": "trigger/1",
                                "timestamp": "2022-03-03T07:48:26.514568+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.hallway_motion",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T07:46:47.557005+00:00",
                                            "mode": "single",
                                            "current": 0,
                                            "id": "1643642651826",
                                            "friendly_name": "Hallway Motion"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.798403+00:00",
                                        "last_updated": "2022-03-03T07:46:47.669248+00:00",
                                        "context": {
                                            "id": "640aea758b8b79a2bb9bdc587bb57c58",
                                            "parent_id": "4ae553dba72c9c608e75460b7386cee4",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "no_motion",
                                        "idx": "1",
                                        "platform": "state",
                                        "entity_id": "binary_sensor.hallway_motion",
                                        "from_state": {
                                            "entity_id": "binary_sensor.hallway_motion",
                                            "state": "on",
                                            "attributes": {
                                                "device_class": "motion",
                                                "friendly_name": "Hallway Motion"
                                            },
                                            "last_changed": "2022-03-03T07:46:47.555989+00:00",
                                            "last_updated": "2022-03-03T07:46:47.555989+00:00",
                                            "context": {
                                                "id": "4ae553dba72c9c608e75460b7386cee4",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "to_state": {
                                            "entity_id": "binary_sensor.hallway_motion",
                                            "state": "off",
                                            "attributes": {
                                                "device_class": "motion",
                                                "friendly_name": "Hallway Motion"
                                            },
                                            "last_changed": "2022-03-03T07:48:26.513515+00:00",
                                            "last_updated": "2022-03-03T07:48:26.513515+00:00",
                                            "context": {
                                                "id": "c345b3b5cfbb7fbb5ff5c857593b4416",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "for": null,
                                        "attribute": null,
                                        "description": "state of binary_sensor.hallway_motion"
                                    }
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T07:48:26.515142+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "0605a7003f7c537b5d8565aa94f5791e",
                                        "parent_id": "c345b3b5cfbb7fbb5ff5c857593b4416",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "choice": 1
                                }
                            }
                        ],
                        "action/0/choose/0": [
                            {
                                "path": "action/0/choose/0",
                                "timestamp": "2022-03-03T07:48:26.515206+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/0/conditions/0",
                                "timestamp": "2022-03-03T07:48:26.515229+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/1": [
                            {
                                "path": "action/0/choose/1",
                                "timestamp": "2022-03-03T07:48:26.515269+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/1/conditions/0": [
                            {
                                "path": "action/0/choose/1/conditions/0",
                                "timestamp": "2022-03-03T07:48:26.515283+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/1/sequence/0": [
                            {
                                "path": "action/0/choose/1/sequence/0",
                                "timestamp": "2022-03-03T07:48:26.515920+00:00",
                                "result": {
                                    "params": {
                                        "domain": "light",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "light.hallway_lights"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ]
                    },
                    "config": {
                        "id": "1643642651826",
                        "alias": "Hallway Motion",
                        "description": "Control the Hallway Lights with motion",
                        "trigger": [
                            {
                                "platform": "state",
                                "entity_id": "binary_sensor.hallway_motion",
                                "id": "motion",
                                "from": "off",
                                "to": "on"
                            },
                            {
                                "platform": "state",
                                "entity_id": "binary_sensor.hallway_motion",
                                "id": "no_motion",
                                "from": "on",
                                "to": "off"
                            }
                        ],
                        "condition": [],
                        "action": [
                            {
                                "choose": [
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "motion"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "condition": "state",
                                                "entity_id": "switch.lights_auto_control",
                                                "state": "on"
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [
                                                            {
                                                                "condition": "time",
                                                                "after": "input_datetime.elenas_wind_down",
                                                                "before": "input_datetime.lights_auto_control_end"
                                                            }
                                                        ],
                                                        "sequence": [
                                                            {
                                                                "service": "light.turn_on",
                                                                "target": {
                                                                    "entity_id": "light.hallway_lights"
                                                                },
                                                                "data": {
                                                                    "brightness_pct": 5
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.hallway_lights"
                                                        },
                                                        "data": {
                                                            "brightness_pct": 100
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "no_motion"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "light.turn_off",
                                                "target": {
                                                    "entity_id": "light.hallway_lights"
                                                }
                                            }
                                        ]
                                    }
                                ],
                                "default": []
                            }
                        ],
                        "mode": "single"
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "0605a7003f7c537b5d8565aa94f5791e",
                        "parent_id": "c345b3b5cfbb7fbb5ff5c857593b4416",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/0/choose/1/sequence/0",
                    "run_id": "954b78d67b194617899adf9658912c7a",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T07:48:26.514497+00:00",
                        "finish": "2022-03-03T07:48:26.630866+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643642651826",
                    "trigger": "state of binary_sensor.hallway_motion"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/0/choose/0/sequence/1/default/0",
                    "run_id": "80bd59f735de70f309f86e26b3f55b2c",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T07:52:21.469239+00:00",
                        "finish": "2022-03-03T07:52:21.585098+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643642651826",
                    "trigger": "state of binary_sensor.hallway_motion",
                    "trace": {
                        "trigger/0": [
                            {
                                "path": "trigger/0",
                                "timestamp": "2022-03-03T07:52:21.469355+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.hallway_motion",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T07:48:26.514713+00:00",
                                            "mode": "single",
                                            "current": 0,
                                            "id": "1643642651826",
                                            "friendly_name": "Hallway Motion"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.798403+00:00",
                                        "last_updated": "2022-03-03T07:48:26.630486+00:00",
                                        "context": {
                                            "id": "0605a7003f7c537b5d8565aa94f5791e",
                                            "parent_id": "c345b3b5cfbb7fbb5ff5c857593b4416",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "motion",
                                        "idx": "0",
                                        "platform": "state",
                                        "entity_id": "binary_sensor.hallway_motion",
                                        "from_state": {
                                            "entity_id": "binary_sensor.hallway_motion",
                                            "state": "off",
                                            "attributes": {
                                                "device_class": "motion",
                                                "friendly_name": "Hallway Motion"
                                            },
                                            "last_changed": "2022-03-03T07:48:26.513515+00:00",
                                            "last_updated": "2022-03-03T07:48:26.513515+00:00",
                                            "context": {
                                                "id": "c345b3b5cfbb7fbb5ff5c857593b4416",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "to_state": {
                                            "entity_id": "binary_sensor.hallway_motion",
                                            "state": "on",
                                            "attributes": {
                                                "device_class": "motion",
                                                "friendly_name": "Hallway Motion"
                                            },
                                            "last_changed": "2022-03-03T07:52:21.468665+00:00",
                                            "last_updated": "2022-03-03T07:52:21.468665+00:00",
                                            "context": {
                                                "id": "066d2fefd83f27e7e920d9537c9e714d",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "for": null,
                                        "attribute": null,
                                        "description": "state of binary_sensor.hallway_motion"
                                    }
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T07:52:21.469862+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "d1d004c6883ab900606537f7d11e78ef",
                                        "parent_id": "066d2fefd83f27e7e920d9537c9e714d",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "choice": 0
                                }
                            }
                        ],
                        "action/0/choose/0": [
                            {
                                "path": "action/0/choose/0",
                                "timestamp": "2022-03-03T07:52:21.469913+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/0/conditions/0",
                                "timestamp": "2022-03-03T07:52:21.469935+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/0": [
                            {
                                "path": "action/0/choose/0/sequence/0",
                                "timestamp": "2022-03-03T07:52:21.470221+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/0/entity_id/0": [
                            {
                                "path": "action/0/choose/0/sequence/0/entity_id/0",
                                "timestamp": "2022-03-03T07:52:21.470275+00:00",
                                "result": {
                                    "result": true,
                                    "state": "on",
                                    "wanted_state": "on"
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/1": [
                            {
                                "path": "action/0/choose/0/sequence/1",
                                "timestamp": "2022-03-03T07:52:21.470339+00:00",
                                "result": {
                                    "choice": "default"
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/1/choose/0": [
                            {
                                "path": "action/0/choose/0/sequence/1/choose/0",
                                "timestamp": "2022-03-03T07:52:21.470367+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/1/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/0/sequence/1/choose/0/conditions/0",
                                "timestamp": "2022-03-03T07:52:21.470383+00:00",
                                "result": {
                                    "after": {
                                        "__type": "<class 'datetime.time'>",
                                        "isoformat": "21:00:00"
                                    },
                                    "now_time": {
                                        "__type": "<class 'datetime.time'>",
                                        "isoformat": "15:52:21.470392"
                                    },
                                    "before": {
                                        "__type": "<class 'datetime.time'>",
                                        "isoformat": "07:00:00"
                                    },
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/1/default/0": [
                            {
                                "path": "action/0/choose/0/sequence/1/default/0",
                                "timestamp": "2022-03-03T07:52:21.470660+00:00",
                                "result": {
                                    "params": {
                                        "domain": "light",
                                        "service": "turn_on",
                                        "service_data": {
                                            "brightness_pct": 100,
                                            "entity_id": [
                                                "light.hallway_lights"
                                            ]
                                        },
                                        "target": {
                                            "entity_id": [
                                                "light.hallway_lights"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ]
                    },
                    "config": {
                        "id": "1643642651826",
                        "alias": "Hallway Motion",
                        "description": "Control the Hallway Lights with motion",
                        "trigger": [
                            {
                                "platform": "state",
                                "entity_id": "binary_sensor.hallway_motion",
                                "id": "motion",
                                "from": "off",
                                "to": "on"
                            },
                            {
                                "platform": "state",
                                "entity_id": "binary_sensor.hallway_motion",
                                "id": "no_motion",
                                "from": "on",
                                "to": "off"
                            }
                        ],
                        "condition": [],
                        "action": [
                            {
                                "choose": [
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "motion"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "condition": "state",
                                                "entity_id": "switch.lights_auto_control",
                                                "state": "on"
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [
                                                            {
                                                                "condition": "time",
                                                                "after": "input_datetime.elenas_wind_down",
                                                                "before": "input_datetime.lights_auto_control_end"
                                                            }
                                                        ],
                                                        "sequence": [
                                                            {
                                                                "service": "light.turn_on",
                                                                "target": {
                                                                    "entity_id": "light.hallway_lights"
                                                                },
                                                                "data": {
                                                                    "brightness_pct": 5
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.hallway_lights"
                                                        },
                                                        "data": {
                                                            "brightness_pct": 100
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "no_motion"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "light.turn_off",
                                                "target": {
                                                    "entity_id": "light.hallway_lights"
                                                }
                                            }
                                        ]
                                    }
                                ],
                                "default": []
                            }
                        ],
                        "mode": "single"
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "d1d004c6883ab900606537f7d11e78ef",
                        "parent_id": "066d2fefd83f27e7e920d9537c9e714d",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/0/choose/0/sequence/1/default/0",
                    "run_id": "80bd59f735de70f309f86e26b3f55b2c",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T07:52:21.469239+00:00",
                        "finish": "2022-03-03T07:52:21.585098+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643642651826",
                    "trigger": "state of binary_sensor.hallway_motion"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/0/choose/1/sequence/0",
                    "run_id": "95d8cc290aa0fd6642a21f1a155303cc",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T07:55:07.260034+00:00",
                        "finish": "2022-03-03T07:55:07.371250+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643642651826",
                    "trigger": "state of binary_sensor.hallway_motion",
                    "trace": {
                        "trigger/1": [
                            {
                                "path": "trigger/1",
                                "timestamp": "2022-03-03T07:55:07.260115+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.hallway_motion",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T07:52:21.469459+00:00",
                                            "mode": "single",
                                            "current": 0,
                                            "id": "1643642651826",
                                            "friendly_name": "Hallway Motion"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.798403+00:00",
                                        "last_updated": "2022-03-03T07:52:21.584671+00:00",
                                        "context": {
                                            "id": "d1d004c6883ab900606537f7d11e78ef",
                                            "parent_id": "066d2fefd83f27e7e920d9537c9e714d",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "no_motion",
                                        "idx": "1",
                                        "platform": "state",
                                        "entity_id": "binary_sensor.hallway_motion",
                                        "from_state": {
                                            "entity_id": "binary_sensor.hallway_motion",
                                            "state": "on",
                                            "attributes": {
                                                "device_class": "motion",
                                                "friendly_name": "Hallway Motion"
                                            },
                                            "last_changed": "2022-03-03T07:52:21.468665+00:00",
                                            "last_updated": "2022-03-03T07:52:21.468665+00:00",
                                            "context": {
                                                "id": "066d2fefd83f27e7e920d9537c9e714d",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "to_state": {
                                            "entity_id": "binary_sensor.hallway_motion",
                                            "state": "off",
                                            "attributes": {
                                                "device_class": "motion",
                                                "friendly_name": "Hallway Motion"
                                            },
                                            "last_changed": "2022-03-03T07:55:07.258646+00:00",
                                            "last_updated": "2022-03-03T07:55:07.258646+00:00",
                                            "context": {
                                                "id": "ce8c539533ded7c6109f85bed7d75c05",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "for": null,
                                        "attribute": null,
                                        "description": "state of binary_sensor.hallway_motion"
                                    }
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T07:55:07.260653+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "9aed37c82e282434f8371564e6c09461",
                                        "parent_id": "ce8c539533ded7c6109f85bed7d75c05",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "choice": 1
                                }
                            }
                        ],
                        "action/0/choose/0": [
                            {
                                "path": "action/0/choose/0",
                                "timestamp": "2022-03-03T07:55:07.260732+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/0/conditions/0",
                                "timestamp": "2022-03-03T07:55:07.260756+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/1": [
                            {
                                "path": "action/0/choose/1",
                                "timestamp": "2022-03-03T07:55:07.260794+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/1/conditions/0": [
                            {
                                "path": "action/0/choose/1/conditions/0",
                                "timestamp": "2022-03-03T07:55:07.260809+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/1/sequence/0": [
                            {
                                "path": "action/0/choose/1/sequence/0",
                                "timestamp": "2022-03-03T07:55:07.261106+00:00",
                                "result": {
                                    "params": {
                                        "domain": "light",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "light.hallway_lights"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ]
                    },
                    "config": {
                        "id": "1643642651826",
                        "alias": "Hallway Motion",
                        "description": "Control the Hallway Lights with motion",
                        "trigger": [
                            {
                                "platform": "state",
                                "entity_id": "binary_sensor.hallway_motion",
                                "id": "motion",
                                "from": "off",
                                "to": "on"
                            },
                            {
                                "platform": "state",
                                "entity_id": "binary_sensor.hallway_motion",
                                "id": "no_motion",
                                "from": "on",
                                "to": "off"
                            }
                        ],
                        "condition": [],
                        "action": [
                            {
                                "choose": [
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "motion"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "condition": "state",
                                                "entity_id": "switch.lights_auto_control",
                                                "state": "on"
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [
                                                            {
                                                                "condition": "time",
                                                                "after": "input_datetime.elenas_wind_down",
                                                                "before": "input_datetime.lights_auto_control_end"
                                                            }
                                                        ],
                                                        "sequence": [
                                                            {
                                                                "service": "light.turn_on",
                                                                "target": {
                                                                    "entity_id": "light.hallway_lights"
                                                                },
                                                                "data": {
                                                                    "brightness_pct": 5
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.hallway_lights"
                                                        },
                                                        "data": {
                                                            "brightness_pct": 100
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "no_motion"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "light.turn_off",
                                                "target": {
                                                    "entity_id": "light.hallway_lights"
                                                }
                                            }
                                        ]
                                    }
                                ],
                                "default": []
                            }
                        ],
                        "mode": "single"
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "9aed37c82e282434f8371564e6c09461",
                        "parent_id": "ce8c539533ded7c6109f85bed7d75c05",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/0/choose/1/sequence/0",
                    "run_id": "95d8cc290aa0fd6642a21f1a155303cc",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T07:55:07.260034+00:00",
                        "finish": "2022-03-03T07:55:07.371250+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643642651826",
                    "trigger": "state of binary_sensor.hallway_motion"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/0/choose/0/sequence/1/default/0",
                    "run_id": "9e52185147f434a4d218daded89652bf",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T08:01:20.759929+00:00",
                        "finish": "2022-03-03T08:01:25.788292+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643642651826",
                    "trigger": "state of binary_sensor.hallway_motion",
                    "trace": {
                        "trigger/0": [
                            {
                                "path": "trigger/0",
                                "timestamp": "2022-03-03T08:01:20.760021+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.hallway_motion",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T07:55:07.260234+00:00",
                                            "mode": "single",
                                            "current": 0,
                                            "id": "1643642651826",
                                            "friendly_name": "Hallway Motion"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.798403+00:00",
                                        "last_updated": "2022-03-03T07:55:07.370941+00:00",
                                        "context": {
                                            "id": "9aed37c82e282434f8371564e6c09461",
                                            "parent_id": "ce8c539533ded7c6109f85bed7d75c05",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "motion",
                                        "idx": "0",
                                        "platform": "state",
                                        "entity_id": "binary_sensor.hallway_motion",
                                        "from_state": {
                                            "entity_id": "binary_sensor.hallway_motion",
                                            "state": "off",
                                            "attributes": {
                                                "device_class": "motion",
                                                "friendly_name": "Hallway Motion"
                                            },
                                            "last_changed": "2022-03-03T07:55:07.258646+00:00",
                                            "last_updated": "2022-03-03T07:55:07.258646+00:00",
                                            "context": {
                                                "id": "ce8c539533ded7c6109f85bed7d75c05",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "to_state": {
                                            "entity_id": "binary_sensor.hallway_motion",
                                            "state": "on",
                                            "attributes": {
                                                "device_class": "motion",
                                                "friendly_name": "Hallway Motion"
                                            },
                                            "last_changed": "2022-03-03T08:01:20.758960+00:00",
                                            "last_updated": "2022-03-03T08:01:20.758960+00:00",
                                            "context": {
                                                "id": "ba5ebbfe06e1b058117bcd97701ab113",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "for": null,
                                        "attribute": null,
                                        "description": "state of binary_sensor.hallway_motion"
                                    }
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T08:01:20.761744+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "3c21549e685fb178aba966c89366d157",
                                        "parent_id": "ba5ebbfe06e1b058117bcd97701ab113",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "choice": 0
                                }
                            }
                        ],
                        "action/0/choose/0": [
                            {
                                "path": "action/0/choose/0",
                                "timestamp": "2022-03-03T08:01:20.761839+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/0/conditions/0",
                                "timestamp": "2022-03-03T08:01:20.762547+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/0": [
                            {
                                "path": "action/0/choose/0/sequence/0",
                                "timestamp": "2022-03-03T08:01:20.763579+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/0/entity_id/0": [
                            {
                                "path": "action/0/choose/0/sequence/0/entity_id/0",
                                "timestamp": "2022-03-03T08:01:20.763657+00:00",
                                "result": {
                                    "result": true,
                                    "state": "on",
                                    "wanted_state": "on"
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/1": [
                            {
                                "path": "action/0/choose/0/sequence/1",
                                "timestamp": "2022-03-03T08:01:20.763798+00:00",
                                "result": {
                                    "choice": "default"
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/1/choose/0": [
                            {
                                "path": "action/0/choose/0/sequence/1/choose/0",
                                "timestamp": "2022-03-03T08:01:20.763854+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/1/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/0/sequence/1/choose/0/conditions/0",
                                "timestamp": "2022-03-03T08:01:20.763888+00:00",
                                "result": {
                                    "after": {
                                        "__type": "<class 'datetime.time'>",
                                        "isoformat": "21:00:00"
                                    },
                                    "now_time": {
                                        "__type": "<class 'datetime.time'>",
                                        "isoformat": "16:01:20.763898"
                                    },
                                    "before": {
                                        "__type": "<class 'datetime.time'>",
                                        "isoformat": "07:00:00"
                                    },
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/1/default/0": [
                            {
                                "path": "action/0/choose/0/sequence/1/default/0",
                                "timestamp": "2022-03-03T08:01:20.764158+00:00",
                                "result": {
                                    "params": {
                                        "domain": "light",
                                        "service": "turn_on",
                                        "service_data": {
                                            "brightness_pct": 100,
                                            "entity_id": [
                                                "light.hallway_lights"
                                            ]
                                        },
                                        "target": {
                                            "entity_id": [
                                                "light.hallway_lights"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ]
                    },
                    "config": {
                        "id": "1643642651826",
                        "alias": "Hallway Motion",
                        "description": "Control the Hallway Lights with motion",
                        "trigger": [
                            {
                                "platform": "state",
                                "entity_id": "binary_sensor.hallway_motion",
                                "id": "motion",
                                "from": "off",
                                "to": "on"
                            },
                            {
                                "platform": "state",
                                "entity_id": "binary_sensor.hallway_motion",
                                "id": "no_motion",
                                "from": "on",
                                "to": "off"
                            }
                        ],
                        "condition": [],
                        "action": [
                            {
                                "choose": [
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "motion"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "condition": "state",
                                                "entity_id": "switch.lights_auto_control",
                                                "state": "on"
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [
                                                            {
                                                                "condition": "time",
                                                                "after": "input_datetime.elenas_wind_down",
                                                                "before": "input_datetime.lights_auto_control_end"
                                                            }
                                                        ],
                                                        "sequence": [
                                                            {
                                                                "service": "light.turn_on",
                                                                "target": {
                                                                    "entity_id": "light.hallway_lights"
                                                                },
                                                                "data": {
                                                                    "brightness_pct": 5
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.hallway_lights"
                                                        },
                                                        "data": {
                                                            "brightness_pct": 100
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "no_motion"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "light.turn_off",
                                                "target": {
                                                    "entity_id": "light.hallway_lights"
                                                }
                                            }
                                        ]
                                    }
                                ],
                                "default": []
                            }
                        ],
                        "mode": "single"
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "3c21549e685fb178aba966c89366d157",
                        "parent_id": "ba5ebbfe06e1b058117bcd97701ab113",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/0/choose/0/sequence/1/default/0",
                    "run_id": "9e52185147f434a4d218daded89652bf",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T08:01:20.759929+00:00",
                        "finish": "2022-03-03T08:01:25.788292+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643642651826",
                    "trigger": "state of binary_sensor.hallway_motion"
                }
            }
        ],
        "script.turn_off_elenas_room": [
            {
                "extended_dict": {
                    "last_step": "sequence/3",
                    "run_id": "93e530b10bdf27a687a1065cf5df3015",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T00:42:10.808915+00:00",
                        "finish": "2022-03-03T00:42:10.947180+00:00"
                    },
                    "domain": "script",
                    "item_id": "turn_off_elenas_room",
                    "trace": {
                        "sequence/0": [
                            {
                                "path": "sequence/0",
                                "timestamp": "2022-03-03T00:42:10.810105+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "script.turn_off_elenas_room",
                                        "state": "off",
                                        "attributes": {
                                            "last_triggered": "2022-03-02T23:34:10.315991+00:00",
                                            "mode": "single",
                                            "current": 0,
                                            "icon": "mdi:power",
                                            "friendly_name": "Turn Off Elena's Room"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.573383+00:00",
                                        "last_updated": "2022-03-03T00:41:11.573383+00:00",
                                        "context": {
                                            "id": "60367374e0e908aca18485883b637ed0",
                                            "parent_id": null,
                                            "user_id": null
                                        }
                                    },
                                    "context": {
                                        "id": "cfe5700bfa6b4434b8b99d0a9e0fdcb0",
                                        "parent_id": null,
                                        "user_id": "ad2bcce775894550affb6dfef93a2a36"
                                    }
                                },
                                "result": {
                                    "params": {
                                        "domain": "automation",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "automation.elenas_room_ac_auto_control"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "sequence/1": [
                            {
                                "path": "sequence/1",
                                "timestamp": "2022-03-03T00:42:10.811842+00:00",
                                "result": {
                                    "params": {
                                        "domain": "fan",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "fan.elenas_room_fan"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "sequence/1/0": [
                            {
                                "path": "sequence/1/0",
                                "timestamp": "2022-03-03T00:42:10.812484+00:00",
                                "child_id": {
                                    "domain": "automation",
                                    "item_id": "1643000778073",
                                    "run_id": "b642862daee9e4d69212a166f153248c"
                                },
                                "result": {
                                    "params": {
                                        "domain": "input_boolean",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "input_boolean.elenas_room_fan_power"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "sequence/2": [
                            {
                                "path": "sequence/2",
                                "timestamp": "2022-03-03T00:42:10.821178+00:00",
                                "result": {
                                    "params": {
                                        "domain": "climate",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "climate.elenas_room_ac"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "sequence/3": [
                            {
                                "path": "sequence/3",
                                "timestamp": "2022-03-03T00:42:10.822660+00:00",
                                "result": {
                                    "params": {
                                        "domain": "light",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "light.elenas_room_lights"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ]
                    },
                    "config": {
                        "sequence": [
                            {
                                "service": "automation.turn_off",
                                "target": {
                                    "entity_id": "automation.elenas_room_ac_auto_control"
                                },
                                "data": {}
                            },
                            {
                                "service": "fan.turn_off",
                                "data": {},
                                "target": {
                                    "entity_id": "fan.elenas_room_fan"
                                }
                            },
                            {
                                "service": "climate.turn_off",
                                "target": {
                                    "entity_id": "climate.elenas_room_ac"
                                },
                                "data": {}
                            },
                            {
                                "service": "light.turn_off",
                                "target": {
                                    "entity_id": "light.elenas_room_lights"
                                },
                                "data": {}
                            }
                        ],
                        "mode": "single",
                        "alias": "Turn Off Elena's Room",
                        "icon": "mdi:power"
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "cfe5700bfa6b4434b8b99d0a9e0fdcb0",
                        "parent_id": null,
                        "user_id": "ad2bcce775894550affb6dfef93a2a36"
                    }
                },
                "short_dict": {
                    "last_step": "sequence/3",
                    "run_id": "93e530b10bdf27a687a1065cf5df3015",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T00:42:10.808915+00:00",
                        "finish": "2022-03-03T00:42:10.947180+00:00"
                    },
                    "domain": "script",
                    "item_id": "turn_off_elenas_room"
                }
            },
            {
                "extended_dict": {
                    "last_step": "sequence/3",
                    "run_id": "e14858d62726e39a17aa5279f1e3ebfd",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T00:42:47.664625+00:00",
                        "finish": "2022-03-03T00:42:47.824524+00:00"
                    },
                    "domain": "script",
                    "item_id": "turn_off_elenas_room",
                    "trace": {
                        "sequence/0": [
                            {
                                "path": "sequence/0",
                                "timestamp": "2022-03-03T00:42:47.665351+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "script.turn_off_elenas_room",
                                        "state": "off",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T00:42:10.808991+00:00",
                                            "mode": "single",
                                            "current": 0,
                                            "icon": "mdi:power",
                                            "friendly_name": "Turn Off Elena's Room"
                                        },
                                        "last_changed": "2022-03-03T00:42:10.946039+00:00",
                                        "last_updated": "2022-03-03T00:42:10.946039+00:00",
                                        "context": {
                                            "id": "cfe5700bfa6b4434b8b99d0a9e0fdcb0",
                                            "parent_id": null,
                                            "user_id": "ad2bcce775894550affb6dfef93a2a36"
                                        }
                                    },
                                    "context": {
                                        "id": "7d3e105f5dc2af0a644046a2b86bca0b",
                                        "parent_id": null,
                                        "user_id": "ad2bcce775894550affb6dfef93a2a36"
                                    }
                                },
                                "result": {
                                    "params": {
                                        "domain": "automation",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "automation.elenas_room_ac_auto_control"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "sequence/1": [
                            {
                                "path": "sequence/1",
                                "timestamp": "2022-03-03T00:42:47.667267+00:00",
                                "result": {
                                    "params": {
                                        "domain": "fan",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "fan.elenas_room_fan"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "sequence/1/0": [
                            {
                                "path": "sequence/1/0",
                                "timestamp": "2022-03-03T00:42:47.668217+00:00",
                                "child_id": {
                                    "domain": "automation",
                                    "item_id": "1643000778073",
                                    "run_id": "b4c6fc90e2bcb9b4e8bff6d757cbe396"
                                },
                                "result": {
                                    "params": {
                                        "domain": "input_boolean",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "input_boolean.elenas_room_fan_power"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "sequence/2": [
                            {
                                "path": "sequence/2",
                                "timestamp": "2022-03-03T00:42:47.676199+00:00",
                                "result": {
                                    "params": {
                                        "domain": "climate",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "climate.elenas_room_ac"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "sequence/3": [
                            {
                                "path": "sequence/3",
                                "timestamp": "2022-03-03T00:42:47.677401+00:00",
                                "result": {
                                    "params": {
                                        "domain": "light",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "light.elenas_room_lights"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ]
                    },
                    "config": {
                        "sequence": [
                            {
                                "service": "automation.turn_off",
                                "target": {
                                    "entity_id": "automation.elenas_room_ac_auto_control"
                                },
                                "data": {}
                            },
                            {
                                "service": "fan.turn_off",
                                "data": {},
                                "target": {
                                    "entity_id": "fan.elenas_room_fan"
                                }
                            },
                            {
                                "service": "climate.turn_off",
                                "target": {
                                    "entity_id": "climate.elenas_room_ac"
                                },
                                "data": {}
                            },
                            {
                                "service": "light.turn_off",
                                "target": {
                                    "entity_id": "light.elenas_room_lights"
                                },
                                "data": {}
                            }
                        ],
                        "mode": "single",
                        "alias": "Turn Off Elena's Room",
                        "icon": "mdi:power"
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "7d3e105f5dc2af0a644046a2b86bca0b",
                        "parent_id": null,
                        "user_id": "ad2bcce775894550affb6dfef93a2a36"
                    }
                },
                "short_dict": {
                    "last_step": "sequence/3",
                    "run_id": "e14858d62726e39a17aa5279f1e3ebfd",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T00:42:47.664625+00:00",
                        "finish": "2022-03-03T00:42:47.824524+00:00"
                    },
                    "domain": "script",
                    "item_id": "turn_off_elenas_room"
                }
            },
            {
                "extended_dict": {
                    "last_step": "sequence/3",
                    "run_id": "3f3d77a1919483b32db2949306382d7a",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T00:43:16.257833+00:00",
                        "finish": "2022-03-03T00:43:16.402642+00:00"
                    },
                    "domain": "script",
                    "item_id": "turn_off_elenas_room",
                    "trace": {
                        "sequence/0": [
                            {
                                "path": "sequence/0",
                                "timestamp": "2022-03-03T00:43:16.258507+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "script.turn_off_elenas_room",
                                        "state": "off",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T00:42:47.664725+00:00",
                                            "mode": "single",
                                            "current": 0,
                                            "icon": "mdi:power",
                                            "friendly_name": "Turn Off Elena's Room"
                                        },
                                        "last_changed": "2022-03-03T00:42:47.823277+00:00",
                                        "last_updated": "2022-03-03T00:42:47.823277+00:00",
                                        "context": {
                                            "id": "7d3e105f5dc2af0a644046a2b86bca0b",
                                            "parent_id": null,
                                            "user_id": "ad2bcce775894550affb6dfef93a2a36"
                                        }
                                    },
                                    "context": {
                                        "id": "d543117ad50afa81dbb9822987ec51f9",
                                        "parent_id": null,
                                        "user_id": "ad2bcce775894550affb6dfef93a2a36"
                                    }
                                },
                                "result": {
                                    "params": {
                                        "domain": "automation",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "automation.elenas_room_ac_auto_control"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "sequence/1": [
                            {
                                "path": "sequence/1",
                                "timestamp": "2022-03-03T00:43:16.260386+00:00",
                                "result": {
                                    "params": {
                                        "domain": "fan",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "fan.elenas_room_fan"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "sequence/1/0": [
                            {
                                "path": "sequence/1/0",
                                "timestamp": "2022-03-03T00:43:16.261303+00:00",
                                "child_id": {
                                    "domain": "automation",
                                    "item_id": "1643000778073",
                                    "run_id": "1a8161d1193a322c0e0f4c7e1538ab35"
                                },
                                "result": {
                                    "params": {
                                        "domain": "input_boolean",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "input_boolean.elenas_room_fan_power"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "sequence/2": [
                            {
                                "path": "sequence/2",
                                "timestamp": "2022-03-03T00:43:16.271291+00:00",
                                "result": {
                                    "params": {
                                        "domain": "climate",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "climate.elenas_room_ac"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "sequence/3": [
                            {
                                "path": "sequence/3",
                                "timestamp": "2022-03-03T00:43:16.273097+00:00",
                                "result": {
                                    "params": {
                                        "domain": "light",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "light.elenas_room_lights"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ]
                    },
                    "config": {
                        "sequence": [
                            {
                                "service": "automation.turn_off",
                                "target": {
                                    "entity_id": "automation.elenas_room_ac_auto_control"
                                },
                                "data": {}
                            },
                            {
                                "service": "fan.turn_off",
                                "data": {},
                                "target": {
                                    "entity_id": "fan.elenas_room_fan"
                                }
                            },
                            {
                                "service": "climate.turn_off",
                                "target": {
                                    "entity_id": "climate.elenas_room_ac"
                                },
                                "data": {}
                            },
                            {
                                "service": "light.turn_off",
                                "target": {
                                    "entity_id": "light.elenas_room_lights"
                                },
                                "data": {}
                            }
                        ],
                        "mode": "single",
                        "alias": "Turn Off Elena's Room",
                        "icon": "mdi:power"
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "d543117ad50afa81dbb9822987ec51f9",
                        "parent_id": null,
                        "user_id": "ad2bcce775894550affb6dfef93a2a36"
                    }
                },
                "short_dict": {
                    "last_step": "sequence/3",
                    "run_id": "3f3d77a1919483b32db2949306382d7a",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T00:43:16.257833+00:00",
                        "finish": "2022-03-03T00:43:16.402642+00:00"
                    },
                    "domain": "script",
                    "item_id": "turn_off_elenas_room"
                }
            },
            {
                "extended_dict": {
                    "last_step": "sequence/3",
                    "run_id": "0aac537bcaf43e071bbaa2013461724b",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:09:46.791744+00:00",
                        "finish": "2022-03-03T05:09:46.935811+00:00"
                    },
                    "domain": "script",
                    "item_id": "turn_off_elenas_room",
                    "trace": {
                        "sequence/0": [
                            {
                                "path": "sequence/0",
                                "timestamp": "2022-03-03T05:09:46.792346+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "script.turn_off_elenas_room",
                                        "state": "off",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T00:43:16.257932+00:00",
                                            "mode": "single",
                                            "current": 0,
                                            "icon": "mdi:power",
                                            "friendly_name": "Turn Off Elena's Room"
                                        },
                                        "last_changed": "2022-03-03T00:43:16.401447+00:00",
                                        "last_updated": "2022-03-03T00:43:16.401447+00:00",
                                        "context": {
                                            "id": "d543117ad50afa81dbb9822987ec51f9",
                                            "parent_id": null,
                                            "user_id": "ad2bcce775894550affb6dfef93a2a36"
                                        }
                                    },
                                    "context": {
                                        "id": "3c34ab25510e6c3602cf039455c14bd6",
                                        "parent_id": null,
                                        "user_id": "ad2bcce775894550affb6dfef93a2a36"
                                    }
                                },
                                "result": {
                                    "params": {
                                        "domain": "automation",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "automation.elenas_room_ac_auto_control"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "sequence/1": [
                            {
                                "path": "sequence/1",
                                "timestamp": "2022-03-03T05:09:46.794097+00:00",
                                "result": {
                                    "params": {
                                        "domain": "fan",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "fan.elenas_room_fan"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "sequence/1/0": [
                            {
                                "path": "sequence/1/0",
                                "timestamp": "2022-03-03T05:09:46.794931+00:00",
                                "result": {
                                    "params": {
                                        "domain": "input_boolean",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "input_boolean.elenas_room_fan_power"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "sequence/2": [
                            {
                                "path": "sequence/2",
                                "timestamp": "2022-03-03T05:09:46.795851+00:00",
                                "result": {
                                    "params": {
                                        "domain": "climate",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "climate.elenas_room_ac"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "sequence/3": [
                            {
                                "path": "sequence/3",
                                "timestamp": "2022-03-03T05:09:46.797900+00:00",
                                "result": {
                                    "params": {
                                        "domain": "light",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "light.elenas_room_lights"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ]
                    },
                    "config": {
                        "sequence": [
                            {
                                "service": "automation.turn_off",
                                "target": {
                                    "entity_id": "automation.elenas_room_ac_auto_control"
                                },
                                "data": {}
                            },
                            {
                                "service": "fan.turn_off",
                                "data": {},
                                "target": {
                                    "entity_id": "fan.elenas_room_fan"
                                }
                            },
                            {
                                "service": "climate.turn_off",
                                "target": {
                                    "entity_id": "climate.elenas_room_ac"
                                },
                                "data": {}
                            },
                            {
                                "service": "light.turn_off",
                                "target": {
                                    "entity_id": "light.elenas_room_lights"
                                },
                                "data": {}
                            }
                        ],
                        "mode": "single",
                        "alias": "Turn Off Elena's Room",
                        "icon": "mdi:power"
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "3c34ab25510e6c3602cf039455c14bd6",
                        "parent_id": null,
                        "user_id": "ad2bcce775894550affb6dfef93a2a36"
                    }
                },
                "short_dict": {
                    "last_step": "sequence/3",
                    "run_id": "0aac537bcaf43e071bbaa2013461724b",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:09:46.791744+00:00",
                        "finish": "2022-03-03T05:09:46.935811+00:00"
                    },
                    "domain": "script",
                    "item_id": "turn_off_elenas_room"
                }
            }
        ],
        "automation.1642998485292": [
            {
                "extended_dict": {
                    "last_step": "action/0/choose/1/sequence/1",
                    "run_id": "0328793ee3ff79ef9ba9ae82b462c1d2",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T00:48:35.589851+00:00",
                        "finish": "2022-03-03T00:48:37.902738+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1642998485292",
                    "trigger": "state of fan.elis_room_fan",
                    "trace": {
                        "trigger/1": [
                            {
                                "path": "trigger/1",
                                "timestamp": "2022-03-03T00:48:35.589886+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.elis_room_fan_set_state",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T00:48:35.589731+00:00",
                                            "mode": "queued",
                                            "current": 1,
                                            "max": 10,
                                            "id": "1642998485292",
                                            "friendly_name": "Eli's Room Fan Set State"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.797685+00:00",
                                        "last_updated": "2022-03-03T00:48:35.589759+00:00",
                                        "context": {
                                            "id": "2e4822911c5ae1155e3bda22aeeced9a",
                                            "parent_id": "8da6db62e8988b109b27ca52d434d20b",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "speed",
                                        "idx": "1",
                                        "platform": "state",
                                        "entity_id": "fan.elis_room_fan",
                                        "from_state": {
                                            "entity_id": "fan.elis_room_fan",
                                            "state": "off",
                                            "attributes": {
                                                "speed_list": [
                                                    "off",
                                                    "low",
                                                    "medium",
                                                    "high"
                                                ],
                                                "preset_modes": null,
                                                "speed": "medium",
                                                "percentage": 50,
                                                "percentage_step": 16.666666666666668,
                                                "preset_mode": null,
                                                "friendly_name": "Eli's Room Fan",
                                                "supported_features": 1
                                            },
                                            "last_changed": "2022-03-03T00:43:24.875120+00:00",
                                            "last_updated": "2022-03-03T00:43:24.875120+00:00",
                                            "context": {
                                                "id": "c5e97d713a12a399871169073fc153fd",
                                                "parent_id": null,
                                                "user_id": "ad2bcce775894550affb6dfef93a2a36"
                                            }
                                        },
                                        "to_state": {
                                            "entity_id": "fan.elis_room_fan",
                                            "state": "unavailable",
                                            "attributes": {
                                                "restored": true,
                                                "speed_list": [
                                                    "off",
                                                    "low",
                                                    "medium",
                                                    "high"
                                                ],
                                                "preset_modes": null,
                                                "friendly_name": "Eli's Room Fan",
                                                "supported_features": 1
                                            },
                                            "last_changed": "2022-03-03T00:48:35.579657+00:00",
                                            "last_updated": "2022-03-03T00:48:35.579657+00:00",
                                            "context": {
                                                "id": "8da6db62e8988b109b27ca52d434d20b",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "for": null,
                                        "attribute": "percentage",
                                        "description": "state of fan.elis_room_fan"
                                    }
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T00:48:37.251304+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "a805724664af5de132f17f5471012daf",
                                        "parent_id": "8da6db62e8988b109b27ca52d434d20b",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "choice": 1
                                }
                            }
                        ],
                        "action/0/choose/0": [
                            {
                                "path": "action/0/choose/0",
                                "timestamp": "2022-03-03T00:48:37.251358+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/0/conditions/0",
                                "timestamp": "2022-03-03T00:48:37.251381+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/1": [
                            {
                                "path": "action/0/choose/1",
                                "timestamp": "2022-03-03T00:48:37.251417+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/1/conditions/0": [
                            {
                                "path": "action/0/choose/1/conditions/0",
                                "timestamp": "2022-03-03T00:48:37.251432+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/1/sequence/0": [
                            {
                                "path": "action/0/choose/1/sequence/0",
                                "timestamp": "2022-03-03T00:48:37.251690+00:00",
                                "result": {
                                    "params": {
                                        "domain": "fan",
                                        "service": "turn_on",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "fan.elis_room_fan"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "action/0/choose/1/sequence/0/0": [
                            {
                                "path": "action/0/choose/1/sequence/0/0",
                                "timestamp": "2022-03-03T00:48:37.252451+00:00",
                                "child_id": {
                                    "domain": "automation",
                                    "item_id": "1642998485292",
                                    "run_id": "659a9cf175b48fbc41b8fa85a4ff533a"
                                },
                                "changed_variables": {
                                    "speed": null,
                                    "percentage": null,
                                    "preset_mode": null
                                },
                                "result": {
                                    "params": {
                                        "domain": "input_boolean",
                                        "service": "turn_on",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "input_boolean.elis_room_fan_power"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "action/0/choose/1/sequence/1": [
                            {
                                "path": "action/0/choose/1/sequence/1",
                                "timestamp": "2022-03-03T00:48:37.259492+00:00",
                                "child_id": {
                                    "domain": "script",
                                    "item_id": "1642846136869",
                                    "run_id": "6f9533fb36bfbef834bc1d34bcd91e36"
                                },
                                "result": {
                                    "params": {
                                        "domain": "script",
                                        "service": "1642846136869",
                                        "service_data": {
                                            "target_fan": "Eli's Room Fan",
                                            "target_fan_speed": 50,
                                            "target_fan_power": true
                                        },
                                        "target": {}
                                    },
                                    "running_script": true,
                                    "limit": null
                                }
                            }
                        ]
                    },
                    "config": {
                        "id": "1642998485292",
                        "alias": "Eli's Room Fan Set State",
                        "description": "Set Eli's Room Fan power and speed",
                        "trigger": [
                            {
                                "platform": "state",
                                "entity_id": "fan.elis_room_fan",
                                "id": "power"
                            },
                            {
                                "platform": "state",
                                "entity_id": "fan.elis_room_fan",
                                "id": "speed",
                                "attribute": "percentage"
                            }
                        ],
                        "condition": [],
                        "action": [
                            {
                                "choose": [
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "power"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [
                                                            {
                                                                "condition": "state",
                                                                "entity_id": "fan.elis_room_fan",
                                                                "state": "off"
                                                            }
                                                        ],
                                                        "sequence": [
                                                            {
                                                                "service": "script.1642846136869",
                                                                "data": {
                                                                    "target_fan": "Eli's Room Fan",
                                                                    "target_fan_power": false,
                                                                    "target_fan_speed": "{{ state_attr(\"fan.elis_room_fan\", \"percentage\") | int }}"
                                                                }
                                                            }
                                                        ]
                                                    },
                                                    {
                                                        "conditions": [
                                                            {
                                                                "condition": "state",
                                                                "entity_id": "fan.elis_room_fan",
                                                                "state": "on"
                                                            }
                                                        ],
                                                        "sequence": [
                                                            {
                                                                "service": "script.1642846136869",
                                                                "data": {
                                                                    "target_fan": "Eli's Room Fan",
                                                                    "target_fan_power": true,
                                                                    "target_fan_speed": "{{ state_attr(\"fan.elis_room_fan\", \"percentage\") | int }}"
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": []
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "speed"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "fan.turn_on",
                                                "target": {
                                                    "entity_id": "fan.elis_room_fan"
                                                }
                                            },
                                            {
                                                "service": "script.1642846136869",
                                                "data": {
                                                    "target_fan": "Eli's Room Fan",
                                                    "target_fan_speed": "{{ state_attr(\"fan.elis_room_fan\", \"percentage\") | int }}",
                                                    "target_fan_power": true
                                                }
                                            }
                                        ]
                                    }
                                ],
                                "default": []
                            }
                        ],
                        "mode": "queued",
                        "max": 10
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "a805724664af5de132f17f5471012daf",
                        "parent_id": "8da6db62e8988b109b27ca52d434d20b",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/0/choose/1/sequence/1",
                    "run_id": "0328793ee3ff79ef9ba9ae82b462c1d2",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T00:48:35.589851+00:00",
                        "finish": "2022-03-03T00:48:37.902738+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1642998485292",
                    "trigger": "state of fan.elis_room_fan"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/0/choose/0/sequence/0/choose/1/sequence/0",
                    "run_id": "54503ad6243dcf569009e20d6ee3c244",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T00:48:35.608883+00:00",
                        "finish": "2022-03-03T00:48:38.570557+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1642998485292",
                    "trigger": "state of fan.elis_room_fan",
                    "trace": {
                        "trigger/0": [
                            {
                                "path": "trigger/0",
                                "timestamp": "2022-03-03T00:48:35.608939+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.elis_room_fan_set_state",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T00:48:35.589954+00:00",
                                            "mode": "queued",
                                            "current": 2,
                                            "max": 10,
                                            "id": "1642998485292",
                                            "friendly_name": "Eli's Room Fan Set State"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.797685+00:00",
                                        "last_updated": "2022-03-03T00:48:35.589979+00:00",
                                        "context": {
                                            "id": "a805724664af5de132f17f5471012daf",
                                            "parent_id": "8da6db62e8988b109b27ca52d434d20b",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "power",
                                        "idx": "0",
                                        "platform": "state",
                                        "entity_id": "fan.elis_room_fan",
                                        "from_state": {
                                            "entity_id": "fan.elis_room_fan",
                                            "state": "unavailable",
                                            "attributes": {
                                                "restored": true,
                                                "speed_list": [
                                                    "off",
                                                    "low",
                                                    "medium",
                                                    "high"
                                                ],
                                                "preset_modes": null,
                                                "friendly_name": "Eli's Room Fan",
                                                "supported_features": 1
                                            },
                                            "last_changed": "2022-03-03T00:48:35.579657+00:00",
                                            "last_updated": "2022-03-03T00:48:35.579657+00:00",
                                            "context": {
                                                "id": "8da6db62e8988b109b27ca52d434d20b",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "to_state": {
                                            "entity_id": "fan.elis_room_fan",
                                            "state": "off",
                                            "attributes": {
                                                "speed_list": [
                                                    "off",
                                                    "low",
                                                    "medium",
                                                    "high"
                                                ],
                                                "preset_modes": null,
                                                "speed": "medium",
                                                "percentage": 50,
                                                "percentage_step": 16.666666666666668,
                                                "preset_mode": null,
                                                "friendly_name": "Eli's Room Fan",
                                                "supported_features": 1
                                            },
                                            "last_changed": "2022-03-03T00:48:35.602349+00:00",
                                            "last_updated": "2022-03-03T00:48:35.602349+00:00",
                                            "context": {
                                                "id": "06d97ea1db77c470a04bac2008a2b3e2",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "for": null,
                                        "attribute": null,
                                        "description": "state of fan.elis_room_fan"
                                    }
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T00:48:37.902863+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "da83d4794cd248d7bdaae0e548943560",
                                        "parent_id": "06d97ea1db77c470a04bac2008a2b3e2",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "choice": 0
                                }
                            }
                        ],
                        "action/0/choose/0": [
                            {
                                "path": "action/0/choose/0",
                                "timestamp": "2022-03-03T00:48:37.902934+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/0/conditions/0",
                                "timestamp": "2022-03-03T00:48:37.902957+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/0": [
                            {
                                "path": "action/0/choose/0/sequence/0",
                                "timestamp": "2022-03-03T00:48:37.903278+00:00",
                                "result": {
                                    "choice": 1
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/0/choose/0": [
                            {
                                "path": "action/0/choose/0/sequence/0/choose/0",
                                "timestamp": "2022-03-03T00:48:37.903318+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/0/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/0/sequence/0/choose/0/conditions/0",
                                "timestamp": "2022-03-03T00:48:37.903337+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/0/choose/0/conditions/0/entity_id/0": [
                            {
                                "path": "action/0/choose/0/sequence/0/choose/0/conditions/0/entity_id/0",
                                "timestamp": "2022-03-03T00:48:37.903351+00:00",
                                "result": {
                                    "result": false,
                                    "state": "on",
                                    "wanted_state": "off"
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/0/choose/1": [
                            {
                                "path": "action/0/choose/0/sequence/0/choose/1",
                                "timestamp": "2022-03-03T00:48:37.903396+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/0/choose/1/conditions/0": [
                            {
                                "path": "action/0/choose/0/sequence/0/choose/1/conditions/0",
                                "timestamp": "2022-03-03T00:48:37.903411+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/0/choose/1/conditions/0/entity_id/0": [
                            {
                                "path": "action/0/choose/0/sequence/0/choose/1/conditions/0/entity_id/0",
                                "timestamp": "2022-03-03T00:48:37.903423+00:00",
                                "result": {
                                    "result": true,
                                    "state": "on",
                                    "wanted_state": "on"
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/0/choose/1/sequence/0": [
                            {
                                "path": "action/0/choose/0/sequence/0/choose/1/sequence/0",
                                "timestamp": "2022-03-03T00:48:37.903731+00:00",
                                "child_id": {
                                    "domain": "script",
                                    "item_id": "1642846136869",
                                    "run_id": "ca8d6d917a69d5f143584e8f3dca7f6b"
                                },
                                "result": {
                                    "params": {
                                        "domain": "script",
                                        "service": "1642846136869",
                                        "service_data": {
                                            "target_fan": "Eli's Room Fan",
                                            "target_fan_power": true,
                                            "target_fan_speed": 50
                                        },
                                        "target": {}
                                    },
                                    "running_script": true,
                                    "limit": null
                                }
                            }
                        ]
                    },
                    "config": {
                        "id": "1642998485292",
                        "alias": "Eli's Room Fan Set State",
                        "description": "Set Eli's Room Fan power and speed",
                        "trigger": [
                            {
                                "platform": "state",
                                "entity_id": "fan.elis_room_fan",
                                "id": "power"
                            },
                            {
                                "platform": "state",
                                "entity_id": "fan.elis_room_fan",
                                "id": "speed",
                                "attribute": "percentage"
                            }
                        ],
                        "condition": [],
                        "action": [
                            {
                                "choose": [
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "power"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [
                                                            {
                                                                "condition": "state",
                                                                "entity_id": "fan.elis_room_fan",
                                                                "state": "off"
                                                            }
                                                        ],
                                                        "sequence": [
                                                            {
                                                                "service": "script.1642846136869",
                                                                "data": {
                                                                    "target_fan": "Eli's Room Fan",
                                                                    "target_fan_power": false,
                                                                    "target_fan_speed": "{{ state_attr(\"fan.elis_room_fan\", \"percentage\") | int }}"
                                                                }
                                                            }
                                                        ]
                                                    },
                                                    {
                                                        "conditions": [
                                                            {
                                                                "condition": "state",
                                                                "entity_id": "fan.elis_room_fan",
                                                                "state": "on"
                                                            }
                                                        ],
                                                        "sequence": [
                                                            {
                                                                "service": "script.1642846136869",
                                                                "data": {
                                                                    "target_fan": "Eli's Room Fan",
                                                                    "target_fan_power": true,
                                                                    "target_fan_speed": "{{ state_attr(\"fan.elis_room_fan\", \"percentage\") | int }}"
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": []
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "speed"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "fan.turn_on",
                                                "target": {
                                                    "entity_id": "fan.elis_room_fan"
                                                }
                                            },
                                            {
                                                "service": "script.1642846136869",
                                                "data": {
                                                    "target_fan": "Eli's Room Fan",
                                                    "target_fan_speed": "{{ state_attr(\"fan.elis_room_fan\", \"percentage\") | int }}",
                                                    "target_fan_power": true
                                                }
                                            }
                                        ]
                                    }
                                ],
                                "default": []
                            }
                        ],
                        "mode": "queued",
                        "max": 10
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "da83d4794cd248d7bdaae0e548943560",
                        "parent_id": "06d97ea1db77c470a04bac2008a2b3e2",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/0/choose/0/sequence/0/choose/1/sequence/0",
                    "run_id": "54503ad6243dcf569009e20d6ee3c244",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T00:48:35.608883+00:00",
                        "finish": "2022-03-03T00:48:38.570557+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1642998485292",
                    "trigger": "state of fan.elis_room_fan"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/0/choose/1/sequence/1",
                    "run_id": "89780d2d64b7668b381565c646bcc0d4",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T00:48:35.609145+00:00",
                        "finish": "2022-03-03T00:48:39.199266+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1642998485292",
                    "trigger": "state of fan.elis_room_fan",
                    "trace": {
                        "trigger/1": [
                            {
                                "path": "trigger/1",
                                "timestamp": "2022-03-03T00:48:35.609202+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.elis_room_fan_set_state",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T00:48:35.609016+00:00",
                                            "mode": "queued",
                                            "current": 3,
                                            "max": 10,
                                            "id": "1642998485292",
                                            "friendly_name": "Eli's Room Fan Set State"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.797685+00:00",
                                        "last_updated": "2022-03-03T00:48:35.609047+00:00",
                                        "context": {
                                            "id": "da83d4794cd248d7bdaae0e548943560",
                                            "parent_id": "06d97ea1db77c470a04bac2008a2b3e2",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "speed",
                                        "idx": "1",
                                        "platform": "state",
                                        "entity_id": "fan.elis_room_fan",
                                        "from_state": {
                                            "entity_id": "fan.elis_room_fan",
                                            "state": "unavailable",
                                            "attributes": {
                                                "restored": true,
                                                "speed_list": [
                                                    "off",
                                                    "low",
                                                    "medium",
                                                    "high"
                                                ],
                                                "preset_modes": null,
                                                "friendly_name": "Eli's Room Fan",
                                                "supported_features": 1
                                            },
                                            "last_changed": "2022-03-03T00:48:35.579657+00:00",
                                            "last_updated": "2022-03-03T00:48:35.579657+00:00",
                                            "context": {
                                                "id": "8da6db62e8988b109b27ca52d434d20b",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "to_state": {
                                            "entity_id": "fan.elis_room_fan",
                                            "state": "off",
                                            "attributes": {
                                                "speed_list": [
                                                    "off",
                                                    "low",
                                                    "medium",
                                                    "high"
                                                ],
                                                "preset_modes": null,
                                                "speed": "medium",
                                                "percentage": 50,
                                                "percentage_step": 16.666666666666668,
                                                "preset_mode": null,
                                                "friendly_name": "Eli's Room Fan",
                                                "supported_features": 1
                                            },
                                            "last_changed": "2022-03-03T00:48:35.602349+00:00",
                                            "last_updated": "2022-03-03T00:48:35.602349+00:00",
                                            "context": {
                                                "id": "06d97ea1db77c470a04bac2008a2b3e2",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "for": null,
                                        "attribute": "percentage",
                                        "description": "state of fan.elis_room_fan"
                                    }
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T00:48:38.570649+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "91e0c347a8bbba5d9ef5f36bde3e60d1",
                                        "parent_id": "06d97ea1db77c470a04bac2008a2b3e2",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "choice": 1
                                }
                            }
                        ],
                        "action/0/choose/0": [
                            {
                                "path": "action/0/choose/0",
                                "timestamp": "2022-03-03T00:48:38.570748+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/0/conditions/0",
                                "timestamp": "2022-03-03T00:48:38.570780+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/1": [
                            {
                                "path": "action/0/choose/1",
                                "timestamp": "2022-03-03T00:48:38.570822+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/1/conditions/0": [
                            {
                                "path": "action/0/choose/1/conditions/0",
                                "timestamp": "2022-03-03T00:48:38.570839+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/1/sequence/0": [
                            {
                                "path": "action/0/choose/1/sequence/0",
                                "timestamp": "2022-03-03T00:48:38.571115+00:00",
                                "result": {
                                    "params": {
                                        "domain": "fan",
                                        "service": "turn_on",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "fan.elis_room_fan"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "action/0/choose/1/sequence/0/0": [
                            {
                                "path": "action/0/choose/1/sequence/0/0",
                                "timestamp": "2022-03-03T00:48:38.571917+00:00",
                                "changed_variables": {
                                    "speed": null,
                                    "percentage": null,
                                    "preset_mode": null
                                },
                                "result": {
                                    "params": {
                                        "domain": "input_boolean",
                                        "service": "turn_on",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "input_boolean.elis_room_fan_power"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "action/0/choose/1/sequence/1": [
                            {
                                "path": "action/0/choose/1/sequence/1",
                                "timestamp": "2022-03-03T00:48:38.573163+00:00",
                                "child_id": {
                                    "domain": "script",
                                    "item_id": "1642846136869",
                                    "run_id": "43c7dff863c25f2260c0156f243587a1"
                                },
                                "result": {
                                    "params": {
                                        "domain": "script",
                                        "service": "1642846136869",
                                        "service_data": {
                                            "target_fan": "Eli's Room Fan",
                                            "target_fan_speed": 50,
                                            "target_fan_power": true
                                        },
                                        "target": {}
                                    },
                                    "running_script": true,
                                    "limit": null
                                }
                            }
                        ]
                    },
                    "config": {
                        "id": "1642998485292",
                        "alias": "Eli's Room Fan Set State",
                        "description": "Set Eli's Room Fan power and speed",
                        "trigger": [
                            {
                                "platform": "state",
                                "entity_id": "fan.elis_room_fan",
                                "id": "power"
                            },
                            {
                                "platform": "state",
                                "entity_id": "fan.elis_room_fan",
                                "id": "speed",
                                "attribute": "percentage"
                            }
                        ],
                        "condition": [],
                        "action": [
                            {
                                "choose": [
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "power"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [
                                                            {
                                                                "condition": "state",
                                                                "entity_id": "fan.elis_room_fan",
                                                                "state": "off"
                                                            }
                                                        ],
                                                        "sequence": [
                                                            {
                                                                "service": "script.1642846136869",
                                                                "data": {
                                                                    "target_fan": "Eli's Room Fan",
                                                                    "target_fan_power": false,
                                                                    "target_fan_speed": "{{ state_attr(\"fan.elis_room_fan\", \"percentage\") | int }}"
                                                                }
                                                            }
                                                        ]
                                                    },
                                                    {
                                                        "conditions": [
                                                            {
                                                                "condition": "state",
                                                                "entity_id": "fan.elis_room_fan",
                                                                "state": "on"
                                                            }
                                                        ],
                                                        "sequence": [
                                                            {
                                                                "service": "script.1642846136869",
                                                                "data": {
                                                                    "target_fan": "Eli's Room Fan",
                                                                    "target_fan_power": true,
                                                                    "target_fan_speed": "{{ state_attr(\"fan.elis_room_fan\", \"percentage\") | int }}"
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": []
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "speed"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "fan.turn_on",
                                                "target": {
                                                    "entity_id": "fan.elis_room_fan"
                                                }
                                            },
                                            {
                                                "service": "script.1642846136869",
                                                "data": {
                                                    "target_fan": "Eli's Room Fan",
                                                    "target_fan_speed": "{{ state_attr(\"fan.elis_room_fan\", \"percentage\") | int }}",
                                                    "target_fan_power": true
                                                }
                                            }
                                        ]
                                    }
                                ],
                                "default": []
                            }
                        ],
                        "mode": "queued",
                        "max": 10
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "91e0c347a8bbba5d9ef5f36bde3e60d1",
                        "parent_id": "06d97ea1db77c470a04bac2008a2b3e2",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/0/choose/1/sequence/1",
                    "run_id": "89780d2d64b7668b381565c646bcc0d4",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T00:48:35.609145+00:00",
                        "finish": "2022-03-03T00:48:39.199266+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1642998485292",
                    "trigger": "state of fan.elis_room_fan"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/0/choose/0/sequence/0/choose/1/sequence/0",
                    "run_id": "659a9cf175b48fbc41b8fa85a4ff533a",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T00:48:37.257650+00:00",
                        "finish": "2022-03-03T00:48:39.471128+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1642998485292",
                    "trigger": "state of fan.elis_room_fan",
                    "trace": {
                        "trigger/0": [
                            {
                                "path": "trigger/0",
                                "timestamp": "2022-03-03T00:48:37.257752+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.elis_room_fan_set_state",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T00:48:35.609275+00:00",
                                            "mode": "queued",
                                            "current": 3,
                                            "max": 10,
                                            "id": "1642998485292",
                                            "friendly_name": "Eli's Room Fan Set State"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.797685+00:00",
                                        "last_updated": "2022-03-03T00:48:37.249737+00:00",
                                        "context": {
                                            "id": "91e0c347a8bbba5d9ef5f36bde3e60d1",
                                            "parent_id": "06d97ea1db77c470a04bac2008a2b3e2",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "power",
                                        "idx": "0",
                                        "platform": "state",
                                        "entity_id": "fan.elis_room_fan",
                                        "from_state": {
                                            "entity_id": "fan.elis_room_fan",
                                            "state": "off",
                                            "attributes": {
                                                "speed_list": [
                                                    "off",
                                                    "low",
                                                    "medium",
                                                    "high"
                                                ],
                                                "preset_modes": null,
                                                "speed": "medium",
                                                "percentage": 50,
                                                "percentage_step": 16.666666666666668,
                                                "preset_mode": null,
                                                "friendly_name": "Eli's Room Fan",
                                                "supported_features": 1
                                            },
                                            "last_changed": "2022-03-03T00:48:35.602349+00:00",
                                            "last_updated": "2022-03-03T00:48:35.602349+00:00",
                                            "context": {
                                                "id": "06d97ea1db77c470a04bac2008a2b3e2",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "to_state": {
                                            "entity_id": "fan.elis_room_fan",
                                            "state": "on",
                                            "attributes": {
                                                "speed_list": [
                                                    "off",
                                                    "low",
                                                    "medium",
                                                    "high"
                                                ],
                                                "preset_modes": null,
                                                "speed": "medium",
                                                "percentage": 50,
                                                "percentage_step": 16.666666666666668,
                                                "preset_mode": null,
                                                "friendly_name": "Eli's Room Fan",
                                                "supported_features": 1
                                            },
                                            "last_changed": "2022-03-03T00:48:37.255369+00:00",
                                            "last_updated": "2022-03-03T00:48:37.255369+00:00",
                                            "context": {
                                                "id": "a805724664af5de132f17f5471012daf",
                                                "parent_id": "8da6db62e8988b109b27ca52d434d20b",
                                                "user_id": null
                                            }
                                        },
                                        "for": null,
                                        "attribute": null,
                                        "description": "state of fan.elis_room_fan"
                                    }
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T00:48:39.199371+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "9f3a87ca5d763afcc6901956ab735981",
                                        "parent_id": "a805724664af5de132f17f5471012daf",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "choice": 0
                                }
                            }
                        ],
                        "action/0/choose/0": [
                            {
                                "path": "action/0/choose/0",
                                "timestamp": "2022-03-03T00:48:39.199435+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/0/conditions/0",
                                "timestamp": "2022-03-03T00:48:39.199461+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/0": [
                            {
                                "path": "action/0/choose/0/sequence/0",
                                "timestamp": "2022-03-03T00:48:39.199792+00:00",
                                "result": {
                                    "choice": 1
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/0/choose/0": [
                            {
                                "path": "action/0/choose/0/sequence/0/choose/0",
                                "timestamp": "2022-03-03T00:48:39.199845+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/0/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/0/sequence/0/choose/0/conditions/0",
                                "timestamp": "2022-03-03T00:48:39.199867+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/0/choose/0/conditions/0/entity_id/0": [
                            {
                                "path": "action/0/choose/0/sequence/0/choose/0/conditions/0/entity_id/0",
                                "timestamp": "2022-03-03T00:48:39.199883+00:00",
                                "result": {
                                    "result": false,
                                    "state": "on",
                                    "wanted_state": "off"
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/0/choose/1": [
                            {
                                "path": "action/0/choose/0/sequence/0/choose/1",
                                "timestamp": "2022-03-03T00:48:39.199937+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/0/choose/1/conditions/0": [
                            {
                                "path": "action/0/choose/0/sequence/0/choose/1/conditions/0",
                                "timestamp": "2022-03-03T00:48:39.199954+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/0/choose/1/conditions/0/entity_id/0": [
                            {
                                "path": "action/0/choose/0/sequence/0/choose/1/conditions/0/entity_id/0",
                                "timestamp": "2022-03-03T00:48:39.199969+00:00",
                                "result": {
                                    "result": true,
                                    "state": "on",
                                    "wanted_state": "on"
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/0/choose/1/sequence/0": [
                            {
                                "path": "action/0/choose/0/sequence/0/choose/1/sequence/0",
                                "timestamp": "2022-03-03T00:48:39.200208+00:00",
                                "child_id": {
                                    "domain": "script",
                                    "item_id": "1642846136869",
                                    "run_id": "a43d30c4cff2dddb75b883c5bd7301fa"
                                },
                                "result": {
                                    "params": {
                                        "domain": "script",
                                        "service": "1642846136869",
                                        "service_data": {
                                            "target_fan": "Eli's Room Fan",
                                            "target_fan_power": true,
                                            "target_fan_speed": 50
                                        },
                                        "target": {}
                                    },
                                    "running_script": true,
                                    "limit": null
                                }
                            }
                        ]
                    },
                    "config": {
                        "id": "1642998485292",
                        "alias": "Eli's Room Fan Set State",
                        "description": "Set Eli's Room Fan power and speed",
                        "trigger": [
                            {
                                "platform": "state",
                                "entity_id": "fan.elis_room_fan",
                                "id": "power"
                            },
                            {
                                "platform": "state",
                                "entity_id": "fan.elis_room_fan",
                                "id": "speed",
                                "attribute": "percentage"
                            }
                        ],
                        "condition": [],
                        "action": [
                            {
                                "choose": [
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "power"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [
                                                            {
                                                                "condition": "state",
                                                                "entity_id": "fan.elis_room_fan",
                                                                "state": "off"
                                                            }
                                                        ],
                                                        "sequence": [
                                                            {
                                                                "service": "script.1642846136869",
                                                                "data": {
                                                                    "target_fan": "Eli's Room Fan",
                                                                    "target_fan_power": false,
                                                                    "target_fan_speed": "{{ state_attr(\"fan.elis_room_fan\", \"percentage\") | int }}"
                                                                }
                                                            }
                                                        ]
                                                    },
                                                    {
                                                        "conditions": [
                                                            {
                                                                "condition": "state",
                                                                "entity_id": "fan.elis_room_fan",
                                                                "state": "on"
                                                            }
                                                        ],
                                                        "sequence": [
                                                            {
                                                                "service": "script.1642846136869",
                                                                "data": {
                                                                    "target_fan": "Eli's Room Fan",
                                                                    "target_fan_power": true,
                                                                    "target_fan_speed": "{{ state_attr(\"fan.elis_room_fan\", \"percentage\") | int }}"
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": []
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "speed"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "fan.turn_on",
                                                "target": {
                                                    "entity_id": "fan.elis_room_fan"
                                                }
                                            },
                                            {
                                                "service": "script.1642846136869",
                                                "data": {
                                                    "target_fan": "Eli's Room Fan",
                                                    "target_fan_speed": "{{ state_attr(\"fan.elis_room_fan\", \"percentage\") | int }}",
                                                    "target_fan_power": true
                                                }
                                            }
                                        ]
                                    }
                                ],
                                "default": []
                            }
                        ],
                        "mode": "queued",
                        "max": 10
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "9f3a87ca5d763afcc6901956ab735981",
                        "parent_id": "a805724664af5de132f17f5471012daf",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/0/choose/0/sequence/0/choose/1/sequence/0",
                    "run_id": "659a9cf175b48fbc41b8fa85a4ff533a",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T00:48:37.257650+00:00",
                        "finish": "2022-03-03T00:48:39.471128+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1642998485292",
                    "trigger": "state of fan.elis_room_fan"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/0/choose/0/sequence/0/choose/0/sequence/0",
                    "run_id": "4da8c5deb8bab9944bd73ed9cdc2d0ce",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T00:48:59.476894+00:00",
                        "finish": "2022-03-03T00:49:00.245008+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1642998485292",
                    "trigger": "state of fan.elis_room_fan",
                    "trace": {
                        "trigger/0": [
                            {
                                "path": "trigger/0",
                                "timestamp": "2022-03-03T00:48:59.476953+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.elis_room_fan_set_state",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T00:48:37.257866+00:00",
                                            "mode": "queued",
                                            "current": 0,
                                            "max": 10,
                                            "id": "1642998485292",
                                            "friendly_name": "Eli's Room Fan Set State"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.797685+00:00",
                                        "last_updated": "2022-03-03T00:48:39.469919+00:00",
                                        "context": {
                                            "id": "9f3a87ca5d763afcc6901956ab735981",
                                            "parent_id": "a805724664af5de132f17f5471012daf",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "power",
                                        "idx": "0",
                                        "platform": "state",
                                        "entity_id": "fan.elis_room_fan",
                                        "from_state": {
                                            "entity_id": "fan.elis_room_fan",
                                            "state": "on",
                                            "attributes": {
                                                "speed_list": [
                                                    "off",
                                                    "low",
                                                    "medium",
                                                    "high"
                                                ],
                                                "preset_modes": null,
                                                "speed": "medium",
                                                "percentage": 50,
                                                "percentage_step": 16.666666666666668,
                                                "preset_mode": null,
                                                "friendly_name": "Eli's Room Fan",
                                                "supported_features": 1
                                            },
                                            "last_changed": "2022-03-03T00:48:37.255369+00:00",
                                            "last_updated": "2022-03-03T00:48:37.255369+00:00",
                                            "context": {
                                                "id": "a805724664af5de132f17f5471012daf",
                                                "parent_id": "8da6db62e8988b109b27ca52d434d20b",
                                                "user_id": null
                                            }
                                        },
                                        "to_state": {
                                            "entity_id": "fan.elis_room_fan",
                                            "state": "off",
                                            "attributes": {
                                                "speed_list": [
                                                    "off",
                                                    "low",
                                                    "medium",
                                                    "high"
                                                ],
                                                "preset_modes": null,
                                                "speed": "medium",
                                                "percentage": 50,
                                                "percentage_step": 16.666666666666668,
                                                "preset_mode": null,
                                                "friendly_name": "Eli's Room Fan",
                                                "supported_features": 1
                                            },
                                            "last_changed": "2022-03-03T00:48:59.474237+00:00",
                                            "last_updated": "2022-03-03T00:48:59.474237+00:00",
                                            "context": {
                                                "id": "4ba1e3e3fb6855d7f50fba6c0972b5d6",
                                                "parent_id": null,
                                                "user_id": "ad2bcce775894550affb6dfef93a2a36"
                                            }
                                        },
                                        "for": null,
                                        "attribute": null,
                                        "description": "state of fan.elis_room_fan"
                                    }
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T00:48:59.478489+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "3e991143fd08e1e3279619982d50f323",
                                        "parent_id": "4ba1e3e3fb6855d7f50fba6c0972b5d6",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "choice": 0
                                }
                            }
                        ],
                        "action/0/choose/0": [
                            {
                                "path": "action/0/choose/0",
                                "timestamp": "2022-03-03T00:48:59.478541+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/0/conditions/0",
                                "timestamp": "2022-03-03T00:48:59.478564+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/0": [
                            {
                                "path": "action/0/choose/0/sequence/0",
                                "timestamp": "2022-03-03T00:48:59.478868+00:00",
                                "result": {
                                    "choice": 0
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/0/choose/0": [
                            {
                                "path": "action/0/choose/0/sequence/0/choose/0",
                                "timestamp": "2022-03-03T00:48:59.478912+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/0/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/0/sequence/0/choose/0/conditions/0",
                                "timestamp": "2022-03-03T00:48:59.478932+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/0/choose/0/conditions/0/entity_id/0": [
                            {
                                "path": "action/0/choose/0/sequence/0/choose/0/conditions/0/entity_id/0",
                                "timestamp": "2022-03-03T00:48:59.478948+00:00",
                                "result": {
                                    "result": true,
                                    "state": "off",
                                    "wanted_state": "off"
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/0/choose/0/sequence/0": [
                            {
                                "path": "action/0/choose/0/sequence/0/choose/0/sequence/0",
                                "timestamp": "2022-03-03T00:48:59.479206+00:00",
                                "child_id": {
                                    "domain": "script",
                                    "item_id": "1642846136869",
                                    "run_id": "b0b0a10c361759e500c27280ca9f91a4"
                                },
                                "result": {
                                    "params": {
                                        "domain": "script",
                                        "service": "1642846136869",
                                        "service_data": {
                                            "target_fan": "Eli's Room Fan",
                                            "target_fan_power": false,
                                            "target_fan_speed": 50
                                        },
                                        "target": {}
                                    },
                                    "running_script": true,
                                    "limit": null
                                }
                            }
                        ]
                    },
                    "config": {
                        "id": "1642998485292",
                        "alias": "Eli's Room Fan Set State",
                        "description": "Set Eli's Room Fan power and speed",
                        "trigger": [
                            {
                                "platform": "state",
                                "entity_id": "fan.elis_room_fan",
                                "id": "power"
                            },
                            {
                                "platform": "state",
                                "entity_id": "fan.elis_room_fan",
                                "id": "speed",
                                "attribute": "percentage"
                            }
                        ],
                        "condition": [],
                        "action": [
                            {
                                "choose": [
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "power"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [
                                                            {
                                                                "condition": "state",
                                                                "entity_id": "fan.elis_room_fan",
                                                                "state": "off"
                                                            }
                                                        ],
                                                        "sequence": [
                                                            {
                                                                "service": "script.1642846136869",
                                                                "data": {
                                                                    "target_fan": "Eli's Room Fan",
                                                                    "target_fan_power": false,
                                                                    "target_fan_speed": "{{ state_attr(\"fan.elis_room_fan\", \"percentage\") | int }}"
                                                                }
                                                            }
                                                        ]
                                                    },
                                                    {
                                                        "conditions": [
                                                            {
                                                                "condition": "state",
                                                                "entity_id": "fan.elis_room_fan",
                                                                "state": "on"
                                                            }
                                                        ],
                                                        "sequence": [
                                                            {
                                                                "service": "script.1642846136869",
                                                                "data": {
                                                                    "target_fan": "Eli's Room Fan",
                                                                    "target_fan_power": true,
                                                                    "target_fan_speed": "{{ state_attr(\"fan.elis_room_fan\", \"percentage\") | int }}"
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": []
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "speed"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "fan.turn_on",
                                                "target": {
                                                    "entity_id": "fan.elis_room_fan"
                                                }
                                            },
                                            {
                                                "service": "script.1642846136869",
                                                "data": {
                                                    "target_fan": "Eli's Room Fan",
                                                    "target_fan_speed": "{{ state_attr(\"fan.elis_room_fan\", \"percentage\") | int }}",
                                                    "target_fan_power": true
                                                }
                                            }
                                        ]
                                    }
                                ],
                                "default": []
                            }
                        ],
                        "mode": "queued",
                        "max": 10
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "3e991143fd08e1e3279619982d50f323",
                        "parent_id": "4ba1e3e3fb6855d7f50fba6c0972b5d6",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/0/choose/0/sequence/0/choose/0/sequence/0",
                    "run_id": "4da8c5deb8bab9944bd73ed9cdc2d0ce",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T00:48:59.476894+00:00",
                        "finish": "2022-03-03T00:49:00.245008+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1642998485292",
                    "trigger": "state of fan.elis_room_fan"
                }
            }
        ],
        "script.turn_off_elis_room": [
            {
                "extended_dict": {
                    "last_step": "sequence/4",
                    "run_id": "bda8d7533ff053a5046309774aa02e6b",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T00:43:02.000460+00:00",
                        "finish": "2022-03-03T00:43:07.248932+00:00"
                    },
                    "domain": "script",
                    "item_id": "turn_off_elis_room",
                    "trace": {
                        "sequence/0": [
                            {
                                "path": "sequence/0",
                                "timestamp": "2022-03-03T00:43:02.002664+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "script.turn_off_elis_room",
                                        "state": "off",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T00:42:43.789688+00:00",
                                            "mode": "single",
                                            "current": 0,
                                            "icon": "mdi:power",
                                            "friendly_name": "Turn Off Eli's Room"
                                        },
                                        "last_changed": "2022-03-03T00:42:49.038903+00:00",
                                        "last_updated": "2022-03-03T00:42:49.038903+00:00",
                                        "context": {
                                            "id": "9418d152edd3d624cee5fcc54b6770aa",
                                            "parent_id": null,
                                            "user_id": null
                                        }
                                    },
                                    "context": {
                                        "id": "ed55a3a5db54a2eea685c2a9728b1a64",
                                        "parent_id": null,
                                        "user_id": "ad2bcce775894550affb6dfef93a2a36"
                                    }
                                },
                                "result": {
                                    "params": {
                                        "domain": "automation",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "automation.elis_room_ac_auto_control"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "sequence/1": [
                            {
                                "path": "sequence/1",
                                "timestamp": "2022-03-03T00:43:02.004269+00:00",
                                "result": {
                                    "params": {
                                        "domain": "fan",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "fan.elis_room_fan"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "sequence/1/0": [
                            {
                                "path": "sequence/1/0",
                                "timestamp": "2022-03-03T00:43:02.004765+00:00",
                                "child_id": {
                                    "domain": "automation",
                                    "item_id": "1642998485292",
                                    "run_id": "d97d410b85f75ec4c4d7aa85ed01f69f"
                                },
                                "result": {
                                    "params": {
                                        "domain": "input_boolean",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "input_boolean.elis_room_fan_power"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "sequence/2": [
                            {
                                "path": "sequence/2",
                                "timestamp": "2022-03-03T00:43:02.010281+00:00",
                                "result": {
                                    "delay": 0.2,
                                    "done": true
                                }
                            }
                        ],
                        "sequence/3": [
                            {
                                "path": "sequence/3",
                                "timestamp": "2022-03-03T00:43:02.211764+00:00",
                                "result": {
                                    "params": {
                                        "domain": "climate",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "climate.elis_room_ac"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "sequence/4": [
                            {
                                "path": "sequence/4",
                                "timestamp": "2022-03-03T00:43:02.212918+00:00",
                                "result": {
                                    "params": {
                                        "domain": "light",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "light.elis_room_lights"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ]
                    },
                    "config": {
                        "sequence": [
                            {
                                "service": "automation.turn_off",
                                "target": {
                                    "entity_id": "automation.elis_room_ac_auto_control"
                                }
                            },
                            {
                                "service": "fan.turn_off",
                                "target": {
                                    "entity_id": "fan.elis_room_fan"
                                }
                            },
                            {
                                "delay": {
                                    "hours": 0,
                                    "minutes": 0,
                                    "seconds": 0,
                                    "milliseconds": 200
                                }
                            },
                            {
                                "service": "climate.turn_off",
                                "target": {
                                    "entity_id": "climate.elis_room_ac"
                                }
                            },
                            {
                                "service": "light.turn_off",
                                "target": {
                                    "entity_id": "light.elis_room_lights"
                                }
                            }
                        ],
                        "mode": "single",
                        "alias": "Turn Off Eli's Room",
                        "icon": "mdi:power"
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "ed55a3a5db54a2eea685c2a9728b1a64",
                        "parent_id": null,
                        "user_id": "ad2bcce775894550affb6dfef93a2a36"
                    }
                },
                "short_dict": {
                    "last_step": "sequence/4",
                    "run_id": "bda8d7533ff053a5046309774aa02e6b",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T00:43:02.000460+00:00",
                        "finish": "2022-03-03T00:43:07.248932+00:00"
                    },
                    "domain": "script",
                    "item_id": "turn_off_elis_room"
                }
            },
            {
                "extended_dict": {
                    "last_step": null,
                    "run_id": "6d96717c02826f05575ce3a82a0ba495",
                    "state": "stopped",
                    "script_execution": "failed_single",
                    "timestamp": {
                        "start": "2022-03-03T00:43:05.115238+00:00",
                        "finish": "2022-03-03T00:43:05.115502+00:00"
                    },
                    "domain": "script",
                    "item_id": "turn_off_elis_room",
                    "trace": {},
                    "config": {
                        "sequence": [
                            {
                                "service": "automation.turn_off",
                                "target": {
                                    "entity_id": "automation.elis_room_ac_auto_control"
                                }
                            },
                            {
                                "service": "fan.turn_off",
                                "target": {
                                    "entity_id": "fan.elis_room_fan"
                                }
                            },
                            {
                                "delay": {
                                    "hours": 0,
                                    "minutes": 0,
                                    "seconds": 0,
                                    "milliseconds": 200
                                }
                            },
                            {
                                "service": "climate.turn_off",
                                "target": {
                                    "entity_id": "climate.elis_room_ac"
                                }
                            },
                            {
                                "service": "light.turn_off",
                                "target": {
                                    "entity_id": "light.elis_room_lights"
                                }
                            }
                        ],
                        "mode": "single",
                        "alias": "Turn Off Eli's Room",
                        "icon": "mdi:power"
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "9a251ae5bac2cd86456251fc12f82443",
                        "parent_id": null,
                        "user_id": "ad2bcce775894550affb6dfef93a2a36"
                    }
                },
                "short_dict": {
                    "last_step": null,
                    "run_id": "6d96717c02826f05575ce3a82a0ba495",
                    "state": "stopped",
                    "script_execution": "failed_single",
                    "timestamp": {
                        "start": "2022-03-03T00:43:05.115238+00:00",
                        "finish": "2022-03-03T00:43:05.115502+00:00"
                    },
                    "domain": "script",
                    "item_id": "turn_off_elis_room"
                }
            },
            {
                "extended_dict": {
                    "last_step": "sequence/4",
                    "run_id": "ce3991afcc12c05de529c452a79b5a4f",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T00:43:14.329092+00:00",
                        "finish": "2022-03-03T00:43:19.591051+00:00"
                    },
                    "domain": "script",
                    "item_id": "turn_off_elis_room",
                    "trace": {
                        "sequence/0": [
                            {
                                "path": "sequence/0",
                                "timestamp": "2022-03-03T00:43:14.329852+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "script.turn_off_elis_room",
                                        "state": "off",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T00:43:02.000529+00:00",
                                            "mode": "single",
                                            "current": 0,
                                            "icon": "mdi:power",
                                            "friendly_name": "Turn Off Eli's Room"
                                        },
                                        "last_changed": "2022-03-03T00:43:07.247492+00:00",
                                        "last_updated": "2022-03-03T00:43:07.247492+00:00",
                                        "context": {
                                            "id": "9a251ae5bac2cd86456251fc12f82443",
                                            "parent_id": null,
                                            "user_id": "ad2bcce775894550affb6dfef93a2a36"
                                        }
                                    },
                                    "context": {
                                        "id": "6ee3f72326c24b80922d5f261fd56629",
                                        "parent_id": null,
                                        "user_id": "ad2bcce775894550affb6dfef93a2a36"
                                    }
                                },
                                "result": {
                                    "params": {
                                        "domain": "automation",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "automation.elis_room_ac_auto_control"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "sequence/1": [
                            {
                                "path": "sequence/1",
                                "timestamp": "2022-03-03T00:43:14.331579+00:00",
                                "result": {
                                    "params": {
                                        "domain": "fan",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "fan.elis_room_fan"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "sequence/1/0": [
                            {
                                "path": "sequence/1/0",
                                "timestamp": "2022-03-03T00:43:14.332295+00:00",
                                "child_id": {
                                    "domain": "automation",
                                    "item_id": "1642998485292",
                                    "run_id": "6f92694cb2c7841de8f17ab23d36d308"
                                },
                                "result": {
                                    "params": {
                                        "domain": "input_boolean",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "input_boolean.elis_room_fan_power"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "sequence/2": [
                            {
                                "path": "sequence/2",
                                "timestamp": "2022-03-03T00:43:14.341032+00:00",
                                "result": {
                                    "delay": 0.2,
                                    "done": true
                                }
                            }
                        ],
                        "sequence/3": [
                            {
                                "path": "sequence/3",
                                "timestamp": "2022-03-03T00:43:14.542548+00:00",
                                "result": {
                                    "params": {
                                        "domain": "climate",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "climate.elis_room_ac"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "sequence/4": [
                            {
                                "path": "sequence/4",
                                "timestamp": "2022-03-03T00:43:14.543974+00:00",
                                "result": {
                                    "params": {
                                        "domain": "light",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "light.elis_room_lights"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ]
                    },
                    "config": {
                        "sequence": [
                            {
                                "service": "automation.turn_off",
                                "target": {
                                    "entity_id": "automation.elis_room_ac_auto_control"
                                }
                            },
                            {
                                "service": "fan.turn_off",
                                "target": {
                                    "entity_id": "fan.elis_room_fan"
                                }
                            },
                            {
                                "delay": {
                                    "hours": 0,
                                    "minutes": 0,
                                    "seconds": 0,
                                    "milliseconds": 200
                                }
                            },
                            {
                                "service": "climate.turn_off",
                                "target": {
                                    "entity_id": "climate.elis_room_ac"
                                }
                            },
                            {
                                "service": "light.turn_off",
                                "target": {
                                    "entity_id": "light.elis_room_lights"
                                }
                            }
                        ],
                        "mode": "single",
                        "alias": "Turn Off Eli's Room",
                        "icon": "mdi:power"
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "6ee3f72326c24b80922d5f261fd56629",
                        "parent_id": null,
                        "user_id": "ad2bcce775894550affb6dfef93a2a36"
                    }
                },
                "short_dict": {
                    "last_step": "sequence/4",
                    "run_id": "ce3991afcc12c05de529c452a79b5a4f",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T00:43:14.329092+00:00",
                        "finish": "2022-03-03T00:43:19.591051+00:00"
                    },
                    "domain": "script",
                    "item_id": "turn_off_elis_room"
                }
            },
            {
                "extended_dict": {
                    "last_step": "sequence/4",
                    "run_id": "2f0a87fc3cf87e8b7d6456a41e1e1f35",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T00:43:24.869388+00:00",
                        "finish": "2022-03-03T00:43:30.117646+00:00"
                    },
                    "domain": "script",
                    "item_id": "turn_off_elis_room",
                    "trace": {
                        "sequence/0": [
                            {
                                "path": "sequence/0",
                                "timestamp": "2022-03-03T00:43:24.870140+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "script.turn_off_elis_room",
                                        "state": "off",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T00:43:14.329162+00:00",
                                            "mode": "single",
                                            "current": 0,
                                            "icon": "mdi:power",
                                            "friendly_name": "Turn Off Eli's Room"
                                        },
                                        "last_changed": "2022-03-03T00:43:19.589781+00:00",
                                        "last_updated": "2022-03-03T00:43:19.589781+00:00",
                                        "context": {
                                            "id": "0d0ba97442de0f9610548174210a5fa6",
                                            "parent_id": null,
                                            "user_id": null
                                        }
                                    },
                                    "context": {
                                        "id": "c5e97d713a12a399871169073fc153fd",
                                        "parent_id": null,
                                        "user_id": "ad2bcce775894550affb6dfef93a2a36"
                                    }
                                },
                                "result": {
                                    "params": {
                                        "domain": "automation",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "automation.elis_room_ac_auto_control"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "sequence/1": [
                            {
                                "path": "sequence/1",
                                "timestamp": "2022-03-03T00:43:24.871979+00:00",
                                "result": {
                                    "params": {
                                        "domain": "fan",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "fan.elis_room_fan"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "sequence/1/0": [
                            {
                                "path": "sequence/1/0",
                                "timestamp": "2022-03-03T00:43:24.873936+00:00",
                                "child_id": {
                                    "domain": "automation",
                                    "item_id": "1642998485292",
                                    "run_id": "4260a81b1b24f2b8ac6de2c14c9d319e"
                                },
                                "result": {
                                    "params": {
                                        "domain": "input_boolean",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "input_boolean.elis_room_fan_power"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "sequence/2": [
                            {
                                "path": "sequence/2",
                                "timestamp": "2022-03-03T00:43:24.881079+00:00",
                                "result": {
                                    "delay": 0.2,
                                    "done": true
                                }
                            }
                        ],
                        "sequence/3": [
                            {
                                "path": "sequence/3",
                                "timestamp": "2022-03-03T00:43:25.082372+00:00",
                                "result": {
                                    "params": {
                                        "domain": "climate",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "climate.elis_room_ac"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "sequence/4": [
                            {
                                "path": "sequence/4",
                                "timestamp": "2022-03-03T00:43:25.083889+00:00",
                                "result": {
                                    "params": {
                                        "domain": "light",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "light.elis_room_lights"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ]
                    },
                    "config": {
                        "sequence": [
                            {
                                "service": "automation.turn_off",
                                "target": {
                                    "entity_id": "automation.elis_room_ac_auto_control"
                                }
                            },
                            {
                                "service": "fan.turn_off",
                                "target": {
                                    "entity_id": "fan.elis_room_fan"
                                }
                            },
                            {
                                "delay": {
                                    "hours": 0,
                                    "minutes": 0,
                                    "seconds": 0,
                                    "milliseconds": 200
                                }
                            },
                            {
                                "service": "climate.turn_off",
                                "target": {
                                    "entity_id": "climate.elis_room_ac"
                                }
                            },
                            {
                                "service": "light.turn_off",
                                "target": {
                                    "entity_id": "light.elis_room_lights"
                                }
                            }
                        ],
                        "mode": "single",
                        "alias": "Turn Off Eli's Room",
                        "icon": "mdi:power"
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "c5e97d713a12a399871169073fc153fd",
                        "parent_id": null,
                        "user_id": "ad2bcce775894550affb6dfef93a2a36"
                    }
                },
                "short_dict": {
                    "last_step": "sequence/4",
                    "run_id": "2f0a87fc3cf87e8b7d6456a41e1e1f35",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T00:43:24.869388+00:00",
                        "finish": "2022-03-03T00:43:30.117646+00:00"
                    },
                    "domain": "script",
                    "item_id": "turn_off_elis_room"
                }
            },
            {
                "extended_dict": {
                    "last_step": "sequence/4",
                    "run_id": "8ec7f98edeb87bbd6bed8d49b3dc24b8",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:09:47.661762+00:00",
                        "finish": "2022-03-03T05:09:52.903927+00:00"
                    },
                    "domain": "script",
                    "item_id": "turn_off_elis_room",
                    "trace": {
                        "sequence/0": [
                            {
                                "path": "sequence/0",
                                "timestamp": "2022-03-03T05:09:47.662549+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "script.turn_off_elis_room",
                                        "state": "off",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T00:43:24.869489+00:00",
                                            "mode": "single",
                                            "current": 0,
                                            "icon": "mdi:power",
                                            "friendly_name": "Turn Off Eli's Room"
                                        },
                                        "last_changed": "2022-03-03T00:43:30.116336+00:00",
                                        "last_updated": "2022-03-03T00:43:30.116336+00:00",
                                        "context": {
                                            "id": "a2b3e2926c5b2d0a544cc89177affda3",
                                            "parent_id": null,
                                            "user_id": null
                                        }
                                    },
                                    "context": {
                                        "id": "3c34ab25510e6c3602cf039455c14bd6",
                                        "parent_id": null,
                                        "user_id": "ad2bcce775894550affb6dfef93a2a36"
                                    }
                                },
                                "result": {
                                    "params": {
                                        "domain": "automation",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "automation.elis_room_ac_auto_control"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "sequence/1": [
                            {
                                "path": "sequence/1",
                                "timestamp": "2022-03-03T05:09:47.664319+00:00",
                                "result": {
                                    "params": {
                                        "domain": "fan",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "fan.elis_room_fan"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "sequence/1/0": [
                            {
                                "path": "sequence/1/0",
                                "timestamp": "2022-03-03T05:09:47.665546+00:00",
                                "result": {
                                    "params": {
                                        "domain": "input_boolean",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "input_boolean.elis_room_fan_power"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "sequence/2": [
                            {
                                "path": "sequence/2",
                                "timestamp": "2022-03-03T05:09:47.666775+00:00",
                                "result": {
                                    "delay": 0.2,
                                    "done": true
                                }
                            }
                        ],
                        "sequence/3": [
                            {
                                "path": "sequence/3",
                                "timestamp": "2022-03-03T05:09:47.867762+00:00",
                                "result": {
                                    "params": {
                                        "domain": "climate",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "climate.elis_room_ac"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "sequence/4": [
                            {
                                "path": "sequence/4",
                                "timestamp": "2022-03-03T05:09:47.868893+00:00",
                                "result": {
                                    "params": {
                                        "domain": "light",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "light.elis_room_lights"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ]
                    },
                    "config": {
                        "sequence": [
                            {
                                "service": "automation.turn_off",
                                "target": {
                                    "entity_id": "automation.elis_room_ac_auto_control"
                                }
                            },
                            {
                                "service": "fan.turn_off",
                                "target": {
                                    "entity_id": "fan.elis_room_fan"
                                }
                            },
                            {
                                "delay": {
                                    "hours": 0,
                                    "minutes": 0,
                                    "seconds": 0,
                                    "milliseconds": 200
                                }
                            },
                            {
                                "service": "climate.turn_off",
                                "target": {
                                    "entity_id": "climate.elis_room_ac"
                                }
                            },
                            {
                                "service": "light.turn_off",
                                "target": {
                                    "entity_id": "light.elis_room_lights"
                                }
                            }
                        ],
                        "mode": "single",
                        "alias": "Turn Off Eli's Room",
                        "icon": "mdi:power"
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "3c34ab25510e6c3602cf039455c14bd6",
                        "parent_id": null,
                        "user_id": "ad2bcce775894550affb6dfef93a2a36"
                    }
                },
                "short_dict": {
                    "last_step": "sequence/4",
                    "run_id": "8ec7f98edeb87bbd6bed8d49b3dc24b8",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:09:47.661762+00:00",
                        "finish": "2022-03-03T05:09:52.903927+00:00"
                    },
                    "domain": "script",
                    "item_id": "turn_off_elis_room"
                }
            }
        ],
        "automation.1643645339926": [
            {
                "extended_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "c67be40ee94e58bef7c36797154441d1",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T03:34:34.146767+00:00",
                        "finish": "2022-03-03T03:34:34.154099+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643645339926",
                    "trigger": "event 'zha_event'",
                    "trace": {
                        "trigger/1": [
                            {
                                "path": "trigger/1",
                                "timestamp": "2022-03-03T03:34:34.147665+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.elis_room_ac_controller",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T02:37:44.550484+00:00",
                                            "mode": "restart",
                                            "current": 0,
                                            "id": "1643645339926",
                                            "friendly_name": "Eli's Room AC Controller"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.798982+00:00",
                                        "last_updated": "2022-03-03T02:37:44.555174+00:00",
                                        "context": {
                                            "id": "c229a21b20c00e9a78ad68ccf2fe4adb",
                                            "parent_id": "4f9069f6dada93b470e9058c9f29d989",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "1",
                                        "idx": "1",
                                        "platform": "event",
                                        "event": {
                                            "event_type": "zha_event",
                                            "data": {
                                                "device_ieee": "84:fd:27:ff:fe:95:bb:ff",
                                                "unique_id": "84:fd:27:ff:fe:95:bb:ff:1:0x0020",
                                                "device_id": "729379c869fac5a454929998eba2f3d2",
                                                "endpoint_id": 1,
                                                "cluster_id": 32,
                                                "command": "checkin",
                                                "args": []
                                            },
                                            "origin": "LOCAL",
                                            "time_fired": "2022-03-03T03:34:34.145474+00:00",
                                            "context": {
                                                "id": "c8577eabc09886dff69f72db99903236",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "description": "event 'zha_event'"
                                    },
                                    "integration": "ZHA",
                                    "button_up_long_loop": false,
                                    "button_up_long_max_loop_repeats": 500,
                                    "button_up_double_press": false,
                                    "button_down_long_loop": false,
                                    "button_down_long_max_loop_repeats": 500,
                                    "button_down_double_press": false,
                                    "helper_last_controller_event": "input_text.zz_eli_s_room_ac_controller_last_event",
                                    "helper_double_press_delay": 500,
                                    "helper_debounce_delay": 0,
                                    "integration_id": "zha",
                                    "adjusted_double_press_delay": 500,
                                    "actions_mapping": {
                                        "deconz": {
                                            "button_up_short": [
                                                "1002"
                                            ],
                                            "button_up_long": [
                                                "1001"
                                            ],
                                            "button_up_release": [
                                                "1003"
                                            ],
                                            "button_down_short": [
                                                "2002"
                                            ],
                                            "button_down_long": [
                                                "2001"
                                            ],
                                            "button_down_release": [
                                                "2003"
                                            ]
                                        },
                                        "zha": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "move_with_on_off_0_83"
                                            ],
                                            "button_up_release": [
                                                "stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "move_1_83"
                                            ],
                                            "button_down_release": [
                                                "stop"
                                            ]
                                        },
                                        "zigbee2mqtt": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "brightness_move_up"
                                            ],
                                            "button_up_release": [
                                                "brightness_stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "brightness_move_down"
                                            ],
                                            "button_down_release": [
                                                "brightness_stop"
                                            ]
                                        }
                                    },
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ],
                                    "integrations_with_prev_event_storage": [
                                        "zha",
                                        "zigbee2mqtt"
                                    ],
                                    "controller_entity": "",
                                    "controller_device": "729379c869fac5a454929998eba2f3d2",
                                    "controller_id": "729379c869fac5a454929998eba2f3d2"
                                }
                            }
                        ],
                        "condition/0": [
                            {
                                "path": "condition/0",
                                "timestamp": "2022-03-03T03:34:34.147740+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "condition/0/conditions/0": [
                            {
                                "path": "condition/0/conditions/0",
                                "timestamp": "2022-03-03T03:34:34.147767+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "condition/0/conditions/1": [
                            {
                                "path": "condition/0/conditions/1",
                                "timestamp": "2022-03-03T03:34:34.147962+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T03:34:34.149294+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "43ff91942ba3aa91130ff710736d4477",
                                        "parent_id": "c8577eabc09886dff69f72db99903236",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "delay": 0.0,
                                    "done": true
                                }
                            }
                        ],
                        "action/1": [
                            {
                                "path": "action/1",
                                "timestamp": "2022-03-03T03:34:34.150394+00:00"
                            }
                        ],
                        "action/2": [
                            {
                                "path": "action/2",
                                "timestamp": "2022-03-03T03:34:34.151033+00:00",
                                "changed_variables": {
                                    "trigger_action": "checkin",
                                    "trigger_delta": 3409597.6088047028,
                                    "last_controller_event": "checkin"
                                },
                                "result": {
                                    "params": {
                                        "domain": "input_text",
                                        "service": "set_value",
                                        "service_data": {
                                            "entity_id": "input_text.zz_eli_s_room_ac_controller_last_event",
                                            "value": {
                                                "trigger_action": "checkin",
                                                "last_triggered": "2022-03-03 11:34:34.151145+08:00"
                                            }
                                        },
                                        "target": {}
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "action/3": [
                            {
                                "path": "action/3",
                                "timestamp": "2022-03-03T03:34:34.152816+00:00"
                            }
                        ],
                        "action/3/choose/0": [
                            {
                                "path": "action/3/choose/0",
                                "timestamp": "2022-03-03T03:34:34.152891+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/0/conditions/0": [
                            {
                                "path": "action/3/choose/0/conditions/0",
                                "timestamp": "2022-03-03T03:34:34.152924+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/1": [
                            {
                                "path": "action/3/choose/1",
                                "timestamp": "2022-03-03T03:34:34.153032+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/1/conditions/0": [
                            {
                                "path": "action/3/choose/1/conditions/0",
                                "timestamp": "2022-03-03T03:34:34.153052+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/2": [
                            {
                                "path": "action/3/choose/2",
                                "timestamp": "2022-03-03T03:34:34.153126+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/2/conditions/0": [
                            {
                                "path": "action/3/choose/2/conditions/0",
                                "timestamp": "2022-03-03T03:34:34.153144+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/3": [
                            {
                                "path": "action/3/choose/3",
                                "timestamp": "2022-03-03T03:34:34.153219+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/3/conditions/0": [
                            {
                                "path": "action/3/choose/3/conditions/0",
                                "timestamp": "2022-03-03T03:34:34.153237+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/4": [
                            {
                                "path": "action/3/choose/4",
                                "timestamp": "2022-03-03T03:34:34.153304+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/4/conditions/0": [
                            {
                                "path": "action/3/choose/4/conditions/0",
                                "timestamp": "2022-03-03T03:34:34.153321+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/5": [
                            {
                                "path": "action/3/choose/5",
                                "timestamp": "2022-03-03T03:34:34.153385+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/5/conditions/0": [
                            {
                                "path": "action/3/choose/5/conditions/0",
                                "timestamp": "2022-03-03T03:34:34.153402+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ]
                    },
                    "config": {
                        "variables": {
                            "integration": "ZHA",
                            "button_up_long_loop": false,
                            "button_up_long_max_loop_repeats": 500,
                            "button_up_double_press": false,
                            "button_down_long_loop": false,
                            "button_down_long_max_loop_repeats": 500,
                            "button_down_double_press": false,
                            "helper_last_controller_event": "input_text.zz_eli_s_room_ac_controller_last_event",
                            "helper_double_press_delay": 500,
                            "helper_debounce_delay": 0,
                            "integration_id": "{{ integration | lower }}",
                            "adjusted_double_press_delay": "{{ [helper_double_press_delay - helper_debounce_delay, 100] | max }}",
                            "actions_mapping": {
                                "deconz": {
                                    "button_up_short": [
                                        "1002"
                                    ],
                                    "button_up_long": [
                                        "1001"
                                    ],
                                    "button_up_release": [
                                        "1003"
                                    ],
                                    "button_down_short": [
                                        "2002"
                                    ],
                                    "button_down_long": [
                                        "2001"
                                    ],
                                    "button_down_release": [
                                        "2003"
                                    ]
                                },
                                "zha": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ]
                                },
                                "zigbee2mqtt": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "brightness_move_up"
                                    ],
                                    "button_up_release": [
                                        "brightness_stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "brightness_move_down"
                                    ],
                                    "button_down_release": [
                                        "brightness_stop"
                                    ]
                                }
                            },
                            "button_up_short": "{{ actions_mapping[integration_id][\"button_up_short\"] }}",
                            "button_up_long": "{{ actions_mapping[integration_id][\"button_up_long\"] }}",
                            "button_up_release": "{{ actions_mapping[integration_id][\"button_up_release\"] }}",
                            "button_down_short": "{{ actions_mapping[integration_id][\"button_down_short\"] }}",
                            "button_down_long": "{{ actions_mapping[integration_id][\"button_down_long\"] }}",
                            "button_down_release": "{{ actions_mapping[integration_id][\"button_down_release\"] }}",
                            "integrations_with_prev_event_storage": [
                                "zha",
                                "zigbee2mqtt"
                            ],
                            "controller_entity": "",
                            "controller_device": "729379c869fac5a454929998eba2f3d2",
                            "controller_id": "{% if integration_id==\"zigbee2mqtt\" %}{{controller_entity}}{% else %}{{controller_device}}{% endif %}"
                        },
                        "mode": "restart",
                        "max_exceeded": "silent",
                        "trigger": [
                            {
                                "platform": "event",
                                "event_type": "state_changed",
                                "event_data": {
                                    "entity_id": ""
                                }
                            },
                            {
                                "platform": "event",
                                "event_type": [
                                    "deconz_event",
                                    "zha_event"
                                ],
                                "event_data": {
                                    "device_id": "729379c869fac5a454929998eba2f3d2"
                                }
                            }
                        ],
                        "condition": [
                            {
                                "condition": "and",
                                "conditions": [
                                    "{%- set trigger_action -%} {%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%} {%- endset -%} {{ trigger_action not in [\"\",\"None\"] }}",
                                    "{{ integration_id != \"zigbee2mqtt\" or trigger.event.data.new_state.state != trigger.event.data.old_state.state }}"
                                ]
                            }
                        ],
                        "action": [
                            {
                                "delay": {
                                    "milliseconds": 0
                                }
                            },
                            {
                                "variables": {
                                    "trigger_action": "{%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%}",
                                    "trigger_delta": "{{ (as_timestamp(now()) - as_timestamp((states(helper_last_controller_event) | from_json).last_triggered if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"1970-01-01 00:00:00\")) * 1000 }}",
                                    "last_controller_event": "{{ (states(helper_last_controller_event) | from_json).trigger_action if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"\" }}"
                                }
                            },
                            {
                                "service": "input_text.set_value",
                                "data": {
                                    "entity_id": "input_text.zz_eli_s_room_ac_controller_last_event",
                                    "value": "{{ {\"trigger_action\":trigger_action,\"last_triggered\":now()|string} | to_json }}"
                                }
                            },
                            {
                                "choose": [
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_eli_s_room_ac_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_up_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_up_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "climate.turn_on",
                                                                                        "target": {
                                                                                            "entity_id": "climate.elis_room_ac"
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_up_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "climate.turn_on",
                                                                        "target": {
                                                                            "entity_id": "climate.elis_room_ac"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_up_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "climate.set_temperature",
                                                                            "target": {
                                                                                "entity_id": "climate.elis_room_ac"
                                                                            },
                                                                            "data": {
                                                                                "temperature": "{% if state_attr('climate.elis_room_ac', 'temperature') < 27 %}\n  {{ state_attr('climate.elis_room_ac', 'temperature') + 1 }}\n{% else %}\n  27\n{% endif %}\n"
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "climate.set_temperature",
                                                        "target": {
                                                            "entity_id": "climate.elis_room_ac"
                                                        },
                                                        "data": {
                                                            "temperature": "{% if state_attr('climate.elis_room_ac', 'temperature') < 27 %}\n  {{ state_attr('climate.elis_room_ac', 'temperature') + 1 }}\n{% else %}\n  27\n{% endif %}\n"
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_up_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_up_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_eli_s_room_ac_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_down_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_down_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "climate.turn_off",
                                                                                        "target": {
                                                                                            "entity_id": "climate.elis_room_ac"
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_down_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "climate.turn_off",
                                                                        "target": {
                                                                            "entity_id": "climate.elis_room_ac"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_down_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "climate.set_temperature",
                                                                            "target": {
                                                                                "entity_id": "climate.elis_room_ac"
                                                                            },
                                                                            "data": {
                                                                                "temperature": "{% if state_attr('climate.elis_room_ac', 'temperature') > 24 %}\n  {{ state_attr('climate.elis_room_ac', 'temperature') - 1 }}\n{% else %}\n  24\n{% endif %}\n"
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "climate.set_temperature",
                                                        "target": {
                                                            "entity_id": "climate.elis_room_ac"
                                                        },
                                                        "data": {
                                                            "temperature": "{% if state_attr('climate.elis_room_ac', 'temperature') > 24 %}\n  {{ state_attr('climate.elis_room_ac', 'temperature') - 1 }}\n{% else %}\n  24\n{% endif %}\n"
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_down_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_down_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            }
                        ],
                        "id": "1643645339926",
                        "alias": "Eli's Room AC Controller",
                        "description": "Control Eli's Room AC"
                    },
                    "blueprint_inputs": {
                        "id": "1643645339926",
                        "alias": "Eli's Room AC Controller",
                        "description": "Control Eli's Room AC",
                        "use_blueprint": {
                            "path": "EPMatt/ikea_e1743.yaml",
                            "input": {
                                "integration": "ZHA",
                                "controller_device": "729379c869fac5a454929998eba2f3d2",
                                "action_button_up_short": [
                                    {
                                        "service": "climate.turn_on",
                                        "target": {
                                            "entity_id": "climate.elis_room_ac"
                                        }
                                    }
                                ],
                                "action_button_up_long": [
                                    {
                                        "service": "climate.set_temperature",
                                        "target": {
                                            "entity_id": "climate.elis_room_ac"
                                        },
                                        "data": {
                                            "temperature": "{% if state_attr('climate.elis_room_ac', 'temperature') < 27 %}\n  {{ state_attr('climate.elis_room_ac', 'temperature') + 1 }}\n{% else %}\n  27\n{% endif %}\n"
                                        }
                                    }
                                ],
                                "action_button_down_short": [
                                    {
                                        "service": "climate.turn_off",
                                        "target": {
                                            "entity_id": "climate.elis_room_ac"
                                        }
                                    }
                                ],
                                "action_button_down_long": [
                                    {
                                        "service": "climate.set_temperature",
                                        "target": {
                                            "entity_id": "climate.elis_room_ac"
                                        },
                                        "data": {
                                            "temperature": "{% if state_attr('climate.elis_room_ac', 'temperature') > 24 %}\n  {{ state_attr('climate.elis_room_ac', 'temperature') - 1 }}\n{% else %}\n  24\n{% endif %}\n"
                                        }
                                    }
                                ],
                                "helper_last_controller_event": "input_text.zz_eli_s_room_ac_controller_last_event"
                            }
                        }
                    },
                    "context": {
                        "id": "43ff91942ba3aa91130ff710736d4477",
                        "parent_id": "c8577eabc09886dff69f72db99903236",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "c67be40ee94e58bef7c36797154441d1",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T03:34:34.146767+00:00",
                        "finish": "2022-03-03T03:34:34.154099+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643645339926",
                    "trigger": "event 'zha_event'"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "953c85eb41ea4eda7728c0bc37daa9fb",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T04:31:23.764263+00:00",
                        "finish": "2022-03-03T04:31:23.770776+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643645339926",
                    "trigger": "event 'zha_event'",
                    "trace": {
                        "trigger/1": [
                            {
                                "path": "trigger/1",
                                "timestamp": "2022-03-03T04:31:23.764998+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.elis_room_ac_controller",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T03:34:34.148163+00:00",
                                            "mode": "restart",
                                            "current": 0,
                                            "id": "1643645339926",
                                            "friendly_name": "Eli's Room AC Controller"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.798982+00:00",
                                        "last_updated": "2022-03-03T03:34:34.153529+00:00",
                                        "context": {
                                            "id": "43ff91942ba3aa91130ff710736d4477",
                                            "parent_id": "c8577eabc09886dff69f72db99903236",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "1",
                                        "idx": "1",
                                        "platform": "event",
                                        "event": {
                                            "event_type": "zha_event",
                                            "data": {
                                                "device_ieee": "84:fd:27:ff:fe:95:bb:ff",
                                                "unique_id": "84:fd:27:ff:fe:95:bb:ff:1:0x0020",
                                                "device_id": "729379c869fac5a454929998eba2f3d2",
                                                "endpoint_id": 1,
                                                "cluster_id": 32,
                                                "command": "checkin",
                                                "args": []
                                            },
                                            "origin": "LOCAL",
                                            "time_fired": "2022-03-03T04:31:23.763415+00:00",
                                            "context": {
                                                "id": "61c377bcae546c6b2da9e268d57d2d5c",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "description": "event 'zha_event'"
                                    },
                                    "integration": "ZHA",
                                    "button_up_long_loop": false,
                                    "button_up_long_max_loop_repeats": 500,
                                    "button_up_double_press": false,
                                    "button_down_long_loop": false,
                                    "button_down_long_max_loop_repeats": 500,
                                    "button_down_double_press": false,
                                    "helper_last_controller_event": "input_text.zz_eli_s_room_ac_controller_last_event",
                                    "helper_double_press_delay": 500,
                                    "helper_debounce_delay": 0,
                                    "integration_id": "zha",
                                    "adjusted_double_press_delay": 500,
                                    "actions_mapping": {
                                        "deconz": {
                                            "button_up_short": [
                                                "1002"
                                            ],
                                            "button_up_long": [
                                                "1001"
                                            ],
                                            "button_up_release": [
                                                "1003"
                                            ],
                                            "button_down_short": [
                                                "2002"
                                            ],
                                            "button_down_long": [
                                                "2001"
                                            ],
                                            "button_down_release": [
                                                "2003"
                                            ]
                                        },
                                        "zha": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "move_with_on_off_0_83"
                                            ],
                                            "button_up_release": [
                                                "stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "move_1_83"
                                            ],
                                            "button_down_release": [
                                                "stop"
                                            ]
                                        },
                                        "zigbee2mqtt": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "brightness_move_up"
                                            ],
                                            "button_up_release": [
                                                "brightness_stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "brightness_move_down"
                                            ],
                                            "button_down_release": [
                                                "brightness_stop"
                                            ]
                                        }
                                    },
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ],
                                    "integrations_with_prev_event_storage": [
                                        "zha",
                                        "zigbee2mqtt"
                                    ],
                                    "controller_entity": "",
                                    "controller_device": "729379c869fac5a454929998eba2f3d2",
                                    "controller_id": "729379c869fac5a454929998eba2f3d2"
                                }
                            }
                        ],
                        "condition/0": [
                            {
                                "path": "condition/0",
                                "timestamp": "2022-03-03T04:31:23.765035+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "condition/0/conditions/0": [
                            {
                                "path": "condition/0/conditions/0",
                                "timestamp": "2022-03-03T04:31:23.765056+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "condition/0/conditions/1": [
                            {
                                "path": "condition/0/conditions/1",
                                "timestamp": "2022-03-03T04:31:23.765197+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T04:31:23.765956+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "ae28cb7c8284df21a33c26ff9e09f865",
                                        "parent_id": "61c377bcae546c6b2da9e268d57d2d5c",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "delay": 0.0,
                                    "done": true
                                }
                            }
                        ],
                        "action/1": [
                            {
                                "path": "action/1",
                                "timestamp": "2022-03-03T04:31:23.766984+00:00"
                            }
                        ],
                        "action/2": [
                            {
                                "path": "action/2",
                                "timestamp": "2022-03-03T04:31:23.767633+00:00",
                                "changed_variables": {
                                    "trigger_action": "checkin",
                                    "trigger_delta": 3409616.089105606,
                                    "last_controller_event": "checkin"
                                },
                                "result": {
                                    "params": {
                                        "domain": "input_text",
                                        "service": "set_value",
                                        "service_data": {
                                            "entity_id": "input_text.zz_eli_s_room_ac_controller_last_event",
                                            "value": {
                                                "trigger_action": "checkin",
                                                "last_triggered": "2022-03-03 12:31:23.767821+08:00"
                                            }
                                        },
                                        "target": {}
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "action/3": [
                            {
                                "path": "action/3",
                                "timestamp": "2022-03-03T04:31:23.769756+00:00"
                            }
                        ],
                        "action/3/choose/0": [
                            {
                                "path": "action/3/choose/0",
                                "timestamp": "2022-03-03T04:31:23.769809+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/0/conditions/0": [
                            {
                                "path": "action/3/choose/0/conditions/0",
                                "timestamp": "2022-03-03T04:31:23.769830+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/1": [
                            {
                                "path": "action/3/choose/1",
                                "timestamp": "2022-03-03T04:31:23.769941+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/1/conditions/0": [
                            {
                                "path": "action/3/choose/1/conditions/0",
                                "timestamp": "2022-03-03T04:31:23.769960+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/2": [
                            {
                                "path": "action/3/choose/2",
                                "timestamp": "2022-03-03T04:31:23.770032+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/2/conditions/0": [
                            {
                                "path": "action/3/choose/2/conditions/0",
                                "timestamp": "2022-03-03T04:31:23.770049+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/3": [
                            {
                                "path": "action/3/choose/3",
                                "timestamp": "2022-03-03T04:31:23.770122+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/3/conditions/0": [
                            {
                                "path": "action/3/choose/3/conditions/0",
                                "timestamp": "2022-03-03T04:31:23.770139+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/4": [
                            {
                                "path": "action/3/choose/4",
                                "timestamp": "2022-03-03T04:31:23.770203+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/4/conditions/0": [
                            {
                                "path": "action/3/choose/4/conditions/0",
                                "timestamp": "2022-03-03T04:31:23.770221+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/5": [
                            {
                                "path": "action/3/choose/5",
                                "timestamp": "2022-03-03T04:31:23.770284+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/5/conditions/0": [
                            {
                                "path": "action/3/choose/5/conditions/0",
                                "timestamp": "2022-03-03T04:31:23.770302+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ]
                    },
                    "config": {
                        "variables": {
                            "integration": "ZHA",
                            "button_up_long_loop": false,
                            "button_up_long_max_loop_repeats": 500,
                            "button_up_double_press": false,
                            "button_down_long_loop": false,
                            "button_down_long_max_loop_repeats": 500,
                            "button_down_double_press": false,
                            "helper_last_controller_event": "input_text.zz_eli_s_room_ac_controller_last_event",
                            "helper_double_press_delay": 500,
                            "helper_debounce_delay": 0,
                            "integration_id": "{{ integration | lower }}",
                            "adjusted_double_press_delay": "{{ [helper_double_press_delay - helper_debounce_delay, 100] | max }}",
                            "actions_mapping": {
                                "deconz": {
                                    "button_up_short": [
                                        "1002"
                                    ],
                                    "button_up_long": [
                                        "1001"
                                    ],
                                    "button_up_release": [
                                        "1003"
                                    ],
                                    "button_down_short": [
                                        "2002"
                                    ],
                                    "button_down_long": [
                                        "2001"
                                    ],
                                    "button_down_release": [
                                        "2003"
                                    ]
                                },
                                "zha": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ]
                                },
                                "zigbee2mqtt": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "brightness_move_up"
                                    ],
                                    "button_up_release": [
                                        "brightness_stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "brightness_move_down"
                                    ],
                                    "button_down_release": [
                                        "brightness_stop"
                                    ]
                                }
                            },
                            "button_up_short": "{{ actions_mapping[integration_id][\"button_up_short\"] }}",
                            "button_up_long": "{{ actions_mapping[integration_id][\"button_up_long\"] }}",
                            "button_up_release": "{{ actions_mapping[integration_id][\"button_up_release\"] }}",
                            "button_down_short": "{{ actions_mapping[integration_id][\"button_down_short\"] }}",
                            "button_down_long": "{{ actions_mapping[integration_id][\"button_down_long\"] }}",
                            "button_down_release": "{{ actions_mapping[integration_id][\"button_down_release\"] }}",
                            "integrations_with_prev_event_storage": [
                                "zha",
                                "zigbee2mqtt"
                            ],
                            "controller_entity": "",
                            "controller_device": "729379c869fac5a454929998eba2f3d2",
                            "controller_id": "{% if integration_id==\"zigbee2mqtt\" %}{{controller_entity}}{% else %}{{controller_device}}{% endif %}"
                        },
                        "mode": "restart",
                        "max_exceeded": "silent",
                        "trigger": [
                            {
                                "platform": "event",
                                "event_type": "state_changed",
                                "event_data": {
                                    "entity_id": ""
                                }
                            },
                            {
                                "platform": "event",
                                "event_type": [
                                    "deconz_event",
                                    "zha_event"
                                ],
                                "event_data": {
                                    "device_id": "729379c869fac5a454929998eba2f3d2"
                                }
                            }
                        ],
                        "condition": [
                            {
                                "condition": "and",
                                "conditions": [
                                    "{%- set trigger_action -%} {%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%} {%- endset -%} {{ trigger_action not in [\"\",\"None\"] }}",
                                    "{{ integration_id != \"zigbee2mqtt\" or trigger.event.data.new_state.state != trigger.event.data.old_state.state }}"
                                ]
                            }
                        ],
                        "action": [
                            {
                                "delay": {
                                    "milliseconds": 0
                                }
                            },
                            {
                                "variables": {
                                    "trigger_action": "{%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%}",
                                    "trigger_delta": "{{ (as_timestamp(now()) - as_timestamp((states(helper_last_controller_event) | from_json).last_triggered if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"1970-01-01 00:00:00\")) * 1000 }}",
                                    "last_controller_event": "{{ (states(helper_last_controller_event) | from_json).trigger_action if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"\" }}"
                                }
                            },
                            {
                                "service": "input_text.set_value",
                                "data": {
                                    "entity_id": "input_text.zz_eli_s_room_ac_controller_last_event",
                                    "value": "{{ {\"trigger_action\":trigger_action,\"last_triggered\":now()|string} | to_json }}"
                                }
                            },
                            {
                                "choose": [
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_eli_s_room_ac_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_up_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_up_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "climate.turn_on",
                                                                                        "target": {
                                                                                            "entity_id": "climate.elis_room_ac"
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_up_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "climate.turn_on",
                                                                        "target": {
                                                                            "entity_id": "climate.elis_room_ac"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_up_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "climate.set_temperature",
                                                                            "target": {
                                                                                "entity_id": "climate.elis_room_ac"
                                                                            },
                                                                            "data": {
                                                                                "temperature": "{% if state_attr('climate.elis_room_ac', 'temperature') < 27 %}\n  {{ state_attr('climate.elis_room_ac', 'temperature') + 1 }}\n{% else %}\n  27\n{% endif %}\n"
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "climate.set_temperature",
                                                        "target": {
                                                            "entity_id": "climate.elis_room_ac"
                                                        },
                                                        "data": {
                                                            "temperature": "{% if state_attr('climate.elis_room_ac', 'temperature') < 27 %}\n  {{ state_attr('climate.elis_room_ac', 'temperature') + 1 }}\n{% else %}\n  27\n{% endif %}\n"
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_up_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_up_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_eli_s_room_ac_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_down_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_down_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "climate.turn_off",
                                                                                        "target": {
                                                                                            "entity_id": "climate.elis_room_ac"
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_down_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "climate.turn_off",
                                                                        "target": {
                                                                            "entity_id": "climate.elis_room_ac"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_down_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "climate.set_temperature",
                                                                            "target": {
                                                                                "entity_id": "climate.elis_room_ac"
                                                                            },
                                                                            "data": {
                                                                                "temperature": "{% if state_attr('climate.elis_room_ac', 'temperature') > 24 %}\n  {{ state_attr('climate.elis_room_ac', 'temperature') - 1 }}\n{% else %}\n  24\n{% endif %}\n"
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "climate.set_temperature",
                                                        "target": {
                                                            "entity_id": "climate.elis_room_ac"
                                                        },
                                                        "data": {
                                                            "temperature": "{% if state_attr('climate.elis_room_ac', 'temperature') > 24 %}\n  {{ state_attr('climate.elis_room_ac', 'temperature') - 1 }}\n{% else %}\n  24\n{% endif %}\n"
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_down_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_down_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            }
                        ],
                        "id": "1643645339926",
                        "alias": "Eli's Room AC Controller",
                        "description": "Control Eli's Room AC"
                    },
                    "blueprint_inputs": {
                        "id": "1643645339926",
                        "alias": "Eli's Room AC Controller",
                        "description": "Control Eli's Room AC",
                        "use_blueprint": {
                            "path": "EPMatt/ikea_e1743.yaml",
                            "input": {
                                "integration": "ZHA",
                                "controller_device": "729379c869fac5a454929998eba2f3d2",
                                "action_button_up_short": [
                                    {
                                        "service": "climate.turn_on",
                                        "target": {
                                            "entity_id": "climate.elis_room_ac"
                                        }
                                    }
                                ],
                                "action_button_up_long": [
                                    {
                                        "service": "climate.set_temperature",
                                        "target": {
                                            "entity_id": "climate.elis_room_ac"
                                        },
                                        "data": {
                                            "temperature": "{% if state_attr('climate.elis_room_ac', 'temperature') < 27 %}\n  {{ state_attr('climate.elis_room_ac', 'temperature') + 1 }}\n{% else %}\n  27\n{% endif %}\n"
                                        }
                                    }
                                ],
                                "action_button_down_short": [
                                    {
                                        "service": "climate.turn_off",
                                        "target": {
                                            "entity_id": "climate.elis_room_ac"
                                        }
                                    }
                                ],
                                "action_button_down_long": [
                                    {
                                        "service": "climate.set_temperature",
                                        "target": {
                                            "entity_id": "climate.elis_room_ac"
                                        },
                                        "data": {
                                            "temperature": "{% if state_attr('climate.elis_room_ac', 'temperature') > 24 %}\n  {{ state_attr('climate.elis_room_ac', 'temperature') - 1 }}\n{% else %}\n  24\n{% endif %}\n"
                                        }
                                    }
                                ],
                                "helper_last_controller_event": "input_text.zz_eli_s_room_ac_controller_last_event"
                            }
                        }
                    },
                    "context": {
                        "id": "ae28cb7c8284df21a33c26ff9e09f865",
                        "parent_id": "61c377bcae546c6b2da9e268d57d2d5c",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "953c85eb41ea4eda7728c0bc37daa9fb",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T04:31:23.764263+00:00",
                        "finish": "2022-03-03T04:31:23.770776+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643645339926",
                    "trigger": "event 'zha_event'"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "1fd39dfd16e5e0f24fd7df1d357b08bb",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:28:13.245452+00:00",
                        "finish": "2022-03-03T05:28:13.253936+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643645339926",
                    "trigger": "event 'zha_event'",
                    "trace": {
                        "trigger/1": [
                            {
                                "path": "trigger/1",
                                "timestamp": "2022-03-03T05:28:13.246207+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.elis_room_ac_controller",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T04:31:23.765376+00:00",
                                            "mode": "restart",
                                            "current": 0,
                                            "id": "1643645339926",
                                            "friendly_name": "Eli's Room AC Controller"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.798982+00:00",
                                        "last_updated": "2022-03-03T04:31:23.770416+00:00",
                                        "context": {
                                            "id": "ae28cb7c8284df21a33c26ff9e09f865",
                                            "parent_id": "61c377bcae546c6b2da9e268d57d2d5c",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "1",
                                        "idx": "1",
                                        "platform": "event",
                                        "event": {
                                            "event_type": "zha_event",
                                            "data": {
                                                "device_ieee": "84:fd:27:ff:fe:95:bb:ff",
                                                "unique_id": "84:fd:27:ff:fe:95:bb:ff:1:0x0020",
                                                "device_id": "729379c869fac5a454929998eba2f3d2",
                                                "endpoint_id": 1,
                                                "cluster_id": 32,
                                                "command": "checkin",
                                                "args": []
                                            },
                                            "origin": "LOCAL",
                                            "time_fired": "2022-03-03T05:28:13.244281+00:00",
                                            "context": {
                                                "id": "965780a0dfd5f0e62ba09a426c54a0e5",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "description": "event 'zha_event'"
                                    },
                                    "integration": "ZHA",
                                    "button_up_long_loop": false,
                                    "button_up_long_max_loop_repeats": 500,
                                    "button_up_double_press": false,
                                    "button_down_long_loop": false,
                                    "button_down_long_max_loop_repeats": 500,
                                    "button_down_double_press": false,
                                    "helper_last_controller_event": "input_text.zz_eli_s_room_ac_controller_last_event",
                                    "helper_double_press_delay": 500,
                                    "helper_debounce_delay": 0,
                                    "integration_id": "zha",
                                    "adjusted_double_press_delay": 500,
                                    "actions_mapping": {
                                        "deconz": {
                                            "button_up_short": [
                                                "1002"
                                            ],
                                            "button_up_long": [
                                                "1001"
                                            ],
                                            "button_up_release": [
                                                "1003"
                                            ],
                                            "button_down_short": [
                                                "2002"
                                            ],
                                            "button_down_long": [
                                                "2001"
                                            ],
                                            "button_down_release": [
                                                "2003"
                                            ]
                                        },
                                        "zha": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "move_with_on_off_0_83"
                                            ],
                                            "button_up_release": [
                                                "stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "move_1_83"
                                            ],
                                            "button_down_release": [
                                                "stop"
                                            ]
                                        },
                                        "zigbee2mqtt": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "brightness_move_up"
                                            ],
                                            "button_up_release": [
                                                "brightness_stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "brightness_move_down"
                                            ],
                                            "button_down_release": [
                                                "brightness_stop"
                                            ]
                                        }
                                    },
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ],
                                    "integrations_with_prev_event_storage": [
                                        "zha",
                                        "zigbee2mqtt"
                                    ],
                                    "controller_entity": "",
                                    "controller_device": "729379c869fac5a454929998eba2f3d2",
                                    "controller_id": "729379c869fac5a454929998eba2f3d2"
                                }
                            }
                        ],
                        "condition/0": [
                            {
                                "path": "condition/0",
                                "timestamp": "2022-03-03T05:28:13.246251+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "condition/0/conditions/0": [
                            {
                                "path": "condition/0/conditions/0",
                                "timestamp": "2022-03-03T05:28:13.246270+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "condition/0/conditions/1": [
                            {
                                "path": "condition/0/conditions/1",
                                "timestamp": "2022-03-03T05:28:13.246403+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T05:28:13.247292+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "b42d3089b0ac5fa882a4cc56cff5d67a",
                                        "parent_id": "965780a0dfd5f0e62ba09a426c54a0e5",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "delay": 0.0,
                                    "done": true
                                }
                            }
                        ],
                        "action/1": [
                            {
                                "path": "action/1",
                                "timestamp": "2022-03-03T05:28:13.248761+00:00"
                            }
                        ],
                        "action/2": [
                            {
                                "path": "action/2",
                                "timestamp": "2022-03-03T05:28:13.249366+00:00",
                                "changed_variables": {
                                    "trigger_action": "checkin",
                                    "trigger_delta": 3409481.189966202,
                                    "last_controller_event": "checkin"
                                },
                                "result": {
                                    "params": {
                                        "domain": "input_text",
                                        "service": "set_value",
                                        "service_data": {
                                            "entity_id": "input_text.zz_eli_s_room_ac_controller_last_event",
                                            "value": {
                                                "trigger_action": "checkin",
                                                "last_triggered": "2022-03-03 13:28:13.249477+08:00"
                                            }
                                        },
                                        "target": {}
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "action/3": [
                            {
                                "path": "action/3",
                                "timestamp": "2022-03-03T05:28:13.251788+00:00"
                            }
                        ],
                        "action/3/choose/0": [
                            {
                                "path": "action/3/choose/0",
                                "timestamp": "2022-03-03T05:28:13.251847+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/0/conditions/0": [
                            {
                                "path": "action/3/choose/0/conditions/0",
                                "timestamp": "2022-03-03T05:28:13.251869+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/1": [
                            {
                                "path": "action/3/choose/1",
                                "timestamp": "2022-03-03T05:28:13.251990+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/1/conditions/0": [
                            {
                                "path": "action/3/choose/1/conditions/0",
                                "timestamp": "2022-03-03T05:28:13.252013+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/2": [
                            {
                                "path": "action/3/choose/2",
                                "timestamp": "2022-03-03T05:28:13.252100+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/2/conditions/0": [
                            {
                                "path": "action/3/choose/2/conditions/0",
                                "timestamp": "2022-03-03T05:28:13.252121+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/3": [
                            {
                                "path": "action/3/choose/3",
                                "timestamp": "2022-03-03T05:28:13.252203+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/3/conditions/0": [
                            {
                                "path": "action/3/choose/3/conditions/0",
                                "timestamp": "2022-03-03T05:28:13.252224+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/4": [
                            {
                                "path": "action/3/choose/4",
                                "timestamp": "2022-03-03T05:28:13.252304+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/4/conditions/0": [
                            {
                                "path": "action/3/choose/4/conditions/0",
                                "timestamp": "2022-03-03T05:28:13.252324+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/5": [
                            {
                                "path": "action/3/choose/5",
                                "timestamp": "2022-03-03T05:28:13.252427+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/5/conditions/0": [
                            {
                                "path": "action/3/choose/5/conditions/0",
                                "timestamp": "2022-03-03T05:28:13.252457+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ]
                    },
                    "config": {
                        "variables": {
                            "integration": "ZHA",
                            "button_up_long_loop": false,
                            "button_up_long_max_loop_repeats": 500,
                            "button_up_double_press": false,
                            "button_down_long_loop": false,
                            "button_down_long_max_loop_repeats": 500,
                            "button_down_double_press": false,
                            "helper_last_controller_event": "input_text.zz_eli_s_room_ac_controller_last_event",
                            "helper_double_press_delay": 500,
                            "helper_debounce_delay": 0,
                            "integration_id": "{{ integration | lower }}",
                            "adjusted_double_press_delay": "{{ [helper_double_press_delay - helper_debounce_delay, 100] | max }}",
                            "actions_mapping": {
                                "deconz": {
                                    "button_up_short": [
                                        "1002"
                                    ],
                                    "button_up_long": [
                                        "1001"
                                    ],
                                    "button_up_release": [
                                        "1003"
                                    ],
                                    "button_down_short": [
                                        "2002"
                                    ],
                                    "button_down_long": [
                                        "2001"
                                    ],
                                    "button_down_release": [
                                        "2003"
                                    ]
                                },
                                "zha": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ]
                                },
                                "zigbee2mqtt": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "brightness_move_up"
                                    ],
                                    "button_up_release": [
                                        "brightness_stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "brightness_move_down"
                                    ],
                                    "button_down_release": [
                                        "brightness_stop"
                                    ]
                                }
                            },
                            "button_up_short": "{{ actions_mapping[integration_id][\"button_up_short\"] }}",
                            "button_up_long": "{{ actions_mapping[integration_id][\"button_up_long\"] }}",
                            "button_up_release": "{{ actions_mapping[integration_id][\"button_up_release\"] }}",
                            "button_down_short": "{{ actions_mapping[integration_id][\"button_down_short\"] }}",
                            "button_down_long": "{{ actions_mapping[integration_id][\"button_down_long\"] }}",
                            "button_down_release": "{{ actions_mapping[integration_id][\"button_down_release\"] }}",
                            "integrations_with_prev_event_storage": [
                                "zha",
                                "zigbee2mqtt"
                            ],
                            "controller_entity": "",
                            "controller_device": "729379c869fac5a454929998eba2f3d2",
                            "controller_id": "{% if integration_id==\"zigbee2mqtt\" %}{{controller_entity}}{% else %}{{controller_device}}{% endif %}"
                        },
                        "mode": "restart",
                        "max_exceeded": "silent",
                        "trigger": [
                            {
                                "platform": "event",
                                "event_type": "state_changed",
                                "event_data": {
                                    "entity_id": ""
                                }
                            },
                            {
                                "platform": "event",
                                "event_type": [
                                    "deconz_event",
                                    "zha_event"
                                ],
                                "event_data": {
                                    "device_id": "729379c869fac5a454929998eba2f3d2"
                                }
                            }
                        ],
                        "condition": [
                            {
                                "condition": "and",
                                "conditions": [
                                    "{%- set trigger_action -%} {%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%} {%- endset -%} {{ trigger_action not in [\"\",\"None\"] }}",
                                    "{{ integration_id != \"zigbee2mqtt\" or trigger.event.data.new_state.state != trigger.event.data.old_state.state }}"
                                ]
                            }
                        ],
                        "action": [
                            {
                                "delay": {
                                    "milliseconds": 0
                                }
                            },
                            {
                                "variables": {
                                    "trigger_action": "{%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%}",
                                    "trigger_delta": "{{ (as_timestamp(now()) - as_timestamp((states(helper_last_controller_event) | from_json).last_triggered if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"1970-01-01 00:00:00\")) * 1000 }}",
                                    "last_controller_event": "{{ (states(helper_last_controller_event) | from_json).trigger_action if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"\" }}"
                                }
                            },
                            {
                                "service": "input_text.set_value",
                                "data": {
                                    "entity_id": "input_text.zz_eli_s_room_ac_controller_last_event",
                                    "value": "{{ {\"trigger_action\":trigger_action,\"last_triggered\":now()|string} | to_json }}"
                                }
                            },
                            {
                                "choose": [
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_eli_s_room_ac_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_up_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_up_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "climate.turn_on",
                                                                                        "target": {
                                                                                            "entity_id": "climate.elis_room_ac"
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_up_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "climate.turn_on",
                                                                        "target": {
                                                                            "entity_id": "climate.elis_room_ac"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_up_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "climate.set_temperature",
                                                                            "target": {
                                                                                "entity_id": "climate.elis_room_ac"
                                                                            },
                                                                            "data": {
                                                                                "temperature": "{% if state_attr('climate.elis_room_ac', 'temperature') < 27 %}\n  {{ state_attr('climate.elis_room_ac', 'temperature') + 1 }}\n{% else %}\n  27\n{% endif %}\n"
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "climate.set_temperature",
                                                        "target": {
                                                            "entity_id": "climate.elis_room_ac"
                                                        },
                                                        "data": {
                                                            "temperature": "{% if state_attr('climate.elis_room_ac', 'temperature') < 27 %}\n  {{ state_attr('climate.elis_room_ac', 'temperature') + 1 }}\n{% else %}\n  27\n{% endif %}\n"
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_up_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_up_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_eli_s_room_ac_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_down_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_down_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "climate.turn_off",
                                                                                        "target": {
                                                                                            "entity_id": "climate.elis_room_ac"
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_down_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "climate.turn_off",
                                                                        "target": {
                                                                            "entity_id": "climate.elis_room_ac"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_down_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "climate.set_temperature",
                                                                            "target": {
                                                                                "entity_id": "climate.elis_room_ac"
                                                                            },
                                                                            "data": {
                                                                                "temperature": "{% if state_attr('climate.elis_room_ac', 'temperature') > 24 %}\n  {{ state_attr('climate.elis_room_ac', 'temperature') - 1 }}\n{% else %}\n  24\n{% endif %}\n"
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "climate.set_temperature",
                                                        "target": {
                                                            "entity_id": "climate.elis_room_ac"
                                                        },
                                                        "data": {
                                                            "temperature": "{% if state_attr('climate.elis_room_ac', 'temperature') > 24 %}\n  {{ state_attr('climate.elis_room_ac', 'temperature') - 1 }}\n{% else %}\n  24\n{% endif %}\n"
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_down_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_down_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            }
                        ],
                        "id": "1643645339926",
                        "alias": "Eli's Room AC Controller",
                        "description": "Control Eli's Room AC"
                    },
                    "blueprint_inputs": {
                        "id": "1643645339926",
                        "alias": "Eli's Room AC Controller",
                        "description": "Control Eli's Room AC",
                        "use_blueprint": {
                            "path": "EPMatt/ikea_e1743.yaml",
                            "input": {
                                "integration": "ZHA",
                                "controller_device": "729379c869fac5a454929998eba2f3d2",
                                "action_button_up_short": [
                                    {
                                        "service": "climate.turn_on",
                                        "target": {
                                            "entity_id": "climate.elis_room_ac"
                                        }
                                    }
                                ],
                                "action_button_up_long": [
                                    {
                                        "service": "climate.set_temperature",
                                        "target": {
                                            "entity_id": "climate.elis_room_ac"
                                        },
                                        "data": {
                                            "temperature": "{% if state_attr('climate.elis_room_ac', 'temperature') < 27 %}\n  {{ state_attr('climate.elis_room_ac', 'temperature') + 1 }}\n{% else %}\n  27\n{% endif %}\n"
                                        }
                                    }
                                ],
                                "action_button_down_short": [
                                    {
                                        "service": "climate.turn_off",
                                        "target": {
                                            "entity_id": "climate.elis_room_ac"
                                        }
                                    }
                                ],
                                "action_button_down_long": [
                                    {
                                        "service": "climate.set_temperature",
                                        "target": {
                                            "entity_id": "climate.elis_room_ac"
                                        },
                                        "data": {
                                            "temperature": "{% if state_attr('climate.elis_room_ac', 'temperature') > 24 %}\n  {{ state_attr('climate.elis_room_ac', 'temperature') - 1 }}\n{% else %}\n  24\n{% endif %}\n"
                                        }
                                    }
                                ],
                                "helper_last_controller_event": "input_text.zz_eli_s_room_ac_controller_last_event"
                            }
                        }
                    },
                    "context": {
                        "id": "b42d3089b0ac5fa882a4cc56cff5d67a",
                        "parent_id": "965780a0dfd5f0e62ba09a426c54a0e5",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "1fd39dfd16e5e0f24fd7df1d357b08bb",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:28:13.245452+00:00",
                        "finish": "2022-03-03T05:28:13.253936+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643645339926",
                    "trigger": "event 'zha_event'"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "50b305d48dab54e485ae275953d57146",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T06:25:02.621086+00:00",
                        "finish": "2022-03-03T06:25:02.632863+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643645339926",
                    "trigger": "event 'zha_event'",
                    "trace": {
                        "trigger/1": [
                            {
                                "path": "trigger/1",
                                "timestamp": "2022-03-03T06:25:02.622132+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.elis_room_ac_controller",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T05:28:13.246561+00:00",
                                            "mode": "restart",
                                            "current": 0,
                                            "id": "1643645339926",
                                            "friendly_name": "Eli's Room AC Controller"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.798982+00:00",
                                        "last_updated": "2022-03-03T05:28:13.252604+00:00",
                                        "context": {
                                            "id": "b42d3089b0ac5fa882a4cc56cff5d67a",
                                            "parent_id": "965780a0dfd5f0e62ba09a426c54a0e5",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "1",
                                        "idx": "1",
                                        "platform": "event",
                                        "event": {
                                            "event_type": "zha_event",
                                            "data": {
                                                "device_ieee": "84:fd:27:ff:fe:95:bb:ff",
                                                "unique_id": "84:fd:27:ff:fe:95:bb:ff:1:0x0020",
                                                "device_id": "729379c869fac5a454929998eba2f3d2",
                                                "endpoint_id": 1,
                                                "cluster_id": 32,
                                                "command": "checkin",
                                                "args": []
                                            },
                                            "origin": "LOCAL",
                                            "time_fired": "2022-03-03T06:25:02.620135+00:00",
                                            "context": {
                                                "id": "e0ccf1202b724568725018ca3e5e52ab",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "description": "event 'zha_event'"
                                    },
                                    "integration": "ZHA",
                                    "button_up_long_loop": false,
                                    "button_up_long_max_loop_repeats": 500,
                                    "button_up_double_press": false,
                                    "button_down_long_loop": false,
                                    "button_down_long_max_loop_repeats": 500,
                                    "button_down_double_press": false,
                                    "helper_last_controller_event": "input_text.zz_eli_s_room_ac_controller_last_event",
                                    "helper_double_press_delay": 500,
                                    "helper_debounce_delay": 0,
                                    "integration_id": "zha",
                                    "adjusted_double_press_delay": 500,
                                    "actions_mapping": {
                                        "deconz": {
                                            "button_up_short": [
                                                "1002"
                                            ],
                                            "button_up_long": [
                                                "1001"
                                            ],
                                            "button_up_release": [
                                                "1003"
                                            ],
                                            "button_down_short": [
                                                "2002"
                                            ],
                                            "button_down_long": [
                                                "2001"
                                            ],
                                            "button_down_release": [
                                                "2003"
                                            ]
                                        },
                                        "zha": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "move_with_on_off_0_83"
                                            ],
                                            "button_up_release": [
                                                "stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "move_1_83"
                                            ],
                                            "button_down_release": [
                                                "stop"
                                            ]
                                        },
                                        "zigbee2mqtt": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "brightness_move_up"
                                            ],
                                            "button_up_release": [
                                                "brightness_stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "brightness_move_down"
                                            ],
                                            "button_down_release": [
                                                "brightness_stop"
                                            ]
                                        }
                                    },
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ],
                                    "integrations_with_prev_event_storage": [
                                        "zha",
                                        "zigbee2mqtt"
                                    ],
                                    "controller_entity": "",
                                    "controller_device": "729379c869fac5a454929998eba2f3d2",
                                    "controller_id": "729379c869fac5a454929998eba2f3d2"
                                }
                            }
                        ],
                        "condition/0": [
                            {
                                "path": "condition/0",
                                "timestamp": "2022-03-03T06:25:02.622174+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "condition/0/conditions/0": [
                            {
                                "path": "condition/0/conditions/0",
                                "timestamp": "2022-03-03T06:25:02.622201+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "condition/0/conditions/1": [
                            {
                                "path": "condition/0/conditions/1",
                                "timestamp": "2022-03-03T06:25:02.622423+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T06:25:02.624597+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "844ed9e40ef6912aeee4c42f1690a68a",
                                        "parent_id": "e0ccf1202b724568725018ca3e5e52ab",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "delay": 0.0,
                                    "done": true
                                }
                            }
                        ],
                        "action/1": [
                            {
                                "path": "action/1",
                                "timestamp": "2022-03-03T06:25:02.626473+00:00"
                            }
                        ],
                        "action/2": [
                            {
                                "path": "action/2",
                                "timestamp": "2022-03-03T06:25:02.627320+00:00",
                                "changed_variables": {
                                    "trigger_action": "checkin",
                                    "trigger_delta": 3409377.4180412292,
                                    "last_controller_event": "checkin"
                                },
                                "result": {
                                    "params": {
                                        "domain": "input_text",
                                        "service": "set_value",
                                        "service_data": {
                                            "entity_id": "input_text.zz_eli_s_room_ac_controller_last_event",
                                            "value": {
                                                "trigger_action": "checkin",
                                                "last_triggered": "2022-03-03 14:25:02.627611+08:00"
                                            }
                                        },
                                        "target": {}
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "action/3": [
                            {
                                "path": "action/3",
                                "timestamp": "2022-03-03T06:25:02.630512+00:00"
                            }
                        ],
                        "action/3/choose/0": [
                            {
                                "path": "action/3/choose/0",
                                "timestamp": "2022-03-03T06:25:02.630597+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/0/conditions/0": [
                            {
                                "path": "action/3/choose/0/conditions/0",
                                "timestamp": "2022-03-03T06:25:02.630649+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/1": [
                            {
                                "path": "action/3/choose/1",
                                "timestamp": "2022-03-03T06:25:02.630875+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/1/conditions/0": [
                            {
                                "path": "action/3/choose/1/conditions/0",
                                "timestamp": "2022-03-03T06:25:02.630902+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/2": [
                            {
                                "path": "action/3/choose/2",
                                "timestamp": "2022-03-03T06:25:02.631001+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/2/conditions/0": [
                            {
                                "path": "action/3/choose/2/conditions/0",
                                "timestamp": "2022-03-03T06:25:02.631023+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/3": [
                            {
                                "path": "action/3/choose/3",
                                "timestamp": "2022-03-03T06:25:02.631123+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/3/conditions/0": [
                            {
                                "path": "action/3/choose/3/conditions/0",
                                "timestamp": "2022-03-03T06:25:02.631145+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/4": [
                            {
                                "path": "action/3/choose/4",
                                "timestamp": "2022-03-03T06:25:02.631227+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/4/conditions/0": [
                            {
                                "path": "action/3/choose/4/conditions/0",
                                "timestamp": "2022-03-03T06:25:02.631247+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/5": [
                            {
                                "path": "action/3/choose/5",
                                "timestamp": "2022-03-03T06:25:02.631323+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/5/conditions/0": [
                            {
                                "path": "action/3/choose/5/conditions/0",
                                "timestamp": "2022-03-03T06:25:02.631342+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ]
                    },
                    "config": {
                        "variables": {
                            "integration": "ZHA",
                            "button_up_long_loop": false,
                            "button_up_long_max_loop_repeats": 500,
                            "button_up_double_press": false,
                            "button_down_long_loop": false,
                            "button_down_long_max_loop_repeats": 500,
                            "button_down_double_press": false,
                            "helper_last_controller_event": "input_text.zz_eli_s_room_ac_controller_last_event",
                            "helper_double_press_delay": 500,
                            "helper_debounce_delay": 0,
                            "integration_id": "{{ integration | lower }}",
                            "adjusted_double_press_delay": "{{ [helper_double_press_delay - helper_debounce_delay, 100] | max }}",
                            "actions_mapping": {
                                "deconz": {
                                    "button_up_short": [
                                        "1002"
                                    ],
                                    "button_up_long": [
                                        "1001"
                                    ],
                                    "button_up_release": [
                                        "1003"
                                    ],
                                    "button_down_short": [
                                        "2002"
                                    ],
                                    "button_down_long": [
                                        "2001"
                                    ],
                                    "button_down_release": [
                                        "2003"
                                    ]
                                },
                                "zha": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ]
                                },
                                "zigbee2mqtt": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "brightness_move_up"
                                    ],
                                    "button_up_release": [
                                        "brightness_stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "brightness_move_down"
                                    ],
                                    "button_down_release": [
                                        "brightness_stop"
                                    ]
                                }
                            },
                            "button_up_short": "{{ actions_mapping[integration_id][\"button_up_short\"] }}",
                            "button_up_long": "{{ actions_mapping[integration_id][\"button_up_long\"] }}",
                            "button_up_release": "{{ actions_mapping[integration_id][\"button_up_release\"] }}",
                            "button_down_short": "{{ actions_mapping[integration_id][\"button_down_short\"] }}",
                            "button_down_long": "{{ actions_mapping[integration_id][\"button_down_long\"] }}",
                            "button_down_release": "{{ actions_mapping[integration_id][\"button_down_release\"] }}",
                            "integrations_with_prev_event_storage": [
                                "zha",
                                "zigbee2mqtt"
                            ],
                            "controller_entity": "",
                            "controller_device": "729379c869fac5a454929998eba2f3d2",
                            "controller_id": "{% if integration_id==\"zigbee2mqtt\" %}{{controller_entity}}{% else %}{{controller_device}}{% endif %}"
                        },
                        "mode": "restart",
                        "max_exceeded": "silent",
                        "trigger": [
                            {
                                "platform": "event",
                                "event_type": "state_changed",
                                "event_data": {
                                    "entity_id": ""
                                }
                            },
                            {
                                "platform": "event",
                                "event_type": [
                                    "deconz_event",
                                    "zha_event"
                                ],
                                "event_data": {
                                    "device_id": "729379c869fac5a454929998eba2f3d2"
                                }
                            }
                        ],
                        "condition": [
                            {
                                "condition": "and",
                                "conditions": [
                                    "{%- set trigger_action -%} {%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%} {%- endset -%} {{ trigger_action not in [\"\",\"None\"] }}",
                                    "{{ integration_id != \"zigbee2mqtt\" or trigger.event.data.new_state.state != trigger.event.data.old_state.state }}"
                                ]
                            }
                        ],
                        "action": [
                            {
                                "delay": {
                                    "milliseconds": 0
                                }
                            },
                            {
                                "variables": {
                                    "trigger_action": "{%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%}",
                                    "trigger_delta": "{{ (as_timestamp(now()) - as_timestamp((states(helper_last_controller_event) | from_json).last_triggered if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"1970-01-01 00:00:00\")) * 1000 }}",
                                    "last_controller_event": "{{ (states(helper_last_controller_event) | from_json).trigger_action if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"\" }}"
                                }
                            },
                            {
                                "service": "input_text.set_value",
                                "data": {
                                    "entity_id": "input_text.zz_eli_s_room_ac_controller_last_event",
                                    "value": "{{ {\"trigger_action\":trigger_action,\"last_triggered\":now()|string} | to_json }}"
                                }
                            },
                            {
                                "choose": [
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_eli_s_room_ac_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_up_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_up_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "climate.turn_on",
                                                                                        "target": {
                                                                                            "entity_id": "climate.elis_room_ac"
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_up_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "climate.turn_on",
                                                                        "target": {
                                                                            "entity_id": "climate.elis_room_ac"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_up_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "climate.set_temperature",
                                                                            "target": {
                                                                                "entity_id": "climate.elis_room_ac"
                                                                            },
                                                                            "data": {
                                                                                "temperature": "{% if state_attr('climate.elis_room_ac', 'temperature') < 27 %}\n  {{ state_attr('climate.elis_room_ac', 'temperature') + 1 }}\n{% else %}\n  27\n{% endif %}\n"
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "climate.set_temperature",
                                                        "target": {
                                                            "entity_id": "climate.elis_room_ac"
                                                        },
                                                        "data": {
                                                            "temperature": "{% if state_attr('climate.elis_room_ac', 'temperature') < 27 %}\n  {{ state_attr('climate.elis_room_ac', 'temperature') + 1 }}\n{% else %}\n  27\n{% endif %}\n"
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_up_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_up_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_eli_s_room_ac_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_down_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_down_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "climate.turn_off",
                                                                                        "target": {
                                                                                            "entity_id": "climate.elis_room_ac"
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_down_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "climate.turn_off",
                                                                        "target": {
                                                                            "entity_id": "climate.elis_room_ac"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_down_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "climate.set_temperature",
                                                                            "target": {
                                                                                "entity_id": "climate.elis_room_ac"
                                                                            },
                                                                            "data": {
                                                                                "temperature": "{% if state_attr('climate.elis_room_ac', 'temperature') > 24 %}\n  {{ state_attr('climate.elis_room_ac', 'temperature') - 1 }}\n{% else %}\n  24\n{% endif %}\n"
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "climate.set_temperature",
                                                        "target": {
                                                            "entity_id": "climate.elis_room_ac"
                                                        },
                                                        "data": {
                                                            "temperature": "{% if state_attr('climate.elis_room_ac', 'temperature') > 24 %}\n  {{ state_attr('climate.elis_room_ac', 'temperature') - 1 }}\n{% else %}\n  24\n{% endif %}\n"
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_down_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_down_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            }
                        ],
                        "id": "1643645339926",
                        "alias": "Eli's Room AC Controller",
                        "description": "Control Eli's Room AC"
                    },
                    "blueprint_inputs": {
                        "id": "1643645339926",
                        "alias": "Eli's Room AC Controller",
                        "description": "Control Eli's Room AC",
                        "use_blueprint": {
                            "path": "EPMatt/ikea_e1743.yaml",
                            "input": {
                                "integration": "ZHA",
                                "controller_device": "729379c869fac5a454929998eba2f3d2",
                                "action_button_up_short": [
                                    {
                                        "service": "climate.turn_on",
                                        "target": {
                                            "entity_id": "climate.elis_room_ac"
                                        }
                                    }
                                ],
                                "action_button_up_long": [
                                    {
                                        "service": "climate.set_temperature",
                                        "target": {
                                            "entity_id": "climate.elis_room_ac"
                                        },
                                        "data": {
                                            "temperature": "{% if state_attr('climate.elis_room_ac', 'temperature') < 27 %}\n  {{ state_attr('climate.elis_room_ac', 'temperature') + 1 }}\n{% else %}\n  27\n{% endif %}\n"
                                        }
                                    }
                                ],
                                "action_button_down_short": [
                                    {
                                        "service": "climate.turn_off",
                                        "target": {
                                            "entity_id": "climate.elis_room_ac"
                                        }
                                    }
                                ],
                                "action_button_down_long": [
                                    {
                                        "service": "climate.set_temperature",
                                        "target": {
                                            "entity_id": "climate.elis_room_ac"
                                        },
                                        "data": {
                                            "temperature": "{% if state_attr('climate.elis_room_ac', 'temperature') > 24 %}\n  {{ state_attr('climate.elis_room_ac', 'temperature') - 1 }}\n{% else %}\n  24\n{% endif %}\n"
                                        }
                                    }
                                ],
                                "helper_last_controller_event": "input_text.zz_eli_s_room_ac_controller_last_event"
                            }
                        }
                    },
                    "context": {
                        "id": "844ed9e40ef6912aeee4c42f1690a68a",
                        "parent_id": "e0ccf1202b724568725018ca3e5e52ab",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "50b305d48dab54e485ae275953d57146",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T06:25:02.621086+00:00",
                        "finish": "2022-03-03T06:25:02.632863+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643645339926",
                    "trigger": "event 'zha_event'"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "df9a1918a817a269b12aeab30dbfad9d",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T07:21:51.894965+00:00",
                        "finish": "2022-03-03T07:21:51.902137+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643645339926",
                    "trigger": "event 'zha_event'",
                    "trace": {
                        "trigger/1": [
                            {
                                "path": "trigger/1",
                                "timestamp": "2022-03-03T07:21:51.896095+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.elis_room_ac_controller",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T06:25:02.622655+00:00",
                                            "mode": "restart",
                                            "current": 0,
                                            "id": "1643645339926",
                                            "friendly_name": "Eli's Room AC Controller"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.798982+00:00",
                                        "last_updated": "2022-03-03T06:25:02.631515+00:00",
                                        "context": {
                                            "id": "844ed9e40ef6912aeee4c42f1690a68a",
                                            "parent_id": "e0ccf1202b724568725018ca3e5e52ab",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "1",
                                        "idx": "1",
                                        "platform": "event",
                                        "event": {
                                            "event_type": "zha_event",
                                            "data": {
                                                "device_ieee": "84:fd:27:ff:fe:95:bb:ff",
                                                "unique_id": "84:fd:27:ff:fe:95:bb:ff:1:0x0020",
                                                "device_id": "729379c869fac5a454929998eba2f3d2",
                                                "endpoint_id": 1,
                                                "cluster_id": 32,
                                                "command": "checkin",
                                                "args": []
                                            },
                                            "origin": "LOCAL",
                                            "time_fired": "2022-03-03T07:21:51.893256+00:00",
                                            "context": {
                                                "id": "cc9bb0d018ab724fd2dc4d2457f6f89b",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "description": "event 'zha_event'"
                                    },
                                    "integration": "ZHA",
                                    "button_up_long_loop": false,
                                    "button_up_long_max_loop_repeats": 500,
                                    "button_up_double_press": false,
                                    "button_down_long_loop": false,
                                    "button_down_long_max_loop_repeats": 500,
                                    "button_down_double_press": false,
                                    "helper_last_controller_event": "input_text.zz_eli_s_room_ac_controller_last_event",
                                    "helper_double_press_delay": 500,
                                    "helper_debounce_delay": 0,
                                    "integration_id": "zha",
                                    "adjusted_double_press_delay": 500,
                                    "actions_mapping": {
                                        "deconz": {
                                            "button_up_short": [
                                                "1002"
                                            ],
                                            "button_up_long": [
                                                "1001"
                                            ],
                                            "button_up_release": [
                                                "1003"
                                            ],
                                            "button_down_short": [
                                                "2002"
                                            ],
                                            "button_down_long": [
                                                "2001"
                                            ],
                                            "button_down_release": [
                                                "2003"
                                            ]
                                        },
                                        "zha": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "move_with_on_off_0_83"
                                            ],
                                            "button_up_release": [
                                                "stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "move_1_83"
                                            ],
                                            "button_down_release": [
                                                "stop"
                                            ]
                                        },
                                        "zigbee2mqtt": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "brightness_move_up"
                                            ],
                                            "button_up_release": [
                                                "brightness_stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "brightness_move_down"
                                            ],
                                            "button_down_release": [
                                                "brightness_stop"
                                            ]
                                        }
                                    },
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ],
                                    "integrations_with_prev_event_storage": [
                                        "zha",
                                        "zigbee2mqtt"
                                    ],
                                    "controller_entity": "",
                                    "controller_device": "729379c869fac5a454929998eba2f3d2",
                                    "controller_id": "729379c869fac5a454929998eba2f3d2"
                                }
                            }
                        ],
                        "condition/0": [
                            {
                                "path": "condition/0",
                                "timestamp": "2022-03-03T07:21:51.896143+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "condition/0/conditions/0": [
                            {
                                "path": "condition/0/conditions/0",
                                "timestamp": "2022-03-03T07:21:51.896164+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "condition/0/conditions/1": [
                            {
                                "path": "condition/0/conditions/1",
                                "timestamp": "2022-03-03T07:21:51.896321+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T07:21:51.897171+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "8e8b0af7109ae151e4580b6e37c79064",
                                        "parent_id": "cc9bb0d018ab724fd2dc4d2457f6f89b",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "delay": 0.0,
                                    "done": true
                                }
                            }
                        ],
                        "action/1": [
                            {
                                "path": "action/1",
                                "timestamp": "2022-03-03T07:21:51.898214+00:00"
                            }
                        ],
                        "action/2": [
                            {
                                "path": "action/2",
                                "timestamp": "2022-03-03T07:21:51.899086+00:00",
                                "changed_variables": {
                                    "trigger_action": "checkin",
                                    "trigger_delta": 3409270.893096924,
                                    "last_controller_event": "checkin"
                                },
                                "result": {
                                    "params": {
                                        "domain": "input_text",
                                        "service": "set_value",
                                        "service_data": {
                                            "entity_id": "input_text.zz_eli_s_room_ac_controller_last_event",
                                            "value": {
                                                "trigger_action": "checkin",
                                                "last_triggered": "2022-03-03 15:21:51.899208+08:00"
                                            }
                                        },
                                        "target": {}
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "action/3": [
                            {
                                "path": "action/3",
                                "timestamp": "2022-03-03T07:21:51.900738+00:00"
                            }
                        ],
                        "action/3/choose/0": [
                            {
                                "path": "action/3/choose/0",
                                "timestamp": "2022-03-03T07:21:51.900793+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/0/conditions/0": [
                            {
                                "path": "action/3/choose/0/conditions/0",
                                "timestamp": "2022-03-03T07:21:51.900830+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/1": [
                            {
                                "path": "action/3/choose/1",
                                "timestamp": "2022-03-03T07:21:51.900948+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/1/conditions/0": [
                            {
                                "path": "action/3/choose/1/conditions/0",
                                "timestamp": "2022-03-03T07:21:51.900968+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/2": [
                            {
                                "path": "action/3/choose/2",
                                "timestamp": "2022-03-03T07:21:51.901046+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/2/conditions/0": [
                            {
                                "path": "action/3/choose/2/conditions/0",
                                "timestamp": "2022-03-03T07:21:51.901064+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/3": [
                            {
                                "path": "action/3/choose/3",
                                "timestamp": "2022-03-03T07:21:51.901142+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/3/conditions/0": [
                            {
                                "path": "action/3/choose/3/conditions/0",
                                "timestamp": "2022-03-03T07:21:51.901160+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/4": [
                            {
                                "path": "action/3/choose/4",
                                "timestamp": "2022-03-03T07:21:51.901225+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/4/conditions/0": [
                            {
                                "path": "action/3/choose/4/conditions/0",
                                "timestamp": "2022-03-03T07:21:51.901242+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/5": [
                            {
                                "path": "action/3/choose/5",
                                "timestamp": "2022-03-03T07:21:51.901314+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/5/conditions/0": [
                            {
                                "path": "action/3/choose/5/conditions/0",
                                "timestamp": "2022-03-03T07:21:51.901332+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ]
                    },
                    "config": {
                        "variables": {
                            "integration": "ZHA",
                            "button_up_long_loop": false,
                            "button_up_long_max_loop_repeats": 500,
                            "button_up_double_press": false,
                            "button_down_long_loop": false,
                            "button_down_long_max_loop_repeats": 500,
                            "button_down_double_press": false,
                            "helper_last_controller_event": "input_text.zz_eli_s_room_ac_controller_last_event",
                            "helper_double_press_delay": 500,
                            "helper_debounce_delay": 0,
                            "integration_id": "{{ integration | lower }}",
                            "adjusted_double_press_delay": "{{ [helper_double_press_delay - helper_debounce_delay, 100] | max }}",
                            "actions_mapping": {
                                "deconz": {
                                    "button_up_short": [
                                        "1002"
                                    ],
                                    "button_up_long": [
                                        "1001"
                                    ],
                                    "button_up_release": [
                                        "1003"
                                    ],
                                    "button_down_short": [
                                        "2002"
                                    ],
                                    "button_down_long": [
                                        "2001"
                                    ],
                                    "button_down_release": [
                                        "2003"
                                    ]
                                },
                                "zha": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ]
                                },
                                "zigbee2mqtt": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "brightness_move_up"
                                    ],
                                    "button_up_release": [
                                        "brightness_stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "brightness_move_down"
                                    ],
                                    "button_down_release": [
                                        "brightness_stop"
                                    ]
                                }
                            },
                            "button_up_short": "{{ actions_mapping[integration_id][\"button_up_short\"] }}",
                            "button_up_long": "{{ actions_mapping[integration_id][\"button_up_long\"] }}",
                            "button_up_release": "{{ actions_mapping[integration_id][\"button_up_release\"] }}",
                            "button_down_short": "{{ actions_mapping[integration_id][\"button_down_short\"] }}",
                            "button_down_long": "{{ actions_mapping[integration_id][\"button_down_long\"] }}",
                            "button_down_release": "{{ actions_mapping[integration_id][\"button_down_release\"] }}",
                            "integrations_with_prev_event_storage": [
                                "zha",
                                "zigbee2mqtt"
                            ],
                            "controller_entity": "",
                            "controller_device": "729379c869fac5a454929998eba2f3d2",
                            "controller_id": "{% if integration_id==\"zigbee2mqtt\" %}{{controller_entity}}{% else %}{{controller_device}}{% endif %}"
                        },
                        "mode": "restart",
                        "max_exceeded": "silent",
                        "trigger": [
                            {
                                "platform": "event",
                                "event_type": "state_changed",
                                "event_data": {
                                    "entity_id": ""
                                }
                            },
                            {
                                "platform": "event",
                                "event_type": [
                                    "deconz_event",
                                    "zha_event"
                                ],
                                "event_data": {
                                    "device_id": "729379c869fac5a454929998eba2f3d2"
                                }
                            }
                        ],
                        "condition": [
                            {
                                "condition": "and",
                                "conditions": [
                                    "{%- set trigger_action -%} {%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%} {%- endset -%} {{ trigger_action not in [\"\",\"None\"] }}",
                                    "{{ integration_id != \"zigbee2mqtt\" or trigger.event.data.new_state.state != trigger.event.data.old_state.state }}"
                                ]
                            }
                        ],
                        "action": [
                            {
                                "delay": {
                                    "milliseconds": 0
                                }
                            },
                            {
                                "variables": {
                                    "trigger_action": "{%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%}",
                                    "trigger_delta": "{{ (as_timestamp(now()) - as_timestamp((states(helper_last_controller_event) | from_json).last_triggered if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"1970-01-01 00:00:00\")) * 1000 }}",
                                    "last_controller_event": "{{ (states(helper_last_controller_event) | from_json).trigger_action if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"\" }}"
                                }
                            },
                            {
                                "service": "input_text.set_value",
                                "data": {
                                    "entity_id": "input_text.zz_eli_s_room_ac_controller_last_event",
                                    "value": "{{ {\"trigger_action\":trigger_action,\"last_triggered\":now()|string} | to_json }}"
                                }
                            },
                            {
                                "choose": [
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_eli_s_room_ac_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_up_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_up_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "climate.turn_on",
                                                                                        "target": {
                                                                                            "entity_id": "climate.elis_room_ac"
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_up_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "climate.turn_on",
                                                                        "target": {
                                                                            "entity_id": "climate.elis_room_ac"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_up_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "climate.set_temperature",
                                                                            "target": {
                                                                                "entity_id": "climate.elis_room_ac"
                                                                            },
                                                                            "data": {
                                                                                "temperature": "{% if state_attr('climate.elis_room_ac', 'temperature') < 27 %}\n  {{ state_attr('climate.elis_room_ac', 'temperature') + 1 }}\n{% else %}\n  27\n{% endif %}\n"
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "climate.set_temperature",
                                                        "target": {
                                                            "entity_id": "climate.elis_room_ac"
                                                        },
                                                        "data": {
                                                            "temperature": "{% if state_attr('climate.elis_room_ac', 'temperature') < 27 %}\n  {{ state_attr('climate.elis_room_ac', 'temperature') + 1 }}\n{% else %}\n  27\n{% endif %}\n"
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_up_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_up_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_eli_s_room_ac_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_down_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_down_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "climate.turn_off",
                                                                                        "target": {
                                                                                            "entity_id": "climate.elis_room_ac"
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_down_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "climate.turn_off",
                                                                        "target": {
                                                                            "entity_id": "climate.elis_room_ac"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_down_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "climate.set_temperature",
                                                                            "target": {
                                                                                "entity_id": "climate.elis_room_ac"
                                                                            },
                                                                            "data": {
                                                                                "temperature": "{% if state_attr('climate.elis_room_ac', 'temperature') > 24 %}\n  {{ state_attr('climate.elis_room_ac', 'temperature') - 1 }}\n{% else %}\n  24\n{% endif %}\n"
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "climate.set_temperature",
                                                        "target": {
                                                            "entity_id": "climate.elis_room_ac"
                                                        },
                                                        "data": {
                                                            "temperature": "{% if state_attr('climate.elis_room_ac', 'temperature') > 24 %}\n  {{ state_attr('climate.elis_room_ac', 'temperature') - 1 }}\n{% else %}\n  24\n{% endif %}\n"
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_down_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_down_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            }
                        ],
                        "id": "1643645339926",
                        "alias": "Eli's Room AC Controller",
                        "description": "Control Eli's Room AC"
                    },
                    "blueprint_inputs": {
                        "id": "1643645339926",
                        "alias": "Eli's Room AC Controller",
                        "description": "Control Eli's Room AC",
                        "use_blueprint": {
                            "path": "EPMatt/ikea_e1743.yaml",
                            "input": {
                                "integration": "ZHA",
                                "controller_device": "729379c869fac5a454929998eba2f3d2",
                                "action_button_up_short": [
                                    {
                                        "service": "climate.turn_on",
                                        "target": {
                                            "entity_id": "climate.elis_room_ac"
                                        }
                                    }
                                ],
                                "action_button_up_long": [
                                    {
                                        "service": "climate.set_temperature",
                                        "target": {
                                            "entity_id": "climate.elis_room_ac"
                                        },
                                        "data": {
                                            "temperature": "{% if state_attr('climate.elis_room_ac', 'temperature') < 27 %}\n  {{ state_attr('climate.elis_room_ac', 'temperature') + 1 }}\n{% else %}\n  27\n{% endif %}\n"
                                        }
                                    }
                                ],
                                "action_button_down_short": [
                                    {
                                        "service": "climate.turn_off",
                                        "target": {
                                            "entity_id": "climate.elis_room_ac"
                                        }
                                    }
                                ],
                                "action_button_down_long": [
                                    {
                                        "service": "climate.set_temperature",
                                        "target": {
                                            "entity_id": "climate.elis_room_ac"
                                        },
                                        "data": {
                                            "temperature": "{% if state_attr('climate.elis_room_ac', 'temperature') > 24 %}\n  {{ state_attr('climate.elis_room_ac', 'temperature') - 1 }}\n{% else %}\n  24\n{% endif %}\n"
                                        }
                                    }
                                ],
                                "helper_last_controller_event": "input_text.zz_eli_s_room_ac_controller_last_event"
                            }
                        }
                    },
                    "context": {
                        "id": "8e8b0af7109ae151e4580b6e37c79064",
                        "parent_id": "cc9bb0d018ab724fd2dc4d2457f6f89b",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "df9a1918a817a269b12aeab30dbfad9d",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T07:21:51.894965+00:00",
                        "finish": "2022-03-03T07:21:51.902137+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643645339926",
                    "trigger": "event 'zha_event'"
                }
            }
        ],
        "automation.1643641631013": [
            {
                "extended_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "18da303ce6d353c106df4f2002b58cc3",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T04:34:14.710227+00:00",
                        "finish": "2022-03-03T04:34:14.716382+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643641631013",
                    "trigger": "event 'zha_event'",
                    "trace": {
                        "trigger/1": [
                            {
                                "path": "trigger/1",
                                "timestamp": "2022-03-03T04:34:14.710908+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.playroom_lights_controller",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T03:37:33.108144+00:00",
                                            "mode": "restart",
                                            "current": 0,
                                            "id": "1643641631013",
                                            "friendly_name": "Playroom Lights Controller"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.798184+00:00",
                                        "last_updated": "2022-03-03T03:37:33.112876+00:00",
                                        "context": {
                                            "id": "358818e7660a144122201e07d95cc26d",
                                            "parent_id": "82d3ac18e58a3b7d3872ee723a9f8df1",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "1",
                                        "idx": "1",
                                        "platform": "event",
                                        "event": {
                                            "event_type": "zha_event",
                                            "data": {
                                                "device_ieee": "84:fd:27:ff:fe:9c:0f:fc",
                                                "unique_id": "84:fd:27:ff:fe:9c:0f:fc:1:0x0020",
                                                "device_id": "867b78e6f7808ffcceb260be52b0c174",
                                                "endpoint_id": 1,
                                                "cluster_id": 32,
                                                "command": "checkin",
                                                "args": []
                                            },
                                            "origin": "LOCAL",
                                            "time_fired": "2022-03-03T04:34:14.709339+00:00",
                                            "context": {
                                                "id": "a759e2eebb95d4891151ce0053ba9e2f",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "description": "event 'zha_event'"
                                    },
                                    "integration": "ZHA",
                                    "button_up_long_loop": true,
                                    "button_up_long_max_loop_repeats": 50,
                                    "button_up_double_press": false,
                                    "button_down_long_loop": true,
                                    "button_down_long_max_loop_repeats": 50,
                                    "button_down_double_press": false,
                                    "helper_last_controller_event": "input_text.zz_playroom_lights_controller_last_event",
                                    "helper_double_press_delay": 500,
                                    "helper_debounce_delay": 0,
                                    "integration_id": "zha",
                                    "adjusted_double_press_delay": 500,
                                    "actions_mapping": {
                                        "deconz": {
                                            "button_up_short": [
                                                "1002"
                                            ],
                                            "button_up_long": [
                                                "1001"
                                            ],
                                            "button_up_release": [
                                                "1003"
                                            ],
                                            "button_down_short": [
                                                "2002"
                                            ],
                                            "button_down_long": [
                                                "2001"
                                            ],
                                            "button_down_release": [
                                                "2003"
                                            ]
                                        },
                                        "zha": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "move_with_on_off_0_83"
                                            ],
                                            "button_up_release": [
                                                "stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "move_1_83"
                                            ],
                                            "button_down_release": [
                                                "stop"
                                            ]
                                        },
                                        "zigbee2mqtt": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "brightness_move_up"
                                            ],
                                            "button_up_release": [
                                                "brightness_stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "brightness_move_down"
                                            ],
                                            "button_down_release": [
                                                "brightness_stop"
                                            ]
                                        }
                                    },
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ],
                                    "integrations_with_prev_event_storage": [
                                        "zha",
                                        "zigbee2mqtt"
                                    ],
                                    "controller_entity": "",
                                    "controller_device": "867b78e6f7808ffcceb260be52b0c174",
                                    "controller_id": "867b78e6f7808ffcceb260be52b0c174"
                                }
                            }
                        ],
                        "condition/0": [
                            {
                                "path": "condition/0",
                                "timestamp": "2022-03-03T04:34:14.710936+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "condition/0/conditions/0": [
                            {
                                "path": "condition/0/conditions/0",
                                "timestamp": "2022-03-03T04:34:14.710962+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "condition/0/conditions/1": [
                            {
                                "path": "condition/0/conditions/1",
                                "timestamp": "2022-03-03T04:34:14.711094+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T04:34:14.712217+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "9ee1fe750088a1a1406e47f15b5d6bf4",
                                        "parent_id": "a759e2eebb95d4891151ce0053ba9e2f",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "delay": 0.0,
                                    "done": true
                                }
                            }
                        ],
                        "action/1": [
                            {
                                "path": "action/1",
                                "timestamp": "2022-03-03T04:34:14.713179+00:00"
                            }
                        ],
                        "action/2": [
                            {
                                "path": "action/2",
                                "timestamp": "2022-03-03T04:34:14.713821+00:00",
                                "changed_variables": {
                                    "trigger_action": "checkin",
                                    "trigger_delta": 3401602.6401519775,
                                    "last_controller_event": "checkin"
                                },
                                "result": {
                                    "params": {
                                        "domain": "input_text",
                                        "service": "set_value",
                                        "service_data": {
                                            "entity_id": "input_text.zz_playroom_lights_controller_last_event",
                                            "value": {
                                                "trigger_action": "checkin",
                                                "last_triggered": "2022-03-03 12:34:14.713931+08:00"
                                            }
                                        },
                                        "target": {}
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "action/3": [
                            {
                                "path": "action/3",
                                "timestamp": "2022-03-03T04:34:14.715302+00:00"
                            }
                        ],
                        "action/3/choose/0": [
                            {
                                "path": "action/3/choose/0",
                                "timestamp": "2022-03-03T04:34:14.715353+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/0/conditions/0": [
                            {
                                "path": "action/3/choose/0/conditions/0",
                                "timestamp": "2022-03-03T04:34:14.715375+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/1": [
                            {
                                "path": "action/3/choose/1",
                                "timestamp": "2022-03-03T04:34:14.715504+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/1/conditions/0": [
                            {
                                "path": "action/3/choose/1/conditions/0",
                                "timestamp": "2022-03-03T04:34:14.715525+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/2": [
                            {
                                "path": "action/3/choose/2",
                                "timestamp": "2022-03-03T04:34:14.715614+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/2/conditions/0": [
                            {
                                "path": "action/3/choose/2/conditions/0",
                                "timestamp": "2022-03-03T04:34:14.715643+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/3": [
                            {
                                "path": "action/3/choose/3",
                                "timestamp": "2022-03-03T04:34:14.715738+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/3/conditions/0": [
                            {
                                "path": "action/3/choose/3/conditions/0",
                                "timestamp": "2022-03-03T04:34:14.715759+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/4": [
                            {
                                "path": "action/3/choose/4",
                                "timestamp": "2022-03-03T04:34:14.715833+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/4/conditions/0": [
                            {
                                "path": "action/3/choose/4/conditions/0",
                                "timestamp": "2022-03-03T04:34:14.715854+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/5": [
                            {
                                "path": "action/3/choose/5",
                                "timestamp": "2022-03-03T04:34:14.715922+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/5/conditions/0": [
                            {
                                "path": "action/3/choose/5/conditions/0",
                                "timestamp": "2022-03-03T04:34:14.715939+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ]
                    },
                    "config": {
                        "variables": {
                            "integration": "ZHA",
                            "button_up_long_loop": true,
                            "button_up_long_max_loop_repeats": 50,
                            "button_up_double_press": false,
                            "button_down_long_loop": true,
                            "button_down_long_max_loop_repeats": 50,
                            "button_down_double_press": false,
                            "helper_last_controller_event": "input_text.zz_playroom_lights_controller_last_event",
                            "helper_double_press_delay": 500,
                            "helper_debounce_delay": 0,
                            "integration_id": "{{ integration | lower }}",
                            "adjusted_double_press_delay": "{{ [helper_double_press_delay - helper_debounce_delay, 100] | max }}",
                            "actions_mapping": {
                                "deconz": {
                                    "button_up_short": [
                                        "1002"
                                    ],
                                    "button_up_long": [
                                        "1001"
                                    ],
                                    "button_up_release": [
                                        "1003"
                                    ],
                                    "button_down_short": [
                                        "2002"
                                    ],
                                    "button_down_long": [
                                        "2001"
                                    ],
                                    "button_down_release": [
                                        "2003"
                                    ]
                                },
                                "zha": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ]
                                },
                                "zigbee2mqtt": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "brightness_move_up"
                                    ],
                                    "button_up_release": [
                                        "brightness_stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "brightness_move_down"
                                    ],
                                    "button_down_release": [
                                        "brightness_stop"
                                    ]
                                }
                            },
                            "button_up_short": "{{ actions_mapping[integration_id][\"button_up_short\"] }}",
                            "button_up_long": "{{ actions_mapping[integration_id][\"button_up_long\"] }}",
                            "button_up_release": "{{ actions_mapping[integration_id][\"button_up_release\"] }}",
                            "button_down_short": "{{ actions_mapping[integration_id][\"button_down_short\"] }}",
                            "button_down_long": "{{ actions_mapping[integration_id][\"button_down_long\"] }}",
                            "button_down_release": "{{ actions_mapping[integration_id][\"button_down_release\"] }}",
                            "integrations_with_prev_event_storage": [
                                "zha",
                                "zigbee2mqtt"
                            ],
                            "controller_entity": "",
                            "controller_device": "867b78e6f7808ffcceb260be52b0c174",
                            "controller_id": "{% if integration_id==\"zigbee2mqtt\" %}{{controller_entity}}{% else %}{{controller_device}}{% endif %}"
                        },
                        "mode": "restart",
                        "max_exceeded": "silent",
                        "trigger": [
                            {
                                "platform": "event",
                                "event_type": "state_changed",
                                "event_data": {
                                    "entity_id": ""
                                }
                            },
                            {
                                "platform": "event",
                                "event_type": [
                                    "deconz_event",
                                    "zha_event"
                                ],
                                "event_data": {
                                    "device_id": "867b78e6f7808ffcceb260be52b0c174"
                                }
                            }
                        ],
                        "condition": [
                            {
                                "condition": "and",
                                "conditions": [
                                    "{%- set trigger_action -%} {%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%} {%- endset -%} {{ trigger_action not in [\"\",\"None\"] }}",
                                    "{{ integration_id != \"zigbee2mqtt\" or trigger.event.data.new_state.state != trigger.event.data.old_state.state }}"
                                ]
                            }
                        ],
                        "action": [
                            {
                                "delay": {
                                    "milliseconds": 0
                                }
                            },
                            {
                                "variables": {
                                    "trigger_action": "{%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%}",
                                    "trigger_delta": "{{ (as_timestamp(now()) - as_timestamp((states(helper_last_controller_event) | from_json).last_triggered if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"1970-01-01 00:00:00\")) * 1000 }}",
                                    "last_controller_event": "{{ (states(helper_last_controller_event) | from_json).trigger_action if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"\" }}"
                                }
                            },
                            {
                                "service": "input_text.set_value",
                                "data": {
                                    "entity_id": "input_text.zz_playroom_lights_controller_last_event",
                                    "value": "{{ {\"trigger_action\":trigger_action,\"last_triggered\":now()|string} | to_json }}"
                                }
                            },
                            {
                                "choose": [
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_playroom_lights_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_up_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_up_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "choose": [
                                                                                            {
                                                                                                "conditions": [
                                                                                                    {
                                                                                                        "condition": "time",
                                                                                                        "before": "input_datetime.lights_auto_control_end",
                                                                                                        "after": "input_datetime.wind_down"
                                                                                                    }
                                                                                                ],
                                                                                                "sequence": [
                                                                                                    {
                                                                                                        "service": "light.turn_on",
                                                                                                        "target": {
                                                                                                            "entity_id": "light.playroom_lights"
                                                                                                        },
                                                                                                        "data": {
                                                                                                            "brightness_pct": 5
                                                                                                        }
                                                                                                    }
                                                                                                ]
                                                                                            }
                                                                                        ],
                                                                                        "default": [
                                                                                            {
                                                                                                "service": "light.turn_on",
                                                                                                "target": {
                                                                                                    "entity_id": "light.playroom_lights"
                                                                                                },
                                                                                                "data": {
                                                                                                    "brightness_pct": 100
                                                                                                }
                                                                                            }
                                                                                        ]
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_up_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [
                                                                                    {
                                                                                        "condition": "time",
                                                                                        "before": "input_datetime.lights_auto_control_end",
                                                                                        "after": "input_datetime.wind_down"
                                                                                    }
                                                                                ],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "light.turn_on",
                                                                                        "target": {
                                                                                            "entity_id": "light.playroom_lights"
                                                                                        },
                                                                                        "data": {
                                                                                            "brightness_pct": 5
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ],
                                                                        "default": [
                                                                            {
                                                                                "service": "light.turn_on",
                                                                                "target": {
                                                                                    "entity_id": "light.playroom_lights"
                                                                                },
                                                                                "data": {
                                                                                    "brightness_pct": 100
                                                                                }
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_up_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "light.turn_on",
                                                                            "target": {
                                                                                "entity_id": "light.playroom_lights"
                                                                            },
                                                                            "data": {
                                                                                "brightness_step_pct": 10
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.playroom_lights"
                                                        },
                                                        "data": {
                                                            "brightness_step_pct": 10
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_up_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_up_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_playroom_lights_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_down_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_down_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "light.turn_off",
                                                                                        "target": {
                                                                                            "entity_id": "light.playroom_lights"
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_down_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "light.turn_off",
                                                                        "target": {
                                                                            "entity_id": "light.playroom_lights"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_down_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "light.turn_on",
                                                                            "target": {
                                                                                "entity_id": "light.playroom_lights"
                                                                            },
                                                                            "data": {
                                                                                "brightness_step_pct": -11
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.playroom_lights"
                                                        },
                                                        "data": {
                                                            "brightness_step_pct": -11
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_down_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_down_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            }
                        ],
                        "id": "1643641631013",
                        "alias": "Playroom Lights Controller",
                        "description": "Control the Playroom Lights"
                    },
                    "blueprint_inputs": {
                        "id": "1643641631013",
                        "alias": "Playroom Lights Controller",
                        "description": "Control the Playroom Lights",
                        "use_blueprint": {
                            "path": "EPMatt/ikea_e1743.yaml",
                            "input": {
                                "integration": "ZHA",
                                "controller_device": "867b78e6f7808ffcceb260be52b0c174",
                                "helper_last_controller_event": "input_text.zz_playroom_lights_controller_last_event",
                                "action_button_up_short": [
                                    {
                                        "choose": [
                                            {
                                                "conditions": [
                                                    {
                                                        "condition": "time",
                                                        "before": "input_datetime.lights_auto_control_end",
                                                        "after": "input_datetime.wind_down"
                                                    }
                                                ],
                                                "sequence": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.playroom_lights"
                                                        },
                                                        "data": {
                                                            "brightness_pct": 5
                                                        }
                                                    }
                                                ]
                                            }
                                        ],
                                        "default": [
                                            {
                                                "service": "light.turn_on",
                                                "target": {
                                                    "entity_id": "light.playroom_lights"
                                                },
                                                "data": {
                                                    "brightness_pct": 100
                                                }
                                            }
                                        ]
                                    }
                                ],
                                "action_button_up_long": [
                                    {
                                        "service": "light.turn_on",
                                        "target": {
                                            "entity_id": "light.playroom_lights"
                                        },
                                        "data": {
                                            "brightness_step_pct": 10
                                        }
                                    }
                                ],
                                "action_button_down_short": [
                                    {
                                        "service": "light.turn_off",
                                        "target": {
                                            "entity_id": "light.playroom_lights"
                                        }
                                    }
                                ],
                                "action_button_down_long": [
                                    {
                                        "service": "light.turn_on",
                                        "target": {
                                            "entity_id": "light.playroom_lights"
                                        },
                                        "data": {
                                            "brightness_step_pct": -11
                                        }
                                    }
                                ],
                                "button_up_long_max_loop_repeats": 50,
                                "button_down_long_max_loop_repeats": 50,
                                "button_down_long_loop": true,
                                "button_up_long_loop": true
                            }
                        }
                    },
                    "context": {
                        "id": "9ee1fe750088a1a1406e47f15b5d6bf4",
                        "parent_id": "a759e2eebb95d4891151ce0053ba9e2f",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "18da303ce6d353c106df4f2002b58cc3",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T04:34:14.710227+00:00",
                        "finish": "2022-03-03T04:34:14.716382+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643641631013",
                    "trigger": "event 'zha_event'"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "ae2b3304a245365fbfc5aba683401502",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:30:56.317877+00:00",
                        "finish": "2022-03-03T05:30:56.326229+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643641631013",
                    "trigger": "event 'zha_event'",
                    "trace": {
                        "trigger/1": [
                            {
                                "path": "trigger/1",
                                "timestamp": "2022-03-03T05:30:56.318529+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.playroom_lights_controller",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T04:34:14.711294+00:00",
                                            "mode": "restart",
                                            "current": 0,
                                            "id": "1643641631013",
                                            "friendly_name": "Playroom Lights Controller"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.798184+00:00",
                                        "last_updated": "2022-03-03T04:34:14.716057+00:00",
                                        "context": {
                                            "id": "9ee1fe750088a1a1406e47f15b5d6bf4",
                                            "parent_id": "a759e2eebb95d4891151ce0053ba9e2f",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "1",
                                        "idx": "1",
                                        "platform": "event",
                                        "event": {
                                            "event_type": "zha_event",
                                            "data": {
                                                "device_ieee": "84:fd:27:ff:fe:9c:0f:fc",
                                                "unique_id": "84:fd:27:ff:fe:9c:0f:fc:1:0x0020",
                                                "device_id": "867b78e6f7808ffcceb260be52b0c174",
                                                "endpoint_id": 1,
                                                "cluster_id": 32,
                                                "command": "checkin",
                                                "args": []
                                            },
                                            "origin": "LOCAL",
                                            "time_fired": "2022-03-03T05:30:56.316994+00:00",
                                            "context": {
                                                "id": "0b696c3510d2aad0a5296545500591ba",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "description": "event 'zha_event'"
                                    },
                                    "integration": "ZHA",
                                    "button_up_long_loop": true,
                                    "button_up_long_max_loop_repeats": 50,
                                    "button_up_double_press": false,
                                    "button_down_long_loop": true,
                                    "button_down_long_max_loop_repeats": 50,
                                    "button_down_double_press": false,
                                    "helper_last_controller_event": "input_text.zz_playroom_lights_controller_last_event",
                                    "helper_double_press_delay": 500,
                                    "helper_debounce_delay": 0,
                                    "integration_id": "zha",
                                    "adjusted_double_press_delay": 500,
                                    "actions_mapping": {
                                        "deconz": {
                                            "button_up_short": [
                                                "1002"
                                            ],
                                            "button_up_long": [
                                                "1001"
                                            ],
                                            "button_up_release": [
                                                "1003"
                                            ],
                                            "button_down_short": [
                                                "2002"
                                            ],
                                            "button_down_long": [
                                                "2001"
                                            ],
                                            "button_down_release": [
                                                "2003"
                                            ]
                                        },
                                        "zha": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "move_with_on_off_0_83"
                                            ],
                                            "button_up_release": [
                                                "stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "move_1_83"
                                            ],
                                            "button_down_release": [
                                                "stop"
                                            ]
                                        },
                                        "zigbee2mqtt": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "brightness_move_up"
                                            ],
                                            "button_up_release": [
                                                "brightness_stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "brightness_move_down"
                                            ],
                                            "button_down_release": [
                                                "brightness_stop"
                                            ]
                                        }
                                    },
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ],
                                    "integrations_with_prev_event_storage": [
                                        "zha",
                                        "zigbee2mqtt"
                                    ],
                                    "controller_entity": "",
                                    "controller_device": "867b78e6f7808ffcceb260be52b0c174",
                                    "controller_id": "867b78e6f7808ffcceb260be52b0c174"
                                }
                            }
                        ],
                        "condition/0": [
                            {
                                "path": "condition/0",
                                "timestamp": "2022-03-03T05:30:56.318558+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "condition/0/conditions/0": [
                            {
                                "path": "condition/0/conditions/0",
                                "timestamp": "2022-03-03T05:30:56.318576+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "condition/0/conditions/1": [
                            {
                                "path": "condition/0/conditions/1",
                                "timestamp": "2022-03-03T05:30:56.318738+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T05:30:56.319649+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "6577acebbb68f927be291e2eacbc22cd",
                                        "parent_id": "0b696c3510d2aad0a5296545500591ba",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "delay": 0.0,
                                    "done": true
                                }
                            }
                        ],
                        "action/1": [
                            {
                                "path": "action/1",
                                "timestamp": "2022-03-03T05:30:56.320983+00:00"
                            }
                        ],
                        "action/2": [
                            {
                                "path": "action/2",
                                "timestamp": "2022-03-03T05:30:56.321622+00:00",
                                "changed_variables": {
                                    "trigger_action": "checkin",
                                    "trigger_delta": 3401607.318878174,
                                    "last_controller_event": "checkin"
                                },
                                "result": {
                                    "params": {
                                        "domain": "input_text",
                                        "service": "set_value",
                                        "service_data": {
                                            "entity_id": "input_text.zz_playroom_lights_controller_last_event",
                                            "value": {
                                                "trigger_action": "checkin",
                                                "last_triggered": "2022-03-03 13:30:56.321771+08:00"
                                            }
                                        },
                                        "target": {}
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "action/3": [
                            {
                                "path": "action/3",
                                "timestamp": "2022-03-03T05:30:56.324468+00:00"
                            }
                        ],
                        "action/3/choose/0": [
                            {
                                "path": "action/3/choose/0",
                                "timestamp": "2022-03-03T05:30:56.324526+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/0/conditions/0": [
                            {
                                "path": "action/3/choose/0/conditions/0",
                                "timestamp": "2022-03-03T05:30:56.324548+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/1": [
                            {
                                "path": "action/3/choose/1",
                                "timestamp": "2022-03-03T05:30:56.324662+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/1/conditions/0": [
                            {
                                "path": "action/3/choose/1/conditions/0",
                                "timestamp": "2022-03-03T05:30:56.324682+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/2": [
                            {
                                "path": "action/3/choose/2",
                                "timestamp": "2022-03-03T05:30:56.324797+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/2/conditions/0": [
                            {
                                "path": "action/3/choose/2/conditions/0",
                                "timestamp": "2022-03-03T05:30:56.324817+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/3": [
                            {
                                "path": "action/3/choose/3",
                                "timestamp": "2022-03-03T05:30:56.324889+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/3/conditions/0": [
                            {
                                "path": "action/3/choose/3/conditions/0",
                                "timestamp": "2022-03-03T05:30:56.324907+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/4": [
                            {
                                "path": "action/3/choose/4",
                                "timestamp": "2022-03-03T05:30:56.325010+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/4/conditions/0": [
                            {
                                "path": "action/3/choose/4/conditions/0",
                                "timestamp": "2022-03-03T05:30:56.325029+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/5": [
                            {
                                "path": "action/3/choose/5",
                                "timestamp": "2022-03-03T05:30:56.325096+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/5/conditions/0": [
                            {
                                "path": "action/3/choose/5/conditions/0",
                                "timestamp": "2022-03-03T05:30:56.325114+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ]
                    },
                    "config": {
                        "variables": {
                            "integration": "ZHA",
                            "button_up_long_loop": true,
                            "button_up_long_max_loop_repeats": 50,
                            "button_up_double_press": false,
                            "button_down_long_loop": true,
                            "button_down_long_max_loop_repeats": 50,
                            "button_down_double_press": false,
                            "helper_last_controller_event": "input_text.zz_playroom_lights_controller_last_event",
                            "helper_double_press_delay": 500,
                            "helper_debounce_delay": 0,
                            "integration_id": "{{ integration | lower }}",
                            "adjusted_double_press_delay": "{{ [helper_double_press_delay - helper_debounce_delay, 100] | max }}",
                            "actions_mapping": {
                                "deconz": {
                                    "button_up_short": [
                                        "1002"
                                    ],
                                    "button_up_long": [
                                        "1001"
                                    ],
                                    "button_up_release": [
                                        "1003"
                                    ],
                                    "button_down_short": [
                                        "2002"
                                    ],
                                    "button_down_long": [
                                        "2001"
                                    ],
                                    "button_down_release": [
                                        "2003"
                                    ]
                                },
                                "zha": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ]
                                },
                                "zigbee2mqtt": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "brightness_move_up"
                                    ],
                                    "button_up_release": [
                                        "brightness_stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "brightness_move_down"
                                    ],
                                    "button_down_release": [
                                        "brightness_stop"
                                    ]
                                }
                            },
                            "button_up_short": "{{ actions_mapping[integration_id][\"button_up_short\"] }}",
                            "button_up_long": "{{ actions_mapping[integration_id][\"button_up_long\"] }}",
                            "button_up_release": "{{ actions_mapping[integration_id][\"button_up_release\"] }}",
                            "button_down_short": "{{ actions_mapping[integration_id][\"button_down_short\"] }}",
                            "button_down_long": "{{ actions_mapping[integration_id][\"button_down_long\"] }}",
                            "button_down_release": "{{ actions_mapping[integration_id][\"button_down_release\"] }}",
                            "integrations_with_prev_event_storage": [
                                "zha",
                                "zigbee2mqtt"
                            ],
                            "controller_entity": "",
                            "controller_device": "867b78e6f7808ffcceb260be52b0c174",
                            "controller_id": "{% if integration_id==\"zigbee2mqtt\" %}{{controller_entity}}{% else %}{{controller_device}}{% endif %}"
                        },
                        "mode": "restart",
                        "max_exceeded": "silent",
                        "trigger": [
                            {
                                "platform": "event",
                                "event_type": "state_changed",
                                "event_data": {
                                    "entity_id": ""
                                }
                            },
                            {
                                "platform": "event",
                                "event_type": [
                                    "deconz_event",
                                    "zha_event"
                                ],
                                "event_data": {
                                    "device_id": "867b78e6f7808ffcceb260be52b0c174"
                                }
                            }
                        ],
                        "condition": [
                            {
                                "condition": "and",
                                "conditions": [
                                    "{%- set trigger_action -%} {%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%} {%- endset -%} {{ trigger_action not in [\"\",\"None\"] }}",
                                    "{{ integration_id != \"zigbee2mqtt\" or trigger.event.data.new_state.state != trigger.event.data.old_state.state }}"
                                ]
                            }
                        ],
                        "action": [
                            {
                                "delay": {
                                    "milliseconds": 0
                                }
                            },
                            {
                                "variables": {
                                    "trigger_action": "{%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%}",
                                    "trigger_delta": "{{ (as_timestamp(now()) - as_timestamp((states(helper_last_controller_event) | from_json).last_triggered if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"1970-01-01 00:00:00\")) * 1000 }}",
                                    "last_controller_event": "{{ (states(helper_last_controller_event) | from_json).trigger_action if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"\" }}"
                                }
                            },
                            {
                                "service": "input_text.set_value",
                                "data": {
                                    "entity_id": "input_text.zz_playroom_lights_controller_last_event",
                                    "value": "{{ {\"trigger_action\":trigger_action,\"last_triggered\":now()|string} | to_json }}"
                                }
                            },
                            {
                                "choose": [
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_playroom_lights_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_up_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_up_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "choose": [
                                                                                            {
                                                                                                "conditions": [
                                                                                                    {
                                                                                                        "condition": "time",
                                                                                                        "before": "input_datetime.lights_auto_control_end",
                                                                                                        "after": "input_datetime.wind_down"
                                                                                                    }
                                                                                                ],
                                                                                                "sequence": [
                                                                                                    {
                                                                                                        "service": "light.turn_on",
                                                                                                        "target": {
                                                                                                            "entity_id": "light.playroom_lights"
                                                                                                        },
                                                                                                        "data": {
                                                                                                            "brightness_pct": 5
                                                                                                        }
                                                                                                    }
                                                                                                ]
                                                                                            }
                                                                                        ],
                                                                                        "default": [
                                                                                            {
                                                                                                "service": "light.turn_on",
                                                                                                "target": {
                                                                                                    "entity_id": "light.playroom_lights"
                                                                                                },
                                                                                                "data": {
                                                                                                    "brightness_pct": 100
                                                                                                }
                                                                                            }
                                                                                        ]
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_up_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [
                                                                                    {
                                                                                        "condition": "time",
                                                                                        "before": "input_datetime.lights_auto_control_end",
                                                                                        "after": "input_datetime.wind_down"
                                                                                    }
                                                                                ],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "light.turn_on",
                                                                                        "target": {
                                                                                            "entity_id": "light.playroom_lights"
                                                                                        },
                                                                                        "data": {
                                                                                            "brightness_pct": 5
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ],
                                                                        "default": [
                                                                            {
                                                                                "service": "light.turn_on",
                                                                                "target": {
                                                                                    "entity_id": "light.playroom_lights"
                                                                                },
                                                                                "data": {
                                                                                    "brightness_pct": 100
                                                                                }
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_up_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "light.turn_on",
                                                                            "target": {
                                                                                "entity_id": "light.playroom_lights"
                                                                            },
                                                                            "data": {
                                                                                "brightness_step_pct": 10
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.playroom_lights"
                                                        },
                                                        "data": {
                                                            "brightness_step_pct": 10
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_up_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_up_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_playroom_lights_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_down_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_down_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "light.turn_off",
                                                                                        "target": {
                                                                                            "entity_id": "light.playroom_lights"
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_down_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "light.turn_off",
                                                                        "target": {
                                                                            "entity_id": "light.playroom_lights"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_down_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "light.turn_on",
                                                                            "target": {
                                                                                "entity_id": "light.playroom_lights"
                                                                            },
                                                                            "data": {
                                                                                "brightness_step_pct": -11
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.playroom_lights"
                                                        },
                                                        "data": {
                                                            "brightness_step_pct": -11
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_down_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_down_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            }
                        ],
                        "id": "1643641631013",
                        "alias": "Playroom Lights Controller",
                        "description": "Control the Playroom Lights"
                    },
                    "blueprint_inputs": {
                        "id": "1643641631013",
                        "alias": "Playroom Lights Controller",
                        "description": "Control the Playroom Lights",
                        "use_blueprint": {
                            "path": "EPMatt/ikea_e1743.yaml",
                            "input": {
                                "integration": "ZHA",
                                "controller_device": "867b78e6f7808ffcceb260be52b0c174",
                                "helper_last_controller_event": "input_text.zz_playroom_lights_controller_last_event",
                                "action_button_up_short": [
                                    {
                                        "choose": [
                                            {
                                                "conditions": [
                                                    {
                                                        "condition": "time",
                                                        "before": "input_datetime.lights_auto_control_end",
                                                        "after": "input_datetime.wind_down"
                                                    }
                                                ],
                                                "sequence": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.playroom_lights"
                                                        },
                                                        "data": {
                                                            "brightness_pct": 5
                                                        }
                                                    }
                                                ]
                                            }
                                        ],
                                        "default": [
                                            {
                                                "service": "light.turn_on",
                                                "target": {
                                                    "entity_id": "light.playroom_lights"
                                                },
                                                "data": {
                                                    "brightness_pct": 100
                                                }
                                            }
                                        ]
                                    }
                                ],
                                "action_button_up_long": [
                                    {
                                        "service": "light.turn_on",
                                        "target": {
                                            "entity_id": "light.playroom_lights"
                                        },
                                        "data": {
                                            "brightness_step_pct": 10
                                        }
                                    }
                                ],
                                "action_button_down_short": [
                                    {
                                        "service": "light.turn_off",
                                        "target": {
                                            "entity_id": "light.playroom_lights"
                                        }
                                    }
                                ],
                                "action_button_down_long": [
                                    {
                                        "service": "light.turn_on",
                                        "target": {
                                            "entity_id": "light.playroom_lights"
                                        },
                                        "data": {
                                            "brightness_step_pct": -11
                                        }
                                    }
                                ],
                                "button_up_long_max_loop_repeats": 50,
                                "button_down_long_max_loop_repeats": 50,
                                "button_down_long_loop": true,
                                "button_up_long_loop": true
                            }
                        }
                    },
                    "context": {
                        "id": "6577acebbb68f927be291e2eacbc22cd",
                        "parent_id": "0b696c3510d2aad0a5296545500591ba",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "ae2b3304a245365fbfc5aba683401502",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:30:56.317877+00:00",
                        "finish": "2022-03-03T05:30:56.326229+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643641631013",
                    "trigger": "event 'zha_event'"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "3e57fa406415054a5aea455907ba729b",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T06:27:37.938313+00:00",
                        "finish": "2022-03-03T06:27:37.946464+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643641631013",
                    "trigger": "event 'zha_event'",
                    "trace": {
                        "trigger/1": [
                            {
                                "path": "trigger/1",
                                "timestamp": "2022-03-03T06:27:37.939133+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.playroom_lights_controller",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T05:30:56.318941+00:00",
                                            "mode": "restart",
                                            "current": 0,
                                            "id": "1643641631013",
                                            "friendly_name": "Playroom Lights Controller"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.798184+00:00",
                                        "last_updated": "2022-03-03T05:30:56.325245+00:00",
                                        "context": {
                                            "id": "6577acebbb68f927be291e2eacbc22cd",
                                            "parent_id": "0b696c3510d2aad0a5296545500591ba",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "1",
                                        "idx": "1",
                                        "platform": "event",
                                        "event": {
                                            "event_type": "zha_event",
                                            "data": {
                                                "device_ieee": "84:fd:27:ff:fe:9c:0f:fc",
                                                "unique_id": "84:fd:27:ff:fe:9c:0f:fc:1:0x0020",
                                                "device_id": "867b78e6f7808ffcceb260be52b0c174",
                                                "endpoint_id": 1,
                                                "cluster_id": 32,
                                                "command": "checkin",
                                                "args": []
                                            },
                                            "origin": "LOCAL",
                                            "time_fired": "2022-03-03T06:27:37.937153+00:00",
                                            "context": {
                                                "id": "48227c58a861ba3f97150337d34ecd0f",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "description": "event 'zha_event'"
                                    },
                                    "integration": "ZHA",
                                    "button_up_long_loop": true,
                                    "button_up_long_max_loop_repeats": 50,
                                    "button_up_double_press": false,
                                    "button_down_long_loop": true,
                                    "button_down_long_max_loop_repeats": 50,
                                    "button_down_double_press": false,
                                    "helper_last_controller_event": "input_text.zz_playroom_lights_controller_last_event",
                                    "helper_double_press_delay": 500,
                                    "helper_debounce_delay": 0,
                                    "integration_id": "zha",
                                    "adjusted_double_press_delay": 500,
                                    "actions_mapping": {
                                        "deconz": {
                                            "button_up_short": [
                                                "1002"
                                            ],
                                            "button_up_long": [
                                                "1001"
                                            ],
                                            "button_up_release": [
                                                "1003"
                                            ],
                                            "button_down_short": [
                                                "2002"
                                            ],
                                            "button_down_long": [
                                                "2001"
                                            ],
                                            "button_down_release": [
                                                "2003"
                                            ]
                                        },
                                        "zha": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "move_with_on_off_0_83"
                                            ],
                                            "button_up_release": [
                                                "stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "move_1_83"
                                            ],
                                            "button_down_release": [
                                                "stop"
                                            ]
                                        },
                                        "zigbee2mqtt": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "brightness_move_up"
                                            ],
                                            "button_up_release": [
                                                "brightness_stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "brightness_move_down"
                                            ],
                                            "button_down_release": [
                                                "brightness_stop"
                                            ]
                                        }
                                    },
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ],
                                    "integrations_with_prev_event_storage": [
                                        "zha",
                                        "zigbee2mqtt"
                                    ],
                                    "controller_entity": "",
                                    "controller_device": "867b78e6f7808ffcceb260be52b0c174",
                                    "controller_id": "867b78e6f7808ffcceb260be52b0c174"
                                }
                            }
                        ],
                        "condition/0": [
                            {
                                "path": "condition/0",
                                "timestamp": "2022-03-03T06:27:37.939171+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "condition/0/conditions/0": [
                            {
                                "path": "condition/0/conditions/0",
                                "timestamp": "2022-03-03T06:27:37.939190+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "condition/0/conditions/1": [
                            {
                                "path": "condition/0/conditions/1",
                                "timestamp": "2022-03-03T06:27:37.939343+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T06:27:37.941211+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "90786809a4cf4c51822e39181cdb9c47",
                                        "parent_id": "48227c58a861ba3f97150337d34ecd0f",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "delay": 0.0,
                                    "done": true
                                }
                            }
                        ],
                        "action/1": [
                            {
                                "path": "action/1",
                                "timestamp": "2022-03-03T06:27:37.942351+00:00"
                            }
                        ],
                        "action/2": [
                            {
                                "path": "action/2",
                                "timestamp": "2022-03-03T06:27:37.942990+00:00",
                                "changed_variables": {
                                    "trigger_action": "checkin",
                                    "trigger_delta": 3401620.831012726,
                                    "last_controller_event": "checkin"
                                },
                                "result": {
                                    "params": {
                                        "domain": "input_text",
                                        "service": "set_value",
                                        "service_data": {
                                            "entity_id": "input_text.zz_playroom_lights_controller_last_event",
                                            "value": {
                                                "trigger_action": "checkin",
                                                "last_triggered": "2022-03-03 14:27:37.943098+08:00"
                                            }
                                        },
                                        "target": {}
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "action/3": [
                            {
                                "path": "action/3",
                                "timestamp": "2022-03-03T06:27:37.944984+00:00"
                            }
                        ],
                        "action/3/choose/0": [
                            {
                                "path": "action/3/choose/0",
                                "timestamp": "2022-03-03T06:27:37.945040+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/0/conditions/0": [
                            {
                                "path": "action/3/choose/0/conditions/0",
                                "timestamp": "2022-03-03T06:27:37.945060+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/1": [
                            {
                                "path": "action/3/choose/1",
                                "timestamp": "2022-03-03T06:27:37.945169+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/1/conditions/0": [
                            {
                                "path": "action/3/choose/1/conditions/0",
                                "timestamp": "2022-03-03T06:27:37.945189+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/2": [
                            {
                                "path": "action/3/choose/2",
                                "timestamp": "2022-03-03T06:27:37.945268+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/2/conditions/0": [
                            {
                                "path": "action/3/choose/2/conditions/0",
                                "timestamp": "2022-03-03T06:27:37.945287+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/3": [
                            {
                                "path": "action/3/choose/3",
                                "timestamp": "2022-03-03T06:27:37.945361+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/3/conditions/0": [
                            {
                                "path": "action/3/choose/3/conditions/0",
                                "timestamp": "2022-03-03T06:27:37.945379+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/4": [
                            {
                                "path": "action/3/choose/4",
                                "timestamp": "2022-03-03T06:27:37.945480+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/4/conditions/0": [
                            {
                                "path": "action/3/choose/4/conditions/0",
                                "timestamp": "2022-03-03T06:27:37.945503+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/5": [
                            {
                                "path": "action/3/choose/5",
                                "timestamp": "2022-03-03T06:27:37.945573+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/5/conditions/0": [
                            {
                                "path": "action/3/choose/5/conditions/0",
                                "timestamp": "2022-03-03T06:27:37.945590+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ]
                    },
                    "config": {
                        "variables": {
                            "integration": "ZHA",
                            "button_up_long_loop": true,
                            "button_up_long_max_loop_repeats": 50,
                            "button_up_double_press": false,
                            "button_down_long_loop": true,
                            "button_down_long_max_loop_repeats": 50,
                            "button_down_double_press": false,
                            "helper_last_controller_event": "input_text.zz_playroom_lights_controller_last_event",
                            "helper_double_press_delay": 500,
                            "helper_debounce_delay": 0,
                            "integration_id": "{{ integration | lower }}",
                            "adjusted_double_press_delay": "{{ [helper_double_press_delay - helper_debounce_delay, 100] | max }}",
                            "actions_mapping": {
                                "deconz": {
                                    "button_up_short": [
                                        "1002"
                                    ],
                                    "button_up_long": [
                                        "1001"
                                    ],
                                    "button_up_release": [
                                        "1003"
                                    ],
                                    "button_down_short": [
                                        "2002"
                                    ],
                                    "button_down_long": [
                                        "2001"
                                    ],
                                    "button_down_release": [
                                        "2003"
                                    ]
                                },
                                "zha": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ]
                                },
                                "zigbee2mqtt": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "brightness_move_up"
                                    ],
                                    "button_up_release": [
                                        "brightness_stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "brightness_move_down"
                                    ],
                                    "button_down_release": [
                                        "brightness_stop"
                                    ]
                                }
                            },
                            "button_up_short": "{{ actions_mapping[integration_id][\"button_up_short\"] }}",
                            "button_up_long": "{{ actions_mapping[integration_id][\"button_up_long\"] }}",
                            "button_up_release": "{{ actions_mapping[integration_id][\"button_up_release\"] }}",
                            "button_down_short": "{{ actions_mapping[integration_id][\"button_down_short\"] }}",
                            "button_down_long": "{{ actions_mapping[integration_id][\"button_down_long\"] }}",
                            "button_down_release": "{{ actions_mapping[integration_id][\"button_down_release\"] }}",
                            "integrations_with_prev_event_storage": [
                                "zha",
                                "zigbee2mqtt"
                            ],
                            "controller_entity": "",
                            "controller_device": "867b78e6f7808ffcceb260be52b0c174",
                            "controller_id": "{% if integration_id==\"zigbee2mqtt\" %}{{controller_entity}}{% else %}{{controller_device}}{% endif %}"
                        },
                        "mode": "restart",
                        "max_exceeded": "silent",
                        "trigger": [
                            {
                                "platform": "event",
                                "event_type": "state_changed",
                                "event_data": {
                                    "entity_id": ""
                                }
                            },
                            {
                                "platform": "event",
                                "event_type": [
                                    "deconz_event",
                                    "zha_event"
                                ],
                                "event_data": {
                                    "device_id": "867b78e6f7808ffcceb260be52b0c174"
                                }
                            }
                        ],
                        "condition": [
                            {
                                "condition": "and",
                                "conditions": [
                                    "{%- set trigger_action -%} {%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%} {%- endset -%} {{ trigger_action not in [\"\",\"None\"] }}",
                                    "{{ integration_id != \"zigbee2mqtt\" or trigger.event.data.new_state.state != trigger.event.data.old_state.state }}"
                                ]
                            }
                        ],
                        "action": [
                            {
                                "delay": {
                                    "milliseconds": 0
                                }
                            },
                            {
                                "variables": {
                                    "trigger_action": "{%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%}",
                                    "trigger_delta": "{{ (as_timestamp(now()) - as_timestamp((states(helper_last_controller_event) | from_json).last_triggered if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"1970-01-01 00:00:00\")) * 1000 }}",
                                    "last_controller_event": "{{ (states(helper_last_controller_event) | from_json).trigger_action if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"\" }}"
                                }
                            },
                            {
                                "service": "input_text.set_value",
                                "data": {
                                    "entity_id": "input_text.zz_playroom_lights_controller_last_event",
                                    "value": "{{ {\"trigger_action\":trigger_action,\"last_triggered\":now()|string} | to_json }}"
                                }
                            },
                            {
                                "choose": [
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_playroom_lights_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_up_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_up_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "choose": [
                                                                                            {
                                                                                                "conditions": [
                                                                                                    {
                                                                                                        "condition": "time",
                                                                                                        "before": "input_datetime.lights_auto_control_end",
                                                                                                        "after": "input_datetime.wind_down"
                                                                                                    }
                                                                                                ],
                                                                                                "sequence": [
                                                                                                    {
                                                                                                        "service": "light.turn_on",
                                                                                                        "target": {
                                                                                                            "entity_id": "light.playroom_lights"
                                                                                                        },
                                                                                                        "data": {
                                                                                                            "brightness_pct": 5
                                                                                                        }
                                                                                                    }
                                                                                                ]
                                                                                            }
                                                                                        ],
                                                                                        "default": [
                                                                                            {
                                                                                                "service": "light.turn_on",
                                                                                                "target": {
                                                                                                    "entity_id": "light.playroom_lights"
                                                                                                },
                                                                                                "data": {
                                                                                                    "brightness_pct": 100
                                                                                                }
                                                                                            }
                                                                                        ]
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_up_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [
                                                                                    {
                                                                                        "condition": "time",
                                                                                        "before": "input_datetime.lights_auto_control_end",
                                                                                        "after": "input_datetime.wind_down"
                                                                                    }
                                                                                ],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "light.turn_on",
                                                                                        "target": {
                                                                                            "entity_id": "light.playroom_lights"
                                                                                        },
                                                                                        "data": {
                                                                                            "brightness_pct": 5
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ],
                                                                        "default": [
                                                                            {
                                                                                "service": "light.turn_on",
                                                                                "target": {
                                                                                    "entity_id": "light.playroom_lights"
                                                                                },
                                                                                "data": {
                                                                                    "brightness_pct": 100
                                                                                }
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_up_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "light.turn_on",
                                                                            "target": {
                                                                                "entity_id": "light.playroom_lights"
                                                                            },
                                                                            "data": {
                                                                                "brightness_step_pct": 10
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.playroom_lights"
                                                        },
                                                        "data": {
                                                            "brightness_step_pct": 10
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_up_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_up_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_playroom_lights_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_down_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_down_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "light.turn_off",
                                                                                        "target": {
                                                                                            "entity_id": "light.playroom_lights"
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_down_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "light.turn_off",
                                                                        "target": {
                                                                            "entity_id": "light.playroom_lights"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_down_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "light.turn_on",
                                                                            "target": {
                                                                                "entity_id": "light.playroom_lights"
                                                                            },
                                                                            "data": {
                                                                                "brightness_step_pct": -11
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.playroom_lights"
                                                        },
                                                        "data": {
                                                            "brightness_step_pct": -11
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_down_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_down_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            }
                        ],
                        "id": "1643641631013",
                        "alias": "Playroom Lights Controller",
                        "description": "Control the Playroom Lights"
                    },
                    "blueprint_inputs": {
                        "id": "1643641631013",
                        "alias": "Playroom Lights Controller",
                        "description": "Control the Playroom Lights",
                        "use_blueprint": {
                            "path": "EPMatt/ikea_e1743.yaml",
                            "input": {
                                "integration": "ZHA",
                                "controller_device": "867b78e6f7808ffcceb260be52b0c174",
                                "helper_last_controller_event": "input_text.zz_playroom_lights_controller_last_event",
                                "action_button_up_short": [
                                    {
                                        "choose": [
                                            {
                                                "conditions": [
                                                    {
                                                        "condition": "time",
                                                        "before": "input_datetime.lights_auto_control_end",
                                                        "after": "input_datetime.wind_down"
                                                    }
                                                ],
                                                "sequence": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.playroom_lights"
                                                        },
                                                        "data": {
                                                            "brightness_pct": 5
                                                        }
                                                    }
                                                ]
                                            }
                                        ],
                                        "default": [
                                            {
                                                "service": "light.turn_on",
                                                "target": {
                                                    "entity_id": "light.playroom_lights"
                                                },
                                                "data": {
                                                    "brightness_pct": 100
                                                }
                                            }
                                        ]
                                    }
                                ],
                                "action_button_up_long": [
                                    {
                                        "service": "light.turn_on",
                                        "target": {
                                            "entity_id": "light.playroom_lights"
                                        },
                                        "data": {
                                            "brightness_step_pct": 10
                                        }
                                    }
                                ],
                                "action_button_down_short": [
                                    {
                                        "service": "light.turn_off",
                                        "target": {
                                            "entity_id": "light.playroom_lights"
                                        }
                                    }
                                ],
                                "action_button_down_long": [
                                    {
                                        "service": "light.turn_on",
                                        "target": {
                                            "entity_id": "light.playroom_lights"
                                        },
                                        "data": {
                                            "brightness_step_pct": -11
                                        }
                                    }
                                ],
                                "button_up_long_max_loop_repeats": 50,
                                "button_down_long_max_loop_repeats": 50,
                                "button_down_long_loop": true,
                                "button_up_long_loop": true
                            }
                        }
                    },
                    "context": {
                        "id": "90786809a4cf4c51822e39181cdb9c47",
                        "parent_id": "48227c58a861ba3f97150337d34ecd0f",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "3e57fa406415054a5aea455907ba729b",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T06:27:37.938313+00:00",
                        "finish": "2022-03-03T06:27:37.946464+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643641631013",
                    "trigger": "event 'zha_event'"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "9c5d64807e90f3e09c92bfe73e97e597",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T07:24:19.526127+00:00",
                        "finish": "2022-03-03T07:24:19.532400+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643641631013",
                    "trigger": "event 'zha_event'",
                    "trace": {
                        "trigger/1": [
                            {
                                "path": "trigger/1",
                                "timestamp": "2022-03-03T07:24:19.526916+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.playroom_lights_controller",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T06:27:37.939531+00:00",
                                            "mode": "restart",
                                            "current": 0,
                                            "id": "1643641631013",
                                            "friendly_name": "Playroom Lights Controller"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.798184+00:00",
                                        "last_updated": "2022-03-03T06:27:37.945738+00:00",
                                        "context": {
                                            "id": "90786809a4cf4c51822e39181cdb9c47",
                                            "parent_id": "48227c58a861ba3f97150337d34ecd0f",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "1",
                                        "idx": "1",
                                        "platform": "event",
                                        "event": {
                                            "event_type": "zha_event",
                                            "data": {
                                                "device_ieee": "84:fd:27:ff:fe:9c:0f:fc",
                                                "unique_id": "84:fd:27:ff:fe:9c:0f:fc:1:0x0020",
                                                "device_id": "867b78e6f7808ffcceb260be52b0c174",
                                                "endpoint_id": 1,
                                                "cluster_id": 32,
                                                "command": "checkin",
                                                "args": []
                                            },
                                            "origin": "LOCAL",
                                            "time_fired": "2022-03-03T07:24:19.525106+00:00",
                                            "context": {
                                                "id": "db559be5bb15c01a7261f6aa85b1b2d4",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "description": "event 'zha_event'"
                                    },
                                    "integration": "ZHA",
                                    "button_up_long_loop": true,
                                    "button_up_long_max_loop_repeats": 50,
                                    "button_up_double_press": false,
                                    "button_down_long_loop": true,
                                    "button_down_long_max_loop_repeats": 50,
                                    "button_down_double_press": false,
                                    "helper_last_controller_event": "input_text.zz_playroom_lights_controller_last_event",
                                    "helper_double_press_delay": 500,
                                    "helper_debounce_delay": 0,
                                    "integration_id": "zha",
                                    "adjusted_double_press_delay": 500,
                                    "actions_mapping": {
                                        "deconz": {
                                            "button_up_short": [
                                                "1002"
                                            ],
                                            "button_up_long": [
                                                "1001"
                                            ],
                                            "button_up_release": [
                                                "1003"
                                            ],
                                            "button_down_short": [
                                                "2002"
                                            ],
                                            "button_down_long": [
                                                "2001"
                                            ],
                                            "button_down_release": [
                                                "2003"
                                            ]
                                        },
                                        "zha": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "move_with_on_off_0_83"
                                            ],
                                            "button_up_release": [
                                                "stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "move_1_83"
                                            ],
                                            "button_down_release": [
                                                "stop"
                                            ]
                                        },
                                        "zigbee2mqtt": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "brightness_move_up"
                                            ],
                                            "button_up_release": [
                                                "brightness_stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "brightness_move_down"
                                            ],
                                            "button_down_release": [
                                                "brightness_stop"
                                            ]
                                        }
                                    },
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ],
                                    "integrations_with_prev_event_storage": [
                                        "zha",
                                        "zigbee2mqtt"
                                    ],
                                    "controller_entity": "",
                                    "controller_device": "867b78e6f7808ffcceb260be52b0c174",
                                    "controller_id": "867b78e6f7808ffcceb260be52b0c174"
                                }
                            }
                        ],
                        "condition/0": [
                            {
                                "path": "condition/0",
                                "timestamp": "2022-03-03T07:24:19.526945+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "condition/0/conditions/0": [
                            {
                                "path": "condition/0/conditions/0",
                                "timestamp": "2022-03-03T07:24:19.526969+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "condition/0/conditions/1": [
                            {
                                "path": "condition/0/conditions/1",
                                "timestamp": "2022-03-03T07:24:19.527124+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T07:24:19.527819+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "8d72a919a9d956cf33bf9e4fa49a10e1",
                                        "parent_id": "db559be5bb15c01a7261f6aa85b1b2d4",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "delay": 0.0,
                                    "done": true
                                }
                            }
                        ],
                        "action/1": [
                            {
                                "path": "action/1",
                                "timestamp": "2022-03-03T07:24:19.528604+00:00"
                            }
                        ],
                        "action/2": [
                            {
                                "path": "action/2",
                                "timestamp": "2022-03-03T07:24:19.529146+00:00",
                                "changed_variables": {
                                    "trigger_action": "checkin",
                                    "trigger_delta": 3401585.7388973236,
                                    "last_controller_event": "checkin"
                                },
                                "result": {
                                    "params": {
                                        "domain": "input_text",
                                        "service": "set_value",
                                        "service_data": {
                                            "entity_id": "input_text.zz_playroom_lights_controller_last_event",
                                            "value": {
                                                "trigger_action": "checkin",
                                                "last_triggered": "2022-03-03 15:24:19.529235+08:00"
                                            }
                                        },
                                        "target": {}
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "action/3": [
                            {
                                "path": "action/3",
                                "timestamp": "2022-03-03T07:24:19.531187+00:00"
                            }
                        ],
                        "action/3/choose/0": [
                            {
                                "path": "action/3/choose/0",
                                "timestamp": "2022-03-03T07:24:19.531237+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/0/conditions/0": [
                            {
                                "path": "action/3/choose/0/conditions/0",
                                "timestamp": "2022-03-03T07:24:19.531258+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/1": [
                            {
                                "path": "action/3/choose/1",
                                "timestamp": "2022-03-03T07:24:19.531368+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/1/conditions/0": [
                            {
                                "path": "action/3/choose/1/conditions/0",
                                "timestamp": "2022-03-03T07:24:19.531388+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/2": [
                            {
                                "path": "action/3/choose/2",
                                "timestamp": "2022-03-03T07:24:19.531500+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/2/conditions/0": [
                            {
                                "path": "action/3/choose/2/conditions/0",
                                "timestamp": "2022-03-03T07:24:19.531518+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/3": [
                            {
                                "path": "action/3/choose/3",
                                "timestamp": "2022-03-03T07:24:19.531588+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/3/conditions/0": [
                            {
                                "path": "action/3/choose/3/conditions/0",
                                "timestamp": "2022-03-03T07:24:19.531605+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/4": [
                            {
                                "path": "action/3/choose/4",
                                "timestamp": "2022-03-03T07:24:19.531669+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/4/conditions/0": [
                            {
                                "path": "action/3/choose/4/conditions/0",
                                "timestamp": "2022-03-03T07:24:19.531686+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/5": [
                            {
                                "path": "action/3/choose/5",
                                "timestamp": "2022-03-03T07:24:19.531785+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/5/conditions/0": [
                            {
                                "path": "action/3/choose/5/conditions/0",
                                "timestamp": "2022-03-03T07:24:19.531805+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ]
                    },
                    "config": {
                        "variables": {
                            "integration": "ZHA",
                            "button_up_long_loop": true,
                            "button_up_long_max_loop_repeats": 50,
                            "button_up_double_press": false,
                            "button_down_long_loop": true,
                            "button_down_long_max_loop_repeats": 50,
                            "button_down_double_press": false,
                            "helper_last_controller_event": "input_text.zz_playroom_lights_controller_last_event",
                            "helper_double_press_delay": 500,
                            "helper_debounce_delay": 0,
                            "integration_id": "{{ integration | lower }}",
                            "adjusted_double_press_delay": "{{ [helper_double_press_delay - helper_debounce_delay, 100] | max }}",
                            "actions_mapping": {
                                "deconz": {
                                    "button_up_short": [
                                        "1002"
                                    ],
                                    "button_up_long": [
                                        "1001"
                                    ],
                                    "button_up_release": [
                                        "1003"
                                    ],
                                    "button_down_short": [
                                        "2002"
                                    ],
                                    "button_down_long": [
                                        "2001"
                                    ],
                                    "button_down_release": [
                                        "2003"
                                    ]
                                },
                                "zha": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ]
                                },
                                "zigbee2mqtt": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "brightness_move_up"
                                    ],
                                    "button_up_release": [
                                        "brightness_stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "brightness_move_down"
                                    ],
                                    "button_down_release": [
                                        "brightness_stop"
                                    ]
                                }
                            },
                            "button_up_short": "{{ actions_mapping[integration_id][\"button_up_short\"] }}",
                            "button_up_long": "{{ actions_mapping[integration_id][\"button_up_long\"] }}",
                            "button_up_release": "{{ actions_mapping[integration_id][\"button_up_release\"] }}",
                            "button_down_short": "{{ actions_mapping[integration_id][\"button_down_short\"] }}",
                            "button_down_long": "{{ actions_mapping[integration_id][\"button_down_long\"] }}",
                            "button_down_release": "{{ actions_mapping[integration_id][\"button_down_release\"] }}",
                            "integrations_with_prev_event_storage": [
                                "zha",
                                "zigbee2mqtt"
                            ],
                            "controller_entity": "",
                            "controller_device": "867b78e6f7808ffcceb260be52b0c174",
                            "controller_id": "{% if integration_id==\"zigbee2mqtt\" %}{{controller_entity}}{% else %}{{controller_device}}{% endif %}"
                        },
                        "mode": "restart",
                        "max_exceeded": "silent",
                        "trigger": [
                            {
                                "platform": "event",
                                "event_type": "state_changed",
                                "event_data": {
                                    "entity_id": ""
                                }
                            },
                            {
                                "platform": "event",
                                "event_type": [
                                    "deconz_event",
                                    "zha_event"
                                ],
                                "event_data": {
                                    "device_id": "867b78e6f7808ffcceb260be52b0c174"
                                }
                            }
                        ],
                        "condition": [
                            {
                                "condition": "and",
                                "conditions": [
                                    "{%- set trigger_action -%} {%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%} {%- endset -%} {{ trigger_action not in [\"\",\"None\"] }}",
                                    "{{ integration_id != \"zigbee2mqtt\" or trigger.event.data.new_state.state != trigger.event.data.old_state.state }}"
                                ]
                            }
                        ],
                        "action": [
                            {
                                "delay": {
                                    "milliseconds": 0
                                }
                            },
                            {
                                "variables": {
                                    "trigger_action": "{%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%}",
                                    "trigger_delta": "{{ (as_timestamp(now()) - as_timestamp((states(helper_last_controller_event) | from_json).last_triggered if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"1970-01-01 00:00:00\")) * 1000 }}",
                                    "last_controller_event": "{{ (states(helper_last_controller_event) | from_json).trigger_action if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"\" }}"
                                }
                            },
                            {
                                "service": "input_text.set_value",
                                "data": {
                                    "entity_id": "input_text.zz_playroom_lights_controller_last_event",
                                    "value": "{{ {\"trigger_action\":trigger_action,\"last_triggered\":now()|string} | to_json }}"
                                }
                            },
                            {
                                "choose": [
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_playroom_lights_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_up_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_up_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "choose": [
                                                                                            {
                                                                                                "conditions": [
                                                                                                    {
                                                                                                        "condition": "time",
                                                                                                        "before": "input_datetime.lights_auto_control_end",
                                                                                                        "after": "input_datetime.wind_down"
                                                                                                    }
                                                                                                ],
                                                                                                "sequence": [
                                                                                                    {
                                                                                                        "service": "light.turn_on",
                                                                                                        "target": {
                                                                                                            "entity_id": "light.playroom_lights"
                                                                                                        },
                                                                                                        "data": {
                                                                                                            "brightness_pct": 5
                                                                                                        }
                                                                                                    }
                                                                                                ]
                                                                                            }
                                                                                        ],
                                                                                        "default": [
                                                                                            {
                                                                                                "service": "light.turn_on",
                                                                                                "target": {
                                                                                                    "entity_id": "light.playroom_lights"
                                                                                                },
                                                                                                "data": {
                                                                                                    "brightness_pct": 100
                                                                                                }
                                                                                            }
                                                                                        ]
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_up_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [
                                                                                    {
                                                                                        "condition": "time",
                                                                                        "before": "input_datetime.lights_auto_control_end",
                                                                                        "after": "input_datetime.wind_down"
                                                                                    }
                                                                                ],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "light.turn_on",
                                                                                        "target": {
                                                                                            "entity_id": "light.playroom_lights"
                                                                                        },
                                                                                        "data": {
                                                                                            "brightness_pct": 5
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ],
                                                                        "default": [
                                                                            {
                                                                                "service": "light.turn_on",
                                                                                "target": {
                                                                                    "entity_id": "light.playroom_lights"
                                                                                },
                                                                                "data": {
                                                                                    "brightness_pct": 100
                                                                                }
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_up_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "light.turn_on",
                                                                            "target": {
                                                                                "entity_id": "light.playroom_lights"
                                                                            },
                                                                            "data": {
                                                                                "brightness_step_pct": 10
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.playroom_lights"
                                                        },
                                                        "data": {
                                                            "brightness_step_pct": 10
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_up_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_up_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_playroom_lights_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_down_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_down_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "light.turn_off",
                                                                                        "target": {
                                                                                            "entity_id": "light.playroom_lights"
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_down_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "light.turn_off",
                                                                        "target": {
                                                                            "entity_id": "light.playroom_lights"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_down_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "light.turn_on",
                                                                            "target": {
                                                                                "entity_id": "light.playroom_lights"
                                                                            },
                                                                            "data": {
                                                                                "brightness_step_pct": -11
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.playroom_lights"
                                                        },
                                                        "data": {
                                                            "brightness_step_pct": -11
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_down_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_down_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            }
                        ],
                        "id": "1643641631013",
                        "alias": "Playroom Lights Controller",
                        "description": "Control the Playroom Lights"
                    },
                    "blueprint_inputs": {
                        "id": "1643641631013",
                        "alias": "Playroom Lights Controller",
                        "description": "Control the Playroom Lights",
                        "use_blueprint": {
                            "path": "EPMatt/ikea_e1743.yaml",
                            "input": {
                                "integration": "ZHA",
                                "controller_device": "867b78e6f7808ffcceb260be52b0c174",
                                "helper_last_controller_event": "input_text.zz_playroom_lights_controller_last_event",
                                "action_button_up_short": [
                                    {
                                        "choose": [
                                            {
                                                "conditions": [
                                                    {
                                                        "condition": "time",
                                                        "before": "input_datetime.lights_auto_control_end",
                                                        "after": "input_datetime.wind_down"
                                                    }
                                                ],
                                                "sequence": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.playroom_lights"
                                                        },
                                                        "data": {
                                                            "brightness_pct": 5
                                                        }
                                                    }
                                                ]
                                            }
                                        ],
                                        "default": [
                                            {
                                                "service": "light.turn_on",
                                                "target": {
                                                    "entity_id": "light.playroom_lights"
                                                },
                                                "data": {
                                                    "brightness_pct": 100
                                                }
                                            }
                                        ]
                                    }
                                ],
                                "action_button_up_long": [
                                    {
                                        "service": "light.turn_on",
                                        "target": {
                                            "entity_id": "light.playroom_lights"
                                        },
                                        "data": {
                                            "brightness_step_pct": 10
                                        }
                                    }
                                ],
                                "action_button_down_short": [
                                    {
                                        "service": "light.turn_off",
                                        "target": {
                                            "entity_id": "light.playroom_lights"
                                        }
                                    }
                                ],
                                "action_button_down_long": [
                                    {
                                        "service": "light.turn_on",
                                        "target": {
                                            "entity_id": "light.playroom_lights"
                                        },
                                        "data": {
                                            "brightness_step_pct": -11
                                        }
                                    }
                                ],
                                "button_up_long_max_loop_repeats": 50,
                                "button_down_long_max_loop_repeats": 50,
                                "button_down_long_loop": true,
                                "button_up_long_loop": true
                            }
                        }
                    },
                    "context": {
                        "id": "8d72a919a9d956cf33bf9e4fa49a10e1",
                        "parent_id": "db559be5bb15c01a7261f6aa85b1b2d4",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "9c5d64807e90f3e09c92bfe73e97e597",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T07:24:19.526127+00:00",
                        "finish": "2022-03-03T07:24:19.532400+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643641631013",
                    "trigger": "event 'zha_event'"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/3/choose/0/sequence/0/default/1/choose/0/sequence/0/default/0",
                    "run_id": "c15a41cd141a5a13f2c1420e204dc948",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T07:52:39.217246+00:00",
                        "finish": "2022-03-03T07:52:39.369888+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643641631013",
                    "trigger": "event 'zha_event'",
                    "trace": {
                        "trigger/1": [
                            {
                                "path": "trigger/1",
                                "timestamp": "2022-03-03T07:52:39.218043+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.playroom_lights_controller",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T07:24:19.527286+00:00",
                                            "mode": "restart",
                                            "current": 0,
                                            "id": "1643641631013",
                                            "friendly_name": "Playroom Lights Controller"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.798184+00:00",
                                        "last_updated": "2022-03-03T07:24:19.531917+00:00",
                                        "context": {
                                            "id": "8d72a919a9d956cf33bf9e4fa49a10e1",
                                            "parent_id": "db559be5bb15c01a7261f6aa85b1b2d4",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "1",
                                        "idx": "1",
                                        "platform": "event",
                                        "event": {
                                            "event_type": "zha_event",
                                            "data": {
                                                "device_ieee": "84:fd:27:ff:fe:9c:0f:fc",
                                                "unique_id": "84:fd:27:ff:fe:9c:0f:fc:1:0x0006",
                                                "device_id": "867b78e6f7808ffcceb260be52b0c174",
                                                "endpoint_id": 1,
                                                "cluster_id": 6,
                                                "command": "on",
                                                "args": []
                                            },
                                            "origin": "LOCAL",
                                            "time_fired": "2022-03-03T07:52:39.216612+00:00",
                                            "context": {
                                                "id": "dbfb9081106818af9f37bee6a71028d2",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "description": "event 'zha_event'"
                                    },
                                    "integration": "ZHA",
                                    "button_up_long_loop": true,
                                    "button_up_long_max_loop_repeats": 50,
                                    "button_up_double_press": false,
                                    "button_down_long_loop": true,
                                    "button_down_long_max_loop_repeats": 50,
                                    "button_down_double_press": false,
                                    "helper_last_controller_event": "input_text.zz_playroom_lights_controller_last_event",
                                    "helper_double_press_delay": 500,
                                    "helper_debounce_delay": 0,
                                    "integration_id": "zha",
                                    "adjusted_double_press_delay": 500,
                                    "actions_mapping": {
                                        "deconz": {
                                            "button_up_short": [
                                                "1002"
                                            ],
                                            "button_up_long": [
                                                "1001"
                                            ],
                                            "button_up_release": [
                                                "1003"
                                            ],
                                            "button_down_short": [
                                                "2002"
                                            ],
                                            "button_down_long": [
                                                "2001"
                                            ],
                                            "button_down_release": [
                                                "2003"
                                            ]
                                        },
                                        "zha": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "move_with_on_off_0_83"
                                            ],
                                            "button_up_release": [
                                                "stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "move_1_83"
                                            ],
                                            "button_down_release": [
                                                "stop"
                                            ]
                                        },
                                        "zigbee2mqtt": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "brightness_move_up"
                                            ],
                                            "button_up_release": [
                                                "brightness_stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "brightness_move_down"
                                            ],
                                            "button_down_release": [
                                                "brightness_stop"
                                            ]
                                        }
                                    },
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ],
                                    "integrations_with_prev_event_storage": [
                                        "zha",
                                        "zigbee2mqtt"
                                    ],
                                    "controller_entity": "",
                                    "controller_device": "867b78e6f7808ffcceb260be52b0c174",
                                    "controller_id": "867b78e6f7808ffcceb260be52b0c174"
                                }
                            }
                        ],
                        "condition/0": [
                            {
                                "path": "condition/0",
                                "timestamp": "2022-03-03T07:52:39.218071+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "condition/0/conditions/0": [
                            {
                                "path": "condition/0/conditions/0",
                                "timestamp": "2022-03-03T07:52:39.218093+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "condition/0/conditions/1": [
                            {
                                "path": "condition/0/conditions/1",
                                "timestamp": "2022-03-03T07:52:39.218259+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T07:52:39.220089+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "4f2b609d6aa6e7673d1ee4a70c91ffd7",
                                        "parent_id": "dbfb9081106818af9f37bee6a71028d2",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "delay": 0.0,
                                    "done": true
                                }
                            }
                        ],
                        "action/1": [
                            {
                                "path": "action/1",
                                "timestamp": "2022-03-03T07:52:39.220442+00:00"
                            }
                        ],
                        "action/2": [
                            {
                                "path": "action/2",
                                "timestamp": "2022-03-03T07:52:39.221001+00:00",
                                "changed_variables": {
                                    "trigger_action": "on",
                                    "trigger_delta": 1699691.4172172546,
                                    "last_controller_event": "checkin"
                                },
                                "result": {
                                    "params": {
                                        "domain": "input_text",
                                        "service": "set_value",
                                        "service_data": {
                                            "entity_id": "input_text.zz_playroom_lights_controller_last_event",
                                            "value": {
                                                "trigger_action": "on",
                                                "last_triggered": "2022-03-03 15:52:39.221097+08:00"
                                            }
                                        },
                                        "target": {}
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "action/3": [
                            {
                                "path": "action/3",
                                "timestamp": "2022-03-03T07:52:39.222420+00:00",
                                "result": {
                                    "choice": 0
                                }
                            }
                        ],
                        "action/3/choose/0": [
                            {
                                "path": "action/3/choose/0",
                                "timestamp": "2022-03-03T07:52:39.222479+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/3/choose/0/conditions/0": [
                            {
                                "path": "action/3/choose/0/conditions/0",
                                "timestamp": "2022-03-03T07:52:39.222500+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/0/sequence/0": [
                            {
                                "path": "action/3/choose/0/sequence/0",
                                "timestamp": "2022-03-03T07:52:39.222882+00:00",
                                "result": {
                                    "choice": "default"
                                }
                            }
                        ],
                        "action/3/choose/0/sequence/0/choose/0": [
                            {
                                "path": "action/3/choose/0/sequence/0/choose/0",
                                "timestamp": "2022-03-03T07:52:39.223137+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/0/sequence/0/choose/0/conditions/0": [
                            {
                                "path": "action/3/choose/0/sequence/0/choose/0/conditions/0",
                                "timestamp": "2022-03-03T07:52:39.223161+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/0/sequence/0/default/0": [
                            {
                                "path": "action/3/choose/0/sequence/0/default/0",
                                "timestamp": "2022-03-03T07:52:39.223570+00:00",
                                "result": {
                                    "event": "ahb_controller_event",
                                    "event_data": {
                                        "controller": "867b78e6f7808ffcceb260be52b0c174",
                                        "action": "button_up_short"
                                    }
                                }
                            }
                        ],
                        "action/3/choose/0/sequence/0/default/1": [
                            {
                                "path": "action/3/choose/0/sequence/0/default/1",
                                "timestamp": "2022-03-03T07:52:39.223794+00:00",
                                "result": {
                                    "choice": 0
                                }
                            }
                        ],
                        "action/3/choose/0/sequence/0/default/1/choose/0": [
                            {
                                "path": "action/3/choose/0/sequence/0/default/1/choose/0",
                                "timestamp": "2022-03-03T07:52:39.223884+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/3/choose/0/sequence/0/default/1/choose/0/sequence/0": [
                            {
                                "path": "action/3/choose/0/sequence/0/default/1/choose/0/sequence/0",
                                "timestamp": "2022-03-03T07:52:39.224160+00:00",
                                "result": {
                                    "choice": "default"
                                }
                            }
                        ],
                        "action/3/choose/0/sequence/0/default/1/choose/0/sequence/0/choose/0": [
                            {
                                "path": "action/3/choose/0/sequence/0/default/1/choose/0/sequence/0/choose/0",
                                "timestamp": "2022-03-03T07:52:39.224293+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/0/sequence/0/default/1/choose/0/sequence/0/choose/0/conditions/0": [
                            {
                                "path": "action/3/choose/0/sequence/0/default/1/choose/0/sequence/0/choose/0/conditions/0",
                                "timestamp": "2022-03-03T07:52:39.224316+00:00",
                                "result": {
                                    "after": {
                                        "__type": "<class 'datetime.time'>",
                                        "isoformat": "21:30:00"
                                    },
                                    "now_time": {
                                        "__type": "<class 'datetime.time'>",
                                        "isoformat": "15:52:39.224332"
                                    },
                                    "before": {
                                        "__type": "<class 'datetime.time'>",
                                        "isoformat": "07:00:00"
                                    },
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/0/sequence/0/default/1/choose/0/sequence/0/default/0": [
                            {
                                "path": "action/3/choose/0/sequence/0/default/1/choose/0/sequence/0/default/0",
                                "timestamp": "2022-03-03T07:52:39.224626+00:00",
                                "result": {
                                    "params": {
                                        "domain": "light",
                                        "service": "turn_on",
                                        "service_data": {
                                            "brightness_pct": 100,
                                            "entity_id": [
                                                "light.playroom_lights"
                                            ]
                                        },
                                        "target": {
                                            "entity_id": [
                                                "light.playroom_lights"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ]
                    },
                    "config": {
                        "variables": {
                            "integration": "ZHA",
                            "button_up_long_loop": true,
                            "button_up_long_max_loop_repeats": 50,
                            "button_up_double_press": false,
                            "button_down_long_loop": true,
                            "button_down_long_max_loop_repeats": 50,
                            "button_down_double_press": false,
                            "helper_last_controller_event": "input_text.zz_playroom_lights_controller_last_event",
                            "helper_double_press_delay": 500,
                            "helper_debounce_delay": 0,
                            "integration_id": "{{ integration | lower }}",
                            "adjusted_double_press_delay": "{{ [helper_double_press_delay - helper_debounce_delay, 100] | max }}",
                            "actions_mapping": {
                                "deconz": {
                                    "button_up_short": [
                                        "1002"
                                    ],
                                    "button_up_long": [
                                        "1001"
                                    ],
                                    "button_up_release": [
                                        "1003"
                                    ],
                                    "button_down_short": [
                                        "2002"
                                    ],
                                    "button_down_long": [
                                        "2001"
                                    ],
                                    "button_down_release": [
                                        "2003"
                                    ]
                                },
                                "zha": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ]
                                },
                                "zigbee2mqtt": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "brightness_move_up"
                                    ],
                                    "button_up_release": [
                                        "brightness_stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "brightness_move_down"
                                    ],
                                    "button_down_release": [
                                        "brightness_stop"
                                    ]
                                }
                            },
                            "button_up_short": "{{ actions_mapping[integration_id][\"button_up_short\"] }}",
                            "button_up_long": "{{ actions_mapping[integration_id][\"button_up_long\"] }}",
                            "button_up_release": "{{ actions_mapping[integration_id][\"button_up_release\"] }}",
                            "button_down_short": "{{ actions_mapping[integration_id][\"button_down_short\"] }}",
                            "button_down_long": "{{ actions_mapping[integration_id][\"button_down_long\"] }}",
                            "button_down_release": "{{ actions_mapping[integration_id][\"button_down_release\"] }}",
                            "integrations_with_prev_event_storage": [
                                "zha",
                                "zigbee2mqtt"
                            ],
                            "controller_entity": "",
                            "controller_device": "867b78e6f7808ffcceb260be52b0c174",
                            "controller_id": "{% if integration_id==\"zigbee2mqtt\" %}{{controller_entity}}{% else %}{{controller_device}}{% endif %}"
                        },
                        "mode": "restart",
                        "max_exceeded": "silent",
                        "trigger": [
                            {
                                "platform": "event",
                                "event_type": "state_changed",
                                "event_data": {
                                    "entity_id": ""
                                }
                            },
                            {
                                "platform": "event",
                                "event_type": [
                                    "deconz_event",
                                    "zha_event"
                                ],
                                "event_data": {
                                    "device_id": "867b78e6f7808ffcceb260be52b0c174"
                                }
                            }
                        ],
                        "condition": [
                            {
                                "condition": "and",
                                "conditions": [
                                    "{%- set trigger_action -%} {%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%} {%- endset -%} {{ trigger_action not in [\"\",\"None\"] }}",
                                    "{{ integration_id != \"zigbee2mqtt\" or trigger.event.data.new_state.state != trigger.event.data.old_state.state }}"
                                ]
                            }
                        ],
                        "action": [
                            {
                                "delay": {
                                    "milliseconds": 0
                                }
                            },
                            {
                                "variables": {
                                    "trigger_action": "{%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%}",
                                    "trigger_delta": "{{ (as_timestamp(now()) - as_timestamp((states(helper_last_controller_event) | from_json).last_triggered if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"1970-01-01 00:00:00\")) * 1000 }}",
                                    "last_controller_event": "{{ (states(helper_last_controller_event) | from_json).trigger_action if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"\" }}"
                                }
                            },
                            {
                                "service": "input_text.set_value",
                                "data": {
                                    "entity_id": "input_text.zz_playroom_lights_controller_last_event",
                                    "value": "{{ {\"trigger_action\":trigger_action,\"last_triggered\":now()|string} | to_json }}"
                                }
                            },
                            {
                                "choose": [
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_playroom_lights_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_up_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_up_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "choose": [
                                                                                            {
                                                                                                "conditions": [
                                                                                                    {
                                                                                                        "condition": "time",
                                                                                                        "before": "input_datetime.lights_auto_control_end",
                                                                                                        "after": "input_datetime.wind_down"
                                                                                                    }
                                                                                                ],
                                                                                                "sequence": [
                                                                                                    {
                                                                                                        "service": "light.turn_on",
                                                                                                        "target": {
                                                                                                            "entity_id": "light.playroom_lights"
                                                                                                        },
                                                                                                        "data": {
                                                                                                            "brightness_pct": 5
                                                                                                        }
                                                                                                    }
                                                                                                ]
                                                                                            }
                                                                                        ],
                                                                                        "default": [
                                                                                            {
                                                                                                "service": "light.turn_on",
                                                                                                "target": {
                                                                                                    "entity_id": "light.playroom_lights"
                                                                                                },
                                                                                                "data": {
                                                                                                    "brightness_pct": 100
                                                                                                }
                                                                                            }
                                                                                        ]
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_up_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [
                                                                                    {
                                                                                        "condition": "time",
                                                                                        "before": "input_datetime.lights_auto_control_end",
                                                                                        "after": "input_datetime.wind_down"
                                                                                    }
                                                                                ],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "light.turn_on",
                                                                                        "target": {
                                                                                            "entity_id": "light.playroom_lights"
                                                                                        },
                                                                                        "data": {
                                                                                            "brightness_pct": 5
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ],
                                                                        "default": [
                                                                            {
                                                                                "service": "light.turn_on",
                                                                                "target": {
                                                                                    "entity_id": "light.playroom_lights"
                                                                                },
                                                                                "data": {
                                                                                    "brightness_pct": 100
                                                                                }
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_up_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "light.turn_on",
                                                                            "target": {
                                                                                "entity_id": "light.playroom_lights"
                                                                            },
                                                                            "data": {
                                                                                "brightness_step_pct": 10
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.playroom_lights"
                                                        },
                                                        "data": {
                                                            "brightness_step_pct": 10
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_up_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_up_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_playroom_lights_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_down_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_down_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "light.turn_off",
                                                                                        "target": {
                                                                                            "entity_id": "light.playroom_lights"
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_down_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "light.turn_off",
                                                                        "target": {
                                                                            "entity_id": "light.playroom_lights"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_down_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "light.turn_on",
                                                                            "target": {
                                                                                "entity_id": "light.playroom_lights"
                                                                            },
                                                                            "data": {
                                                                                "brightness_step_pct": -11
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.playroom_lights"
                                                        },
                                                        "data": {
                                                            "brightness_step_pct": -11
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_down_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_down_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            }
                        ],
                        "id": "1643641631013",
                        "alias": "Playroom Lights Controller",
                        "description": "Control the Playroom Lights"
                    },
                    "blueprint_inputs": {
                        "id": "1643641631013",
                        "alias": "Playroom Lights Controller",
                        "description": "Control the Playroom Lights",
                        "use_blueprint": {
                            "path": "EPMatt/ikea_e1743.yaml",
                            "input": {
                                "integration": "ZHA",
                                "controller_device": "867b78e6f7808ffcceb260be52b0c174",
                                "helper_last_controller_event": "input_text.zz_playroom_lights_controller_last_event",
                                "action_button_up_short": [
                                    {
                                        "choose": [
                                            {
                                                "conditions": [
                                                    {
                                                        "condition": "time",
                                                        "before": "input_datetime.lights_auto_control_end",
                                                        "after": "input_datetime.wind_down"
                                                    }
                                                ],
                                                "sequence": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.playroom_lights"
                                                        },
                                                        "data": {
                                                            "brightness_pct": 5
                                                        }
                                                    }
                                                ]
                                            }
                                        ],
                                        "default": [
                                            {
                                                "service": "light.turn_on",
                                                "target": {
                                                    "entity_id": "light.playroom_lights"
                                                },
                                                "data": {
                                                    "brightness_pct": 100
                                                }
                                            }
                                        ]
                                    }
                                ],
                                "action_button_up_long": [
                                    {
                                        "service": "light.turn_on",
                                        "target": {
                                            "entity_id": "light.playroom_lights"
                                        },
                                        "data": {
                                            "brightness_step_pct": 10
                                        }
                                    }
                                ],
                                "action_button_down_short": [
                                    {
                                        "service": "light.turn_off",
                                        "target": {
                                            "entity_id": "light.playroom_lights"
                                        }
                                    }
                                ],
                                "action_button_down_long": [
                                    {
                                        "service": "light.turn_on",
                                        "target": {
                                            "entity_id": "light.playroom_lights"
                                        },
                                        "data": {
                                            "brightness_step_pct": -11
                                        }
                                    }
                                ],
                                "button_up_long_max_loop_repeats": 50,
                                "button_down_long_max_loop_repeats": 50,
                                "button_down_long_loop": true,
                                "button_up_long_loop": true
                            }
                        }
                    },
                    "context": {
                        "id": "4f2b609d6aa6e7673d1ee4a70c91ffd7",
                        "parent_id": "dbfb9081106818af9f37bee6a71028d2",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/3/choose/0/sequence/0/default/1/choose/0/sequence/0/default/0",
                    "run_id": "c15a41cd141a5a13f2c1420e204dc948",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T07:52:39.217246+00:00",
                        "finish": "2022-03-03T07:52:39.369888+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643641631013",
                    "trigger": "event 'zha_event'"
                }
            }
        ],
        "automation.1642997460354": [
            {
                "extended_dict": {
                    "last_step": "action/0/choose/0/sequence/1",
                    "run_id": "cdea81fd689f5ff6d2dd6f765c1597cb",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:44:44.424040+00:00",
                        "finish": "2022-03-03T05:44:45.693932+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1642997460354",
                    "trigger": "state of fan.dining_room_fan",
                    "trace": {
                        "trigger/1": [
                            {
                                "path": "trigger/1",
                                "timestamp": "2022-03-03T05:44:44.424104+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.dining_room_fan_set_state",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T05:44:44.423881+00:00",
                                            "mode": "queued",
                                            "current": 1,
                                            "max": 10,
                                            "id": "1642997460354",
                                            "friendly_name": "Dining Room Fan Set State"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.797567+00:00",
                                        "last_updated": "2022-03-03T05:44:44.423950+00:00",
                                        "context": {
                                            "id": "9383225a2028ccf0a2bff6aee0e1a07d",
                                            "parent_id": "4de2f4d60fa5bfc044f0b7e479e169f0",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "speed",
                                        "idx": "1",
                                        "platform": "state",
                                        "entity_id": "fan.dining_room_fan",
                                        "from_state": {
                                            "entity_id": "fan.dining_room_fan",
                                            "state": "off",
                                            "attributes": {
                                                "speed_list": [
                                                    "off",
                                                    "low",
                                                    "medium",
                                                    "high"
                                                ],
                                                "preset_modes": null,
                                                "speed": "low",
                                                "percentage": 33,
                                                "percentage_step": 16.666666666666668,
                                                "preset_mode": null,
                                                "friendly_name": "Dining Room Fan",
                                                "supported_features": 1
                                            },
                                            "last_changed": "2022-03-03T05:10:14.383293+00:00",
                                            "last_updated": "2022-03-03T05:10:14.383293+00:00",
                                            "context": {
                                                "id": "d0d0684262400ebc2a65b25be2da899d",
                                                "parent_id": null,
                                                "user_id": "ad2bcce775894550affb6dfef93a2a36"
                                            }
                                        },
                                        "to_state": {
                                            "entity_id": "fan.dining_room_fan",
                                            "state": "on",
                                            "attributes": {
                                                "speed_list": [
                                                    "off",
                                                    "low",
                                                    "medium",
                                                    "high"
                                                ],
                                                "preset_modes": null,
                                                "speed": "off",
                                                "percentage": 0,
                                                "percentage_step": 16.666666666666668,
                                                "preset_mode": null,
                                                "friendly_name": "Dining Room Fan",
                                                "supported_features": 1
                                            },
                                            "last_changed": "2022-03-03T05:44:44.422190+00:00",
                                            "last_updated": "2022-03-03T05:44:44.422190+00:00",
                                            "context": {
                                                "id": "4de2f4d60fa5bfc044f0b7e479e169f0",
                                                "parent_id": "c53ff127fbb554733efe369026b7ab36",
                                                "user_id": null
                                            }
                                        },
                                        "for": null,
                                        "attribute": "percentage",
                                        "description": "state of fan.dining_room_fan"
                                    }
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T05:44:45.259491+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "89396d303c4b1290339e1442584efa7e",
                                        "parent_id": "4de2f4d60fa5bfc044f0b7e479e169f0",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "choice": 0
                                }
                            }
                        ],
                        "action/0/choose/0": [
                            {
                                "path": "action/0/choose/0",
                                "timestamp": "2022-03-03T05:44:45.259550+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/0/conditions/0",
                                "timestamp": "2022-03-03T05:44:45.259575+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/0": [
                            {
                                "path": "action/0/choose/0/sequence/0",
                                "timestamp": "2022-03-03T05:44:45.259917+00:00",
                                "result": {
                                    "params": {
                                        "domain": "fan",
                                        "service": "turn_on",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "fan.dining_room_fan"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/0/0": [
                            {
                                "path": "action/0/choose/0/sequence/0/0",
                                "timestamp": "2022-03-03T05:44:45.260684+00:00",
                                "changed_variables": {
                                    "speed": null,
                                    "percentage": null,
                                    "preset_mode": null
                                },
                                "result": {
                                    "params": {
                                        "domain": "input_boolean",
                                        "service": "turn_on",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "input_boolean.dining_room_fan_power"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/1": [
                            {
                                "path": "action/0/choose/0/sequence/1",
                                "timestamp": "2022-03-03T05:44:45.261783+00:00",
                                "child_id": {
                                    "domain": "script",
                                    "item_id": "1642846136869",
                                    "run_id": "a79ce77100a3e5c252cad6f96ccbc58d"
                                },
                                "result": {
                                    "params": {
                                        "domain": "script",
                                        "service": "1642846136869",
                                        "service_data": {
                                            "target_fan": "Dining Room Fan",
                                            "target_fan_power": true,
                                            "target_fan_speed": 0
                                        },
                                        "target": {}
                                    },
                                    "running_script": true,
                                    "limit": null
                                }
                            }
                        ]
                    },
                    "config": {
                        "id": "1642997460354",
                        "alias": "Dining Room Fan Set State",
                        "description": "Set Dining Room Fan power and speed",
                        "trigger": [
                            {
                                "platform": "state",
                                "entity_id": "fan.dining_room_fan",
                                "id": "power"
                            },
                            {
                                "platform": "state",
                                "entity_id": "fan.dining_room_fan",
                                "id": "speed",
                                "attribute": "percentage"
                            }
                        ],
                        "condition": [],
                        "action": [
                            {
                                "choose": [
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "speed"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "fan.turn_on",
                                                "target": {
                                                    "entity_id": "fan.dining_room_fan"
                                                }
                                            },
                                            {
                                                "service": "script.1642846136869",
                                                "data": {
                                                    "target_fan": "Dining Room Fan",
                                                    "target_fan_power": true,
                                                    "target_fan_speed": "{{ state_attr('fan.dining_room_fan', 'percentage') | int }}"
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "power"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [
                                                            {
                                                                "condition": "state",
                                                                "entity_id": "fan.dining_room_fan",
                                                                "state": "off"
                                                            }
                                                        ],
                                                        "sequence": [
                                                            {
                                                                "service": "script.1642846136869",
                                                                "data": {
                                                                    "target_fan": "Dining Room Fan",
                                                                    "target_fan_power": false,
                                                                    "target_fan_speed": "{{ state_attr('fan.dining_room_fan', 'percentage') | int }}"
                                                                }
                                                            }
                                                        ]
                                                    },
                                                    {
                                                        "conditions": [
                                                            {
                                                                "condition": "state",
                                                                "entity_id": "fan.dining_room_fan",
                                                                "state": "on"
                                                            }
                                                        ],
                                                        "sequence": [
                                                            {
                                                                "service": "script.1642846136869",
                                                                "data": {
                                                                    "target_fan": "Dining Room Fan",
                                                                    "target_fan_power": true,
                                                                    "target_fan_speed": "{{ state_attr('fan.dining_room_fan', 'percentage') | int }}"
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": []
                                            }
                                        ]
                                    }
                                ],
                                "default": []
                            }
                        ],
                        "mode": "queued",
                        "max": 10
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "89396d303c4b1290339e1442584efa7e",
                        "parent_id": "4de2f4d60fa5bfc044f0b7e479e169f0",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/0/choose/0/sequence/1",
                    "run_id": "cdea81fd689f5ff6d2dd6f765c1597cb",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:44:44.424040+00:00",
                        "finish": "2022-03-03T05:44:45.693932+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1642997460354",
                    "trigger": "state of fan.dining_room_fan"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/0/choose/1/sequence/0/choose/1/sequence/0",
                    "run_id": "d36aaffe96a9c25db02420cbb083fdea",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:45:26.454569+00:00",
                        "finish": "2022-03-03T05:45:27.219660+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1642997460354",
                    "trigger": "state of fan.dining_room_fan",
                    "trace": {
                        "trigger/0": [
                            {
                                "path": "trigger/0",
                                "timestamp": "2022-03-03T05:45:26.454671+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.dining_room_fan_set_state",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T05:44:44.424170+00:00",
                                            "mode": "queued",
                                            "current": 0,
                                            "max": 10,
                                            "id": "1642997460354",
                                            "friendly_name": "Dining Room Fan Set State"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.797567+00:00",
                                        "last_updated": "2022-03-03T05:44:45.693518+00:00",
                                        "context": {
                                            "id": "89396d303c4b1290339e1442584efa7e",
                                            "parent_id": "4de2f4d60fa5bfc044f0b7e479e169f0",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "power",
                                        "idx": "0",
                                        "platform": "state",
                                        "entity_id": "fan.dining_room_fan",
                                        "from_state": {
                                            "entity_id": "fan.dining_room_fan",
                                            "state": "on",
                                            "attributes": {
                                                "speed_list": [
                                                    "off",
                                                    "low",
                                                    "medium",
                                                    "high"
                                                ],
                                                "preset_modes": null,
                                                "speed": "off",
                                                "percentage": 0,
                                                "percentage_step": 16.666666666666668,
                                                "preset_mode": null,
                                                "friendly_name": "Dining Room Fan",
                                                "supported_features": 1
                                            },
                                            "last_changed": "2022-03-03T05:44:44.422190+00:00",
                                            "last_updated": "2022-03-03T05:44:44.422190+00:00",
                                            "context": {
                                                "id": "4de2f4d60fa5bfc044f0b7e479e169f0",
                                                "parent_id": "c53ff127fbb554733efe369026b7ab36",
                                                "user_id": null
                                            }
                                        },
                                        "to_state": {
                                            "entity_id": "fan.dining_room_fan",
                                            "state": "on",
                                            "attributes": {
                                                "speed_list": [
                                                    "off",
                                                    "low",
                                                    "medium",
                                                    "high"
                                                ],
                                                "preset_modes": null,
                                                "speed": "low",
                                                "percentage": 16,
                                                "percentage_step": 16.666666666666668,
                                                "preset_mode": null,
                                                "friendly_name": "Dining Room Fan",
                                                "supported_features": 1
                                            },
                                            "last_changed": "2022-03-03T05:44:44.422190+00:00",
                                            "last_updated": "2022-03-03T05:45:26.453779+00:00",
                                            "context": {
                                                "id": "a3d5692cc337adfaca64783a1281f5cb",
                                                "parent_id": "397e652bfc40637542b07fea65c6872a",
                                                "user_id": null
                                            }
                                        },
                                        "for": null,
                                        "attribute": null,
                                        "description": "state of fan.dining_room_fan"
                                    }
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T05:45:26.455820+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "12ab56b5f7ebc825e5044adfd45b484e",
                                        "parent_id": "a3d5692cc337adfaca64783a1281f5cb",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "choice": 1
                                }
                            }
                        ],
                        "action/0/choose/0": [
                            {
                                "path": "action/0/choose/0",
                                "timestamp": "2022-03-03T05:45:26.455886+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/0/conditions/0",
                                "timestamp": "2022-03-03T05:45:26.455904+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/1": [
                            {
                                "path": "action/0/choose/1",
                                "timestamp": "2022-03-03T05:45:26.455935+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/1/conditions/0": [
                            {
                                "path": "action/0/choose/1/conditions/0",
                                "timestamp": "2022-03-03T05:45:26.455949+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/1/sequence/0": [
                            {
                                "path": "action/0/choose/1/sequence/0",
                                "timestamp": "2022-03-03T05:45:26.456234+00:00",
                                "result": {
                                    "choice": 1
                                }
                            }
                        ],
                        "action/0/choose/1/sequence/0/choose/0": [
                            {
                                "path": "action/0/choose/1/sequence/0/choose/0",
                                "timestamp": "2022-03-03T05:45:26.456280+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/1/sequence/0/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/1/sequence/0/choose/0/conditions/0",
                                "timestamp": "2022-03-03T05:45:26.456296+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/1/sequence/0/choose/0/conditions/0/entity_id/0": [
                            {
                                "path": "action/0/choose/1/sequence/0/choose/0/conditions/0/entity_id/0",
                                "timestamp": "2022-03-03T05:45:26.456308+00:00",
                                "result": {
                                    "result": false,
                                    "state": "on",
                                    "wanted_state": "off"
                                }
                            }
                        ],
                        "action/0/choose/1/sequence/0/choose/1": [
                            {
                                "path": "action/0/choose/1/sequence/0/choose/1",
                                "timestamp": "2022-03-03T05:45:26.456347+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/1/sequence/0/choose/1/conditions/0": [
                            {
                                "path": "action/0/choose/1/sequence/0/choose/1/conditions/0",
                                "timestamp": "2022-03-03T05:45:26.456361+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/1/sequence/0/choose/1/conditions/0/entity_id/0": [
                            {
                                "path": "action/0/choose/1/sequence/0/choose/1/conditions/0/entity_id/0",
                                "timestamp": "2022-03-03T05:45:26.456372+00:00",
                                "result": {
                                    "result": true,
                                    "state": "on",
                                    "wanted_state": "on"
                                }
                            }
                        ],
                        "action/0/choose/1/sequence/0/choose/1/sequence/0": [
                            {
                                "path": "action/0/choose/1/sequence/0/choose/1/sequence/0",
                                "timestamp": "2022-03-03T05:45:26.456648+00:00",
                                "child_id": {
                                    "domain": "script",
                                    "item_id": "1642846136869",
                                    "run_id": "31973ff7ef9e089af806214ca43d2eef"
                                },
                                "result": {
                                    "params": {
                                        "domain": "script",
                                        "service": "1642846136869",
                                        "service_data": {
                                            "target_fan": "Dining Room Fan",
                                            "target_fan_power": true,
                                            "target_fan_speed": 16
                                        },
                                        "target": {}
                                    },
                                    "running_script": true,
                                    "limit": null
                                }
                            }
                        ]
                    },
                    "config": {
                        "id": "1642997460354",
                        "alias": "Dining Room Fan Set State",
                        "description": "Set Dining Room Fan power and speed",
                        "trigger": [
                            {
                                "platform": "state",
                                "entity_id": "fan.dining_room_fan",
                                "id": "power"
                            },
                            {
                                "platform": "state",
                                "entity_id": "fan.dining_room_fan",
                                "id": "speed",
                                "attribute": "percentage"
                            }
                        ],
                        "condition": [],
                        "action": [
                            {
                                "choose": [
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "speed"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "fan.turn_on",
                                                "target": {
                                                    "entity_id": "fan.dining_room_fan"
                                                }
                                            },
                                            {
                                                "service": "script.1642846136869",
                                                "data": {
                                                    "target_fan": "Dining Room Fan",
                                                    "target_fan_power": true,
                                                    "target_fan_speed": "{{ state_attr('fan.dining_room_fan', 'percentage') | int }}"
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "power"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [
                                                            {
                                                                "condition": "state",
                                                                "entity_id": "fan.dining_room_fan",
                                                                "state": "off"
                                                            }
                                                        ],
                                                        "sequence": [
                                                            {
                                                                "service": "script.1642846136869",
                                                                "data": {
                                                                    "target_fan": "Dining Room Fan",
                                                                    "target_fan_power": false,
                                                                    "target_fan_speed": "{{ state_attr('fan.dining_room_fan', 'percentage') | int }}"
                                                                }
                                                            }
                                                        ]
                                                    },
                                                    {
                                                        "conditions": [
                                                            {
                                                                "condition": "state",
                                                                "entity_id": "fan.dining_room_fan",
                                                                "state": "on"
                                                            }
                                                        ],
                                                        "sequence": [
                                                            {
                                                                "service": "script.1642846136869",
                                                                "data": {
                                                                    "target_fan": "Dining Room Fan",
                                                                    "target_fan_power": true,
                                                                    "target_fan_speed": "{{ state_attr('fan.dining_room_fan', 'percentage') | int }}"
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": []
                                            }
                                        ]
                                    }
                                ],
                                "default": []
                            }
                        ],
                        "mode": "queued",
                        "max": 10
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "12ab56b5f7ebc825e5044adfd45b484e",
                        "parent_id": "a3d5692cc337adfaca64783a1281f5cb",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/0/choose/1/sequence/0/choose/1/sequence/0",
                    "run_id": "d36aaffe96a9c25db02420cbb083fdea",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:45:26.454569+00:00",
                        "finish": "2022-03-03T05:45:27.219660+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1642997460354",
                    "trigger": "state of fan.dining_room_fan"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/0/choose/0/sequence/1",
                    "run_id": "9f592260b85e092476801dab234ffb0d",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:45:26.454907+00:00",
                        "finish": "2022-03-03T05:45:27.988909+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1642997460354",
                    "trigger": "state of fan.dining_room_fan",
                    "trace": {
                        "trigger/1": [
                            {
                                "path": "trigger/1",
                                "timestamp": "2022-03-03T05:45:26.454971+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.dining_room_fan_set_state",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T05:45:26.454784+00:00",
                                            "mode": "queued",
                                            "current": 1,
                                            "max": 10,
                                            "id": "1642997460354",
                                            "friendly_name": "Dining Room Fan Set State"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.797567+00:00",
                                        "last_updated": "2022-03-03T05:45:26.454820+00:00",
                                        "context": {
                                            "id": "12ab56b5f7ebc825e5044adfd45b484e",
                                            "parent_id": "a3d5692cc337adfaca64783a1281f5cb",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "speed",
                                        "idx": "1",
                                        "platform": "state",
                                        "entity_id": "fan.dining_room_fan",
                                        "from_state": {
                                            "entity_id": "fan.dining_room_fan",
                                            "state": "on",
                                            "attributes": {
                                                "speed_list": [
                                                    "off",
                                                    "low",
                                                    "medium",
                                                    "high"
                                                ],
                                                "preset_modes": null,
                                                "speed": "off",
                                                "percentage": 0,
                                                "percentage_step": 16.666666666666668,
                                                "preset_mode": null,
                                                "friendly_name": "Dining Room Fan",
                                                "supported_features": 1
                                            },
                                            "last_changed": "2022-03-03T05:44:44.422190+00:00",
                                            "last_updated": "2022-03-03T05:44:44.422190+00:00",
                                            "context": {
                                                "id": "4de2f4d60fa5bfc044f0b7e479e169f0",
                                                "parent_id": "c53ff127fbb554733efe369026b7ab36",
                                                "user_id": null
                                            }
                                        },
                                        "to_state": {
                                            "entity_id": "fan.dining_room_fan",
                                            "state": "on",
                                            "attributes": {
                                                "speed_list": [
                                                    "off",
                                                    "low",
                                                    "medium",
                                                    "high"
                                                ],
                                                "preset_modes": null,
                                                "speed": "low",
                                                "percentage": 16,
                                                "percentage_step": 16.666666666666668,
                                                "preset_mode": null,
                                                "friendly_name": "Dining Room Fan",
                                                "supported_features": 1
                                            },
                                            "last_changed": "2022-03-03T05:44:44.422190+00:00",
                                            "last_updated": "2022-03-03T05:45:26.453779+00:00",
                                            "context": {
                                                "id": "a3d5692cc337adfaca64783a1281f5cb",
                                                "parent_id": "397e652bfc40637542b07fea65c6872a",
                                                "user_id": null
                                            }
                                        },
                                        "for": null,
                                        "attribute": "percentage",
                                        "description": "state of fan.dining_room_fan"
                                    }
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T05:45:27.219784+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "9cc92ad7eeb0b9ffa72d831f7b5a8e69",
                                        "parent_id": "a3d5692cc337adfaca64783a1281f5cb",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "choice": 0
                                }
                            }
                        ],
                        "action/0/choose/0": [
                            {
                                "path": "action/0/choose/0",
                                "timestamp": "2022-03-03T05:45:27.219859+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/0/conditions/0",
                                "timestamp": "2022-03-03T05:45:27.219886+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/0": [
                            {
                                "path": "action/0/choose/0/sequence/0",
                                "timestamp": "2022-03-03T05:45:27.220198+00:00",
                                "result": {
                                    "params": {
                                        "domain": "fan",
                                        "service": "turn_on",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "fan.dining_room_fan"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/0/0": [
                            {
                                "path": "action/0/choose/0/sequence/0/0",
                                "timestamp": "2022-03-03T05:45:27.220992+00:00",
                                "changed_variables": {
                                    "speed": null,
                                    "percentage": null,
                                    "preset_mode": null
                                },
                                "result": {
                                    "params": {
                                        "domain": "input_boolean",
                                        "service": "turn_on",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "input_boolean.dining_room_fan_power"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/1": [
                            {
                                "path": "action/0/choose/0/sequence/1",
                                "timestamp": "2022-03-03T05:45:27.222144+00:00",
                                "child_id": {
                                    "domain": "script",
                                    "item_id": "1642846136869",
                                    "run_id": "0b74789bc8cf5c0ae4cab86ae800b9a6"
                                },
                                "result": {
                                    "params": {
                                        "domain": "script",
                                        "service": "1642846136869",
                                        "service_data": {
                                            "target_fan": "Dining Room Fan",
                                            "target_fan_power": true,
                                            "target_fan_speed": 16
                                        },
                                        "target": {}
                                    },
                                    "running_script": true,
                                    "limit": null
                                }
                            }
                        ]
                    },
                    "config": {
                        "id": "1642997460354",
                        "alias": "Dining Room Fan Set State",
                        "description": "Set Dining Room Fan power and speed",
                        "trigger": [
                            {
                                "platform": "state",
                                "entity_id": "fan.dining_room_fan",
                                "id": "power"
                            },
                            {
                                "platform": "state",
                                "entity_id": "fan.dining_room_fan",
                                "id": "speed",
                                "attribute": "percentage"
                            }
                        ],
                        "condition": [],
                        "action": [
                            {
                                "choose": [
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "speed"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "fan.turn_on",
                                                "target": {
                                                    "entity_id": "fan.dining_room_fan"
                                                }
                                            },
                                            {
                                                "service": "script.1642846136869",
                                                "data": {
                                                    "target_fan": "Dining Room Fan",
                                                    "target_fan_power": true,
                                                    "target_fan_speed": "{{ state_attr('fan.dining_room_fan', 'percentage') | int }}"
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "power"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [
                                                            {
                                                                "condition": "state",
                                                                "entity_id": "fan.dining_room_fan",
                                                                "state": "off"
                                                            }
                                                        ],
                                                        "sequence": [
                                                            {
                                                                "service": "script.1642846136869",
                                                                "data": {
                                                                    "target_fan": "Dining Room Fan",
                                                                    "target_fan_power": false,
                                                                    "target_fan_speed": "{{ state_attr('fan.dining_room_fan', 'percentage') | int }}"
                                                                }
                                                            }
                                                        ]
                                                    },
                                                    {
                                                        "conditions": [
                                                            {
                                                                "condition": "state",
                                                                "entity_id": "fan.dining_room_fan",
                                                                "state": "on"
                                                            }
                                                        ],
                                                        "sequence": [
                                                            {
                                                                "service": "script.1642846136869",
                                                                "data": {
                                                                    "target_fan": "Dining Room Fan",
                                                                    "target_fan_power": true,
                                                                    "target_fan_speed": "{{ state_attr('fan.dining_room_fan', 'percentage') | int }}"
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": []
                                            }
                                        ]
                                    }
                                ],
                                "default": []
                            }
                        ],
                        "mode": "queued",
                        "max": 10
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "9cc92ad7eeb0b9ffa72d831f7b5a8e69",
                        "parent_id": "a3d5692cc337adfaca64783a1281f5cb",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/0/choose/0/sequence/1",
                    "run_id": "9f592260b85e092476801dab234ffb0d",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:45:26.454907+00:00",
                        "finish": "2022-03-03T05:45:27.988909+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1642997460354",
                    "trigger": "state of fan.dining_room_fan"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/0/choose/1/sequence/0/choose/1/sequence/0",
                    "run_id": "7008528c64a6d1396b4c1f8f71d63e0e",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:45:37.330045+00:00",
                        "finish": "2022-03-03T05:45:38.096721+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1642997460354",
                    "trigger": "state of fan.dining_room_fan",
                    "trace": {
                        "trigger/0": [
                            {
                                "path": "trigger/0",
                                "timestamp": "2022-03-03T05:45:37.330128+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.dining_room_fan_set_state",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T05:45:26.455037+00:00",
                                            "mode": "queued",
                                            "current": 0,
                                            "max": 10,
                                            "id": "1642997460354",
                                            "friendly_name": "Dining Room Fan Set State"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.797567+00:00",
                                        "last_updated": "2022-03-03T05:45:27.988218+00:00",
                                        "context": {
                                            "id": "9cc92ad7eeb0b9ffa72d831f7b5a8e69",
                                            "parent_id": "a3d5692cc337adfaca64783a1281f5cb",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "power",
                                        "idx": "0",
                                        "platform": "state",
                                        "entity_id": "fan.dining_room_fan",
                                        "from_state": {
                                            "entity_id": "fan.dining_room_fan",
                                            "state": "on",
                                            "attributes": {
                                                "speed_list": [
                                                    "off",
                                                    "low",
                                                    "medium",
                                                    "high"
                                                ],
                                                "preset_modes": null,
                                                "speed": "low",
                                                "percentage": 16,
                                                "percentage_step": 16.666666666666668,
                                                "preset_mode": null,
                                                "friendly_name": "Dining Room Fan",
                                                "supported_features": 1
                                            },
                                            "last_changed": "2022-03-03T05:44:44.422190+00:00",
                                            "last_updated": "2022-03-03T05:45:26.453779+00:00",
                                            "context": {
                                                "id": "a3d5692cc337adfaca64783a1281f5cb",
                                                "parent_id": "397e652bfc40637542b07fea65c6872a",
                                                "user_id": null
                                            }
                                        },
                                        "to_state": {
                                            "entity_id": "fan.dining_room_fan",
                                            "state": "on",
                                            "attributes": {
                                                "speed_list": [
                                                    "off",
                                                    "low",
                                                    "medium",
                                                    "high"
                                                ],
                                                "preset_modes": null,
                                                "speed": "medium",
                                                "percentage": 66,
                                                "percentage_step": 16.666666666666668,
                                                "preset_mode": null,
                                                "friendly_name": "Dining Room Fan",
                                                "supported_features": 1
                                            },
                                            "last_changed": "2022-03-03T05:44:44.422190+00:00",
                                            "last_updated": "2022-03-03T05:45:37.328534+00:00",
                                            "context": {
                                                "id": "ff751dc646454987acc07db9d12c7f00",
                                                "parent_id": null,
                                                "user_id": "ad2bcce775894550affb6dfef93a2a36"
                                            }
                                        },
                                        "for": null,
                                        "attribute": null,
                                        "description": "state of fan.dining_room_fan"
                                    }
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T05:45:37.332502+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "6c595b8c3b24290d344dfa49d889e5f8",
                                        "parent_id": "ff751dc646454987acc07db9d12c7f00",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "choice": 1
                                }
                            }
                        ],
                        "action/0/choose/0": [
                            {
                                "path": "action/0/choose/0",
                                "timestamp": "2022-03-03T05:45:37.332561+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/0/conditions/0",
                                "timestamp": "2022-03-03T05:45:37.332580+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/1": [
                            {
                                "path": "action/0/choose/1",
                                "timestamp": "2022-03-03T05:45:37.332613+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/1/conditions/0": [
                            {
                                "path": "action/0/choose/1/conditions/0",
                                "timestamp": "2022-03-03T05:45:37.332626+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/1/sequence/0": [
                            {
                                "path": "action/0/choose/1/sequence/0",
                                "timestamp": "2022-03-03T05:45:37.332877+00:00",
                                "result": {
                                    "choice": 1
                                }
                            }
                        ],
                        "action/0/choose/1/sequence/0/choose/0": [
                            {
                                "path": "action/0/choose/1/sequence/0/choose/0",
                                "timestamp": "2022-03-03T05:45:37.332911+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/1/sequence/0/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/1/sequence/0/choose/0/conditions/0",
                                "timestamp": "2022-03-03T05:45:37.332927+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/1/sequence/0/choose/0/conditions/0/entity_id/0": [
                            {
                                "path": "action/0/choose/1/sequence/0/choose/0/conditions/0/entity_id/0",
                                "timestamp": "2022-03-03T05:45:37.332939+00:00",
                                "result": {
                                    "result": false,
                                    "state": "on",
                                    "wanted_state": "off"
                                }
                            }
                        ],
                        "action/0/choose/1/sequence/0/choose/1": [
                            {
                                "path": "action/0/choose/1/sequence/0/choose/1",
                                "timestamp": "2022-03-03T05:45:37.332979+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/1/sequence/0/choose/1/conditions/0": [
                            {
                                "path": "action/0/choose/1/sequence/0/choose/1/conditions/0",
                                "timestamp": "2022-03-03T05:45:37.332993+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/1/sequence/0/choose/1/conditions/0/entity_id/0": [
                            {
                                "path": "action/0/choose/1/sequence/0/choose/1/conditions/0/entity_id/0",
                                "timestamp": "2022-03-03T05:45:37.333004+00:00",
                                "result": {
                                    "result": true,
                                    "state": "on",
                                    "wanted_state": "on"
                                }
                            }
                        ],
                        "action/0/choose/1/sequence/0/choose/1/sequence/0": [
                            {
                                "path": "action/0/choose/1/sequence/0/choose/1/sequence/0",
                                "timestamp": "2022-03-03T05:45:37.333206+00:00",
                                "child_id": {
                                    "domain": "script",
                                    "item_id": "1642846136869",
                                    "run_id": "e2dbb68c2a1dd332b8904b134645cb31"
                                },
                                "result": {
                                    "params": {
                                        "domain": "script",
                                        "service": "1642846136869",
                                        "service_data": {
                                            "target_fan": "Dining Room Fan",
                                            "target_fan_power": true,
                                            "target_fan_speed": 66
                                        },
                                        "target": {}
                                    },
                                    "running_script": true,
                                    "limit": null
                                }
                            }
                        ]
                    },
                    "config": {
                        "id": "1642997460354",
                        "alias": "Dining Room Fan Set State",
                        "description": "Set Dining Room Fan power and speed",
                        "trigger": [
                            {
                                "platform": "state",
                                "entity_id": "fan.dining_room_fan",
                                "id": "power"
                            },
                            {
                                "platform": "state",
                                "entity_id": "fan.dining_room_fan",
                                "id": "speed",
                                "attribute": "percentage"
                            }
                        ],
                        "condition": [],
                        "action": [
                            {
                                "choose": [
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "speed"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "fan.turn_on",
                                                "target": {
                                                    "entity_id": "fan.dining_room_fan"
                                                }
                                            },
                                            {
                                                "service": "script.1642846136869",
                                                "data": {
                                                    "target_fan": "Dining Room Fan",
                                                    "target_fan_power": true,
                                                    "target_fan_speed": "{{ state_attr('fan.dining_room_fan', 'percentage') | int }}"
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "power"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [
                                                            {
                                                                "condition": "state",
                                                                "entity_id": "fan.dining_room_fan",
                                                                "state": "off"
                                                            }
                                                        ],
                                                        "sequence": [
                                                            {
                                                                "service": "script.1642846136869",
                                                                "data": {
                                                                    "target_fan": "Dining Room Fan",
                                                                    "target_fan_power": false,
                                                                    "target_fan_speed": "{{ state_attr('fan.dining_room_fan', 'percentage') | int }}"
                                                                }
                                                            }
                                                        ]
                                                    },
                                                    {
                                                        "conditions": [
                                                            {
                                                                "condition": "state",
                                                                "entity_id": "fan.dining_room_fan",
                                                                "state": "on"
                                                            }
                                                        ],
                                                        "sequence": [
                                                            {
                                                                "service": "script.1642846136869",
                                                                "data": {
                                                                    "target_fan": "Dining Room Fan",
                                                                    "target_fan_power": true,
                                                                    "target_fan_speed": "{{ state_attr('fan.dining_room_fan', 'percentage') | int }}"
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": []
                                            }
                                        ]
                                    }
                                ],
                                "default": []
                            }
                        ],
                        "mode": "queued",
                        "max": 10
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "6c595b8c3b24290d344dfa49d889e5f8",
                        "parent_id": "ff751dc646454987acc07db9d12c7f00",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/0/choose/1/sequence/0/choose/1/sequence/0",
                    "run_id": "7008528c64a6d1396b4c1f8f71d63e0e",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:45:37.330045+00:00",
                        "finish": "2022-03-03T05:45:38.096721+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1642997460354",
                    "trigger": "state of fan.dining_room_fan"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/0/choose/0/sequence/1",
                    "run_id": "183caf3090a36aa07dacba21e0957485",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:45:37.330342+00:00",
                        "finish": "2022-03-03T05:45:38.465457+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1642997460354",
                    "trigger": "state of fan.dining_room_fan",
                    "trace": {
                        "trigger/1": [
                            {
                                "path": "trigger/1",
                                "timestamp": "2022-03-03T05:45:37.330400+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.dining_room_fan_set_state",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T05:45:37.330216+00:00",
                                            "mode": "queued",
                                            "current": 1,
                                            "max": 10,
                                            "id": "1642997460354",
                                            "friendly_name": "Dining Room Fan Set State"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.797567+00:00",
                                        "last_updated": "2022-03-03T05:45:37.330254+00:00",
                                        "context": {
                                            "id": "6c595b8c3b24290d344dfa49d889e5f8",
                                            "parent_id": "ff751dc646454987acc07db9d12c7f00",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "speed",
                                        "idx": "1",
                                        "platform": "state",
                                        "entity_id": "fan.dining_room_fan",
                                        "from_state": {
                                            "entity_id": "fan.dining_room_fan",
                                            "state": "on",
                                            "attributes": {
                                                "speed_list": [
                                                    "off",
                                                    "low",
                                                    "medium",
                                                    "high"
                                                ],
                                                "preset_modes": null,
                                                "speed": "low",
                                                "percentage": 16,
                                                "percentage_step": 16.666666666666668,
                                                "preset_mode": null,
                                                "friendly_name": "Dining Room Fan",
                                                "supported_features": 1
                                            },
                                            "last_changed": "2022-03-03T05:44:44.422190+00:00",
                                            "last_updated": "2022-03-03T05:45:26.453779+00:00",
                                            "context": {
                                                "id": "a3d5692cc337adfaca64783a1281f5cb",
                                                "parent_id": "397e652bfc40637542b07fea65c6872a",
                                                "user_id": null
                                            }
                                        },
                                        "to_state": {
                                            "entity_id": "fan.dining_room_fan",
                                            "state": "on",
                                            "attributes": {
                                                "speed_list": [
                                                    "off",
                                                    "low",
                                                    "medium",
                                                    "high"
                                                ],
                                                "preset_modes": null,
                                                "speed": "medium",
                                                "percentage": 66,
                                                "percentage_step": 16.666666666666668,
                                                "preset_mode": null,
                                                "friendly_name": "Dining Room Fan",
                                                "supported_features": 1
                                            },
                                            "last_changed": "2022-03-03T05:44:44.422190+00:00",
                                            "last_updated": "2022-03-03T05:45:37.328534+00:00",
                                            "context": {
                                                "id": "ff751dc646454987acc07db9d12c7f00",
                                                "parent_id": null,
                                                "user_id": "ad2bcce775894550affb6dfef93a2a36"
                                            }
                                        },
                                        "for": null,
                                        "attribute": "percentage",
                                        "description": "state of fan.dining_room_fan"
                                    }
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T05:45:38.096816+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "b3d52e9c0add0149b197ce79436fc2ca",
                                        "parent_id": "ff751dc646454987acc07db9d12c7f00",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "choice": 0
                                }
                            }
                        ],
                        "action/0/choose/0": [
                            {
                                "path": "action/0/choose/0",
                                "timestamp": "2022-03-03T05:45:38.096867+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/0/conditions/0",
                                "timestamp": "2022-03-03T05:45:38.096887+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/0": [
                            {
                                "path": "action/0/choose/0/sequence/0",
                                "timestamp": "2022-03-03T05:45:38.097114+00:00",
                                "result": {
                                    "params": {
                                        "domain": "fan",
                                        "service": "turn_on",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "fan.dining_room_fan"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/0/0": [
                            {
                                "path": "action/0/choose/0/sequence/0/0",
                                "timestamp": "2022-03-03T05:45:38.097843+00:00",
                                "changed_variables": {
                                    "speed": null,
                                    "percentage": null,
                                    "preset_mode": null
                                },
                                "result": {
                                    "params": {
                                        "domain": "input_boolean",
                                        "service": "turn_on",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "input_boolean.dining_room_fan_power"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/1": [
                            {
                                "path": "action/0/choose/0/sequence/1",
                                "timestamp": "2022-03-03T05:45:38.099107+00:00",
                                "child_id": {
                                    "domain": "script",
                                    "item_id": "1642846136869",
                                    "run_id": "7b943f7a42a9f4986e183061aaa9b3aa"
                                },
                                "result": {
                                    "params": {
                                        "domain": "script",
                                        "service": "1642846136869",
                                        "service_data": {
                                            "target_fan": "Dining Room Fan",
                                            "target_fan_power": true,
                                            "target_fan_speed": 66
                                        },
                                        "target": {}
                                    },
                                    "running_script": true,
                                    "limit": null
                                }
                            }
                        ]
                    },
                    "config": {
                        "id": "1642997460354",
                        "alias": "Dining Room Fan Set State",
                        "description": "Set Dining Room Fan power and speed",
                        "trigger": [
                            {
                                "platform": "state",
                                "entity_id": "fan.dining_room_fan",
                                "id": "power"
                            },
                            {
                                "platform": "state",
                                "entity_id": "fan.dining_room_fan",
                                "id": "speed",
                                "attribute": "percentage"
                            }
                        ],
                        "condition": [],
                        "action": [
                            {
                                "choose": [
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "speed"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "fan.turn_on",
                                                "target": {
                                                    "entity_id": "fan.dining_room_fan"
                                                }
                                            },
                                            {
                                                "service": "script.1642846136869",
                                                "data": {
                                                    "target_fan": "Dining Room Fan",
                                                    "target_fan_power": true,
                                                    "target_fan_speed": "{{ state_attr('fan.dining_room_fan', 'percentage') | int }}"
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "power"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [
                                                            {
                                                                "condition": "state",
                                                                "entity_id": "fan.dining_room_fan",
                                                                "state": "off"
                                                            }
                                                        ],
                                                        "sequence": [
                                                            {
                                                                "service": "script.1642846136869",
                                                                "data": {
                                                                    "target_fan": "Dining Room Fan",
                                                                    "target_fan_power": false,
                                                                    "target_fan_speed": "{{ state_attr('fan.dining_room_fan', 'percentage') | int }}"
                                                                }
                                                            }
                                                        ]
                                                    },
                                                    {
                                                        "conditions": [
                                                            {
                                                                "condition": "state",
                                                                "entity_id": "fan.dining_room_fan",
                                                                "state": "on"
                                                            }
                                                        ],
                                                        "sequence": [
                                                            {
                                                                "service": "script.1642846136869",
                                                                "data": {
                                                                    "target_fan": "Dining Room Fan",
                                                                    "target_fan_power": true,
                                                                    "target_fan_speed": "{{ state_attr('fan.dining_room_fan', 'percentage') | int }}"
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": []
                                            }
                                        ]
                                    }
                                ],
                                "default": []
                            }
                        ],
                        "mode": "queued",
                        "max": 10
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "b3d52e9c0add0149b197ce79436fc2ca",
                        "parent_id": "ff751dc646454987acc07db9d12c7f00",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/0/choose/0/sequence/1",
                    "run_id": "183caf3090a36aa07dacba21e0957485",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:45:37.330342+00:00",
                        "finish": "2022-03-03T05:45:38.465457+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1642997460354",
                    "trigger": "state of fan.dining_room_fan"
                }
            }
        ],
        "automation.1643642352545": [
            {
                "extended_dict": {
                    "last_step": "action/0/choose/1/sequence/0",
                    "run_id": "3d434e3d30874b1ba7a74d38eaf2828d",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T07:06:08.536085+00:00",
                        "finish": "2022-03-03T07:06:08.665075+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643642352545",
                    "trigger": "state of binary_sensor.playroom_motion",
                    "trace": {
                        "trigger/1": [
                            {
                                "path": "trigger/1",
                                "timestamp": "2022-03-03T07:06:08.536194+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.playroom_motion",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T07:02:14.322555+00:00",
                                            "mode": "single",
                                            "current": 0,
                                            "id": "1643642352545",
                                            "friendly_name": "Playroom Motion"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.798307+00:00",
                                        "last_updated": "2022-03-03T07:02:14.324141+00:00",
                                        "context": {
                                            "id": "e2f320490bc8316e5838581a733e3ddb",
                                            "parent_id": "927f1ef7b7c380eed61ab7a7245d61d2",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "no_motion",
                                        "idx": "1",
                                        "platform": "state",
                                        "entity_id": "binary_sensor.playroom_motion",
                                        "from_state": {
                                            "entity_id": "binary_sensor.playroom_motion",
                                            "state": "on",
                                            "attributes": {
                                                "device_class": "motion",
                                                "friendly_name": "Playroom Motion"
                                            },
                                            "last_changed": "2022-03-03T07:02:14.321730+00:00",
                                            "last_updated": "2022-03-03T07:02:14.321730+00:00",
                                            "context": {
                                                "id": "927f1ef7b7c380eed61ab7a7245d61d2",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "to_state": {
                                            "entity_id": "binary_sensor.playroom_motion",
                                            "state": "off",
                                            "attributes": {
                                                "device_class": "motion",
                                                "friendly_name": "Playroom Motion"
                                            },
                                            "last_changed": "2022-03-03T07:05:08.534898+00:00",
                                            "last_updated": "2022-03-03T07:05:08.534898+00:00",
                                            "context": {
                                                "id": "69e2ccdeea72b4f31b9afe318b6d9373",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "for": {
                                            "__type": "<class 'datetime.timedelta'>",
                                            "total_seconds": 60.0
                                        },
                                        "attribute": null,
                                        "description": "state of binary_sensor.playroom_motion"
                                    }
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T07:06:08.536941+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "7a7c5f09c6f26df39ff086c604b2b623",
                                        "parent_id": "69e2ccdeea72b4f31b9afe318b6d9373",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "choice": 1
                                }
                            }
                        ],
                        "action/0/choose/0": [
                            {
                                "path": "action/0/choose/0",
                                "timestamp": "2022-03-03T07:06:08.537008+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/0/conditions/0",
                                "timestamp": "2022-03-03T07:06:08.537037+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/1": [
                            {
                                "path": "action/0/choose/1",
                                "timestamp": "2022-03-03T07:06:08.537090+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/1/conditions/0": [
                            {
                                "path": "action/0/choose/1/conditions/0",
                                "timestamp": "2022-03-03T07:06:08.537108+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/1/sequence/0": [
                            {
                                "path": "action/0/choose/1/sequence/0",
                                "timestamp": "2022-03-03T07:06:08.537443+00:00",
                                "result": {
                                    "params": {
                                        "domain": "light",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "light.playroom_lights"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ]
                    },
                    "config": {
                        "id": "1643642352545",
                        "alias": "Playroom Motion",
                        "description": "Control the Playroom Lights with Motion",
                        "trigger": [
                            {
                                "platform": "state",
                                "entity_id": "binary_sensor.playroom_motion",
                                "id": "motion",
                                "from": "off",
                                "to": "on"
                            },
                            {
                                "platform": "state",
                                "entity_id": "binary_sensor.playroom_motion",
                                "id": "no_motion",
                                "from": "on",
                                "to": "off",
                                "for": {
                                    "hours": 0,
                                    "minutes": 1,
                                    "seconds": 0
                                }
                            }
                        ],
                        "condition": [],
                        "action": [
                            {
                                "choose": [
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "motion"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "condition": "state",
                                                "entity_id": "switch.lights_auto_control",
                                                "state": "on"
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [
                                                            {
                                                                "condition": "time",
                                                                "before": "input_datetime.lights_auto_control_end",
                                                                "weekday": [
                                                                    "mon",
                                                                    "tue",
                                                                    "wed",
                                                                    "thu",
                                                                    "fri",
                                                                    "sat",
                                                                    "sun"
                                                                ],
                                                                "after": "input_datetime.wind_down"
                                                            }
                                                        ],
                                                        "sequence": [
                                                            {
                                                                "service": "light.turn_on",
                                                                "target": {
                                                                    "entity_id": "light.playroom_lights"
                                                                },
                                                                "data": {
                                                                    "brightness_pct": 5
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.playroom_lights"
                                                        },
                                                        "data": {
                                                            "brightness_pct": 100
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "no_motion"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "light.turn_off",
                                                "target": {
                                                    "entity_id": "light.playroom_lights"
                                                }
                                            }
                                        ]
                                    }
                                ],
                                "default": []
                            }
                        ],
                        "mode": "single"
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "7a7c5f09c6f26df39ff086c604b2b623",
                        "parent_id": "69e2ccdeea72b4f31b9afe318b6d9373",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/0/choose/1/sequence/0",
                    "run_id": "3d434e3d30874b1ba7a74d38eaf2828d",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T07:06:08.536085+00:00",
                        "finish": "2022-03-03T07:06:08.665075+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643642352545",
                    "trigger": "state of binary_sensor.playroom_motion"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/0/choose/0/sequence/1/default/0",
                    "run_id": "2f8121d0c9556ebb8b946c59d25b9381",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T07:46:22.387554+00:00",
                        "finish": "2022-03-03T07:46:22.554989+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643642352545",
                    "trigger": "state of binary_sensor.playroom_motion",
                    "trace": {
                        "trigger/0": [
                            {
                                "path": "trigger/0",
                                "timestamp": "2022-03-03T07:46:22.387674+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.playroom_motion",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T07:06:08.536352+00:00",
                                            "mode": "single",
                                            "current": 0,
                                            "id": "1643642352545",
                                            "friendly_name": "Playroom Motion"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.798307+00:00",
                                        "last_updated": "2022-03-03T07:06:08.664583+00:00",
                                        "context": {
                                            "id": "7a7c5f09c6f26df39ff086c604b2b623",
                                            "parent_id": "69e2ccdeea72b4f31b9afe318b6d9373",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "motion",
                                        "idx": "0",
                                        "platform": "state",
                                        "entity_id": "binary_sensor.playroom_motion",
                                        "from_state": {
                                            "entity_id": "binary_sensor.playroom_motion",
                                            "state": "off",
                                            "attributes": {
                                                "device_class": "motion",
                                                "friendly_name": "Playroom Motion"
                                            },
                                            "last_changed": "2022-03-03T07:05:08.534898+00:00",
                                            "last_updated": "2022-03-03T07:05:08.534898+00:00",
                                            "context": {
                                                "id": "69e2ccdeea72b4f31b9afe318b6d9373",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "to_state": {
                                            "entity_id": "binary_sensor.playroom_motion",
                                            "state": "on",
                                            "attributes": {
                                                "device_class": "motion",
                                                "friendly_name": "Playroom Motion"
                                            },
                                            "last_changed": "2022-03-03T07:46:22.386814+00:00",
                                            "last_updated": "2022-03-03T07:46:22.386814+00:00",
                                            "context": {
                                                "id": "2bdd93ee8078204932912bb0b60e4d8e",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "for": null,
                                        "attribute": null,
                                        "description": "state of binary_sensor.playroom_motion"
                                    }
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T07:46:22.389171+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "b6aba6bf109e58bda817f6e5b4783007",
                                        "parent_id": "2bdd93ee8078204932912bb0b60e4d8e",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "choice": 0
                                }
                            }
                        ],
                        "action/0/choose/0": [
                            {
                                "path": "action/0/choose/0",
                                "timestamp": "2022-03-03T07:46:22.389234+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/0/conditions/0",
                                "timestamp": "2022-03-03T07:46:22.389260+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/0": [
                            {
                                "path": "action/0/choose/0/sequence/0",
                                "timestamp": "2022-03-03T07:46:22.390290+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/0/entity_id/0": [
                            {
                                "path": "action/0/choose/0/sequence/0/entity_id/0",
                                "timestamp": "2022-03-03T07:46:22.390372+00:00",
                                "result": {
                                    "result": true,
                                    "state": "on",
                                    "wanted_state": "on"
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/1": [
                            {
                                "path": "action/0/choose/0/sequence/1",
                                "timestamp": "2022-03-03T07:46:22.390446+00:00",
                                "result": {
                                    "choice": "default"
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/1/choose/0": [
                            {
                                "path": "action/0/choose/0/sequence/1/choose/0",
                                "timestamp": "2022-03-03T07:46:22.390650+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/1/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/0/sequence/1/choose/0/conditions/0",
                                "timestamp": "2022-03-03T07:46:22.390723+00:00",
                                "result": {
                                    "after": {
                                        "__type": "<class 'datetime.time'>",
                                        "isoformat": "21:30:00"
                                    },
                                    "now_time": {
                                        "__type": "<class 'datetime.time'>",
                                        "isoformat": "15:46:22.390741"
                                    },
                                    "before": {
                                        "__type": "<class 'datetime.time'>",
                                        "isoformat": "07:00:00"
                                    },
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/1/default/0": [
                            {
                                "path": "action/0/choose/0/sequence/1/default/0",
                                "timestamp": "2022-03-03T07:46:22.391030+00:00",
                                "result": {
                                    "params": {
                                        "domain": "light",
                                        "service": "turn_on",
                                        "service_data": {
                                            "brightness_pct": 100,
                                            "entity_id": [
                                                "light.playroom_lights"
                                            ]
                                        },
                                        "target": {
                                            "entity_id": [
                                                "light.playroom_lights"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ]
                    },
                    "config": {
                        "id": "1643642352545",
                        "alias": "Playroom Motion",
                        "description": "Control the Playroom Lights with Motion",
                        "trigger": [
                            {
                                "platform": "state",
                                "entity_id": "binary_sensor.playroom_motion",
                                "id": "motion",
                                "from": "off",
                                "to": "on"
                            },
                            {
                                "platform": "state",
                                "entity_id": "binary_sensor.playroom_motion",
                                "id": "no_motion",
                                "from": "on",
                                "to": "off",
                                "for": {
                                    "hours": 0,
                                    "minutes": 1,
                                    "seconds": 0
                                }
                            }
                        ],
                        "condition": [],
                        "action": [
                            {
                                "choose": [
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "motion"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "condition": "state",
                                                "entity_id": "switch.lights_auto_control",
                                                "state": "on"
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [
                                                            {
                                                                "condition": "time",
                                                                "before": "input_datetime.lights_auto_control_end",
                                                                "weekday": [
                                                                    "mon",
                                                                    "tue",
                                                                    "wed",
                                                                    "thu",
                                                                    "fri",
                                                                    "sat",
                                                                    "sun"
                                                                ],
                                                                "after": "input_datetime.wind_down"
                                                            }
                                                        ],
                                                        "sequence": [
                                                            {
                                                                "service": "light.turn_on",
                                                                "target": {
                                                                    "entity_id": "light.playroom_lights"
                                                                },
                                                                "data": {
                                                                    "brightness_pct": 5
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.playroom_lights"
                                                        },
                                                        "data": {
                                                            "brightness_pct": 100
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "no_motion"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "light.turn_off",
                                                "target": {
                                                    "entity_id": "light.playroom_lights"
                                                }
                                            }
                                        ]
                                    }
                                ],
                                "default": []
                            }
                        ],
                        "mode": "single"
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "b6aba6bf109e58bda817f6e5b4783007",
                        "parent_id": "2bdd93ee8078204932912bb0b60e4d8e",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/0/choose/0/sequence/1/default/0",
                    "run_id": "2f8121d0c9556ebb8b946c59d25b9381",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T07:46:22.387554+00:00",
                        "finish": "2022-03-03T07:46:22.554989+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643642352545",
                    "trigger": "state of binary_sensor.playroom_motion"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/0/choose/1/sequence/0",
                    "run_id": "f3e77dc96961886f9955cab2236d8e7a",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T07:48:37.616287+00:00",
                        "finish": "2022-03-03T07:48:37.807141+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643642352545",
                    "trigger": "state of binary_sensor.playroom_motion",
                    "trace": {
                        "trigger/1": [
                            {
                                "path": "trigger/1",
                                "timestamp": "2022-03-03T07:48:37.616367+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.playroom_motion",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T07:46:22.387827+00:00",
                                            "mode": "single",
                                            "current": 0,
                                            "id": "1643642352545",
                                            "friendly_name": "Playroom Motion"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.798307+00:00",
                                        "last_updated": "2022-03-03T07:46:22.554023+00:00",
                                        "context": {
                                            "id": "b6aba6bf109e58bda817f6e5b4783007",
                                            "parent_id": "2bdd93ee8078204932912bb0b60e4d8e",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "no_motion",
                                        "idx": "1",
                                        "platform": "state",
                                        "entity_id": "binary_sensor.playroom_motion",
                                        "from_state": {
                                            "entity_id": "binary_sensor.playroom_motion",
                                            "state": "on",
                                            "attributes": {
                                                "device_class": "motion",
                                                "friendly_name": "Playroom Motion"
                                            },
                                            "last_changed": "2022-03-03T07:46:22.386814+00:00",
                                            "last_updated": "2022-03-03T07:46:22.386814+00:00",
                                            "context": {
                                                "id": "2bdd93ee8078204932912bb0b60e4d8e",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "to_state": {
                                            "entity_id": "binary_sensor.playroom_motion",
                                            "state": "off",
                                            "attributes": {
                                                "device_class": "motion",
                                                "friendly_name": "Playroom Motion"
                                            },
                                            "last_changed": "2022-03-03T07:47:37.615105+00:00",
                                            "last_updated": "2022-03-03T07:47:37.615105+00:00",
                                            "context": {
                                                "id": "a8213c5685eab4bee5a8c1815319d144",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "for": {
                                            "__type": "<class 'datetime.timedelta'>",
                                            "total_seconds": 60.0
                                        },
                                        "attribute": null,
                                        "description": "state of binary_sensor.playroom_motion"
                                    }
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T07:48:37.617061+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "913b8316e68670850be59d16b96c43f6",
                                        "parent_id": "a8213c5685eab4bee5a8c1815319d144",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "choice": 1
                                }
                            }
                        ],
                        "action/0/choose/0": [
                            {
                                "path": "action/0/choose/0",
                                "timestamp": "2022-03-03T07:48:37.617122+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/0/conditions/0",
                                "timestamp": "2022-03-03T07:48:37.617149+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/1": [
                            {
                                "path": "action/0/choose/1",
                                "timestamp": "2022-03-03T07:48:37.617193+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/1/conditions/0": [
                            {
                                "path": "action/0/choose/1/conditions/0",
                                "timestamp": "2022-03-03T07:48:37.617209+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/1/sequence/0": [
                            {
                                "path": "action/0/choose/1/sequence/0",
                                "timestamp": "2022-03-03T07:48:37.617505+00:00",
                                "result": {
                                    "params": {
                                        "domain": "light",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "light.playroom_lights"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ]
                    },
                    "config": {
                        "id": "1643642352545",
                        "alias": "Playroom Motion",
                        "description": "Control the Playroom Lights with Motion",
                        "trigger": [
                            {
                                "platform": "state",
                                "entity_id": "binary_sensor.playroom_motion",
                                "id": "motion",
                                "from": "off",
                                "to": "on"
                            },
                            {
                                "platform": "state",
                                "entity_id": "binary_sensor.playroom_motion",
                                "id": "no_motion",
                                "from": "on",
                                "to": "off",
                                "for": {
                                    "hours": 0,
                                    "minutes": 1,
                                    "seconds": 0
                                }
                            }
                        ],
                        "condition": [],
                        "action": [
                            {
                                "choose": [
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "motion"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "condition": "state",
                                                "entity_id": "switch.lights_auto_control",
                                                "state": "on"
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [
                                                            {
                                                                "condition": "time",
                                                                "before": "input_datetime.lights_auto_control_end",
                                                                "weekday": [
                                                                    "mon",
                                                                    "tue",
                                                                    "wed",
                                                                    "thu",
                                                                    "fri",
                                                                    "sat",
                                                                    "sun"
                                                                ],
                                                                "after": "input_datetime.wind_down"
                                                            }
                                                        ],
                                                        "sequence": [
                                                            {
                                                                "service": "light.turn_on",
                                                                "target": {
                                                                    "entity_id": "light.playroom_lights"
                                                                },
                                                                "data": {
                                                                    "brightness_pct": 5
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.playroom_lights"
                                                        },
                                                        "data": {
                                                            "brightness_pct": 100
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "no_motion"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "light.turn_off",
                                                "target": {
                                                    "entity_id": "light.playroom_lights"
                                                }
                                            }
                                        ]
                                    }
                                ],
                                "default": []
                            }
                        ],
                        "mode": "single"
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "913b8316e68670850be59d16b96c43f6",
                        "parent_id": "a8213c5685eab4bee5a8c1815319d144",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/0/choose/1/sequence/0",
                    "run_id": "f3e77dc96961886f9955cab2236d8e7a",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T07:48:37.616287+00:00",
                        "finish": "2022-03-03T07:48:37.807141+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643642352545",
                    "trigger": "state of binary_sensor.playroom_motion"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/0/choose/0/sequence/1/default/0",
                    "run_id": "f15b1cce248ab2f3e31af03edd68ddea",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T07:52:41.106399+00:00",
                        "finish": "2022-03-03T07:52:41.218661+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643642352545",
                    "trigger": "state of binary_sensor.playroom_motion",
                    "trace": {
                        "trigger/0": [
                            {
                                "path": "trigger/0",
                                "timestamp": "2022-03-03T07:52:41.106504+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.playroom_motion",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T07:48:37.616510+00:00",
                                            "mode": "single",
                                            "current": 0,
                                            "id": "1643642352545",
                                            "friendly_name": "Playroom Motion"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.798307+00:00",
                                        "last_updated": "2022-03-03T07:48:37.806781+00:00",
                                        "context": {
                                            "id": "913b8316e68670850be59d16b96c43f6",
                                            "parent_id": "a8213c5685eab4bee5a8c1815319d144",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "motion",
                                        "idx": "0",
                                        "platform": "state",
                                        "entity_id": "binary_sensor.playroom_motion",
                                        "from_state": {
                                            "entity_id": "binary_sensor.playroom_motion",
                                            "state": "off",
                                            "attributes": {
                                                "device_class": "motion",
                                                "friendly_name": "Playroom Motion"
                                            },
                                            "last_changed": "2022-03-03T07:47:37.615105+00:00",
                                            "last_updated": "2022-03-03T07:47:37.615105+00:00",
                                            "context": {
                                                "id": "a8213c5685eab4bee5a8c1815319d144",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "to_state": {
                                            "entity_id": "binary_sensor.playroom_motion",
                                            "state": "on",
                                            "attributes": {
                                                "device_class": "motion",
                                                "friendly_name": "Playroom Motion"
                                            },
                                            "last_changed": "2022-03-03T07:52:41.105799+00:00",
                                            "last_updated": "2022-03-03T07:52:41.105799+00:00",
                                            "context": {
                                                "id": "a3e7215642595c28395ed525d72e1bbb",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "for": null,
                                        "attribute": null,
                                        "description": "state of binary_sensor.playroom_motion"
                                    }
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T07:52:41.107116+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "ff1afa6f5b66554483e244d955459394",
                                        "parent_id": "a3e7215642595c28395ed525d72e1bbb",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "choice": 0
                                }
                            }
                        ],
                        "action/0/choose/0": [
                            {
                                "path": "action/0/choose/0",
                                "timestamp": "2022-03-03T07:52:41.107172+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/0/conditions/0",
                                "timestamp": "2022-03-03T07:52:41.107195+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/0": [
                            {
                                "path": "action/0/choose/0/sequence/0",
                                "timestamp": "2022-03-03T07:52:41.108260+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/0/entity_id/0": [
                            {
                                "path": "action/0/choose/0/sequence/0/entity_id/0",
                                "timestamp": "2022-03-03T07:52:41.108314+00:00",
                                "result": {
                                    "result": true,
                                    "state": "on",
                                    "wanted_state": "on"
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/1": [
                            {
                                "path": "action/0/choose/0/sequence/1",
                                "timestamp": "2022-03-03T07:52:41.108372+00:00",
                                "result": {
                                    "choice": "default"
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/1/choose/0": [
                            {
                                "path": "action/0/choose/0/sequence/1/choose/0",
                                "timestamp": "2022-03-03T07:52:41.108407+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/1/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/0/sequence/1/choose/0/conditions/0",
                                "timestamp": "2022-03-03T07:52:41.108422+00:00",
                                "result": {
                                    "after": {
                                        "__type": "<class 'datetime.time'>",
                                        "isoformat": "21:30:00"
                                    },
                                    "now_time": {
                                        "__type": "<class 'datetime.time'>",
                                        "isoformat": "15:52:41.108431"
                                    },
                                    "before": {
                                        "__type": "<class 'datetime.time'>",
                                        "isoformat": "07:00:00"
                                    },
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/1/default/0": [
                            {
                                "path": "action/0/choose/0/sequence/1/default/0",
                                "timestamp": "2022-03-03T07:52:41.108751+00:00",
                                "result": {
                                    "params": {
                                        "domain": "light",
                                        "service": "turn_on",
                                        "service_data": {
                                            "brightness_pct": 100,
                                            "entity_id": [
                                                "light.playroom_lights"
                                            ]
                                        },
                                        "target": {
                                            "entity_id": [
                                                "light.playroom_lights"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ]
                    },
                    "config": {
                        "id": "1643642352545",
                        "alias": "Playroom Motion",
                        "description": "Control the Playroom Lights with Motion",
                        "trigger": [
                            {
                                "platform": "state",
                                "entity_id": "binary_sensor.playroom_motion",
                                "id": "motion",
                                "from": "off",
                                "to": "on"
                            },
                            {
                                "platform": "state",
                                "entity_id": "binary_sensor.playroom_motion",
                                "id": "no_motion",
                                "from": "on",
                                "to": "off",
                                "for": {
                                    "hours": 0,
                                    "minutes": 1,
                                    "seconds": 0
                                }
                            }
                        ],
                        "condition": [],
                        "action": [
                            {
                                "choose": [
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "motion"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "condition": "state",
                                                "entity_id": "switch.lights_auto_control",
                                                "state": "on"
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [
                                                            {
                                                                "condition": "time",
                                                                "before": "input_datetime.lights_auto_control_end",
                                                                "weekday": [
                                                                    "mon",
                                                                    "tue",
                                                                    "wed",
                                                                    "thu",
                                                                    "fri",
                                                                    "sat",
                                                                    "sun"
                                                                ],
                                                                "after": "input_datetime.wind_down"
                                                            }
                                                        ],
                                                        "sequence": [
                                                            {
                                                                "service": "light.turn_on",
                                                                "target": {
                                                                    "entity_id": "light.playroom_lights"
                                                                },
                                                                "data": {
                                                                    "brightness_pct": 5
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.playroom_lights"
                                                        },
                                                        "data": {
                                                            "brightness_pct": 100
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "no_motion"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "light.turn_off",
                                                "target": {
                                                    "entity_id": "light.playroom_lights"
                                                }
                                            }
                                        ]
                                    }
                                ],
                                "default": []
                            }
                        ],
                        "mode": "single"
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "ff1afa6f5b66554483e244d955459394",
                        "parent_id": "a3e7215642595c28395ed525d72e1bbb",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/0/choose/0/sequence/1/default/0",
                    "run_id": "f15b1cce248ab2f3e31af03edd68ddea",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T07:52:41.106399+00:00",
                        "finish": "2022-03-03T07:52:41.218661+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643642352545",
                    "trigger": "state of binary_sensor.playroom_motion"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/0/choose/1/sequence/0",
                    "run_id": "40edcf244ae6854f4045eeecab7d1d42",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T07:55:17.402781+00:00",
                        "finish": "2022-03-03T07:55:17.533841+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643642352545",
                    "trigger": "state of binary_sensor.playroom_motion",
                    "trace": {
                        "trigger/1": [
                            {
                                "path": "trigger/1",
                                "timestamp": "2022-03-03T07:55:17.402887+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.playroom_motion",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T07:52:41.106624+00:00",
                                            "mode": "single",
                                            "current": 0,
                                            "id": "1643642352545",
                                            "friendly_name": "Playroom Motion"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.798307+00:00",
                                        "last_updated": "2022-03-03T07:52:41.218189+00:00",
                                        "context": {
                                            "id": "ff1afa6f5b66554483e244d955459394",
                                            "parent_id": "a3e7215642595c28395ed525d72e1bbb",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "no_motion",
                                        "idx": "1",
                                        "platform": "state",
                                        "entity_id": "binary_sensor.playroom_motion",
                                        "from_state": {
                                            "entity_id": "binary_sensor.playroom_motion",
                                            "state": "on",
                                            "attributes": {
                                                "device_class": "motion",
                                                "friendly_name": "Playroom Motion"
                                            },
                                            "last_changed": "2022-03-03T07:52:41.105799+00:00",
                                            "last_updated": "2022-03-03T07:52:41.105799+00:00",
                                            "context": {
                                                "id": "a3e7215642595c28395ed525d72e1bbb",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "to_state": {
                                            "entity_id": "binary_sensor.playroom_motion",
                                            "state": "off",
                                            "attributes": {
                                                "device_class": "motion",
                                                "friendly_name": "Playroom Motion"
                                            },
                                            "last_changed": "2022-03-03T07:54:17.401284+00:00",
                                            "last_updated": "2022-03-03T07:54:17.401284+00:00",
                                            "context": {
                                                "id": "8a2a577d76723fb285531a0aa9e3b4d2",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "for": {
                                            "__type": "<class 'datetime.timedelta'>",
                                            "total_seconds": 60.0
                                        },
                                        "attribute": null,
                                        "description": "state of binary_sensor.playroom_motion"
                                    }
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T07:55:17.403532+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "575dffff65a5f7df4a499001efea2757",
                                        "parent_id": "8a2a577d76723fb285531a0aa9e3b4d2",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "choice": 1
                                }
                            }
                        ],
                        "action/0/choose/0": [
                            {
                                "path": "action/0/choose/0",
                                "timestamp": "2022-03-03T07:55:17.403591+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/0/conditions/0",
                                "timestamp": "2022-03-03T07:55:17.403617+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/1": [
                            {
                                "path": "action/0/choose/1",
                                "timestamp": "2022-03-03T07:55:17.403660+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/1/conditions/0": [
                            {
                                "path": "action/0/choose/1/conditions/0",
                                "timestamp": "2022-03-03T07:55:17.403677+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/1/sequence/0": [
                            {
                                "path": "action/0/choose/1/sequence/0",
                                "timestamp": "2022-03-03T07:55:17.404409+00:00",
                                "result": {
                                    "params": {
                                        "domain": "light",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "light.playroom_lights"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ]
                    },
                    "config": {
                        "id": "1643642352545",
                        "alias": "Playroom Motion",
                        "description": "Control the Playroom Lights with Motion",
                        "trigger": [
                            {
                                "platform": "state",
                                "entity_id": "binary_sensor.playroom_motion",
                                "id": "motion",
                                "from": "off",
                                "to": "on"
                            },
                            {
                                "platform": "state",
                                "entity_id": "binary_sensor.playroom_motion",
                                "id": "no_motion",
                                "from": "on",
                                "to": "off",
                                "for": {
                                    "hours": 0,
                                    "minutes": 1,
                                    "seconds": 0
                                }
                            }
                        ],
                        "condition": [],
                        "action": [
                            {
                                "choose": [
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "motion"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "condition": "state",
                                                "entity_id": "switch.lights_auto_control",
                                                "state": "on"
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [
                                                            {
                                                                "condition": "time",
                                                                "before": "input_datetime.lights_auto_control_end",
                                                                "weekday": [
                                                                    "mon",
                                                                    "tue",
                                                                    "wed",
                                                                    "thu",
                                                                    "fri",
                                                                    "sat",
                                                                    "sun"
                                                                ],
                                                                "after": "input_datetime.wind_down"
                                                            }
                                                        ],
                                                        "sequence": [
                                                            {
                                                                "service": "light.turn_on",
                                                                "target": {
                                                                    "entity_id": "light.playroom_lights"
                                                                },
                                                                "data": {
                                                                    "brightness_pct": 5
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.playroom_lights"
                                                        },
                                                        "data": {
                                                            "brightness_pct": 100
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "no_motion"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "light.turn_off",
                                                "target": {
                                                    "entity_id": "light.playroom_lights"
                                                }
                                            }
                                        ]
                                    }
                                ],
                                "default": []
                            }
                        ],
                        "mode": "single"
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "575dffff65a5f7df4a499001efea2757",
                        "parent_id": "8a2a577d76723fb285531a0aa9e3b4d2",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/0/choose/1/sequence/0",
                    "run_id": "40edcf244ae6854f4045eeecab7d1d42",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T07:55:17.402781+00:00",
                        "finish": "2022-03-03T07:55:17.533841+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643642352545",
                    "trigger": "state of binary_sensor.playroom_motion"
                }
            }
        ],
        "automation.1643643631965": [
            {
                "extended_dict": {
                    "last_step": "action/3/choose/1/sequence/1/default/0/0",
                    "run_id": "e883ed4864e0f6c51c3c33669e942d17",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T01:56:40.847184+00:00",
                        "finish": "2022-03-03T01:56:40.866609+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643643631965",
                    "trigger": "event 'zha_event'",
                    "trace": {
                        "trigger/1": [
                            {
                                "path": "trigger/1",
                                "timestamp": "2022-03-03T01:56:40.847930+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.dining_room_fan_controller",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T01:56:36.072252+00:00",
                                            "mode": "restart",
                                            "current": 0,
                                            "id": "1643643631965",
                                            "friendly_name": "Dining Room Fan Controller"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.798638+00:00",
                                        "last_updated": "2022-03-03T01:56:36.088600+00:00",
                                        "context": {
                                            "id": "14fd77e5d516b1dafa1cde83bca48bad",
                                            "parent_id": "9592c932bd24f67e7310dbfeae23e59a",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "1",
                                        "idx": "1",
                                        "platform": "event",
                                        "event": {
                                            "event_type": "zha_event",
                                            "data": {
                                                "device_ieee": "84:fd:27:ff:fe:9f:11:87",
                                                "unique_id": "84:fd:27:ff:fe:9f:11:87:1:0x0008",
                                                "device_id": "2c65aa31e07cc74bcef34dfa0d22d784",
                                                "endpoint_id": 1,
                                                "cluster_id": 8,
                                                "command": "move_with_on_off",
                                                "args": [
                                                    0,
                                                    83
                                                ]
                                            },
                                            "origin": "LOCAL",
                                            "time_fired": "2022-03-03T01:56:40.846506+00:00",
                                            "context": {
                                                "id": "b4effce409316ff07fd2865f0479c699",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "description": "event 'zha_event'"
                                    },
                                    "integration": "ZHA",
                                    "button_up_long_loop": false,
                                    "button_up_long_max_loop_repeats": 500,
                                    "button_up_double_press": false,
                                    "button_down_long_loop": false,
                                    "button_down_long_max_loop_repeats": 500,
                                    "button_down_double_press": false,
                                    "helper_last_controller_event": "input_text.zz_dining_room_fan_controller_last_event",
                                    "helper_double_press_delay": 500,
                                    "helper_debounce_delay": 0,
                                    "integration_id": "zha",
                                    "adjusted_double_press_delay": 500,
                                    "actions_mapping": {
                                        "deconz": {
                                            "button_up_short": [
                                                "1002"
                                            ],
                                            "button_up_long": [
                                                "1001"
                                            ],
                                            "button_up_release": [
                                                "1003"
                                            ],
                                            "button_down_short": [
                                                "2002"
                                            ],
                                            "button_down_long": [
                                                "2001"
                                            ],
                                            "button_down_release": [
                                                "2003"
                                            ]
                                        },
                                        "zha": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "move_with_on_off_0_83"
                                            ],
                                            "button_up_release": [
                                                "stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "move_1_83"
                                            ],
                                            "button_down_release": [
                                                "stop"
                                            ]
                                        },
                                        "zigbee2mqtt": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "brightness_move_up"
                                            ],
                                            "button_up_release": [
                                                "brightness_stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "brightness_move_down"
                                            ],
                                            "button_down_release": [
                                                "brightness_stop"
                                            ]
                                        }
                                    },
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ],
                                    "integrations_with_prev_event_storage": [
                                        "zha",
                                        "zigbee2mqtt"
                                    ],
                                    "controller_entity": "",
                                    "controller_device": "2c65aa31e07cc74bcef34dfa0d22d784",
                                    "controller_id": "2c65aa31e07cc74bcef34dfa0d22d784"
                                }
                            }
                        ],
                        "condition/0": [
                            {
                                "path": "condition/0",
                                "timestamp": "2022-03-03T01:56:40.847960+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "condition/0/conditions/0": [
                            {
                                "path": "condition/0/conditions/0",
                                "timestamp": "2022-03-03T01:56:40.847980+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "condition/0/conditions/1": [
                            {
                                "path": "condition/0/conditions/1",
                                "timestamp": "2022-03-03T01:56:40.848121+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T01:56:40.848922+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "2db49dd90834b2ee84c3c912db61807f",
                                        "parent_id": "b4effce409316ff07fd2865f0479c699",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "delay": 0.0,
                                    "done": true
                                }
                            }
                        ],
                        "action/1": [
                            {
                                "path": "action/1",
                                "timestamp": "2022-03-03T01:56:40.850128+00:00"
                            }
                        ],
                        "action/2": [
                            {
                                "path": "action/2",
                                "timestamp": "2022-03-03T01:56:40.850812+00:00",
                                "changed_variables": {
                                    "trigger_action": "move_with_on_off_0_83",
                                    "trigger_delta": 4775.8588790893555,
                                    "last_controller_event": "on"
                                },
                                "result": {
                                    "params": {
                                        "domain": "input_text",
                                        "service": "set_value",
                                        "service_data": {
                                            "entity_id": "input_text.zz_dining_room_fan_controller_last_event",
                                            "value": {
                                                "trigger_action": "move_with_on_off_0_83",
                                                "last_triggered": "2022-03-03 09:56:40.850943+08:00"
                                            }
                                        },
                                        "target": {}
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "action/3": [
                            {
                                "path": "action/3",
                                "timestamp": "2022-03-03T01:56:40.853298+00:00",
                                "result": {
                                    "choice": 1
                                }
                            }
                        ],
                        "action/3/choose/0": [
                            {
                                "path": "action/3/choose/0",
                                "timestamp": "2022-03-03T01:56:40.853357+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/0/conditions/0": [
                            {
                                "path": "action/3/choose/0/conditions/0",
                                "timestamp": "2022-03-03T01:56:40.853381+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/1": [
                            {
                                "path": "action/3/choose/1",
                                "timestamp": "2022-03-03T01:56:40.853489+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/3/choose/1/conditions/0": [
                            {
                                "path": "action/3/choose/1/conditions/0",
                                "timestamp": "2022-03-03T01:56:40.853511+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/1/sequence/0": [
                            {
                                "path": "action/3/choose/1/sequence/0",
                                "timestamp": "2022-03-03T01:56:40.853834+00:00",
                                "result": {
                                    "event": "ahb_controller_event",
                                    "event_data": {
                                        "controller": "2c65aa31e07cc74bcef34dfa0d22d784",
                                        "action": "button_up_long"
                                    }
                                }
                            }
                        ],
                        "action/3/choose/1/sequence/1": [
                            {
                                "path": "action/3/choose/1/sequence/1",
                                "timestamp": "2022-03-03T01:56:40.854048+00:00",
                                "result": {
                                    "choice": "default"
                                }
                            }
                        ],
                        "action/3/choose/1/sequence/1/choose/0": [
                            {
                                "path": "action/3/choose/1/sequence/1/choose/0",
                                "timestamp": "2022-03-03T01:56:40.854197+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/1/sequence/1/choose/0/conditions/0": [
                            {
                                "path": "action/3/choose/1/sequence/1/choose/0/conditions/0",
                                "timestamp": "2022-03-03T01:56:40.854219+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/1/sequence/1/default/0": [
                            {
                                "path": "action/3/choose/1/sequence/1/default/0",
                                "timestamp": "2022-03-03T01:56:40.854615+00:00",
                                "result": {
                                    "params": {
                                        "domain": "fan",
                                        "service": "increase_speed",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "fan.dining_room_fan"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "action/3/choose/1/sequence/1/default/0/0": [
                            {
                                "path": "action/3/choose/1/sequence/1/default/0/0",
                                "timestamp": "2022-03-03T01:56:40.855401+00:00",
                                "child_id": {
                                    "domain": "automation",
                                    "item_id": "1642997460354",
                                    "run_id": "de7e2c74f34ed39dfe68962e51e0d138"
                                },
                                "changed_variables": {
                                    "percentage": 16
                                },
                                "result": {
                                    "params": {
                                        "domain": "input_number",
                                        "service": "set_value",
                                        "service_data": {
                                            "value": 16,
                                            "entity_id": [
                                                "input_number.dining_room_fan_speed"
                                            ]
                                        },
                                        "target": {
                                            "entity_id": [
                                                "input_number.dining_room_fan_speed"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ]
                    },
                    "config": {
                        "variables": {
                            "integration": "ZHA",
                            "button_up_long_loop": false,
                            "button_up_long_max_loop_repeats": 500,
                            "button_up_double_press": false,
                            "button_down_long_loop": false,
                            "button_down_long_max_loop_repeats": 500,
                            "button_down_double_press": false,
                            "helper_last_controller_event": "input_text.zz_dining_room_fan_controller_last_event",
                            "helper_double_press_delay": 500,
                            "helper_debounce_delay": 0,
                            "integration_id": "{{ integration | lower }}",
                            "adjusted_double_press_delay": "{{ [helper_double_press_delay - helper_debounce_delay, 100] | max }}",
                            "actions_mapping": {
                                "deconz": {
                                    "button_up_short": [
                                        "1002"
                                    ],
                                    "button_up_long": [
                                        "1001"
                                    ],
                                    "button_up_release": [
                                        "1003"
                                    ],
                                    "button_down_short": [
                                        "2002"
                                    ],
                                    "button_down_long": [
                                        "2001"
                                    ],
                                    "button_down_release": [
                                        "2003"
                                    ]
                                },
                                "zha": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ]
                                },
                                "zigbee2mqtt": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "brightness_move_up"
                                    ],
                                    "button_up_release": [
                                        "brightness_stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "brightness_move_down"
                                    ],
                                    "button_down_release": [
                                        "brightness_stop"
                                    ]
                                }
                            },
                            "button_up_short": "{{ actions_mapping[integration_id][\"button_up_short\"] }}",
                            "button_up_long": "{{ actions_mapping[integration_id][\"button_up_long\"] }}",
                            "button_up_release": "{{ actions_mapping[integration_id][\"button_up_release\"] }}",
                            "button_down_short": "{{ actions_mapping[integration_id][\"button_down_short\"] }}",
                            "button_down_long": "{{ actions_mapping[integration_id][\"button_down_long\"] }}",
                            "button_down_release": "{{ actions_mapping[integration_id][\"button_down_release\"] }}",
                            "integrations_with_prev_event_storage": [
                                "zha",
                                "zigbee2mqtt"
                            ],
                            "controller_entity": "",
                            "controller_device": "2c65aa31e07cc74bcef34dfa0d22d784",
                            "controller_id": "{% if integration_id==\"zigbee2mqtt\" %}{{controller_entity}}{% else %}{{controller_device}}{% endif %}"
                        },
                        "mode": "restart",
                        "max_exceeded": "silent",
                        "trigger": [
                            {
                                "platform": "event",
                                "event_type": "state_changed",
                                "event_data": {
                                    "entity_id": ""
                                }
                            },
                            {
                                "platform": "event",
                                "event_type": [
                                    "deconz_event",
                                    "zha_event"
                                ],
                                "event_data": {
                                    "device_id": "2c65aa31e07cc74bcef34dfa0d22d784"
                                }
                            }
                        ],
                        "condition": [
                            {
                                "condition": "and",
                                "conditions": [
                                    "{%- set trigger_action -%} {%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%} {%- endset -%} {{ trigger_action not in [\"\",\"None\"] }}",
                                    "{{ integration_id != \"zigbee2mqtt\" or trigger.event.data.new_state.state != trigger.event.data.old_state.state }}"
                                ]
                            }
                        ],
                        "action": [
                            {
                                "delay": {
                                    "milliseconds": 0
                                }
                            },
                            {
                                "variables": {
                                    "trigger_action": "{%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%}",
                                    "trigger_delta": "{{ (as_timestamp(now()) - as_timestamp((states(helper_last_controller_event) | from_json).last_triggered if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"1970-01-01 00:00:00\")) * 1000 }}",
                                    "last_controller_event": "{{ (states(helper_last_controller_event) | from_json).trigger_action if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"\" }}"
                                }
                            },
                            {
                                "service": "input_text.set_value",
                                "data": {
                                    "entity_id": "input_text.zz_dining_room_fan_controller_last_event",
                                    "value": "{{ {\"trigger_action\":trigger_action,\"last_triggered\":now()|string} | to_json }}"
                                }
                            },
                            {
                                "choose": [
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_dining_room_fan_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_up_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_up_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "fan.turn_on",
                                                                                        "target": {
                                                                                            "entity_id": "fan.dining_room_fan"
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_up_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "fan.turn_on",
                                                                        "target": {
                                                                            "entity_id": "fan.dining_room_fan"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_up_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "fan.increase_speed",
                                                                            "target": {
                                                                                "entity_id": "fan.dining_room_fan"
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "fan.increase_speed",
                                                        "target": {
                                                            "entity_id": "fan.dining_room_fan"
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_up_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_up_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_dining_room_fan_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_down_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_down_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "fan.turn_off",
                                                                                        "target": {
                                                                                            "entity_id": "fan.dining_room_fan"
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_down_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "fan.turn_off",
                                                                        "target": {
                                                                            "entity_id": "fan.dining_room_fan"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_down_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "fan.decrease_speed",
                                                                            "target": {
                                                                                "entity_id": "fan.dining_room_fan"
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "fan.decrease_speed",
                                                        "target": {
                                                            "entity_id": "fan.dining_room_fan"
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_down_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_down_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            }
                        ],
                        "id": "1643643631965",
                        "alias": "Dining Room Fan Controller",
                        "description": "Control the Dining Room Fan"
                    },
                    "blueprint_inputs": {
                        "id": "1643643631965",
                        "alias": "Dining Room Fan Controller",
                        "description": "Control the Dining Room Fan",
                        "use_blueprint": {
                            "path": "EPMatt/ikea_e1743.yaml",
                            "input": {
                                "integration": "ZHA",
                                "controller_device": "2c65aa31e07cc74bcef34dfa0d22d784",
                                "helper_last_controller_event": "input_text.zz_dining_room_fan_controller_last_event",
                                "action_button_up_short": [
                                    {
                                        "service": "fan.turn_on",
                                        "target": {
                                            "entity_id": "fan.dining_room_fan"
                                        }
                                    }
                                ],
                                "action_button_down_short": [
                                    {
                                        "service": "fan.turn_off",
                                        "target": {
                                            "entity_id": "fan.dining_room_fan"
                                        }
                                    }
                                ],
                                "action_button_down_long": [
                                    {
                                        "service": "fan.decrease_speed",
                                        "target": {
                                            "entity_id": "fan.dining_room_fan"
                                        }
                                    }
                                ],
                                "action_button_up_long": [
                                    {
                                        "service": "fan.increase_speed",
                                        "target": {
                                            "entity_id": "fan.dining_room_fan"
                                        }
                                    }
                                ]
                            }
                        }
                    },
                    "context": {
                        "id": "2db49dd90834b2ee84c3c912db61807f",
                        "parent_id": "b4effce409316ff07fd2865f0479c699",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/3/choose/1/sequence/1/default/0/0",
                    "run_id": "e883ed4864e0f6c51c3c33669e942d17",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T01:56:40.847184+00:00",
                        "finish": "2022-03-03T01:56:40.866609+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643643631965",
                    "trigger": "event 'zha_event'"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/3/choose/2/sequence/1/choose/0",
                    "run_id": "57995b2976235d6755d609e52bca91fa",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T01:56:41.243949+00:00",
                        "finish": "2022-03-03T01:56:41.251831+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643643631965",
                    "trigger": "event 'zha_event'",
                    "trace": {
                        "trigger/1": [
                            {
                                "path": "trigger/1",
                                "timestamp": "2022-03-03T01:56:41.244574+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.dining_room_fan_controller",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T01:56:40.848301+00:00",
                                            "mode": "restart",
                                            "current": 0,
                                            "id": "1643643631965",
                                            "friendly_name": "Dining Room Fan Controller"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.798638+00:00",
                                        "last_updated": "2022-03-03T01:56:40.865203+00:00",
                                        "context": {
                                            "id": "2db49dd90834b2ee84c3c912db61807f",
                                            "parent_id": "b4effce409316ff07fd2865f0479c699",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "1",
                                        "idx": "1",
                                        "platform": "event",
                                        "event": {
                                            "event_type": "zha_event",
                                            "data": {
                                                "device_ieee": "84:fd:27:ff:fe:9f:11:87",
                                                "unique_id": "84:fd:27:ff:fe:9f:11:87:1:0x0008",
                                                "device_id": "2c65aa31e07cc74bcef34dfa0d22d784",
                                                "endpoint_id": 1,
                                                "cluster_id": 8,
                                                "command": "stop",
                                                "args": []
                                            },
                                            "origin": "LOCAL",
                                            "time_fired": "2022-03-03T01:56:41.243331+00:00",
                                            "context": {
                                                "id": "a327882cef1c72b16f264eb885f0508c",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "description": "event 'zha_event'"
                                    },
                                    "integration": "ZHA",
                                    "button_up_long_loop": false,
                                    "button_up_long_max_loop_repeats": 500,
                                    "button_up_double_press": false,
                                    "button_down_long_loop": false,
                                    "button_down_long_max_loop_repeats": 500,
                                    "button_down_double_press": false,
                                    "helper_last_controller_event": "input_text.zz_dining_room_fan_controller_last_event",
                                    "helper_double_press_delay": 500,
                                    "helper_debounce_delay": 0,
                                    "integration_id": "zha",
                                    "adjusted_double_press_delay": 500,
                                    "actions_mapping": {
                                        "deconz": {
                                            "button_up_short": [
                                                "1002"
                                            ],
                                            "button_up_long": [
                                                "1001"
                                            ],
                                            "button_up_release": [
                                                "1003"
                                            ],
                                            "button_down_short": [
                                                "2002"
                                            ],
                                            "button_down_long": [
                                                "2001"
                                            ],
                                            "button_down_release": [
                                                "2003"
                                            ]
                                        },
                                        "zha": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "move_with_on_off_0_83"
                                            ],
                                            "button_up_release": [
                                                "stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "move_1_83"
                                            ],
                                            "button_down_release": [
                                                "stop"
                                            ]
                                        },
                                        "zigbee2mqtt": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "brightness_move_up"
                                            ],
                                            "button_up_release": [
                                                "brightness_stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "brightness_move_down"
                                            ],
                                            "button_down_release": [
                                                "brightness_stop"
                                            ]
                                        }
                                    },
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ],
                                    "integrations_with_prev_event_storage": [
                                        "zha",
                                        "zigbee2mqtt"
                                    ],
                                    "controller_entity": "",
                                    "controller_device": "2c65aa31e07cc74bcef34dfa0d22d784",
                                    "controller_id": "2c65aa31e07cc74bcef34dfa0d22d784"
                                }
                            }
                        ],
                        "condition/0": [
                            {
                                "path": "condition/0",
                                "timestamp": "2022-03-03T01:56:41.244610+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "condition/0/conditions/0": [
                            {
                                "path": "condition/0/conditions/0",
                                "timestamp": "2022-03-03T01:56:41.244630+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "condition/0/conditions/1": [
                            {
                                "path": "condition/0/conditions/1",
                                "timestamp": "2022-03-03T01:56:41.244802+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T01:56:41.245494+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "72540fa5afa1661bdf544b9133d48f72",
                                        "parent_id": "a327882cef1c72b16f264eb885f0508c",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "delay": 0.0,
                                    "done": true
                                }
                            }
                        ],
                        "action/1": [
                            {
                                "path": "action/1",
                                "timestamp": "2022-03-03T01:56:41.246547+00:00"
                            }
                        ],
                        "action/2": [
                            {
                                "path": "action/2",
                                "timestamp": "2022-03-03T01:56:41.247190+00:00",
                                "changed_variables": {
                                    "trigger_action": "stop",
                                    "trigger_delta": 395.9038257598877,
                                    "last_controller_event": "move_with_on_off_0_83"
                                },
                                "result": {
                                    "params": {
                                        "domain": "input_text",
                                        "service": "set_value",
                                        "service_data": {
                                            "entity_id": "input_text.zz_dining_room_fan_controller_last_event",
                                            "value": {
                                                "trigger_action": "stop",
                                                "last_triggered": "2022-03-03 09:56:41.247298+08:00"
                                            }
                                        },
                                        "target": {}
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "action/3": [
                            {
                                "path": "action/3",
                                "timestamp": "2022-03-03T01:56:41.249253+00:00",
                                "result": {
                                    "choice": 2
                                }
                            }
                        ],
                        "action/3/choose/0": [
                            {
                                "path": "action/3/choose/0",
                                "timestamp": "2022-03-03T01:56:41.249305+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/0/conditions/0": [
                            {
                                "path": "action/3/choose/0/conditions/0",
                                "timestamp": "2022-03-03T01:56:41.249326+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/1": [
                            {
                                "path": "action/3/choose/1",
                                "timestamp": "2022-03-03T01:56:41.249422+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/1/conditions/0": [
                            {
                                "path": "action/3/choose/1/conditions/0",
                                "timestamp": "2022-03-03T01:56:41.249442+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/2": [
                            {
                                "path": "action/3/choose/2",
                                "timestamp": "2022-03-03T01:56:41.249512+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/3/choose/2/conditions/0": [
                            {
                                "path": "action/3/choose/2/conditions/0",
                                "timestamp": "2022-03-03T01:56:41.249529+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/2/conditions/1": [
                            {
                                "path": "action/3/choose/2/conditions/1",
                                "timestamp": "2022-03-03T01:56:41.249587+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/2/sequence/0": [
                            {
                                "path": "action/3/choose/2/sequence/0",
                                "timestamp": "2022-03-03T01:56:41.249973+00:00",
                                "result": {
                                    "event": "ahb_controller_event",
                                    "event_data": {
                                        "controller": "2c65aa31e07cc74bcef34dfa0d22d784",
                                        "action": "button_up_release"
                                    }
                                }
                            }
                        ],
                        "action/3/choose/2/sequence/1": [
                            {
                                "path": "action/3/choose/2/sequence/1",
                                "timestamp": "2022-03-03T01:56:41.250154+00:00",
                                "result": {
                                    "choice": 0
                                }
                            }
                        ],
                        "action/3/choose/2/sequence/1/choose/0": [
                            {
                                "path": "action/3/choose/2/sequence/1/choose/0",
                                "timestamp": "2022-03-03T01:56:41.250234+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ]
                    },
                    "config": {
                        "variables": {
                            "integration": "ZHA",
                            "button_up_long_loop": false,
                            "button_up_long_max_loop_repeats": 500,
                            "button_up_double_press": false,
                            "button_down_long_loop": false,
                            "button_down_long_max_loop_repeats": 500,
                            "button_down_double_press": false,
                            "helper_last_controller_event": "input_text.zz_dining_room_fan_controller_last_event",
                            "helper_double_press_delay": 500,
                            "helper_debounce_delay": 0,
                            "integration_id": "{{ integration | lower }}",
                            "adjusted_double_press_delay": "{{ [helper_double_press_delay - helper_debounce_delay, 100] | max }}",
                            "actions_mapping": {
                                "deconz": {
                                    "button_up_short": [
                                        "1002"
                                    ],
                                    "button_up_long": [
                                        "1001"
                                    ],
                                    "button_up_release": [
                                        "1003"
                                    ],
                                    "button_down_short": [
                                        "2002"
                                    ],
                                    "button_down_long": [
                                        "2001"
                                    ],
                                    "button_down_release": [
                                        "2003"
                                    ]
                                },
                                "zha": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ]
                                },
                                "zigbee2mqtt": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "brightness_move_up"
                                    ],
                                    "button_up_release": [
                                        "brightness_stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "brightness_move_down"
                                    ],
                                    "button_down_release": [
                                        "brightness_stop"
                                    ]
                                }
                            },
                            "button_up_short": "{{ actions_mapping[integration_id][\"button_up_short\"] }}",
                            "button_up_long": "{{ actions_mapping[integration_id][\"button_up_long\"] }}",
                            "button_up_release": "{{ actions_mapping[integration_id][\"button_up_release\"] }}",
                            "button_down_short": "{{ actions_mapping[integration_id][\"button_down_short\"] }}",
                            "button_down_long": "{{ actions_mapping[integration_id][\"button_down_long\"] }}",
                            "button_down_release": "{{ actions_mapping[integration_id][\"button_down_release\"] }}",
                            "integrations_with_prev_event_storage": [
                                "zha",
                                "zigbee2mqtt"
                            ],
                            "controller_entity": "",
                            "controller_device": "2c65aa31e07cc74bcef34dfa0d22d784",
                            "controller_id": "{% if integration_id==\"zigbee2mqtt\" %}{{controller_entity}}{% else %}{{controller_device}}{% endif %}"
                        },
                        "mode": "restart",
                        "max_exceeded": "silent",
                        "trigger": [
                            {
                                "platform": "event",
                                "event_type": "state_changed",
                                "event_data": {
                                    "entity_id": ""
                                }
                            },
                            {
                                "platform": "event",
                                "event_type": [
                                    "deconz_event",
                                    "zha_event"
                                ],
                                "event_data": {
                                    "device_id": "2c65aa31e07cc74bcef34dfa0d22d784"
                                }
                            }
                        ],
                        "condition": [
                            {
                                "condition": "and",
                                "conditions": [
                                    "{%- set trigger_action -%} {%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%} {%- endset -%} {{ trigger_action not in [\"\",\"None\"] }}",
                                    "{{ integration_id != \"zigbee2mqtt\" or trigger.event.data.new_state.state != trigger.event.data.old_state.state }}"
                                ]
                            }
                        ],
                        "action": [
                            {
                                "delay": {
                                    "milliseconds": 0
                                }
                            },
                            {
                                "variables": {
                                    "trigger_action": "{%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%}",
                                    "trigger_delta": "{{ (as_timestamp(now()) - as_timestamp((states(helper_last_controller_event) | from_json).last_triggered if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"1970-01-01 00:00:00\")) * 1000 }}",
                                    "last_controller_event": "{{ (states(helper_last_controller_event) | from_json).trigger_action if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"\" }}"
                                }
                            },
                            {
                                "service": "input_text.set_value",
                                "data": {
                                    "entity_id": "input_text.zz_dining_room_fan_controller_last_event",
                                    "value": "{{ {\"trigger_action\":trigger_action,\"last_triggered\":now()|string} | to_json }}"
                                }
                            },
                            {
                                "choose": [
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_dining_room_fan_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_up_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_up_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "fan.turn_on",
                                                                                        "target": {
                                                                                            "entity_id": "fan.dining_room_fan"
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_up_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "fan.turn_on",
                                                                        "target": {
                                                                            "entity_id": "fan.dining_room_fan"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_up_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "fan.increase_speed",
                                                                            "target": {
                                                                                "entity_id": "fan.dining_room_fan"
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "fan.increase_speed",
                                                        "target": {
                                                            "entity_id": "fan.dining_room_fan"
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_up_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_up_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_dining_room_fan_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_down_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_down_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "fan.turn_off",
                                                                                        "target": {
                                                                                            "entity_id": "fan.dining_room_fan"
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_down_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "fan.turn_off",
                                                                        "target": {
                                                                            "entity_id": "fan.dining_room_fan"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_down_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "fan.decrease_speed",
                                                                            "target": {
                                                                                "entity_id": "fan.dining_room_fan"
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "fan.decrease_speed",
                                                        "target": {
                                                            "entity_id": "fan.dining_room_fan"
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_down_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_down_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            }
                        ],
                        "id": "1643643631965",
                        "alias": "Dining Room Fan Controller",
                        "description": "Control the Dining Room Fan"
                    },
                    "blueprint_inputs": {
                        "id": "1643643631965",
                        "alias": "Dining Room Fan Controller",
                        "description": "Control the Dining Room Fan",
                        "use_blueprint": {
                            "path": "EPMatt/ikea_e1743.yaml",
                            "input": {
                                "integration": "ZHA",
                                "controller_device": "2c65aa31e07cc74bcef34dfa0d22d784",
                                "helper_last_controller_event": "input_text.zz_dining_room_fan_controller_last_event",
                                "action_button_up_short": [
                                    {
                                        "service": "fan.turn_on",
                                        "target": {
                                            "entity_id": "fan.dining_room_fan"
                                        }
                                    }
                                ],
                                "action_button_down_short": [
                                    {
                                        "service": "fan.turn_off",
                                        "target": {
                                            "entity_id": "fan.dining_room_fan"
                                        }
                                    }
                                ],
                                "action_button_down_long": [
                                    {
                                        "service": "fan.decrease_speed",
                                        "target": {
                                            "entity_id": "fan.dining_room_fan"
                                        }
                                    }
                                ],
                                "action_button_up_long": [
                                    {
                                        "service": "fan.increase_speed",
                                        "target": {
                                            "entity_id": "fan.dining_room_fan"
                                        }
                                    }
                                ]
                            }
                        }
                    },
                    "context": {
                        "id": "72540fa5afa1661bdf544b9133d48f72",
                        "parent_id": "a327882cef1c72b16f264eb885f0508c",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/3/choose/2/sequence/1/choose/0",
                    "run_id": "57995b2976235d6755d609e52bca91fa",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T01:56:41.243949+00:00",
                        "finish": "2022-03-03T01:56:41.251831+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643643631965",
                    "trigger": "event 'zha_event'"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/3/choose/0/sequence/0/default/1/choose/0/sequence/0/0",
                    "run_id": "fb7651789b4834b0222d8870024f40bf",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:44:44.415299+00:00",
                        "finish": "2022-03-03T05:44:44.429152+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643643631965",
                    "trigger": "event 'zha_event'",
                    "trace": {
                        "trigger/1": [
                            {
                                "path": "trigger/1",
                                "timestamp": "2022-03-03T05:44:44.416034+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.dining_room_fan_controller",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T01:56:41.244962+00:00",
                                            "mode": "restart",
                                            "current": 0,
                                            "id": "1643643631965",
                                            "friendly_name": "Dining Room Fan Controller"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.798638+00:00",
                                        "last_updated": "2022-03-03T01:56:41.250941+00:00",
                                        "context": {
                                            "id": "72540fa5afa1661bdf544b9133d48f72",
                                            "parent_id": "a327882cef1c72b16f264eb885f0508c",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "1",
                                        "idx": "1",
                                        "platform": "event",
                                        "event": {
                                            "event_type": "zha_event",
                                            "data": {
                                                "device_ieee": "84:fd:27:ff:fe:9f:11:87",
                                                "unique_id": "84:fd:27:ff:fe:9f:11:87:1:0x0006",
                                                "device_id": "2c65aa31e07cc74bcef34dfa0d22d784",
                                                "endpoint_id": 1,
                                                "cluster_id": 6,
                                                "command": "on",
                                                "args": []
                                            },
                                            "origin": "LOCAL",
                                            "time_fired": "2022-03-03T05:44:44.414202+00:00",
                                            "context": {
                                                "id": "c53ff127fbb554733efe369026b7ab36",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "description": "event 'zha_event'"
                                    },
                                    "integration": "ZHA",
                                    "button_up_long_loop": false,
                                    "button_up_long_max_loop_repeats": 500,
                                    "button_up_double_press": false,
                                    "button_down_long_loop": false,
                                    "button_down_long_max_loop_repeats": 500,
                                    "button_down_double_press": false,
                                    "helper_last_controller_event": "input_text.zz_dining_room_fan_controller_last_event",
                                    "helper_double_press_delay": 500,
                                    "helper_debounce_delay": 0,
                                    "integration_id": "zha",
                                    "adjusted_double_press_delay": 500,
                                    "actions_mapping": {
                                        "deconz": {
                                            "button_up_short": [
                                                "1002"
                                            ],
                                            "button_up_long": [
                                                "1001"
                                            ],
                                            "button_up_release": [
                                                "1003"
                                            ],
                                            "button_down_short": [
                                                "2002"
                                            ],
                                            "button_down_long": [
                                                "2001"
                                            ],
                                            "button_down_release": [
                                                "2003"
                                            ]
                                        },
                                        "zha": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "move_with_on_off_0_83"
                                            ],
                                            "button_up_release": [
                                                "stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "move_1_83"
                                            ],
                                            "button_down_release": [
                                                "stop"
                                            ]
                                        },
                                        "zigbee2mqtt": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "brightness_move_up"
                                            ],
                                            "button_up_release": [
                                                "brightness_stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "brightness_move_down"
                                            ],
                                            "button_down_release": [
                                                "brightness_stop"
                                            ]
                                        }
                                    },
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ],
                                    "integrations_with_prev_event_storage": [
                                        "zha",
                                        "zigbee2mqtt"
                                    ],
                                    "controller_entity": "",
                                    "controller_device": "2c65aa31e07cc74bcef34dfa0d22d784",
                                    "controller_id": "2c65aa31e07cc74bcef34dfa0d22d784"
                                }
                            }
                        ],
                        "condition/0": [
                            {
                                "path": "condition/0",
                                "timestamp": "2022-03-03T05:44:44.416079+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "condition/0/conditions/0": [
                            {
                                "path": "condition/0/conditions/0",
                                "timestamp": "2022-03-03T05:44:44.416097+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "condition/0/conditions/1": [
                            {
                                "path": "condition/0/conditions/1",
                                "timestamp": "2022-03-03T05:44:44.416244+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T05:44:44.416801+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "4de2f4d60fa5bfc044f0b7e479e169f0",
                                        "parent_id": "c53ff127fbb554733efe369026b7ab36",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "delay": 0.0,
                                    "done": true
                                }
                            }
                        ],
                        "action/1": [
                            {
                                "path": "action/1",
                                "timestamp": "2022-03-03T05:44:44.417168+00:00"
                            }
                        ],
                        "action/2": [
                            {
                                "path": "action/2",
                                "timestamp": "2022-03-03T05:44:44.417664+00:00",
                                "changed_variables": {
                                    "trigger_action": "on",
                                    "trigger_delta": 13683170.068979263,
                                    "last_controller_event": "stop"
                                },
                                "result": {
                                    "params": {
                                        "domain": "input_text",
                                        "service": "set_value",
                                        "service_data": {
                                            "entity_id": "input_text.zz_dining_room_fan_controller_last_event",
                                            "value": {
                                                "trigger_action": "on",
                                                "last_triggered": "2022-03-03 13:44:44.417789+08:00"
                                            }
                                        },
                                        "target": {}
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "action/3": [
                            {
                                "path": "action/3",
                                "timestamp": "2022-03-03T05:44:44.418971+00:00",
                                "result": {
                                    "choice": 0
                                }
                            }
                        ],
                        "action/3/choose/0": [
                            {
                                "path": "action/3/choose/0",
                                "timestamp": "2022-03-03T05:44:44.419020+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/3/choose/0/conditions/0": [
                            {
                                "path": "action/3/choose/0/conditions/0",
                                "timestamp": "2022-03-03T05:44:44.419042+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/0/sequence/0": [
                            {
                                "path": "action/3/choose/0/sequence/0",
                                "timestamp": "2022-03-03T05:44:44.419648+00:00",
                                "result": {
                                    "choice": "default"
                                }
                            }
                        ],
                        "action/3/choose/0/sequence/0/choose/0": [
                            {
                                "path": "action/3/choose/0/sequence/0/choose/0",
                                "timestamp": "2022-03-03T05:44:44.419713+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/0/sequence/0/choose/0/conditions/0": [
                            {
                                "path": "action/3/choose/0/sequence/0/choose/0/conditions/0",
                                "timestamp": "2022-03-03T05:44:44.419739+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/0/sequence/0/default/0": [
                            {
                                "path": "action/3/choose/0/sequence/0/default/0",
                                "timestamp": "2022-03-03T05:44:44.420097+00:00",
                                "result": {
                                    "event": "ahb_controller_event",
                                    "event_data": {
                                        "controller": "2c65aa31e07cc74bcef34dfa0d22d784",
                                        "action": "button_up_short"
                                    }
                                }
                            }
                        ],
                        "action/3/choose/0/sequence/0/default/1": [
                            {
                                "path": "action/3/choose/0/sequence/0/default/1",
                                "timestamp": "2022-03-03T05:44:44.420257+00:00",
                                "result": {
                                    "choice": 0
                                }
                            }
                        ],
                        "action/3/choose/0/sequence/0/default/1/choose/0": [
                            {
                                "path": "action/3/choose/0/sequence/0/default/1/choose/0",
                                "timestamp": "2022-03-03T05:44:44.420292+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/3/choose/0/sequence/0/default/1/choose/0/sequence/0": [
                            {
                                "path": "action/3/choose/0/sequence/0/default/1/choose/0/sequence/0",
                                "timestamp": "2022-03-03T05:44:44.420558+00:00",
                                "result": {
                                    "params": {
                                        "domain": "fan",
                                        "service": "turn_on",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "fan.dining_room_fan"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "action/3/choose/0/sequence/0/default/1/choose/0/sequence/0/0": [
                            {
                                "path": "action/3/choose/0/sequence/0/default/1/choose/0/sequence/0/0",
                                "timestamp": "2022-03-03T05:44:44.421273+00:00",
                                "child_id": {
                                    "domain": "automation",
                                    "item_id": "1642997460354",
                                    "run_id": "cdea81fd689f5ff6d2dd6f765c1597cb"
                                },
                                "changed_variables": {
                                    "speed": null,
                                    "percentage": null,
                                    "preset_mode": null
                                },
                                "result": {
                                    "params": {
                                        "domain": "input_boolean",
                                        "service": "turn_on",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "input_boolean.dining_room_fan_power"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ]
                    },
                    "config": {
                        "variables": {
                            "integration": "ZHA",
                            "button_up_long_loop": false,
                            "button_up_long_max_loop_repeats": 500,
                            "button_up_double_press": false,
                            "button_down_long_loop": false,
                            "button_down_long_max_loop_repeats": 500,
                            "button_down_double_press": false,
                            "helper_last_controller_event": "input_text.zz_dining_room_fan_controller_last_event",
                            "helper_double_press_delay": 500,
                            "helper_debounce_delay": 0,
                            "integration_id": "{{ integration | lower }}",
                            "adjusted_double_press_delay": "{{ [helper_double_press_delay - helper_debounce_delay, 100] | max }}",
                            "actions_mapping": {
                                "deconz": {
                                    "button_up_short": [
                                        "1002"
                                    ],
                                    "button_up_long": [
                                        "1001"
                                    ],
                                    "button_up_release": [
                                        "1003"
                                    ],
                                    "button_down_short": [
                                        "2002"
                                    ],
                                    "button_down_long": [
                                        "2001"
                                    ],
                                    "button_down_release": [
                                        "2003"
                                    ]
                                },
                                "zha": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ]
                                },
                                "zigbee2mqtt": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "brightness_move_up"
                                    ],
                                    "button_up_release": [
                                        "brightness_stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "brightness_move_down"
                                    ],
                                    "button_down_release": [
                                        "brightness_stop"
                                    ]
                                }
                            },
                            "button_up_short": "{{ actions_mapping[integration_id][\"button_up_short\"] }}",
                            "button_up_long": "{{ actions_mapping[integration_id][\"button_up_long\"] }}",
                            "button_up_release": "{{ actions_mapping[integration_id][\"button_up_release\"] }}",
                            "button_down_short": "{{ actions_mapping[integration_id][\"button_down_short\"] }}",
                            "button_down_long": "{{ actions_mapping[integration_id][\"button_down_long\"] }}",
                            "button_down_release": "{{ actions_mapping[integration_id][\"button_down_release\"] }}",
                            "integrations_with_prev_event_storage": [
                                "zha",
                                "zigbee2mqtt"
                            ],
                            "controller_entity": "",
                            "controller_device": "2c65aa31e07cc74bcef34dfa0d22d784",
                            "controller_id": "{% if integration_id==\"zigbee2mqtt\" %}{{controller_entity}}{% else %}{{controller_device}}{% endif %}"
                        },
                        "mode": "restart",
                        "max_exceeded": "silent",
                        "trigger": [
                            {
                                "platform": "event",
                                "event_type": "state_changed",
                                "event_data": {
                                    "entity_id": ""
                                }
                            },
                            {
                                "platform": "event",
                                "event_type": [
                                    "deconz_event",
                                    "zha_event"
                                ],
                                "event_data": {
                                    "device_id": "2c65aa31e07cc74bcef34dfa0d22d784"
                                }
                            }
                        ],
                        "condition": [
                            {
                                "condition": "and",
                                "conditions": [
                                    "{%- set trigger_action -%} {%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%} {%- endset -%} {{ trigger_action not in [\"\",\"None\"] }}",
                                    "{{ integration_id != \"zigbee2mqtt\" or trigger.event.data.new_state.state != trigger.event.data.old_state.state }}"
                                ]
                            }
                        ],
                        "action": [
                            {
                                "delay": {
                                    "milliseconds": 0
                                }
                            },
                            {
                                "variables": {
                                    "trigger_action": "{%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%}",
                                    "trigger_delta": "{{ (as_timestamp(now()) - as_timestamp((states(helper_last_controller_event) | from_json).last_triggered if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"1970-01-01 00:00:00\")) * 1000 }}",
                                    "last_controller_event": "{{ (states(helper_last_controller_event) | from_json).trigger_action if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"\" }}"
                                }
                            },
                            {
                                "service": "input_text.set_value",
                                "data": {
                                    "entity_id": "input_text.zz_dining_room_fan_controller_last_event",
                                    "value": "{{ {\"trigger_action\":trigger_action,\"last_triggered\":now()|string} | to_json }}"
                                }
                            },
                            {
                                "choose": [
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_dining_room_fan_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_up_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_up_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "fan.turn_on",
                                                                                        "target": {
                                                                                            "entity_id": "fan.dining_room_fan"
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_up_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "fan.turn_on",
                                                                        "target": {
                                                                            "entity_id": "fan.dining_room_fan"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_up_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "fan.increase_speed",
                                                                            "target": {
                                                                                "entity_id": "fan.dining_room_fan"
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "fan.increase_speed",
                                                        "target": {
                                                            "entity_id": "fan.dining_room_fan"
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_up_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_up_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_dining_room_fan_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_down_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_down_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "fan.turn_off",
                                                                                        "target": {
                                                                                            "entity_id": "fan.dining_room_fan"
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_down_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "fan.turn_off",
                                                                        "target": {
                                                                            "entity_id": "fan.dining_room_fan"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_down_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "fan.decrease_speed",
                                                                            "target": {
                                                                                "entity_id": "fan.dining_room_fan"
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "fan.decrease_speed",
                                                        "target": {
                                                            "entity_id": "fan.dining_room_fan"
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_down_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_down_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            }
                        ],
                        "id": "1643643631965",
                        "alias": "Dining Room Fan Controller",
                        "description": "Control the Dining Room Fan"
                    },
                    "blueprint_inputs": {
                        "id": "1643643631965",
                        "alias": "Dining Room Fan Controller",
                        "description": "Control the Dining Room Fan",
                        "use_blueprint": {
                            "path": "EPMatt/ikea_e1743.yaml",
                            "input": {
                                "integration": "ZHA",
                                "controller_device": "2c65aa31e07cc74bcef34dfa0d22d784",
                                "helper_last_controller_event": "input_text.zz_dining_room_fan_controller_last_event",
                                "action_button_up_short": [
                                    {
                                        "service": "fan.turn_on",
                                        "target": {
                                            "entity_id": "fan.dining_room_fan"
                                        }
                                    }
                                ],
                                "action_button_down_short": [
                                    {
                                        "service": "fan.turn_off",
                                        "target": {
                                            "entity_id": "fan.dining_room_fan"
                                        }
                                    }
                                ],
                                "action_button_down_long": [
                                    {
                                        "service": "fan.decrease_speed",
                                        "target": {
                                            "entity_id": "fan.dining_room_fan"
                                        }
                                    }
                                ],
                                "action_button_up_long": [
                                    {
                                        "service": "fan.increase_speed",
                                        "target": {
                                            "entity_id": "fan.dining_room_fan"
                                        }
                                    }
                                ]
                            }
                        }
                    },
                    "context": {
                        "id": "4de2f4d60fa5bfc044f0b7e479e169f0",
                        "parent_id": "c53ff127fbb554733efe369026b7ab36",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/3/choose/0/sequence/0/default/1/choose/0/sequence/0/0",
                    "run_id": "fb7651789b4834b0222d8870024f40bf",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:44:44.415299+00:00",
                        "finish": "2022-03-03T05:44:44.429152+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643643631965",
                    "trigger": "event 'zha_event'"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/3/choose/1/sequence/1/default/0/0",
                    "run_id": "965feaa13b784a091022c59910852e9c",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:45:26.444958+00:00",
                        "finish": "2022-03-03T05:45:26.461243+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643643631965",
                    "trigger": "event 'zha_event'",
                    "trace": {
                        "trigger/1": [
                            {
                                "path": "trigger/1",
                                "timestamp": "2022-03-03T05:45:26.445739+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.dining_room_fan_controller",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T05:44:44.416406+00:00",
                                            "mode": "restart",
                                            "current": 0,
                                            "id": "1643643631965",
                                            "friendly_name": "Dining Room Fan Controller"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.798638+00:00",
                                        "last_updated": "2022-03-03T05:44:44.428827+00:00",
                                        "context": {
                                            "id": "4de2f4d60fa5bfc044f0b7e479e169f0",
                                            "parent_id": "c53ff127fbb554733efe369026b7ab36",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "1",
                                        "idx": "1",
                                        "platform": "event",
                                        "event": {
                                            "event_type": "zha_event",
                                            "data": {
                                                "device_ieee": "84:fd:27:ff:fe:9f:11:87",
                                                "unique_id": "84:fd:27:ff:fe:9f:11:87:1:0x0008",
                                                "device_id": "2c65aa31e07cc74bcef34dfa0d22d784",
                                                "endpoint_id": 1,
                                                "cluster_id": 8,
                                                "command": "move_with_on_off",
                                                "args": [
                                                    0,
                                                    83
                                                ]
                                            },
                                            "origin": "LOCAL",
                                            "time_fired": "2022-03-03T05:45:26.443475+00:00",
                                            "context": {
                                                "id": "397e652bfc40637542b07fea65c6872a",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "description": "event 'zha_event'"
                                    },
                                    "integration": "ZHA",
                                    "button_up_long_loop": false,
                                    "button_up_long_max_loop_repeats": 500,
                                    "button_up_double_press": false,
                                    "button_down_long_loop": false,
                                    "button_down_long_max_loop_repeats": 500,
                                    "button_down_double_press": false,
                                    "helper_last_controller_event": "input_text.zz_dining_room_fan_controller_last_event",
                                    "helper_double_press_delay": 500,
                                    "helper_debounce_delay": 0,
                                    "integration_id": "zha",
                                    "adjusted_double_press_delay": 500,
                                    "actions_mapping": {
                                        "deconz": {
                                            "button_up_short": [
                                                "1002"
                                            ],
                                            "button_up_long": [
                                                "1001"
                                            ],
                                            "button_up_release": [
                                                "1003"
                                            ],
                                            "button_down_short": [
                                                "2002"
                                            ],
                                            "button_down_long": [
                                                "2001"
                                            ],
                                            "button_down_release": [
                                                "2003"
                                            ]
                                        },
                                        "zha": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "move_with_on_off_0_83"
                                            ],
                                            "button_up_release": [
                                                "stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "move_1_83"
                                            ],
                                            "button_down_release": [
                                                "stop"
                                            ]
                                        },
                                        "zigbee2mqtt": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "brightness_move_up"
                                            ],
                                            "button_up_release": [
                                                "brightness_stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "brightness_move_down"
                                            ],
                                            "button_down_release": [
                                                "brightness_stop"
                                            ]
                                        }
                                    },
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ],
                                    "integrations_with_prev_event_storage": [
                                        "zha",
                                        "zigbee2mqtt"
                                    ],
                                    "controller_entity": "",
                                    "controller_device": "2c65aa31e07cc74bcef34dfa0d22d784",
                                    "controller_id": "2c65aa31e07cc74bcef34dfa0d22d784"
                                }
                            }
                        ],
                        "condition/0": [
                            {
                                "path": "condition/0",
                                "timestamp": "2022-03-03T05:45:26.445773+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "condition/0/conditions/0": [
                            {
                                "path": "condition/0/conditions/0",
                                "timestamp": "2022-03-03T05:45:26.445792+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "condition/0/conditions/1": [
                            {
                                "path": "condition/0/conditions/1",
                                "timestamp": "2022-03-03T05:45:26.445939+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T05:45:26.446539+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "a3d5692cc337adfaca64783a1281f5cb",
                                        "parent_id": "397e652bfc40637542b07fea65c6872a",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "delay": 0.0,
                                    "done": true
                                }
                            }
                        ],
                        "action/1": [
                            {
                                "path": "action/1",
                                "timestamp": "2022-03-03T05:45:26.446913+00:00"
                            }
                        ],
                        "action/2": [
                            {
                                "path": "action/2",
                                "timestamp": "2022-03-03T05:45:26.447437+00:00",
                                "changed_variables": {
                                    "trigger_action": "move_with_on_off_0_83",
                                    "trigger_delta": 42029.35004234314,
                                    "last_controller_event": "on"
                                },
                                "result": {
                                    "params": {
                                        "domain": "input_text",
                                        "service": "set_value",
                                        "service_data": {
                                            "entity_id": "input_text.zz_dining_room_fan_controller_last_event",
                                            "value": {
                                                "trigger_action": "move_with_on_off_0_83",
                                                "last_triggered": "2022-03-03 13:45:26.447533+08:00"
                                            }
                                        },
                                        "target": {}
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "action/3": [
                            {
                                "path": "action/3",
                                "timestamp": "2022-03-03T05:45:26.449484+00:00",
                                "result": {
                                    "choice": 1
                                }
                            }
                        ],
                        "action/3/choose/0": [
                            {
                                "path": "action/3/choose/0",
                                "timestamp": "2022-03-03T05:45:26.449546+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/0/conditions/0": [
                            {
                                "path": "action/3/choose/0/conditions/0",
                                "timestamp": "2022-03-03T05:45:26.449572+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/1": [
                            {
                                "path": "action/3/choose/1",
                                "timestamp": "2022-03-03T05:45:26.449753+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/3/choose/1/conditions/0": [
                            {
                                "path": "action/3/choose/1/conditions/0",
                                "timestamp": "2022-03-03T05:45:26.449782+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/1/sequence/0": [
                            {
                                "path": "action/3/choose/1/sequence/0",
                                "timestamp": "2022-03-03T05:45:26.450105+00:00",
                                "result": {
                                    "event": "ahb_controller_event",
                                    "event_data": {
                                        "controller": "2c65aa31e07cc74bcef34dfa0d22d784",
                                        "action": "button_up_long"
                                    }
                                }
                            }
                        ],
                        "action/3/choose/1/sequence/1": [
                            {
                                "path": "action/3/choose/1/sequence/1",
                                "timestamp": "2022-03-03T05:45:26.451469+00:00",
                                "result": {
                                    "choice": "default"
                                }
                            }
                        ],
                        "action/3/choose/1/sequence/1/choose/0": [
                            {
                                "path": "action/3/choose/1/sequence/1/choose/0",
                                "timestamp": "2022-03-03T05:45:26.451511+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/1/sequence/1/choose/0/conditions/0": [
                            {
                                "path": "action/3/choose/1/sequence/1/choose/0/conditions/0",
                                "timestamp": "2022-03-03T05:45:26.451531+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/1/sequence/1/default/0": [
                            {
                                "path": "action/3/choose/1/sequence/1/default/0",
                                "timestamp": "2022-03-03T05:45:26.451966+00:00",
                                "result": {
                                    "params": {
                                        "domain": "fan",
                                        "service": "increase_speed",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "fan.dining_room_fan"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "action/3/choose/1/sequence/1/default/0/0": [
                            {
                                "path": "action/3/choose/1/sequence/1/default/0/0",
                                "timestamp": "2022-03-03T05:45:26.452759+00:00",
                                "child_id": {
                                    "domain": "automation",
                                    "item_id": "1642997460354",
                                    "run_id": "9f592260b85e092476801dab234ffb0d"
                                },
                                "changed_variables": {
                                    "percentage": 16
                                },
                                "result": {
                                    "params": {
                                        "domain": "input_number",
                                        "service": "set_value",
                                        "service_data": {
                                            "value": 16,
                                            "entity_id": [
                                                "input_number.dining_room_fan_speed"
                                            ]
                                        },
                                        "target": {
                                            "entity_id": [
                                                "input_number.dining_room_fan_speed"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ]
                    },
                    "config": {
                        "variables": {
                            "integration": "ZHA",
                            "button_up_long_loop": false,
                            "button_up_long_max_loop_repeats": 500,
                            "button_up_double_press": false,
                            "button_down_long_loop": false,
                            "button_down_long_max_loop_repeats": 500,
                            "button_down_double_press": false,
                            "helper_last_controller_event": "input_text.zz_dining_room_fan_controller_last_event",
                            "helper_double_press_delay": 500,
                            "helper_debounce_delay": 0,
                            "integration_id": "{{ integration | lower }}",
                            "adjusted_double_press_delay": "{{ [helper_double_press_delay - helper_debounce_delay, 100] | max }}",
                            "actions_mapping": {
                                "deconz": {
                                    "button_up_short": [
                                        "1002"
                                    ],
                                    "button_up_long": [
                                        "1001"
                                    ],
                                    "button_up_release": [
                                        "1003"
                                    ],
                                    "button_down_short": [
                                        "2002"
                                    ],
                                    "button_down_long": [
                                        "2001"
                                    ],
                                    "button_down_release": [
                                        "2003"
                                    ]
                                },
                                "zha": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ]
                                },
                                "zigbee2mqtt": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "brightness_move_up"
                                    ],
                                    "button_up_release": [
                                        "brightness_stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "brightness_move_down"
                                    ],
                                    "button_down_release": [
                                        "brightness_stop"
                                    ]
                                }
                            },
                            "button_up_short": "{{ actions_mapping[integration_id][\"button_up_short\"] }}",
                            "button_up_long": "{{ actions_mapping[integration_id][\"button_up_long\"] }}",
                            "button_up_release": "{{ actions_mapping[integration_id][\"button_up_release\"] }}",
                            "button_down_short": "{{ actions_mapping[integration_id][\"button_down_short\"] }}",
                            "button_down_long": "{{ actions_mapping[integration_id][\"button_down_long\"] }}",
                            "button_down_release": "{{ actions_mapping[integration_id][\"button_down_release\"] }}",
                            "integrations_with_prev_event_storage": [
                                "zha",
                                "zigbee2mqtt"
                            ],
                            "controller_entity": "",
                            "controller_device": "2c65aa31e07cc74bcef34dfa0d22d784",
                            "controller_id": "{% if integration_id==\"zigbee2mqtt\" %}{{controller_entity}}{% else %}{{controller_device}}{% endif %}"
                        },
                        "mode": "restart",
                        "max_exceeded": "silent",
                        "trigger": [
                            {
                                "platform": "event",
                                "event_type": "state_changed",
                                "event_data": {
                                    "entity_id": ""
                                }
                            },
                            {
                                "platform": "event",
                                "event_type": [
                                    "deconz_event",
                                    "zha_event"
                                ],
                                "event_data": {
                                    "device_id": "2c65aa31e07cc74bcef34dfa0d22d784"
                                }
                            }
                        ],
                        "condition": [
                            {
                                "condition": "and",
                                "conditions": [
                                    "{%- set trigger_action -%} {%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%} {%- endset -%} {{ trigger_action not in [\"\",\"None\"] }}",
                                    "{{ integration_id != \"zigbee2mqtt\" or trigger.event.data.new_state.state != trigger.event.data.old_state.state }}"
                                ]
                            }
                        ],
                        "action": [
                            {
                                "delay": {
                                    "milliseconds": 0
                                }
                            },
                            {
                                "variables": {
                                    "trigger_action": "{%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%}",
                                    "trigger_delta": "{{ (as_timestamp(now()) - as_timestamp((states(helper_last_controller_event) | from_json).last_triggered if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"1970-01-01 00:00:00\")) * 1000 }}",
                                    "last_controller_event": "{{ (states(helper_last_controller_event) | from_json).trigger_action if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"\" }}"
                                }
                            },
                            {
                                "service": "input_text.set_value",
                                "data": {
                                    "entity_id": "input_text.zz_dining_room_fan_controller_last_event",
                                    "value": "{{ {\"trigger_action\":trigger_action,\"last_triggered\":now()|string} | to_json }}"
                                }
                            },
                            {
                                "choose": [
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_dining_room_fan_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_up_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_up_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "fan.turn_on",
                                                                                        "target": {
                                                                                            "entity_id": "fan.dining_room_fan"
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_up_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "fan.turn_on",
                                                                        "target": {
                                                                            "entity_id": "fan.dining_room_fan"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_up_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "fan.increase_speed",
                                                                            "target": {
                                                                                "entity_id": "fan.dining_room_fan"
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "fan.increase_speed",
                                                        "target": {
                                                            "entity_id": "fan.dining_room_fan"
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_up_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_up_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_dining_room_fan_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_down_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_down_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "fan.turn_off",
                                                                                        "target": {
                                                                                            "entity_id": "fan.dining_room_fan"
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_down_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "fan.turn_off",
                                                                        "target": {
                                                                            "entity_id": "fan.dining_room_fan"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_down_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "fan.decrease_speed",
                                                                            "target": {
                                                                                "entity_id": "fan.dining_room_fan"
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "fan.decrease_speed",
                                                        "target": {
                                                            "entity_id": "fan.dining_room_fan"
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_down_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_down_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            }
                        ],
                        "id": "1643643631965",
                        "alias": "Dining Room Fan Controller",
                        "description": "Control the Dining Room Fan"
                    },
                    "blueprint_inputs": {
                        "id": "1643643631965",
                        "alias": "Dining Room Fan Controller",
                        "description": "Control the Dining Room Fan",
                        "use_blueprint": {
                            "path": "EPMatt/ikea_e1743.yaml",
                            "input": {
                                "integration": "ZHA",
                                "controller_device": "2c65aa31e07cc74bcef34dfa0d22d784",
                                "helper_last_controller_event": "input_text.zz_dining_room_fan_controller_last_event",
                                "action_button_up_short": [
                                    {
                                        "service": "fan.turn_on",
                                        "target": {
                                            "entity_id": "fan.dining_room_fan"
                                        }
                                    }
                                ],
                                "action_button_down_short": [
                                    {
                                        "service": "fan.turn_off",
                                        "target": {
                                            "entity_id": "fan.dining_room_fan"
                                        }
                                    }
                                ],
                                "action_button_down_long": [
                                    {
                                        "service": "fan.decrease_speed",
                                        "target": {
                                            "entity_id": "fan.dining_room_fan"
                                        }
                                    }
                                ],
                                "action_button_up_long": [
                                    {
                                        "service": "fan.increase_speed",
                                        "target": {
                                            "entity_id": "fan.dining_room_fan"
                                        }
                                    }
                                ]
                            }
                        }
                    },
                    "context": {
                        "id": "a3d5692cc337adfaca64783a1281f5cb",
                        "parent_id": "397e652bfc40637542b07fea65c6872a",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/3/choose/1/sequence/1/default/0/0",
                    "run_id": "965feaa13b784a091022c59910852e9c",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:45:26.444958+00:00",
                        "finish": "2022-03-03T05:45:26.461243+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643643631965",
                    "trigger": "event 'zha_event'"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/3/choose/2/sequence/1/choose/0",
                    "run_id": "4b0eb4a9bb01c443233a06884d3ab02c",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:45:26.570014+00:00",
                        "finish": "2022-03-03T05:45:26.576855+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643643631965",
                    "trigger": "event 'zha_event'",
                    "trace": {
                        "trigger/1": [
                            {
                                "path": "trigger/1",
                                "timestamp": "2022-03-03T05:45:26.570777+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.dining_room_fan_controller",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T05:45:26.446118+00:00",
                                            "mode": "restart",
                                            "current": 0,
                                            "id": "1643643631965",
                                            "friendly_name": "Dining Room Fan Controller"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.798638+00:00",
                                        "last_updated": "2022-03-03T05:45:26.459193+00:00",
                                        "context": {
                                            "id": "a3d5692cc337adfaca64783a1281f5cb",
                                            "parent_id": "397e652bfc40637542b07fea65c6872a",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "1",
                                        "idx": "1",
                                        "platform": "event",
                                        "event": {
                                            "event_type": "zha_event",
                                            "data": {
                                                "device_ieee": "84:fd:27:ff:fe:9f:11:87",
                                                "unique_id": "84:fd:27:ff:fe:9f:11:87:1:0x0008",
                                                "device_id": "2c65aa31e07cc74bcef34dfa0d22d784",
                                                "endpoint_id": 1,
                                                "cluster_id": 8,
                                                "command": "stop",
                                                "args": []
                                            },
                                            "origin": "LOCAL",
                                            "time_fired": "2022-03-03T05:45:26.569404+00:00",
                                            "context": {
                                                "id": "8a2331e2cfb1e9599b20067a8b008435",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "description": "event 'zha_event'"
                                    },
                                    "integration": "ZHA",
                                    "button_up_long_loop": false,
                                    "button_up_long_max_loop_repeats": 500,
                                    "button_up_double_press": false,
                                    "button_down_long_loop": false,
                                    "button_down_long_max_loop_repeats": 500,
                                    "button_down_double_press": false,
                                    "helper_last_controller_event": "input_text.zz_dining_room_fan_controller_last_event",
                                    "helper_double_press_delay": 500,
                                    "helper_debounce_delay": 0,
                                    "integration_id": "zha",
                                    "adjusted_double_press_delay": 500,
                                    "actions_mapping": {
                                        "deconz": {
                                            "button_up_short": [
                                                "1002"
                                            ],
                                            "button_up_long": [
                                                "1001"
                                            ],
                                            "button_up_release": [
                                                "1003"
                                            ],
                                            "button_down_short": [
                                                "2002"
                                            ],
                                            "button_down_long": [
                                                "2001"
                                            ],
                                            "button_down_release": [
                                                "2003"
                                            ]
                                        },
                                        "zha": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "move_with_on_off_0_83"
                                            ],
                                            "button_up_release": [
                                                "stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "move_1_83"
                                            ],
                                            "button_down_release": [
                                                "stop"
                                            ]
                                        },
                                        "zigbee2mqtt": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "brightness_move_up"
                                            ],
                                            "button_up_release": [
                                                "brightness_stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "brightness_move_down"
                                            ],
                                            "button_down_release": [
                                                "brightness_stop"
                                            ]
                                        }
                                    },
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ],
                                    "integrations_with_prev_event_storage": [
                                        "zha",
                                        "zigbee2mqtt"
                                    ],
                                    "controller_entity": "",
                                    "controller_device": "2c65aa31e07cc74bcef34dfa0d22d784",
                                    "controller_id": "2c65aa31e07cc74bcef34dfa0d22d784"
                                }
                            }
                        ],
                        "condition/0": [
                            {
                                "path": "condition/0",
                                "timestamp": "2022-03-03T05:45:26.570807+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "condition/0/conditions/0": [
                            {
                                "path": "condition/0/conditions/0",
                                "timestamp": "2022-03-03T05:45:26.570826+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "condition/0/conditions/1": [
                            {
                                "path": "condition/0/conditions/1",
                                "timestamp": "2022-03-03T05:45:26.570961+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T05:45:26.571519+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "b49e426dcfca60b9cb38e1865411b5d4",
                                        "parent_id": "8a2331e2cfb1e9599b20067a8b008435",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "delay": 0.0,
                                    "done": true
                                }
                            }
                        ],
                        "action/1": [
                            {
                                "path": "action/1",
                                "timestamp": "2022-03-03T05:45:26.571846+00:00"
                            }
                        ],
                        "action/2": [
                            {
                                "path": "action/2",
                                "timestamp": "2022-03-03T05:45:26.572327+00:00",
                                "changed_variables": {
                                    "trigger_action": "stop",
                                    "trigger_delta": 124.50718879699707,
                                    "last_controller_event": "move_with_on_off_0_83"
                                },
                                "result": {
                                    "params": {
                                        "domain": "input_text",
                                        "service": "set_value",
                                        "service_data": {
                                            "entity_id": "input_text.zz_dining_room_fan_controller_last_event",
                                            "value": {
                                                "trigger_action": "stop",
                                                "last_triggered": "2022-03-03 13:45:26.572972+08:00"
                                            }
                                        },
                                        "target": {}
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "action/3": [
                            {
                                "path": "action/3",
                                "timestamp": "2022-03-03T05:45:26.574147+00:00",
                                "result": {
                                    "choice": 2
                                }
                            }
                        ],
                        "action/3/choose/0": [
                            {
                                "path": "action/3/choose/0",
                                "timestamp": "2022-03-03T05:45:26.574197+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/0/conditions/0": [
                            {
                                "path": "action/3/choose/0/conditions/0",
                                "timestamp": "2022-03-03T05:45:26.574218+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/1": [
                            {
                                "path": "action/3/choose/1",
                                "timestamp": "2022-03-03T05:45:26.574319+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/1/conditions/0": [
                            {
                                "path": "action/3/choose/1/conditions/0",
                                "timestamp": "2022-03-03T05:45:26.574338+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/2": [
                            {
                                "path": "action/3/choose/2",
                                "timestamp": "2022-03-03T05:45:26.574409+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/3/choose/2/conditions/0": [
                            {
                                "path": "action/3/choose/2/conditions/0",
                                "timestamp": "2022-03-03T05:45:26.574427+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/2/conditions/1": [
                            {
                                "path": "action/3/choose/2/conditions/1",
                                "timestamp": "2022-03-03T05:45:26.574484+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/2/sequence/0": [
                            {
                                "path": "action/3/choose/2/sequence/0",
                                "timestamp": "2022-03-03T05:45:26.574841+00:00",
                                "result": {
                                    "event": "ahb_controller_event",
                                    "event_data": {
                                        "controller": "2c65aa31e07cc74bcef34dfa0d22d784",
                                        "action": "button_up_release"
                                    }
                                }
                            }
                        ],
                        "action/3/choose/2/sequence/1": [
                            {
                                "path": "action/3/choose/2/sequence/1",
                                "timestamp": "2022-03-03T05:45:26.575005+00:00",
                                "result": {
                                    "choice": 0
                                }
                            }
                        ],
                        "action/3/choose/2/sequence/1/choose/0": [
                            {
                                "path": "action/3/choose/2/sequence/1/choose/0",
                                "timestamp": "2022-03-03T05:45:26.575041+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ]
                    },
                    "config": {
                        "variables": {
                            "integration": "ZHA",
                            "button_up_long_loop": false,
                            "button_up_long_max_loop_repeats": 500,
                            "button_up_double_press": false,
                            "button_down_long_loop": false,
                            "button_down_long_max_loop_repeats": 500,
                            "button_down_double_press": false,
                            "helper_last_controller_event": "input_text.zz_dining_room_fan_controller_last_event",
                            "helper_double_press_delay": 500,
                            "helper_debounce_delay": 0,
                            "integration_id": "{{ integration | lower }}",
                            "adjusted_double_press_delay": "{{ [helper_double_press_delay - helper_debounce_delay, 100] | max }}",
                            "actions_mapping": {
                                "deconz": {
                                    "button_up_short": [
                                        "1002"
                                    ],
                                    "button_up_long": [
                                        "1001"
                                    ],
                                    "button_up_release": [
                                        "1003"
                                    ],
                                    "button_down_short": [
                                        "2002"
                                    ],
                                    "button_down_long": [
                                        "2001"
                                    ],
                                    "button_down_release": [
                                        "2003"
                                    ]
                                },
                                "zha": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ]
                                },
                                "zigbee2mqtt": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "brightness_move_up"
                                    ],
                                    "button_up_release": [
                                        "brightness_stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "brightness_move_down"
                                    ],
                                    "button_down_release": [
                                        "brightness_stop"
                                    ]
                                }
                            },
                            "button_up_short": "{{ actions_mapping[integration_id][\"button_up_short\"] }}",
                            "button_up_long": "{{ actions_mapping[integration_id][\"button_up_long\"] }}",
                            "button_up_release": "{{ actions_mapping[integration_id][\"button_up_release\"] }}",
                            "button_down_short": "{{ actions_mapping[integration_id][\"button_down_short\"] }}",
                            "button_down_long": "{{ actions_mapping[integration_id][\"button_down_long\"] }}",
                            "button_down_release": "{{ actions_mapping[integration_id][\"button_down_release\"] }}",
                            "integrations_with_prev_event_storage": [
                                "zha",
                                "zigbee2mqtt"
                            ],
                            "controller_entity": "",
                            "controller_device": "2c65aa31e07cc74bcef34dfa0d22d784",
                            "controller_id": "{% if integration_id==\"zigbee2mqtt\" %}{{controller_entity}}{% else %}{{controller_device}}{% endif %}"
                        },
                        "mode": "restart",
                        "max_exceeded": "silent",
                        "trigger": [
                            {
                                "platform": "event",
                                "event_type": "state_changed",
                                "event_data": {
                                    "entity_id": ""
                                }
                            },
                            {
                                "platform": "event",
                                "event_type": [
                                    "deconz_event",
                                    "zha_event"
                                ],
                                "event_data": {
                                    "device_id": "2c65aa31e07cc74bcef34dfa0d22d784"
                                }
                            }
                        ],
                        "condition": [
                            {
                                "condition": "and",
                                "conditions": [
                                    "{%- set trigger_action -%} {%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%} {%- endset -%} {{ trigger_action not in [\"\",\"None\"] }}",
                                    "{{ integration_id != \"zigbee2mqtt\" or trigger.event.data.new_state.state != trigger.event.data.old_state.state }}"
                                ]
                            }
                        ],
                        "action": [
                            {
                                "delay": {
                                    "milliseconds": 0
                                }
                            },
                            {
                                "variables": {
                                    "trigger_action": "{%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%}",
                                    "trigger_delta": "{{ (as_timestamp(now()) - as_timestamp((states(helper_last_controller_event) | from_json).last_triggered if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"1970-01-01 00:00:00\")) * 1000 }}",
                                    "last_controller_event": "{{ (states(helper_last_controller_event) | from_json).trigger_action if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"\" }}"
                                }
                            },
                            {
                                "service": "input_text.set_value",
                                "data": {
                                    "entity_id": "input_text.zz_dining_room_fan_controller_last_event",
                                    "value": "{{ {\"trigger_action\":trigger_action,\"last_triggered\":now()|string} | to_json }}"
                                }
                            },
                            {
                                "choose": [
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_dining_room_fan_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_up_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_up_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "fan.turn_on",
                                                                                        "target": {
                                                                                            "entity_id": "fan.dining_room_fan"
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_up_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "fan.turn_on",
                                                                        "target": {
                                                                            "entity_id": "fan.dining_room_fan"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_up_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "fan.increase_speed",
                                                                            "target": {
                                                                                "entity_id": "fan.dining_room_fan"
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "fan.increase_speed",
                                                        "target": {
                                                            "entity_id": "fan.dining_room_fan"
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_up_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_up_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_dining_room_fan_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_down_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_down_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "fan.turn_off",
                                                                                        "target": {
                                                                                            "entity_id": "fan.dining_room_fan"
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_down_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "fan.turn_off",
                                                                        "target": {
                                                                            "entity_id": "fan.dining_room_fan"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_down_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "fan.decrease_speed",
                                                                            "target": {
                                                                                "entity_id": "fan.dining_room_fan"
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "fan.decrease_speed",
                                                        "target": {
                                                            "entity_id": "fan.dining_room_fan"
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_down_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_down_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            }
                        ],
                        "id": "1643643631965",
                        "alias": "Dining Room Fan Controller",
                        "description": "Control the Dining Room Fan"
                    },
                    "blueprint_inputs": {
                        "id": "1643643631965",
                        "alias": "Dining Room Fan Controller",
                        "description": "Control the Dining Room Fan",
                        "use_blueprint": {
                            "path": "EPMatt/ikea_e1743.yaml",
                            "input": {
                                "integration": "ZHA",
                                "controller_device": "2c65aa31e07cc74bcef34dfa0d22d784",
                                "helper_last_controller_event": "input_text.zz_dining_room_fan_controller_last_event",
                                "action_button_up_short": [
                                    {
                                        "service": "fan.turn_on",
                                        "target": {
                                            "entity_id": "fan.dining_room_fan"
                                        }
                                    }
                                ],
                                "action_button_down_short": [
                                    {
                                        "service": "fan.turn_off",
                                        "target": {
                                            "entity_id": "fan.dining_room_fan"
                                        }
                                    }
                                ],
                                "action_button_down_long": [
                                    {
                                        "service": "fan.decrease_speed",
                                        "target": {
                                            "entity_id": "fan.dining_room_fan"
                                        }
                                    }
                                ],
                                "action_button_up_long": [
                                    {
                                        "service": "fan.increase_speed",
                                        "target": {
                                            "entity_id": "fan.dining_room_fan"
                                        }
                                    }
                                ]
                            }
                        }
                    },
                    "context": {
                        "id": "b49e426dcfca60b9cb38e1865411b5d4",
                        "parent_id": "8a2331e2cfb1e9599b20067a8b008435",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/3/choose/2/sequence/1/choose/0",
                    "run_id": "4b0eb4a9bb01c443233a06884d3ab02c",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:45:26.570014+00:00",
                        "finish": "2022-03-03T05:45:26.576855+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643643631965",
                    "trigger": "event 'zha_event'"
                }
            }
        ],
        "automation.1643644178195": [
            {
                "extended_dict": {
                    "last_step": "action/3/choose/3/sequence/0/default/1/choose/0/sequence/0",
                    "run_id": "8ea3f0ff2c09912cb737792edf345de0",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:37:19.885466+00:00",
                        "finish": "2022-03-03T05:37:19.950161+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643644178195",
                    "trigger": "event 'zha_event'",
                    "trace": {
                        "trigger/1": [
                            {
                                "path": "trigger/1",
                                "timestamp": "2022-03-03T05:37:19.886311+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.powder_room_lights_controller",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T05:35:59.476281+00:00",
                                            "mode": "restart",
                                            "current": 0,
                                            "id": "1643644178195",
                                            "friendly_name": "Powder Room Lights Controller"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.798769+00:00",
                                        "last_updated": "2022-03-03T05:35:59.481411+00:00",
                                        "context": {
                                            "id": "3cebac8372c35c2fee7ed93bc8a0ce0e",
                                            "parent_id": "bf8c904d9b2acccb7bb247da6d3a8194",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "1",
                                        "idx": "1",
                                        "platform": "event",
                                        "event": {
                                            "event_type": "zha_event",
                                            "data": {
                                                "device_ieee": "84:fd:27:ff:fe:37:50:2c",
                                                "unique_id": "84:fd:27:ff:fe:37:50:2c:1:0x0006",
                                                "device_id": "8fd4f8715be89cc0f383c887c3fac892",
                                                "endpoint_id": 1,
                                                "cluster_id": 6,
                                                "command": "off",
                                                "args": []
                                            },
                                            "origin": "LOCAL",
                                            "time_fired": "2022-03-03T05:37:19.884813+00:00",
                                            "context": {
                                                "id": "79dbdd6ed62b6bb3b37f608b1148cd70",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "description": "event 'zha_event'"
                                    },
                                    "integration": "ZHA",
                                    "button_up_long_loop": true,
                                    "button_up_long_max_loop_repeats": 50,
                                    "button_up_double_press": false,
                                    "button_down_long_loop": true,
                                    "button_down_long_max_loop_repeats": 50,
                                    "button_down_double_press": false,
                                    "helper_last_controller_event": "input_text.zz_powder_room_lights_controller_last_event",
                                    "helper_double_press_delay": 500,
                                    "helper_debounce_delay": 0,
                                    "integration_id": "zha",
                                    "adjusted_double_press_delay": 500,
                                    "actions_mapping": {
                                        "deconz": {
                                            "button_up_short": [
                                                "1002"
                                            ],
                                            "button_up_long": [
                                                "1001"
                                            ],
                                            "button_up_release": [
                                                "1003"
                                            ],
                                            "button_down_short": [
                                                "2002"
                                            ],
                                            "button_down_long": [
                                                "2001"
                                            ],
                                            "button_down_release": [
                                                "2003"
                                            ]
                                        },
                                        "zha": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "move_with_on_off_0_83"
                                            ],
                                            "button_up_release": [
                                                "stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "move_1_83"
                                            ],
                                            "button_down_release": [
                                                "stop"
                                            ]
                                        },
                                        "zigbee2mqtt": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "brightness_move_up"
                                            ],
                                            "button_up_release": [
                                                "brightness_stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "brightness_move_down"
                                            ],
                                            "button_down_release": [
                                                "brightness_stop"
                                            ]
                                        }
                                    },
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ],
                                    "integrations_with_prev_event_storage": [
                                        "zha",
                                        "zigbee2mqtt"
                                    ],
                                    "controller_entity": "",
                                    "controller_device": "8fd4f8715be89cc0f383c887c3fac892",
                                    "controller_id": "8fd4f8715be89cc0f383c887c3fac892"
                                }
                            }
                        ],
                        "condition/0": [
                            {
                                "path": "condition/0",
                                "timestamp": "2022-03-03T05:37:19.886342+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "condition/0/conditions/0": [
                            {
                                "path": "condition/0/conditions/0",
                                "timestamp": "2022-03-03T05:37:19.886367+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "condition/0/conditions/1": [
                            {
                                "path": "condition/0/conditions/1",
                                "timestamp": "2022-03-03T05:37:19.886512+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T05:37:19.887190+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "21f14a01501f14e38adf3922d8fafc22",
                                        "parent_id": "79dbdd6ed62b6bb3b37f608b1148cd70",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "delay": 0.0,
                                    "done": true
                                }
                            }
                        ],
                        "action/1": [
                            {
                                "path": "action/1",
                                "timestamp": "2022-03-03T05:37:19.887556+00:00"
                            }
                        ],
                        "action/2": [
                            {
                                "path": "action/2",
                                "timestamp": "2022-03-03T05:37:19.888131+00:00",
                                "changed_variables": {
                                    "trigger_action": "off",
                                    "trigger_delta": 80409.1489315033,
                                    "last_controller_event": "checkin"
                                },
                                "result": {
                                    "params": {
                                        "domain": "input_text",
                                        "service": "set_value",
                                        "service_data": {
                                            "entity_id": "input_text.zz_powder_room_lights_controller_last_event",
                                            "value": {
                                                "trigger_action": "off",
                                                "last_triggered": "2022-03-03 13:37:19.888229+08:00"
                                            }
                                        },
                                        "target": {}
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "action/3": [
                            {
                                "path": "action/3",
                                "timestamp": "2022-03-03T05:37:19.889950+00:00",
                                "result": {
                                    "choice": 3
                                }
                            }
                        ],
                        "action/3/choose/0": [
                            {
                                "path": "action/3/choose/0",
                                "timestamp": "2022-03-03T05:37:19.890015+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/0/conditions/0": [
                            {
                                "path": "action/3/choose/0/conditions/0",
                                "timestamp": "2022-03-03T05:37:19.890040+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/1": [
                            {
                                "path": "action/3/choose/1",
                                "timestamp": "2022-03-03T05:37:19.890146+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/1/conditions/0": [
                            {
                                "path": "action/3/choose/1/conditions/0",
                                "timestamp": "2022-03-03T05:37:19.890165+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/2": [
                            {
                                "path": "action/3/choose/2",
                                "timestamp": "2022-03-03T05:37:19.890236+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/2/conditions/0": [
                            {
                                "path": "action/3/choose/2/conditions/0",
                                "timestamp": "2022-03-03T05:37:19.890254+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/3": [
                            {
                                "path": "action/3/choose/3",
                                "timestamp": "2022-03-03T05:37:19.890321+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/3/choose/3/conditions/0": [
                            {
                                "path": "action/3/choose/3/conditions/0",
                                "timestamp": "2022-03-03T05:37:19.890338+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/3/sequence/0": [
                            {
                                "path": "action/3/choose/3/sequence/0",
                                "timestamp": "2022-03-03T05:37:19.890663+00:00",
                                "result": {
                                    "choice": "default"
                                }
                            }
                        ],
                        "action/3/choose/3/sequence/0/choose/0": [
                            {
                                "path": "action/3/choose/3/sequence/0/choose/0",
                                "timestamp": "2022-03-03T05:37:19.890891+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/3/sequence/0/choose/0/conditions/0": [
                            {
                                "path": "action/3/choose/3/sequence/0/choose/0/conditions/0",
                                "timestamp": "2022-03-03T05:37:19.890915+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/3/sequence/0/default/0": [
                            {
                                "path": "action/3/choose/3/sequence/0/default/0",
                                "timestamp": "2022-03-03T05:37:19.891320+00:00",
                                "result": {
                                    "event": "ahb_controller_event",
                                    "event_data": {
                                        "controller": "8fd4f8715be89cc0f383c887c3fac892",
                                        "action": "button_down_short"
                                    }
                                }
                            }
                        ],
                        "action/3/choose/3/sequence/0/default/1": [
                            {
                                "path": "action/3/choose/3/sequence/0/default/1",
                                "timestamp": "2022-03-03T05:37:19.891502+00:00",
                                "result": {
                                    "choice": 0
                                }
                            }
                        ],
                        "action/3/choose/3/sequence/0/default/1/choose/0": [
                            {
                                "path": "action/3/choose/3/sequence/0/default/1/choose/0",
                                "timestamp": "2022-03-03T05:37:19.891576+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/3/choose/3/sequence/0/default/1/choose/0/sequence/0": [
                            {
                                "path": "action/3/choose/3/sequence/0/default/1/choose/0/sequence/0",
                                "timestamp": "2022-03-03T05:37:19.891904+00:00",
                                "result": {
                                    "params": {
                                        "domain": "light",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "light.powder_room_pendant_light_entity"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ]
                    },
                    "config": {
                        "variables": {
                            "integration": "ZHA",
                            "button_up_long_loop": true,
                            "button_up_long_max_loop_repeats": 50,
                            "button_up_double_press": false,
                            "button_down_long_loop": true,
                            "button_down_long_max_loop_repeats": 50,
                            "button_down_double_press": false,
                            "helper_last_controller_event": "input_text.zz_powder_room_lights_controller_last_event",
                            "helper_double_press_delay": 500,
                            "helper_debounce_delay": 0,
                            "integration_id": "{{ integration | lower }}",
                            "adjusted_double_press_delay": "{{ [helper_double_press_delay - helper_debounce_delay, 100] | max }}",
                            "actions_mapping": {
                                "deconz": {
                                    "button_up_short": [
                                        "1002"
                                    ],
                                    "button_up_long": [
                                        "1001"
                                    ],
                                    "button_up_release": [
                                        "1003"
                                    ],
                                    "button_down_short": [
                                        "2002"
                                    ],
                                    "button_down_long": [
                                        "2001"
                                    ],
                                    "button_down_release": [
                                        "2003"
                                    ]
                                },
                                "zha": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ]
                                },
                                "zigbee2mqtt": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "brightness_move_up"
                                    ],
                                    "button_up_release": [
                                        "brightness_stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "brightness_move_down"
                                    ],
                                    "button_down_release": [
                                        "brightness_stop"
                                    ]
                                }
                            },
                            "button_up_short": "{{ actions_mapping[integration_id][\"button_up_short\"] }}",
                            "button_up_long": "{{ actions_mapping[integration_id][\"button_up_long\"] }}",
                            "button_up_release": "{{ actions_mapping[integration_id][\"button_up_release\"] }}",
                            "button_down_short": "{{ actions_mapping[integration_id][\"button_down_short\"] }}",
                            "button_down_long": "{{ actions_mapping[integration_id][\"button_down_long\"] }}",
                            "button_down_release": "{{ actions_mapping[integration_id][\"button_down_release\"] }}",
                            "integrations_with_prev_event_storage": [
                                "zha",
                                "zigbee2mqtt"
                            ],
                            "controller_entity": "",
                            "controller_device": "8fd4f8715be89cc0f383c887c3fac892",
                            "controller_id": "{% if integration_id==\"zigbee2mqtt\" %}{{controller_entity}}{% else %}{{controller_device}}{% endif %}"
                        },
                        "mode": "restart",
                        "max_exceeded": "silent",
                        "trigger": [
                            {
                                "platform": "event",
                                "event_type": "state_changed",
                                "event_data": {
                                    "entity_id": ""
                                }
                            },
                            {
                                "platform": "event",
                                "event_type": [
                                    "deconz_event",
                                    "zha_event"
                                ],
                                "event_data": {
                                    "device_id": "8fd4f8715be89cc0f383c887c3fac892"
                                }
                            }
                        ],
                        "condition": [
                            {
                                "condition": "and",
                                "conditions": [
                                    "{%- set trigger_action -%} {%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%} {%- endset -%} {{ trigger_action not in [\"\",\"None\"] }}",
                                    "{{ integration_id != \"zigbee2mqtt\" or trigger.event.data.new_state.state != trigger.event.data.old_state.state }}"
                                ]
                            }
                        ],
                        "action": [
                            {
                                "delay": {
                                    "milliseconds": 0
                                }
                            },
                            {
                                "variables": {
                                    "trigger_action": "{%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%}",
                                    "trigger_delta": "{{ (as_timestamp(now()) - as_timestamp((states(helper_last_controller_event) | from_json).last_triggered if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"1970-01-01 00:00:00\")) * 1000 }}",
                                    "last_controller_event": "{{ (states(helper_last_controller_event) | from_json).trigger_action if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"\" }}"
                                }
                            },
                            {
                                "service": "input_text.set_value",
                                "data": {
                                    "entity_id": "input_text.zz_powder_room_lights_controller_last_event",
                                    "value": "{{ {\"trigger_action\":trigger_action,\"last_triggered\":now()|string} | to_json }}"
                                }
                            },
                            {
                                "choose": [
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_powder_room_lights_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_up_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_up_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "choose": [
                                                                                            {
                                                                                                "conditions": [
                                                                                                    {
                                                                                                        "condition": "time",
                                                                                                        "after": "input_datetime.sleep_hours_start",
                                                                                                        "before": "input_datetime.lights_auto_control_end"
                                                                                                    }
                                                                                                ],
                                                                                                "sequence": [
                                                                                                    {
                                                                                                        "service": "light.turn_on",
                                                                                                        "target": {
                                                                                                            "entity_id": "light.powder_room_pendant_light_entity"
                                                                                                        },
                                                                                                        "data": {
                                                                                                            "brightness_pct": 5
                                                                                                        }
                                                                                                    }
                                                                                                ]
                                                                                            }
                                                                                        ],
                                                                                        "default": [
                                                                                            {
                                                                                                "service": "light.turn_on",
                                                                                                "target": {
                                                                                                    "entity_id": "light.powder_room_pendant_light_entity"
                                                                                                },
                                                                                                "data": {
                                                                                                    "brightness_pct": 100
                                                                                                }
                                                                                            }
                                                                                        ]
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_up_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [
                                                                                    {
                                                                                        "condition": "time",
                                                                                        "after": "input_datetime.sleep_hours_start",
                                                                                        "before": "input_datetime.lights_auto_control_end"
                                                                                    }
                                                                                ],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "light.turn_on",
                                                                                        "target": {
                                                                                            "entity_id": "light.powder_room_pendant_light_entity"
                                                                                        },
                                                                                        "data": {
                                                                                            "brightness_pct": 5
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ],
                                                                        "default": [
                                                                            {
                                                                                "service": "light.turn_on",
                                                                                "target": {
                                                                                    "entity_id": "light.powder_room_pendant_light_entity"
                                                                                },
                                                                                "data": {
                                                                                    "brightness_pct": 100
                                                                                }
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_up_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "light.turn_on",
                                                                            "target": {
                                                                                "entity_id": "light.powder_room_pendant_light_entity"
                                                                            },
                                                                            "data": {
                                                                                "brightness_step_pct": 10
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.powder_room_pendant_light_entity"
                                                        },
                                                        "data": {
                                                            "brightness_step_pct": 10
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_up_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_up_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_powder_room_lights_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_down_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_down_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "light.turn_off",
                                                                                        "target": {
                                                                                            "entity_id": "light.powder_room_pendant_light_entity"
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_down_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "light.turn_off",
                                                                        "target": {
                                                                            "entity_id": "light.powder_room_pendant_light_entity"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_down_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "light.turn_on",
                                                                            "target": {
                                                                                "entity_id": "light.powder_room_pendant_light_entity"
                                                                            },
                                                                            "data": {
                                                                                "brightness_step_pct": -10
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.powder_room_pendant_light_entity"
                                                        },
                                                        "data": {
                                                            "brightness_step_pct": -10
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_down_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_down_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            }
                        ],
                        "id": "1643644178195",
                        "alias": "Powder Room Lights Controller",
                        "description": "Control the Powder Room Lights"
                    },
                    "blueprint_inputs": {
                        "id": "1643644178195",
                        "alias": "Powder Room Lights Controller",
                        "description": "Control the Powder Room Lights",
                        "use_blueprint": {
                            "path": "EPMatt/ikea_e1743.yaml",
                            "input": {
                                "integration": "ZHA",
                                "controller_device": "8fd4f8715be89cc0f383c887c3fac892",
                                "helper_last_controller_event": "input_text.zz_powder_room_lights_controller_last_event",
                                "action_button_up_short": [
                                    {
                                        "choose": [
                                            {
                                                "conditions": [
                                                    {
                                                        "condition": "time",
                                                        "after": "input_datetime.sleep_hours_start",
                                                        "before": "input_datetime.lights_auto_control_end"
                                                    }
                                                ],
                                                "sequence": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.powder_room_pendant_light_entity"
                                                        },
                                                        "data": {
                                                            "brightness_pct": 5
                                                        }
                                                    }
                                                ]
                                            }
                                        ],
                                        "default": [
                                            {
                                                "service": "light.turn_on",
                                                "target": {
                                                    "entity_id": "light.powder_room_pendant_light_entity"
                                                },
                                                "data": {
                                                    "brightness_pct": 100
                                                }
                                            }
                                        ]
                                    }
                                ],
                                "action_button_up_long": [
                                    {
                                        "service": "light.turn_on",
                                        "target": {
                                            "entity_id": "light.powder_room_pendant_light_entity"
                                        },
                                        "data": {
                                            "brightness_step_pct": 10
                                        }
                                    }
                                ],
                                "action_button_down_short": [
                                    {
                                        "service": "light.turn_off",
                                        "target": {
                                            "entity_id": "light.powder_room_pendant_light_entity"
                                        }
                                    }
                                ],
                                "action_button_down_long": [
                                    {
                                        "service": "light.turn_on",
                                        "target": {
                                            "entity_id": "light.powder_room_pendant_light_entity"
                                        },
                                        "data": {
                                            "brightness_step_pct": -10
                                        }
                                    }
                                ],
                                "button_up_long_loop": true,
                                "button_up_long_max_loop_repeats": 50,
                                "button_down_long_loop": true,
                                "button_down_long_max_loop_repeats": 50
                            }
                        }
                    },
                    "context": {
                        "id": "21f14a01501f14e38adf3922d8fafc22",
                        "parent_id": "79dbdd6ed62b6bb3b37f608b1148cd70",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/3/choose/3/sequence/0/default/1/choose/0/sequence/0",
                    "run_id": "8ea3f0ff2c09912cb737792edf345de0",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:37:19.885466+00:00",
                        "finish": "2022-03-03T05:37:19.950161+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643644178195",
                    "trigger": "event 'zha_event'"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/3/choose/3/sequence/0/default/1/choose/0/sequence/0",
                    "run_id": "995a9d524d6312aba8fc7704c9069505",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:45:22.964525+00:00",
                        "finish": "2022-03-03T05:45:23.047229+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643644178195",
                    "trigger": "event 'zha_event'",
                    "trace": {
                        "trigger/1": [
                            {
                                "path": "trigger/1",
                                "timestamp": "2022-03-03T05:45:22.965426+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.powder_room_lights_controller",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T05:37:19.886721+00:00",
                                            "mode": "restart",
                                            "current": 0,
                                            "id": "1643644178195",
                                            "friendly_name": "Powder Room Lights Controller"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.798769+00:00",
                                        "last_updated": "2022-03-03T05:37:19.949383+00:00",
                                        "context": {
                                            "id": "21f14a01501f14e38adf3922d8fafc22",
                                            "parent_id": "79dbdd6ed62b6bb3b37f608b1148cd70",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "1",
                                        "idx": "1",
                                        "platform": "event",
                                        "event": {
                                            "event_type": "zha_event",
                                            "data": {
                                                "device_ieee": "84:fd:27:ff:fe:37:50:2c",
                                                "unique_id": "84:fd:27:ff:fe:37:50:2c:1:0x0006",
                                                "device_id": "8fd4f8715be89cc0f383c887c3fac892",
                                                "endpoint_id": 1,
                                                "cluster_id": 6,
                                                "command": "off",
                                                "args": []
                                            },
                                            "origin": "LOCAL",
                                            "time_fired": "2022-03-03T05:45:22.963563+00:00",
                                            "context": {
                                                "id": "a4357f64e89e7472d61b7dbf6cd9a948",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "description": "event 'zha_event'"
                                    },
                                    "integration": "ZHA",
                                    "button_up_long_loop": true,
                                    "button_up_long_max_loop_repeats": 50,
                                    "button_up_double_press": false,
                                    "button_down_long_loop": true,
                                    "button_down_long_max_loop_repeats": 50,
                                    "button_down_double_press": false,
                                    "helper_last_controller_event": "input_text.zz_powder_room_lights_controller_last_event",
                                    "helper_double_press_delay": 500,
                                    "helper_debounce_delay": 0,
                                    "integration_id": "zha",
                                    "adjusted_double_press_delay": 500,
                                    "actions_mapping": {
                                        "deconz": {
                                            "button_up_short": [
                                                "1002"
                                            ],
                                            "button_up_long": [
                                                "1001"
                                            ],
                                            "button_up_release": [
                                                "1003"
                                            ],
                                            "button_down_short": [
                                                "2002"
                                            ],
                                            "button_down_long": [
                                                "2001"
                                            ],
                                            "button_down_release": [
                                                "2003"
                                            ]
                                        },
                                        "zha": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "move_with_on_off_0_83"
                                            ],
                                            "button_up_release": [
                                                "stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "move_1_83"
                                            ],
                                            "button_down_release": [
                                                "stop"
                                            ]
                                        },
                                        "zigbee2mqtt": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "brightness_move_up"
                                            ],
                                            "button_up_release": [
                                                "brightness_stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "brightness_move_down"
                                            ],
                                            "button_down_release": [
                                                "brightness_stop"
                                            ]
                                        }
                                    },
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ],
                                    "integrations_with_prev_event_storage": [
                                        "zha",
                                        "zigbee2mqtt"
                                    ],
                                    "controller_entity": "",
                                    "controller_device": "8fd4f8715be89cc0f383c887c3fac892",
                                    "controller_id": "8fd4f8715be89cc0f383c887c3fac892"
                                }
                            }
                        ],
                        "condition/0": [
                            {
                                "path": "condition/0",
                                "timestamp": "2022-03-03T05:45:22.965470+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "condition/0/conditions/0": [
                            {
                                "path": "condition/0/conditions/0",
                                "timestamp": "2022-03-03T05:45:22.965511+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "condition/0/conditions/1": [
                            {
                                "path": "condition/0/conditions/1",
                                "timestamp": "2022-03-03T05:45:22.965734+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T05:45:22.966515+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "99a2d6ca8c6082c8a707b6bc5e5025a3",
                                        "parent_id": "a4357f64e89e7472d61b7dbf6cd9a948",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "delay": 0.0,
                                    "done": true
                                }
                            }
                        ],
                        "action/1": [
                            {
                                "path": "action/1",
                                "timestamp": "2022-03-03T05:45:22.967387+00:00"
                            }
                        ],
                        "action/2": [
                            {
                                "path": "action/2",
                                "timestamp": "2022-03-03T05:45:22.968140+00:00",
                                "changed_variables": {
                                    "trigger_action": "off",
                                    "trigger_delta": 483079.5021057129,
                                    "last_controller_event": "off"
                                },
                                "result": {
                                    "params": {
                                        "domain": "input_text",
                                        "service": "set_value",
                                        "service_data": {
                                            "entity_id": "input_text.zz_powder_room_lights_controller_last_event",
                                            "value": {
                                                "trigger_action": "off",
                                                "last_triggered": "2022-03-03 13:45:22.968270+08:00"
                                            }
                                        },
                                        "target": {}
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "action/3": [
                            {
                                "path": "action/3",
                                "timestamp": "2022-03-03T05:45:22.971052+00:00",
                                "result": {
                                    "choice": 3
                                }
                            }
                        ],
                        "action/3/choose/0": [
                            {
                                "path": "action/3/choose/0",
                                "timestamp": "2022-03-03T05:45:22.971121+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/0/conditions/0": [
                            {
                                "path": "action/3/choose/0/conditions/0",
                                "timestamp": "2022-03-03T05:45:22.971148+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/1": [
                            {
                                "path": "action/3/choose/1",
                                "timestamp": "2022-03-03T05:45:22.971281+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/1/conditions/0": [
                            {
                                "path": "action/3/choose/1/conditions/0",
                                "timestamp": "2022-03-03T05:45:22.971304+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/2": [
                            {
                                "path": "action/3/choose/2",
                                "timestamp": "2022-03-03T05:45:22.971396+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/2/conditions/0": [
                            {
                                "path": "action/3/choose/2/conditions/0",
                                "timestamp": "2022-03-03T05:45:22.971416+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/3": [
                            {
                                "path": "action/3/choose/3",
                                "timestamp": "2022-03-03T05:45:22.971498+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/3/choose/3/conditions/0": [
                            {
                                "path": "action/3/choose/3/conditions/0",
                                "timestamp": "2022-03-03T05:45:22.971517+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/3/sequence/0": [
                            {
                                "path": "action/3/choose/3/sequence/0",
                                "timestamp": "2022-03-03T05:45:22.971926+00:00",
                                "result": {
                                    "choice": "default"
                                }
                            }
                        ],
                        "action/3/choose/3/sequence/0/choose/0": [
                            {
                                "path": "action/3/choose/3/sequence/0/choose/0",
                                "timestamp": "2022-03-03T05:45:22.971979+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/3/sequence/0/choose/0/conditions/0": [
                            {
                                "path": "action/3/choose/3/sequence/0/choose/0/conditions/0",
                                "timestamp": "2022-03-03T05:45:22.972002+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/3/sequence/0/default/0": [
                            {
                                "path": "action/3/choose/3/sequence/0/default/0",
                                "timestamp": "2022-03-03T05:45:22.972344+00:00",
                                "result": {
                                    "event": "ahb_controller_event",
                                    "event_data": {
                                        "controller": "8fd4f8715be89cc0f383c887c3fac892",
                                        "action": "button_down_short"
                                    }
                                }
                            }
                        ],
                        "action/3/choose/3/sequence/0/default/1": [
                            {
                                "path": "action/3/choose/3/sequence/0/default/1",
                                "timestamp": "2022-03-03T05:45:22.972538+00:00",
                                "result": {
                                    "choice": 0
                                }
                            }
                        ],
                        "action/3/choose/3/sequence/0/default/1/choose/0": [
                            {
                                "path": "action/3/choose/3/sequence/0/default/1/choose/0",
                                "timestamp": "2022-03-03T05:45:22.972581+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/3/choose/3/sequence/0/default/1/choose/0/sequence/0": [
                            {
                                "path": "action/3/choose/3/sequence/0/default/1/choose/0/sequence/0",
                                "timestamp": "2022-03-03T05:45:22.973085+00:00",
                                "result": {
                                    "params": {
                                        "domain": "light",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "light.powder_room_pendant_light_entity"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ]
                    },
                    "config": {
                        "variables": {
                            "integration": "ZHA",
                            "button_up_long_loop": true,
                            "button_up_long_max_loop_repeats": 50,
                            "button_up_double_press": false,
                            "button_down_long_loop": true,
                            "button_down_long_max_loop_repeats": 50,
                            "button_down_double_press": false,
                            "helper_last_controller_event": "input_text.zz_powder_room_lights_controller_last_event",
                            "helper_double_press_delay": 500,
                            "helper_debounce_delay": 0,
                            "integration_id": "{{ integration | lower }}",
                            "adjusted_double_press_delay": "{{ [helper_double_press_delay - helper_debounce_delay, 100] | max }}",
                            "actions_mapping": {
                                "deconz": {
                                    "button_up_short": [
                                        "1002"
                                    ],
                                    "button_up_long": [
                                        "1001"
                                    ],
                                    "button_up_release": [
                                        "1003"
                                    ],
                                    "button_down_short": [
                                        "2002"
                                    ],
                                    "button_down_long": [
                                        "2001"
                                    ],
                                    "button_down_release": [
                                        "2003"
                                    ]
                                },
                                "zha": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ]
                                },
                                "zigbee2mqtt": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "brightness_move_up"
                                    ],
                                    "button_up_release": [
                                        "brightness_stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "brightness_move_down"
                                    ],
                                    "button_down_release": [
                                        "brightness_stop"
                                    ]
                                }
                            },
                            "button_up_short": "{{ actions_mapping[integration_id][\"button_up_short\"] }}",
                            "button_up_long": "{{ actions_mapping[integration_id][\"button_up_long\"] }}",
                            "button_up_release": "{{ actions_mapping[integration_id][\"button_up_release\"] }}",
                            "button_down_short": "{{ actions_mapping[integration_id][\"button_down_short\"] }}",
                            "button_down_long": "{{ actions_mapping[integration_id][\"button_down_long\"] }}",
                            "button_down_release": "{{ actions_mapping[integration_id][\"button_down_release\"] }}",
                            "integrations_with_prev_event_storage": [
                                "zha",
                                "zigbee2mqtt"
                            ],
                            "controller_entity": "",
                            "controller_device": "8fd4f8715be89cc0f383c887c3fac892",
                            "controller_id": "{% if integration_id==\"zigbee2mqtt\" %}{{controller_entity}}{% else %}{{controller_device}}{% endif %}"
                        },
                        "mode": "restart",
                        "max_exceeded": "silent",
                        "trigger": [
                            {
                                "platform": "event",
                                "event_type": "state_changed",
                                "event_data": {
                                    "entity_id": ""
                                }
                            },
                            {
                                "platform": "event",
                                "event_type": [
                                    "deconz_event",
                                    "zha_event"
                                ],
                                "event_data": {
                                    "device_id": "8fd4f8715be89cc0f383c887c3fac892"
                                }
                            }
                        ],
                        "condition": [
                            {
                                "condition": "and",
                                "conditions": [
                                    "{%- set trigger_action -%} {%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%} {%- endset -%} {{ trigger_action not in [\"\",\"None\"] }}",
                                    "{{ integration_id != \"zigbee2mqtt\" or trigger.event.data.new_state.state != trigger.event.data.old_state.state }}"
                                ]
                            }
                        ],
                        "action": [
                            {
                                "delay": {
                                    "milliseconds": 0
                                }
                            },
                            {
                                "variables": {
                                    "trigger_action": "{%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%}",
                                    "trigger_delta": "{{ (as_timestamp(now()) - as_timestamp((states(helper_last_controller_event) | from_json).last_triggered if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"1970-01-01 00:00:00\")) * 1000 }}",
                                    "last_controller_event": "{{ (states(helper_last_controller_event) | from_json).trigger_action if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"\" }}"
                                }
                            },
                            {
                                "service": "input_text.set_value",
                                "data": {
                                    "entity_id": "input_text.zz_powder_room_lights_controller_last_event",
                                    "value": "{{ {\"trigger_action\":trigger_action,\"last_triggered\":now()|string} | to_json }}"
                                }
                            },
                            {
                                "choose": [
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_powder_room_lights_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_up_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_up_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "choose": [
                                                                                            {
                                                                                                "conditions": [
                                                                                                    {
                                                                                                        "condition": "time",
                                                                                                        "after": "input_datetime.sleep_hours_start",
                                                                                                        "before": "input_datetime.lights_auto_control_end"
                                                                                                    }
                                                                                                ],
                                                                                                "sequence": [
                                                                                                    {
                                                                                                        "service": "light.turn_on",
                                                                                                        "target": {
                                                                                                            "entity_id": "light.powder_room_pendant_light_entity"
                                                                                                        },
                                                                                                        "data": {
                                                                                                            "brightness_pct": 5
                                                                                                        }
                                                                                                    }
                                                                                                ]
                                                                                            }
                                                                                        ],
                                                                                        "default": [
                                                                                            {
                                                                                                "service": "light.turn_on",
                                                                                                "target": {
                                                                                                    "entity_id": "light.powder_room_pendant_light_entity"
                                                                                                },
                                                                                                "data": {
                                                                                                    "brightness_pct": 100
                                                                                                }
                                                                                            }
                                                                                        ]
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_up_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [
                                                                                    {
                                                                                        "condition": "time",
                                                                                        "after": "input_datetime.sleep_hours_start",
                                                                                        "before": "input_datetime.lights_auto_control_end"
                                                                                    }
                                                                                ],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "light.turn_on",
                                                                                        "target": {
                                                                                            "entity_id": "light.powder_room_pendant_light_entity"
                                                                                        },
                                                                                        "data": {
                                                                                            "brightness_pct": 5
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ],
                                                                        "default": [
                                                                            {
                                                                                "service": "light.turn_on",
                                                                                "target": {
                                                                                    "entity_id": "light.powder_room_pendant_light_entity"
                                                                                },
                                                                                "data": {
                                                                                    "brightness_pct": 100
                                                                                }
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_up_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "light.turn_on",
                                                                            "target": {
                                                                                "entity_id": "light.powder_room_pendant_light_entity"
                                                                            },
                                                                            "data": {
                                                                                "brightness_step_pct": 10
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.powder_room_pendant_light_entity"
                                                        },
                                                        "data": {
                                                            "brightness_step_pct": 10
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_up_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_up_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_powder_room_lights_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_down_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_down_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "light.turn_off",
                                                                                        "target": {
                                                                                            "entity_id": "light.powder_room_pendant_light_entity"
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_down_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "light.turn_off",
                                                                        "target": {
                                                                            "entity_id": "light.powder_room_pendant_light_entity"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_down_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "light.turn_on",
                                                                            "target": {
                                                                                "entity_id": "light.powder_room_pendant_light_entity"
                                                                            },
                                                                            "data": {
                                                                                "brightness_step_pct": -10
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.powder_room_pendant_light_entity"
                                                        },
                                                        "data": {
                                                            "brightness_step_pct": -10
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_down_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_down_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            }
                        ],
                        "id": "1643644178195",
                        "alias": "Powder Room Lights Controller",
                        "description": "Control the Powder Room Lights"
                    },
                    "blueprint_inputs": {
                        "id": "1643644178195",
                        "alias": "Powder Room Lights Controller",
                        "description": "Control the Powder Room Lights",
                        "use_blueprint": {
                            "path": "EPMatt/ikea_e1743.yaml",
                            "input": {
                                "integration": "ZHA",
                                "controller_device": "8fd4f8715be89cc0f383c887c3fac892",
                                "helper_last_controller_event": "input_text.zz_powder_room_lights_controller_last_event",
                                "action_button_up_short": [
                                    {
                                        "choose": [
                                            {
                                                "conditions": [
                                                    {
                                                        "condition": "time",
                                                        "after": "input_datetime.sleep_hours_start",
                                                        "before": "input_datetime.lights_auto_control_end"
                                                    }
                                                ],
                                                "sequence": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.powder_room_pendant_light_entity"
                                                        },
                                                        "data": {
                                                            "brightness_pct": 5
                                                        }
                                                    }
                                                ]
                                            }
                                        ],
                                        "default": [
                                            {
                                                "service": "light.turn_on",
                                                "target": {
                                                    "entity_id": "light.powder_room_pendant_light_entity"
                                                },
                                                "data": {
                                                    "brightness_pct": 100
                                                }
                                            }
                                        ]
                                    }
                                ],
                                "action_button_up_long": [
                                    {
                                        "service": "light.turn_on",
                                        "target": {
                                            "entity_id": "light.powder_room_pendant_light_entity"
                                        },
                                        "data": {
                                            "brightness_step_pct": 10
                                        }
                                    }
                                ],
                                "action_button_down_short": [
                                    {
                                        "service": "light.turn_off",
                                        "target": {
                                            "entity_id": "light.powder_room_pendant_light_entity"
                                        }
                                    }
                                ],
                                "action_button_down_long": [
                                    {
                                        "service": "light.turn_on",
                                        "target": {
                                            "entity_id": "light.powder_room_pendant_light_entity"
                                        },
                                        "data": {
                                            "brightness_step_pct": -10
                                        }
                                    }
                                ],
                                "button_up_long_loop": true,
                                "button_up_long_max_loop_repeats": 50,
                                "button_down_long_loop": true,
                                "button_down_long_max_loop_repeats": 50
                            }
                        }
                    },
                    "context": {
                        "id": "99a2d6ca8c6082c8a707b6bc5e5025a3",
                        "parent_id": "a4357f64e89e7472d61b7dbf6cd9a948",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/3/choose/3/sequence/0/default/1/choose/0/sequence/0",
                    "run_id": "995a9d524d6312aba8fc7704c9069505",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:45:22.964525+00:00",
                        "finish": "2022-03-03T05:45:23.047229+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643644178195",
                    "trigger": "event 'zha_event'"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "b0daccce277f43b9f4cdc91772bd7ee4",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T06:32:40.944643+00:00",
                        "finish": "2022-03-03T06:32:40.953794+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643644178195",
                    "trigger": "event 'zha_event'",
                    "trace": {
                        "trigger/1": [
                            {
                                "path": "trigger/1",
                                "timestamp": "2022-03-03T06:32:40.945447+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.powder_room_lights_controller",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T05:45:22.965986+00:00",
                                            "mode": "restart",
                                            "current": 0,
                                            "id": "1643644178195",
                                            "friendly_name": "Powder Room Lights Controller"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.798769+00:00",
                                        "last_updated": "2022-03-03T05:45:23.046807+00:00",
                                        "context": {
                                            "id": "99a2d6ca8c6082c8a707b6bc5e5025a3",
                                            "parent_id": "a4357f64e89e7472d61b7dbf6cd9a948",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "1",
                                        "idx": "1",
                                        "platform": "event",
                                        "event": {
                                            "event_type": "zha_event",
                                            "data": {
                                                "device_ieee": "84:fd:27:ff:fe:37:50:2c",
                                                "unique_id": "84:fd:27:ff:fe:37:50:2c:1:0x0020",
                                                "device_id": "8fd4f8715be89cc0f383c887c3fac892",
                                                "endpoint_id": 1,
                                                "cluster_id": 32,
                                                "command": "checkin",
                                                "args": []
                                            },
                                            "origin": "LOCAL",
                                            "time_fired": "2022-03-03T06:32:40.943034+00:00",
                                            "context": {
                                                "id": "62e11f3f8bdf4bbcb5d479051e164c25",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "description": "event 'zha_event'"
                                    },
                                    "integration": "ZHA",
                                    "button_up_long_loop": true,
                                    "button_up_long_max_loop_repeats": 50,
                                    "button_up_double_press": false,
                                    "button_down_long_loop": true,
                                    "button_down_long_max_loop_repeats": 50,
                                    "button_down_double_press": false,
                                    "helper_last_controller_event": "input_text.zz_powder_room_lights_controller_last_event",
                                    "helper_double_press_delay": 500,
                                    "helper_debounce_delay": 0,
                                    "integration_id": "zha",
                                    "adjusted_double_press_delay": 500,
                                    "actions_mapping": {
                                        "deconz": {
                                            "button_up_short": [
                                                "1002"
                                            ],
                                            "button_up_long": [
                                                "1001"
                                            ],
                                            "button_up_release": [
                                                "1003"
                                            ],
                                            "button_down_short": [
                                                "2002"
                                            ],
                                            "button_down_long": [
                                                "2001"
                                            ],
                                            "button_down_release": [
                                                "2003"
                                            ]
                                        },
                                        "zha": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "move_with_on_off_0_83"
                                            ],
                                            "button_up_release": [
                                                "stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "move_1_83"
                                            ],
                                            "button_down_release": [
                                                "stop"
                                            ]
                                        },
                                        "zigbee2mqtt": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "brightness_move_up"
                                            ],
                                            "button_up_release": [
                                                "brightness_stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "brightness_move_down"
                                            ],
                                            "button_down_release": [
                                                "brightness_stop"
                                            ]
                                        }
                                    },
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ],
                                    "integrations_with_prev_event_storage": [
                                        "zha",
                                        "zigbee2mqtt"
                                    ],
                                    "controller_entity": "",
                                    "controller_device": "8fd4f8715be89cc0f383c887c3fac892",
                                    "controller_id": "8fd4f8715be89cc0f383c887c3fac892"
                                }
                            }
                        ],
                        "condition/0": [
                            {
                                "path": "condition/0",
                                "timestamp": "2022-03-03T06:32:40.945486+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "condition/0/conditions/0": [
                            {
                                "path": "condition/0/conditions/0",
                                "timestamp": "2022-03-03T06:32:40.945508+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "condition/0/conditions/1": [
                            {
                                "path": "condition/0/conditions/1",
                                "timestamp": "2022-03-03T06:32:40.945674+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T06:32:40.946626+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "549e2f80285ba59d07d9b7c26c23029c",
                                        "parent_id": "62e11f3f8bdf4bbcb5d479051e164c25",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "delay": 0.0,
                                    "done": true
                                }
                            }
                        ],
                        "action/1": [
                            {
                                "path": "action/1",
                                "timestamp": "2022-03-03T06:32:40.947973+00:00"
                            }
                        ],
                        "action/2": [
                            {
                                "path": "action/2",
                                "timestamp": "2022-03-03T06:32:40.948617+00:00",
                                "changed_variables": {
                                    "trigger_action": "checkin",
                                    "trigger_delta": 2837979.9818992615,
                                    "last_controller_event": "off"
                                },
                                "result": {
                                    "params": {
                                        "domain": "input_text",
                                        "service": "set_value",
                                        "service_data": {
                                            "entity_id": "input_text.zz_powder_room_lights_controller_last_event",
                                            "value": {
                                                "trigger_action": "checkin",
                                                "last_triggered": "2022-03-03 14:32:40.948764+08:00"
                                            }
                                        },
                                        "target": {}
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "action/3": [
                            {
                                "path": "action/3",
                                "timestamp": "2022-03-03T06:32:40.950964+00:00"
                            }
                        ],
                        "action/3/choose/0": [
                            {
                                "path": "action/3/choose/0",
                                "timestamp": "2022-03-03T06:32:40.951029+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/0/conditions/0": [
                            {
                                "path": "action/3/choose/0/conditions/0",
                                "timestamp": "2022-03-03T06:32:40.951051+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/1": [
                            {
                                "path": "action/3/choose/1",
                                "timestamp": "2022-03-03T06:32:40.951159+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/1/conditions/0": [
                            {
                                "path": "action/3/choose/1/conditions/0",
                                "timestamp": "2022-03-03T06:32:40.951177+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/2": [
                            {
                                "path": "action/3/choose/2",
                                "timestamp": "2022-03-03T06:32:40.951251+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/2/conditions/0": [
                            {
                                "path": "action/3/choose/2/conditions/0",
                                "timestamp": "2022-03-03T06:32:40.951269+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/3": [
                            {
                                "path": "action/3/choose/3",
                                "timestamp": "2022-03-03T06:32:40.951343+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/3/conditions/0": [
                            {
                                "path": "action/3/choose/3/conditions/0",
                                "timestamp": "2022-03-03T06:32:40.951362+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/4": [
                            {
                                "path": "action/3/choose/4",
                                "timestamp": "2022-03-03T06:32:40.951443+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/4/conditions/0": [
                            {
                                "path": "action/3/choose/4/conditions/0",
                                "timestamp": "2022-03-03T06:32:40.951461+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/5": [
                            {
                                "path": "action/3/choose/5",
                                "timestamp": "2022-03-03T06:32:40.951539+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/5/conditions/0": [
                            {
                                "path": "action/3/choose/5/conditions/0",
                                "timestamp": "2022-03-03T06:32:40.951558+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ]
                    },
                    "config": {
                        "variables": {
                            "integration": "ZHA",
                            "button_up_long_loop": true,
                            "button_up_long_max_loop_repeats": 50,
                            "button_up_double_press": false,
                            "button_down_long_loop": true,
                            "button_down_long_max_loop_repeats": 50,
                            "button_down_double_press": false,
                            "helper_last_controller_event": "input_text.zz_powder_room_lights_controller_last_event",
                            "helper_double_press_delay": 500,
                            "helper_debounce_delay": 0,
                            "integration_id": "{{ integration | lower }}",
                            "adjusted_double_press_delay": "{{ [helper_double_press_delay - helper_debounce_delay, 100] | max }}",
                            "actions_mapping": {
                                "deconz": {
                                    "button_up_short": [
                                        "1002"
                                    ],
                                    "button_up_long": [
                                        "1001"
                                    ],
                                    "button_up_release": [
                                        "1003"
                                    ],
                                    "button_down_short": [
                                        "2002"
                                    ],
                                    "button_down_long": [
                                        "2001"
                                    ],
                                    "button_down_release": [
                                        "2003"
                                    ]
                                },
                                "zha": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ]
                                },
                                "zigbee2mqtt": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "brightness_move_up"
                                    ],
                                    "button_up_release": [
                                        "brightness_stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "brightness_move_down"
                                    ],
                                    "button_down_release": [
                                        "brightness_stop"
                                    ]
                                }
                            },
                            "button_up_short": "{{ actions_mapping[integration_id][\"button_up_short\"] }}",
                            "button_up_long": "{{ actions_mapping[integration_id][\"button_up_long\"] }}",
                            "button_up_release": "{{ actions_mapping[integration_id][\"button_up_release\"] }}",
                            "button_down_short": "{{ actions_mapping[integration_id][\"button_down_short\"] }}",
                            "button_down_long": "{{ actions_mapping[integration_id][\"button_down_long\"] }}",
                            "button_down_release": "{{ actions_mapping[integration_id][\"button_down_release\"] }}",
                            "integrations_with_prev_event_storage": [
                                "zha",
                                "zigbee2mqtt"
                            ],
                            "controller_entity": "",
                            "controller_device": "8fd4f8715be89cc0f383c887c3fac892",
                            "controller_id": "{% if integration_id==\"zigbee2mqtt\" %}{{controller_entity}}{% else %}{{controller_device}}{% endif %}"
                        },
                        "mode": "restart",
                        "max_exceeded": "silent",
                        "trigger": [
                            {
                                "platform": "event",
                                "event_type": "state_changed",
                                "event_data": {
                                    "entity_id": ""
                                }
                            },
                            {
                                "platform": "event",
                                "event_type": [
                                    "deconz_event",
                                    "zha_event"
                                ],
                                "event_data": {
                                    "device_id": "8fd4f8715be89cc0f383c887c3fac892"
                                }
                            }
                        ],
                        "condition": [
                            {
                                "condition": "and",
                                "conditions": [
                                    "{%- set trigger_action -%} {%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%} {%- endset -%} {{ trigger_action not in [\"\",\"None\"] }}",
                                    "{{ integration_id != \"zigbee2mqtt\" or trigger.event.data.new_state.state != trigger.event.data.old_state.state }}"
                                ]
                            }
                        ],
                        "action": [
                            {
                                "delay": {
                                    "milliseconds": 0
                                }
                            },
                            {
                                "variables": {
                                    "trigger_action": "{%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%}",
                                    "trigger_delta": "{{ (as_timestamp(now()) - as_timestamp((states(helper_last_controller_event) | from_json).last_triggered if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"1970-01-01 00:00:00\")) * 1000 }}",
                                    "last_controller_event": "{{ (states(helper_last_controller_event) | from_json).trigger_action if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"\" }}"
                                }
                            },
                            {
                                "service": "input_text.set_value",
                                "data": {
                                    "entity_id": "input_text.zz_powder_room_lights_controller_last_event",
                                    "value": "{{ {\"trigger_action\":trigger_action,\"last_triggered\":now()|string} | to_json }}"
                                }
                            },
                            {
                                "choose": [
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_powder_room_lights_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_up_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_up_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "choose": [
                                                                                            {
                                                                                                "conditions": [
                                                                                                    {
                                                                                                        "condition": "time",
                                                                                                        "after": "input_datetime.sleep_hours_start",
                                                                                                        "before": "input_datetime.lights_auto_control_end"
                                                                                                    }
                                                                                                ],
                                                                                                "sequence": [
                                                                                                    {
                                                                                                        "service": "light.turn_on",
                                                                                                        "target": {
                                                                                                            "entity_id": "light.powder_room_pendant_light_entity"
                                                                                                        },
                                                                                                        "data": {
                                                                                                            "brightness_pct": 5
                                                                                                        }
                                                                                                    }
                                                                                                ]
                                                                                            }
                                                                                        ],
                                                                                        "default": [
                                                                                            {
                                                                                                "service": "light.turn_on",
                                                                                                "target": {
                                                                                                    "entity_id": "light.powder_room_pendant_light_entity"
                                                                                                },
                                                                                                "data": {
                                                                                                    "brightness_pct": 100
                                                                                                }
                                                                                            }
                                                                                        ]
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_up_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [
                                                                                    {
                                                                                        "condition": "time",
                                                                                        "after": "input_datetime.sleep_hours_start",
                                                                                        "before": "input_datetime.lights_auto_control_end"
                                                                                    }
                                                                                ],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "light.turn_on",
                                                                                        "target": {
                                                                                            "entity_id": "light.powder_room_pendant_light_entity"
                                                                                        },
                                                                                        "data": {
                                                                                            "brightness_pct": 5
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ],
                                                                        "default": [
                                                                            {
                                                                                "service": "light.turn_on",
                                                                                "target": {
                                                                                    "entity_id": "light.powder_room_pendant_light_entity"
                                                                                },
                                                                                "data": {
                                                                                    "brightness_pct": 100
                                                                                }
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_up_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "light.turn_on",
                                                                            "target": {
                                                                                "entity_id": "light.powder_room_pendant_light_entity"
                                                                            },
                                                                            "data": {
                                                                                "brightness_step_pct": 10
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.powder_room_pendant_light_entity"
                                                        },
                                                        "data": {
                                                            "brightness_step_pct": 10
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_up_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_up_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_powder_room_lights_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_down_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_down_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "light.turn_off",
                                                                                        "target": {
                                                                                            "entity_id": "light.powder_room_pendant_light_entity"
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_down_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "light.turn_off",
                                                                        "target": {
                                                                            "entity_id": "light.powder_room_pendant_light_entity"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_down_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "light.turn_on",
                                                                            "target": {
                                                                                "entity_id": "light.powder_room_pendant_light_entity"
                                                                            },
                                                                            "data": {
                                                                                "brightness_step_pct": -10
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.powder_room_pendant_light_entity"
                                                        },
                                                        "data": {
                                                            "brightness_step_pct": -10
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_down_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_down_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            }
                        ],
                        "id": "1643644178195",
                        "alias": "Powder Room Lights Controller",
                        "description": "Control the Powder Room Lights"
                    },
                    "blueprint_inputs": {
                        "id": "1643644178195",
                        "alias": "Powder Room Lights Controller",
                        "description": "Control the Powder Room Lights",
                        "use_blueprint": {
                            "path": "EPMatt/ikea_e1743.yaml",
                            "input": {
                                "integration": "ZHA",
                                "controller_device": "8fd4f8715be89cc0f383c887c3fac892",
                                "helper_last_controller_event": "input_text.zz_powder_room_lights_controller_last_event",
                                "action_button_up_short": [
                                    {
                                        "choose": [
                                            {
                                                "conditions": [
                                                    {
                                                        "condition": "time",
                                                        "after": "input_datetime.sleep_hours_start",
                                                        "before": "input_datetime.lights_auto_control_end"
                                                    }
                                                ],
                                                "sequence": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.powder_room_pendant_light_entity"
                                                        },
                                                        "data": {
                                                            "brightness_pct": 5
                                                        }
                                                    }
                                                ]
                                            }
                                        ],
                                        "default": [
                                            {
                                                "service": "light.turn_on",
                                                "target": {
                                                    "entity_id": "light.powder_room_pendant_light_entity"
                                                },
                                                "data": {
                                                    "brightness_pct": 100
                                                }
                                            }
                                        ]
                                    }
                                ],
                                "action_button_up_long": [
                                    {
                                        "service": "light.turn_on",
                                        "target": {
                                            "entity_id": "light.powder_room_pendant_light_entity"
                                        },
                                        "data": {
                                            "brightness_step_pct": 10
                                        }
                                    }
                                ],
                                "action_button_down_short": [
                                    {
                                        "service": "light.turn_off",
                                        "target": {
                                            "entity_id": "light.powder_room_pendant_light_entity"
                                        }
                                    }
                                ],
                                "action_button_down_long": [
                                    {
                                        "service": "light.turn_on",
                                        "target": {
                                            "entity_id": "light.powder_room_pendant_light_entity"
                                        },
                                        "data": {
                                            "brightness_step_pct": -10
                                        }
                                    }
                                ],
                                "button_up_long_loop": true,
                                "button_up_long_max_loop_repeats": 50,
                                "button_down_long_loop": true,
                                "button_down_long_max_loop_repeats": 50
                            }
                        }
                    },
                    "context": {
                        "id": "549e2f80285ba59d07d9b7c26c23029c",
                        "parent_id": "62e11f3f8bdf4bbcb5d479051e164c25",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "b0daccce277f43b9f4cdc91772bd7ee4",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T06:32:40.944643+00:00",
                        "finish": "2022-03-03T06:32:40.953794+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643644178195",
                    "trigger": "event 'zha_event'"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "3975726197b98c18ba8ae512692a0615",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T07:29:22.423248+00:00",
                        "finish": "2022-03-03T07:29:22.430063+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643644178195",
                    "trigger": "event 'zha_event'",
                    "trace": {
                        "trigger/1": [
                            {
                                "path": "trigger/1",
                                "timestamp": "2022-03-03T07:29:22.424074+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.powder_room_lights_controller",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T06:32:40.945919+00:00",
                                            "mode": "restart",
                                            "current": 0,
                                            "id": "1643644178195",
                                            "friendly_name": "Powder Room Lights Controller"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.798769+00:00",
                                        "last_updated": "2022-03-03T06:32:40.952675+00:00",
                                        "context": {
                                            "id": "549e2f80285ba59d07d9b7c26c23029c",
                                            "parent_id": "62e11f3f8bdf4bbcb5d479051e164c25",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "1",
                                        "idx": "1",
                                        "platform": "event",
                                        "event": {
                                            "event_type": "zha_event",
                                            "data": {
                                                "device_ieee": "84:fd:27:ff:fe:37:50:2c",
                                                "unique_id": "84:fd:27:ff:fe:37:50:2c:1:0x0020",
                                                "device_id": "8fd4f8715be89cc0f383c887c3fac892",
                                                "endpoint_id": 1,
                                                "cluster_id": 32,
                                                "command": "checkin",
                                                "args": []
                                            },
                                            "origin": "LOCAL",
                                            "time_fired": "2022-03-03T07:29:22.422036+00:00",
                                            "context": {
                                                "id": "df409eff0fa43869eb411ecdba97910c",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "description": "event 'zha_event'"
                                    },
                                    "integration": "ZHA",
                                    "button_up_long_loop": true,
                                    "button_up_long_max_loop_repeats": 50,
                                    "button_up_double_press": false,
                                    "button_down_long_loop": true,
                                    "button_down_long_max_loop_repeats": 50,
                                    "button_down_double_press": false,
                                    "helper_last_controller_event": "input_text.zz_powder_room_lights_controller_last_event",
                                    "helper_double_press_delay": 500,
                                    "helper_debounce_delay": 0,
                                    "integration_id": "zha",
                                    "adjusted_double_press_delay": 500,
                                    "actions_mapping": {
                                        "deconz": {
                                            "button_up_short": [
                                                "1002"
                                            ],
                                            "button_up_long": [
                                                "1001"
                                            ],
                                            "button_up_release": [
                                                "1003"
                                            ],
                                            "button_down_short": [
                                                "2002"
                                            ],
                                            "button_down_long": [
                                                "2001"
                                            ],
                                            "button_down_release": [
                                                "2003"
                                            ]
                                        },
                                        "zha": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "move_with_on_off_0_83"
                                            ],
                                            "button_up_release": [
                                                "stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "move_1_83"
                                            ],
                                            "button_down_release": [
                                                "stop"
                                            ]
                                        },
                                        "zigbee2mqtt": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "brightness_move_up"
                                            ],
                                            "button_up_release": [
                                                "brightness_stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "brightness_move_down"
                                            ],
                                            "button_down_release": [
                                                "brightness_stop"
                                            ]
                                        }
                                    },
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ],
                                    "integrations_with_prev_event_storage": [
                                        "zha",
                                        "zigbee2mqtt"
                                    ],
                                    "controller_entity": "",
                                    "controller_device": "8fd4f8715be89cc0f383c887c3fac892",
                                    "controller_id": "8fd4f8715be89cc0f383c887c3fac892"
                                }
                            }
                        ],
                        "condition/0": [
                            {
                                "path": "condition/0",
                                "timestamp": "2022-03-03T07:29:22.424129+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "condition/0/conditions/0": [
                            {
                                "path": "condition/0/conditions/0",
                                "timestamp": "2022-03-03T07:29:22.424155+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "condition/0/conditions/1": [
                            {
                                "path": "condition/0/conditions/1",
                                "timestamp": "2022-03-03T07:29:22.424321+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T07:29:22.425099+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "71f39aadc3a469bfc25308f598cb7155",
                                        "parent_id": "df409eff0fa43869eb411ecdba97910c",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "delay": 0.0,
                                    "done": true
                                }
                            }
                        ],
                        "action/1": [
                            {
                                "path": "action/1",
                                "timestamp": "2022-03-03T07:29:22.426052+00:00"
                            }
                        ],
                        "action/2": [
                            {
                                "path": "action/2",
                                "timestamp": "2022-03-03T07:29:22.426624+00:00",
                                "changed_variables": {
                                    "trigger_action": "checkin",
                                    "trigger_delta": 3401477.5400161743,
                                    "last_controller_event": "checkin"
                                },
                                "result": {
                                    "params": {
                                        "domain": "input_text",
                                        "service": "set_value",
                                        "service_data": {
                                            "entity_id": "input_text.zz_powder_room_lights_controller_last_event",
                                            "value": {
                                                "trigger_action": "checkin",
                                                "last_triggered": "2022-03-03 15:29:22.426750+08:00"
                                            }
                                        },
                                        "target": {}
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "action/3": [
                            {
                                "path": "action/3",
                                "timestamp": "2022-03-03T07:29:22.428985+00:00"
                            }
                        ],
                        "action/3/choose/0": [
                            {
                                "path": "action/3/choose/0",
                                "timestamp": "2022-03-03T07:29:22.429056+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/0/conditions/0": [
                            {
                                "path": "action/3/choose/0/conditions/0",
                                "timestamp": "2022-03-03T07:29:22.429078+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/1": [
                            {
                                "path": "action/3/choose/1",
                                "timestamp": "2022-03-03T07:29:22.429185+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/1/conditions/0": [
                            {
                                "path": "action/3/choose/1/conditions/0",
                                "timestamp": "2022-03-03T07:29:22.429205+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/2": [
                            {
                                "path": "action/3/choose/2",
                                "timestamp": "2022-03-03T07:29:22.429287+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/2/conditions/0": [
                            {
                                "path": "action/3/choose/2/conditions/0",
                                "timestamp": "2022-03-03T07:29:22.429306+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/3": [
                            {
                                "path": "action/3/choose/3",
                                "timestamp": "2022-03-03T07:29:22.429393+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/3/conditions/0": [
                            {
                                "path": "action/3/choose/3/conditions/0",
                                "timestamp": "2022-03-03T07:29:22.429411+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/4": [
                            {
                                "path": "action/3/choose/4",
                                "timestamp": "2022-03-03T07:29:22.429475+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/4/conditions/0": [
                            {
                                "path": "action/3/choose/4/conditions/0",
                                "timestamp": "2022-03-03T07:29:22.429492+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/5": [
                            {
                                "path": "action/3/choose/5",
                                "timestamp": "2022-03-03T07:29:22.429556+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/5/conditions/0": [
                            {
                                "path": "action/3/choose/5/conditions/0",
                                "timestamp": "2022-03-03T07:29:22.429573+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ]
                    },
                    "config": {
                        "variables": {
                            "integration": "ZHA",
                            "button_up_long_loop": true,
                            "button_up_long_max_loop_repeats": 50,
                            "button_up_double_press": false,
                            "button_down_long_loop": true,
                            "button_down_long_max_loop_repeats": 50,
                            "button_down_double_press": false,
                            "helper_last_controller_event": "input_text.zz_powder_room_lights_controller_last_event",
                            "helper_double_press_delay": 500,
                            "helper_debounce_delay": 0,
                            "integration_id": "{{ integration | lower }}",
                            "adjusted_double_press_delay": "{{ [helper_double_press_delay - helper_debounce_delay, 100] | max }}",
                            "actions_mapping": {
                                "deconz": {
                                    "button_up_short": [
                                        "1002"
                                    ],
                                    "button_up_long": [
                                        "1001"
                                    ],
                                    "button_up_release": [
                                        "1003"
                                    ],
                                    "button_down_short": [
                                        "2002"
                                    ],
                                    "button_down_long": [
                                        "2001"
                                    ],
                                    "button_down_release": [
                                        "2003"
                                    ]
                                },
                                "zha": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ]
                                },
                                "zigbee2mqtt": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "brightness_move_up"
                                    ],
                                    "button_up_release": [
                                        "brightness_stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "brightness_move_down"
                                    ],
                                    "button_down_release": [
                                        "brightness_stop"
                                    ]
                                }
                            },
                            "button_up_short": "{{ actions_mapping[integration_id][\"button_up_short\"] }}",
                            "button_up_long": "{{ actions_mapping[integration_id][\"button_up_long\"] }}",
                            "button_up_release": "{{ actions_mapping[integration_id][\"button_up_release\"] }}",
                            "button_down_short": "{{ actions_mapping[integration_id][\"button_down_short\"] }}",
                            "button_down_long": "{{ actions_mapping[integration_id][\"button_down_long\"] }}",
                            "button_down_release": "{{ actions_mapping[integration_id][\"button_down_release\"] }}",
                            "integrations_with_prev_event_storage": [
                                "zha",
                                "zigbee2mqtt"
                            ],
                            "controller_entity": "",
                            "controller_device": "8fd4f8715be89cc0f383c887c3fac892",
                            "controller_id": "{% if integration_id==\"zigbee2mqtt\" %}{{controller_entity}}{% else %}{{controller_device}}{% endif %}"
                        },
                        "mode": "restart",
                        "max_exceeded": "silent",
                        "trigger": [
                            {
                                "platform": "event",
                                "event_type": "state_changed",
                                "event_data": {
                                    "entity_id": ""
                                }
                            },
                            {
                                "platform": "event",
                                "event_type": [
                                    "deconz_event",
                                    "zha_event"
                                ],
                                "event_data": {
                                    "device_id": "8fd4f8715be89cc0f383c887c3fac892"
                                }
                            }
                        ],
                        "condition": [
                            {
                                "condition": "and",
                                "conditions": [
                                    "{%- set trigger_action -%} {%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%} {%- endset -%} {{ trigger_action not in [\"\",\"None\"] }}",
                                    "{{ integration_id != \"zigbee2mqtt\" or trigger.event.data.new_state.state != trigger.event.data.old_state.state }}"
                                ]
                            }
                        ],
                        "action": [
                            {
                                "delay": {
                                    "milliseconds": 0
                                }
                            },
                            {
                                "variables": {
                                    "trigger_action": "{%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%}",
                                    "trigger_delta": "{{ (as_timestamp(now()) - as_timestamp((states(helper_last_controller_event) | from_json).last_triggered if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"1970-01-01 00:00:00\")) * 1000 }}",
                                    "last_controller_event": "{{ (states(helper_last_controller_event) | from_json).trigger_action if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"\" }}"
                                }
                            },
                            {
                                "service": "input_text.set_value",
                                "data": {
                                    "entity_id": "input_text.zz_powder_room_lights_controller_last_event",
                                    "value": "{{ {\"trigger_action\":trigger_action,\"last_triggered\":now()|string} | to_json }}"
                                }
                            },
                            {
                                "choose": [
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_powder_room_lights_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_up_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_up_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "choose": [
                                                                                            {
                                                                                                "conditions": [
                                                                                                    {
                                                                                                        "condition": "time",
                                                                                                        "after": "input_datetime.sleep_hours_start",
                                                                                                        "before": "input_datetime.lights_auto_control_end"
                                                                                                    }
                                                                                                ],
                                                                                                "sequence": [
                                                                                                    {
                                                                                                        "service": "light.turn_on",
                                                                                                        "target": {
                                                                                                            "entity_id": "light.powder_room_pendant_light_entity"
                                                                                                        },
                                                                                                        "data": {
                                                                                                            "brightness_pct": 5
                                                                                                        }
                                                                                                    }
                                                                                                ]
                                                                                            }
                                                                                        ],
                                                                                        "default": [
                                                                                            {
                                                                                                "service": "light.turn_on",
                                                                                                "target": {
                                                                                                    "entity_id": "light.powder_room_pendant_light_entity"
                                                                                                },
                                                                                                "data": {
                                                                                                    "brightness_pct": 100
                                                                                                }
                                                                                            }
                                                                                        ]
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_up_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [
                                                                                    {
                                                                                        "condition": "time",
                                                                                        "after": "input_datetime.sleep_hours_start",
                                                                                        "before": "input_datetime.lights_auto_control_end"
                                                                                    }
                                                                                ],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "light.turn_on",
                                                                                        "target": {
                                                                                            "entity_id": "light.powder_room_pendant_light_entity"
                                                                                        },
                                                                                        "data": {
                                                                                            "brightness_pct": 5
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ],
                                                                        "default": [
                                                                            {
                                                                                "service": "light.turn_on",
                                                                                "target": {
                                                                                    "entity_id": "light.powder_room_pendant_light_entity"
                                                                                },
                                                                                "data": {
                                                                                    "brightness_pct": 100
                                                                                }
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_up_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "light.turn_on",
                                                                            "target": {
                                                                                "entity_id": "light.powder_room_pendant_light_entity"
                                                                            },
                                                                            "data": {
                                                                                "brightness_step_pct": 10
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.powder_room_pendant_light_entity"
                                                        },
                                                        "data": {
                                                            "brightness_step_pct": 10
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_up_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_up_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_powder_room_lights_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_down_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_down_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "light.turn_off",
                                                                                        "target": {
                                                                                            "entity_id": "light.powder_room_pendant_light_entity"
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_down_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "light.turn_off",
                                                                        "target": {
                                                                            "entity_id": "light.powder_room_pendant_light_entity"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_down_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "light.turn_on",
                                                                            "target": {
                                                                                "entity_id": "light.powder_room_pendant_light_entity"
                                                                            },
                                                                            "data": {
                                                                                "brightness_step_pct": -10
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.powder_room_pendant_light_entity"
                                                        },
                                                        "data": {
                                                            "brightness_step_pct": -10
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_down_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_down_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            }
                        ],
                        "id": "1643644178195",
                        "alias": "Powder Room Lights Controller",
                        "description": "Control the Powder Room Lights"
                    },
                    "blueprint_inputs": {
                        "id": "1643644178195",
                        "alias": "Powder Room Lights Controller",
                        "description": "Control the Powder Room Lights",
                        "use_blueprint": {
                            "path": "EPMatt/ikea_e1743.yaml",
                            "input": {
                                "integration": "ZHA",
                                "controller_device": "8fd4f8715be89cc0f383c887c3fac892",
                                "helper_last_controller_event": "input_text.zz_powder_room_lights_controller_last_event",
                                "action_button_up_short": [
                                    {
                                        "choose": [
                                            {
                                                "conditions": [
                                                    {
                                                        "condition": "time",
                                                        "after": "input_datetime.sleep_hours_start",
                                                        "before": "input_datetime.lights_auto_control_end"
                                                    }
                                                ],
                                                "sequence": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.powder_room_pendant_light_entity"
                                                        },
                                                        "data": {
                                                            "brightness_pct": 5
                                                        }
                                                    }
                                                ]
                                            }
                                        ],
                                        "default": [
                                            {
                                                "service": "light.turn_on",
                                                "target": {
                                                    "entity_id": "light.powder_room_pendant_light_entity"
                                                },
                                                "data": {
                                                    "brightness_pct": 100
                                                }
                                            }
                                        ]
                                    }
                                ],
                                "action_button_up_long": [
                                    {
                                        "service": "light.turn_on",
                                        "target": {
                                            "entity_id": "light.powder_room_pendant_light_entity"
                                        },
                                        "data": {
                                            "brightness_step_pct": 10
                                        }
                                    }
                                ],
                                "action_button_down_short": [
                                    {
                                        "service": "light.turn_off",
                                        "target": {
                                            "entity_id": "light.powder_room_pendant_light_entity"
                                        }
                                    }
                                ],
                                "action_button_down_long": [
                                    {
                                        "service": "light.turn_on",
                                        "target": {
                                            "entity_id": "light.powder_room_pendant_light_entity"
                                        },
                                        "data": {
                                            "brightness_step_pct": -10
                                        }
                                    }
                                ],
                                "button_up_long_loop": true,
                                "button_up_long_max_loop_repeats": 50,
                                "button_down_long_loop": true,
                                "button_down_long_max_loop_repeats": 50
                            }
                        }
                    },
                    "context": {
                        "id": "71f39aadc3a469bfc25308f598cb7155",
                        "parent_id": "df409eff0fa43869eb411ecdba97910c",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "3975726197b98c18ba8ae512692a0615",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T07:29:22.423248+00:00",
                        "finish": "2022-03-03T07:29:22.430063+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643644178195",
                    "trigger": "event 'zha_event'"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/3/choose/3/sequence/0/default/1/choose/0/sequence/0",
                    "run_id": "4367454806820068537c3de6c7564c62",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T07:47:25.086559+00:00",
                        "finish": "2022-03-03T07:47:25.154905+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643644178195",
                    "trigger": "event 'zha_event'",
                    "trace": {
                        "trigger/1": [
                            {
                                "path": "trigger/1",
                                "timestamp": "2022-03-03T07:47:25.087357+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.powder_room_lights_controller",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T07:29:22.424520+00:00",
                                            "mode": "restart",
                                            "current": 0,
                                            "id": "1643644178195",
                                            "friendly_name": "Powder Room Lights Controller"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.798769+00:00",
                                        "last_updated": "2022-03-03T07:29:22.429711+00:00",
                                        "context": {
                                            "id": "71f39aadc3a469bfc25308f598cb7155",
                                            "parent_id": "df409eff0fa43869eb411ecdba97910c",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "1",
                                        "idx": "1",
                                        "platform": "event",
                                        "event": {
                                            "event_type": "zha_event",
                                            "data": {
                                                "device_ieee": "84:fd:27:ff:fe:37:50:2c",
                                                "unique_id": "84:fd:27:ff:fe:37:50:2c:1:0x0006",
                                                "device_id": "8fd4f8715be89cc0f383c887c3fac892",
                                                "endpoint_id": 1,
                                                "cluster_id": 6,
                                                "command": "off",
                                                "args": []
                                            },
                                            "origin": "LOCAL",
                                            "time_fired": "2022-03-03T07:47:25.085949+00:00",
                                            "context": {
                                                "id": "d5fd068b521d5a87b19f1099b05e044b",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "description": "event 'zha_event'"
                                    },
                                    "integration": "ZHA",
                                    "button_up_long_loop": true,
                                    "button_up_long_max_loop_repeats": 50,
                                    "button_up_double_press": false,
                                    "button_down_long_loop": true,
                                    "button_down_long_max_loop_repeats": 50,
                                    "button_down_double_press": false,
                                    "helper_last_controller_event": "input_text.zz_powder_room_lights_controller_last_event",
                                    "helper_double_press_delay": 500,
                                    "helper_debounce_delay": 0,
                                    "integration_id": "zha",
                                    "adjusted_double_press_delay": 500,
                                    "actions_mapping": {
                                        "deconz": {
                                            "button_up_short": [
                                                "1002"
                                            ],
                                            "button_up_long": [
                                                "1001"
                                            ],
                                            "button_up_release": [
                                                "1003"
                                            ],
                                            "button_down_short": [
                                                "2002"
                                            ],
                                            "button_down_long": [
                                                "2001"
                                            ],
                                            "button_down_release": [
                                                "2003"
                                            ]
                                        },
                                        "zha": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "move_with_on_off_0_83"
                                            ],
                                            "button_up_release": [
                                                "stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "move_1_83"
                                            ],
                                            "button_down_release": [
                                                "stop"
                                            ]
                                        },
                                        "zigbee2mqtt": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "brightness_move_up"
                                            ],
                                            "button_up_release": [
                                                "brightness_stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "brightness_move_down"
                                            ],
                                            "button_down_release": [
                                                "brightness_stop"
                                            ]
                                        }
                                    },
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ],
                                    "integrations_with_prev_event_storage": [
                                        "zha",
                                        "zigbee2mqtt"
                                    ],
                                    "controller_entity": "",
                                    "controller_device": "8fd4f8715be89cc0f383c887c3fac892",
                                    "controller_id": "8fd4f8715be89cc0f383c887c3fac892"
                                }
                            }
                        ],
                        "condition/0": [
                            {
                                "path": "condition/0",
                                "timestamp": "2022-03-03T07:47:25.087386+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "condition/0/conditions/0": [
                            {
                                "path": "condition/0/conditions/0",
                                "timestamp": "2022-03-03T07:47:25.087404+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "condition/0/conditions/1": [
                            {
                                "path": "condition/0/conditions/1",
                                "timestamp": "2022-03-03T07:47:25.087544+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T07:47:25.088354+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "44677091b74cbcb3c44910e9e3ae8560",
                                        "parent_id": "d5fd068b521d5a87b19f1099b05e044b",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "delay": 0.0,
                                    "done": true
                                }
                            }
                        ],
                        "action/1": [
                            {
                                "path": "action/1",
                                "timestamp": "2022-03-03T07:47:25.089510+00:00"
                            }
                        ],
                        "action/2": [
                            {
                                "path": "action/2",
                                "timestamp": "2022-03-03T07:47:25.090211+00:00",
                                "changed_variables": {
                                    "trigger_action": "off",
                                    "trigger_delta": 1082663.0699634552,
                                    "last_controller_event": "checkin"
                                },
                                "result": {
                                    "params": {
                                        "domain": "input_text",
                                        "service": "set_value",
                                        "service_data": {
                                            "entity_id": "input_text.zz_powder_room_lights_controller_last_event",
                                            "value": {
                                                "trigger_action": "off",
                                                "last_triggered": "2022-03-03 15:47:25.090325+08:00"
                                            }
                                        },
                                        "target": {}
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "action/3": [
                            {
                                "path": "action/3",
                                "timestamp": "2022-03-03T07:47:25.092889+00:00",
                                "result": {
                                    "choice": 3
                                }
                            }
                        ],
                        "action/3/choose/0": [
                            {
                                "path": "action/3/choose/0",
                                "timestamp": "2022-03-03T07:47:25.092950+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/0/conditions/0": [
                            {
                                "path": "action/3/choose/0/conditions/0",
                                "timestamp": "2022-03-03T07:47:25.092973+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/1": [
                            {
                                "path": "action/3/choose/1",
                                "timestamp": "2022-03-03T07:47:25.093103+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/1/conditions/0": [
                            {
                                "path": "action/3/choose/1/conditions/0",
                                "timestamp": "2022-03-03T07:47:25.093141+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/2": [
                            {
                                "path": "action/3/choose/2",
                                "timestamp": "2022-03-03T07:47:25.093245+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/2/conditions/0": [
                            {
                                "path": "action/3/choose/2/conditions/0",
                                "timestamp": "2022-03-03T07:47:25.093267+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/3": [
                            {
                                "path": "action/3/choose/3",
                                "timestamp": "2022-03-03T07:47:25.093358+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/3/choose/3/conditions/0": [
                            {
                                "path": "action/3/choose/3/conditions/0",
                                "timestamp": "2022-03-03T07:47:25.093379+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/3/sequence/0": [
                            {
                                "path": "action/3/choose/3/sequence/0",
                                "timestamp": "2022-03-03T07:47:25.093673+00:00",
                                "result": {
                                    "choice": "default"
                                }
                            }
                        ],
                        "action/3/choose/3/sequence/0/choose/0": [
                            {
                                "path": "action/3/choose/3/sequence/0/choose/0",
                                "timestamp": "2022-03-03T07:47:25.093747+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/3/sequence/0/choose/0/conditions/0": [
                            {
                                "path": "action/3/choose/3/sequence/0/choose/0/conditions/0",
                                "timestamp": "2022-03-03T07:47:25.093770+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/3/sequence/0/default/0": [
                            {
                                "path": "action/3/choose/3/sequence/0/default/0",
                                "timestamp": "2022-03-03T07:47:25.094016+00:00",
                                "result": {
                                    "event": "ahb_controller_event",
                                    "event_data": {
                                        "controller": "8fd4f8715be89cc0f383c887c3fac892",
                                        "action": "button_down_short"
                                    }
                                }
                            }
                        ],
                        "action/3/choose/3/sequence/0/default/1": [
                            {
                                "path": "action/3/choose/3/sequence/0/default/1",
                                "timestamp": "2022-03-03T07:47:25.094189+00:00",
                                "result": {
                                    "choice": 0
                                }
                            }
                        ],
                        "action/3/choose/3/sequence/0/default/1/choose/0": [
                            {
                                "path": "action/3/choose/3/sequence/0/default/1/choose/0",
                                "timestamp": "2022-03-03T07:47:25.094227+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/3/choose/3/sequence/0/default/1/choose/0/sequence/0": [
                            {
                                "path": "action/3/choose/3/sequence/0/default/1/choose/0/sequence/0",
                                "timestamp": "2022-03-03T07:47:25.094512+00:00",
                                "result": {
                                    "params": {
                                        "domain": "light",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "light.powder_room_pendant_light_entity"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ]
                    },
                    "config": {
                        "variables": {
                            "integration": "ZHA",
                            "button_up_long_loop": true,
                            "button_up_long_max_loop_repeats": 50,
                            "button_up_double_press": false,
                            "button_down_long_loop": true,
                            "button_down_long_max_loop_repeats": 50,
                            "button_down_double_press": false,
                            "helper_last_controller_event": "input_text.zz_powder_room_lights_controller_last_event",
                            "helper_double_press_delay": 500,
                            "helper_debounce_delay": 0,
                            "integration_id": "{{ integration | lower }}",
                            "adjusted_double_press_delay": "{{ [helper_double_press_delay - helper_debounce_delay, 100] | max }}",
                            "actions_mapping": {
                                "deconz": {
                                    "button_up_short": [
                                        "1002"
                                    ],
                                    "button_up_long": [
                                        "1001"
                                    ],
                                    "button_up_release": [
                                        "1003"
                                    ],
                                    "button_down_short": [
                                        "2002"
                                    ],
                                    "button_down_long": [
                                        "2001"
                                    ],
                                    "button_down_release": [
                                        "2003"
                                    ]
                                },
                                "zha": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ]
                                },
                                "zigbee2mqtt": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "brightness_move_up"
                                    ],
                                    "button_up_release": [
                                        "brightness_stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "brightness_move_down"
                                    ],
                                    "button_down_release": [
                                        "brightness_stop"
                                    ]
                                }
                            },
                            "button_up_short": "{{ actions_mapping[integration_id][\"button_up_short\"] }}",
                            "button_up_long": "{{ actions_mapping[integration_id][\"button_up_long\"] }}",
                            "button_up_release": "{{ actions_mapping[integration_id][\"button_up_release\"] }}",
                            "button_down_short": "{{ actions_mapping[integration_id][\"button_down_short\"] }}",
                            "button_down_long": "{{ actions_mapping[integration_id][\"button_down_long\"] }}",
                            "button_down_release": "{{ actions_mapping[integration_id][\"button_down_release\"] }}",
                            "integrations_with_prev_event_storage": [
                                "zha",
                                "zigbee2mqtt"
                            ],
                            "controller_entity": "",
                            "controller_device": "8fd4f8715be89cc0f383c887c3fac892",
                            "controller_id": "{% if integration_id==\"zigbee2mqtt\" %}{{controller_entity}}{% else %}{{controller_device}}{% endif %}"
                        },
                        "mode": "restart",
                        "max_exceeded": "silent",
                        "trigger": [
                            {
                                "platform": "event",
                                "event_type": "state_changed",
                                "event_data": {
                                    "entity_id": ""
                                }
                            },
                            {
                                "platform": "event",
                                "event_type": [
                                    "deconz_event",
                                    "zha_event"
                                ],
                                "event_data": {
                                    "device_id": "8fd4f8715be89cc0f383c887c3fac892"
                                }
                            }
                        ],
                        "condition": [
                            {
                                "condition": "and",
                                "conditions": [
                                    "{%- set trigger_action -%} {%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%} {%- endset -%} {{ trigger_action not in [\"\",\"None\"] }}",
                                    "{{ integration_id != \"zigbee2mqtt\" or trigger.event.data.new_state.state != trigger.event.data.old_state.state }}"
                                ]
                            }
                        ],
                        "action": [
                            {
                                "delay": {
                                    "milliseconds": 0
                                }
                            },
                            {
                                "variables": {
                                    "trigger_action": "{%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%}",
                                    "trigger_delta": "{{ (as_timestamp(now()) - as_timestamp((states(helper_last_controller_event) | from_json).last_triggered if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"1970-01-01 00:00:00\")) * 1000 }}",
                                    "last_controller_event": "{{ (states(helper_last_controller_event) | from_json).trigger_action if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"\" }}"
                                }
                            },
                            {
                                "service": "input_text.set_value",
                                "data": {
                                    "entity_id": "input_text.zz_powder_room_lights_controller_last_event",
                                    "value": "{{ {\"trigger_action\":trigger_action,\"last_triggered\":now()|string} | to_json }}"
                                }
                            },
                            {
                                "choose": [
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_powder_room_lights_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_up_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_up_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "choose": [
                                                                                            {
                                                                                                "conditions": [
                                                                                                    {
                                                                                                        "condition": "time",
                                                                                                        "after": "input_datetime.sleep_hours_start",
                                                                                                        "before": "input_datetime.lights_auto_control_end"
                                                                                                    }
                                                                                                ],
                                                                                                "sequence": [
                                                                                                    {
                                                                                                        "service": "light.turn_on",
                                                                                                        "target": {
                                                                                                            "entity_id": "light.powder_room_pendant_light_entity"
                                                                                                        },
                                                                                                        "data": {
                                                                                                            "brightness_pct": 5
                                                                                                        }
                                                                                                    }
                                                                                                ]
                                                                                            }
                                                                                        ],
                                                                                        "default": [
                                                                                            {
                                                                                                "service": "light.turn_on",
                                                                                                "target": {
                                                                                                    "entity_id": "light.powder_room_pendant_light_entity"
                                                                                                },
                                                                                                "data": {
                                                                                                    "brightness_pct": 100
                                                                                                }
                                                                                            }
                                                                                        ]
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_up_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [
                                                                                    {
                                                                                        "condition": "time",
                                                                                        "after": "input_datetime.sleep_hours_start",
                                                                                        "before": "input_datetime.lights_auto_control_end"
                                                                                    }
                                                                                ],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "light.turn_on",
                                                                                        "target": {
                                                                                            "entity_id": "light.powder_room_pendant_light_entity"
                                                                                        },
                                                                                        "data": {
                                                                                            "brightness_pct": 5
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ],
                                                                        "default": [
                                                                            {
                                                                                "service": "light.turn_on",
                                                                                "target": {
                                                                                    "entity_id": "light.powder_room_pendant_light_entity"
                                                                                },
                                                                                "data": {
                                                                                    "brightness_pct": 100
                                                                                }
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_up_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "light.turn_on",
                                                                            "target": {
                                                                                "entity_id": "light.powder_room_pendant_light_entity"
                                                                            },
                                                                            "data": {
                                                                                "brightness_step_pct": 10
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.powder_room_pendant_light_entity"
                                                        },
                                                        "data": {
                                                            "brightness_step_pct": 10
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_up_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_up_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_powder_room_lights_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_down_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_down_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "light.turn_off",
                                                                                        "target": {
                                                                                            "entity_id": "light.powder_room_pendant_light_entity"
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_down_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "light.turn_off",
                                                                        "target": {
                                                                            "entity_id": "light.powder_room_pendant_light_entity"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_down_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "light.turn_on",
                                                                            "target": {
                                                                                "entity_id": "light.powder_room_pendant_light_entity"
                                                                            },
                                                                            "data": {
                                                                                "brightness_step_pct": -10
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.powder_room_pendant_light_entity"
                                                        },
                                                        "data": {
                                                            "brightness_step_pct": -10
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_down_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_down_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            }
                        ],
                        "id": "1643644178195",
                        "alias": "Powder Room Lights Controller",
                        "description": "Control the Powder Room Lights"
                    },
                    "blueprint_inputs": {
                        "id": "1643644178195",
                        "alias": "Powder Room Lights Controller",
                        "description": "Control the Powder Room Lights",
                        "use_blueprint": {
                            "path": "EPMatt/ikea_e1743.yaml",
                            "input": {
                                "integration": "ZHA",
                                "controller_device": "8fd4f8715be89cc0f383c887c3fac892",
                                "helper_last_controller_event": "input_text.zz_powder_room_lights_controller_last_event",
                                "action_button_up_short": [
                                    {
                                        "choose": [
                                            {
                                                "conditions": [
                                                    {
                                                        "condition": "time",
                                                        "after": "input_datetime.sleep_hours_start",
                                                        "before": "input_datetime.lights_auto_control_end"
                                                    }
                                                ],
                                                "sequence": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.powder_room_pendant_light_entity"
                                                        },
                                                        "data": {
                                                            "brightness_pct": 5
                                                        }
                                                    }
                                                ]
                                            }
                                        ],
                                        "default": [
                                            {
                                                "service": "light.turn_on",
                                                "target": {
                                                    "entity_id": "light.powder_room_pendant_light_entity"
                                                },
                                                "data": {
                                                    "brightness_pct": 100
                                                }
                                            }
                                        ]
                                    }
                                ],
                                "action_button_up_long": [
                                    {
                                        "service": "light.turn_on",
                                        "target": {
                                            "entity_id": "light.powder_room_pendant_light_entity"
                                        },
                                        "data": {
                                            "brightness_step_pct": 10
                                        }
                                    }
                                ],
                                "action_button_down_short": [
                                    {
                                        "service": "light.turn_off",
                                        "target": {
                                            "entity_id": "light.powder_room_pendant_light_entity"
                                        }
                                    }
                                ],
                                "action_button_down_long": [
                                    {
                                        "service": "light.turn_on",
                                        "target": {
                                            "entity_id": "light.powder_room_pendant_light_entity"
                                        },
                                        "data": {
                                            "brightness_step_pct": -10
                                        }
                                    }
                                ],
                                "button_up_long_loop": true,
                                "button_up_long_max_loop_repeats": 50,
                                "button_down_long_loop": true,
                                "button_down_long_max_loop_repeats": 50
                            }
                        }
                    },
                    "context": {
                        "id": "44677091b74cbcb3c44910e9e3ae8560",
                        "parent_id": "d5fd068b521d5a87b19f1099b05e044b",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/3/choose/3/sequence/0/default/1/choose/0/sequence/0",
                    "run_id": "4367454806820068537c3de6c7564c62",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T07:47:25.086559+00:00",
                        "finish": "2022-03-03T07:47:25.154905+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643644178195",
                    "trigger": "event 'zha_event'"
                }
            }
        ],
        "automation.1644147041887": [
            {
                "extended_dict": {
                    "last_step": "action/0/choose/0/sequence/0/default/0",
                    "run_id": "604e88e83614236e9bbe853775fe660d",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T03:42:06.198840+00:00",
                        "finish": "2022-03-03T03:42:06.267038+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1644147041887",
                    "trigger": "state of binary_sensor.junior_bathroom_motion",
                    "trace": {
                        "trigger/0": [
                            {
                                "path": "trigger/0",
                                "timestamp": "2022-03-03T03:42:06.198912+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.junior_bathroom_motion",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T03:40:23.199181+00:00",
                                            "mode": "single",
                                            "current": 0,
                                            "id": "1644147041887",
                                            "friendly_name": "Junior Bathroom Motion"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.800378+00:00",
                                        "last_updated": "2022-03-03T03:40:23.316383+00:00",
                                        "context": {
                                            "id": "232811d835b688b802b991c90bccb517",
                                            "parent_id": "2a3a8930b1766df8443b01090a9f3310",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "motion",
                                        "idx": "0",
                                        "platform": "state",
                                        "entity_id": "binary_sensor.junior_bathroom_motion",
                                        "from_state": {
                                            "entity_id": "binary_sensor.junior_bathroom_motion",
                                            "state": "off",
                                            "attributes": {
                                                "device_class": "motion",
                                                "friendly_name": "Junior Bathroom Motion"
                                            },
                                            "last_changed": "2022-03-03T03:25:23.197392+00:00",
                                            "last_updated": "2022-03-03T03:25:23.197392+00:00",
                                            "context": {
                                                "id": "2a3a8930b1766df8443b01090a9f3310",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "to_state": {
                                            "entity_id": "binary_sensor.junior_bathroom_motion",
                                            "state": "on",
                                            "attributes": {
                                                "device_class": "motion",
                                                "friendly_name": "Junior Bathroom Motion"
                                            },
                                            "last_changed": "2022-03-03T03:42:06.198289+00:00",
                                            "last_updated": "2022-03-03T03:42:06.198289+00:00",
                                            "context": {
                                                "id": "3e15759bc08fd803c4c0c352e56880db",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "for": null,
                                        "attribute": null,
                                        "description": "state of binary_sensor.junior_bathroom_motion"
                                    }
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T03:42:06.199386+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "82f1c8ebe79ef56620993cdd116b8f6f",
                                        "parent_id": "3e15759bc08fd803c4c0c352e56880db",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "choice": 0
                                }
                            }
                        ],
                        "action/0/choose/0": [
                            {
                                "path": "action/0/choose/0",
                                "timestamp": "2022-03-03T03:42:06.199446+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/0/conditions/0",
                                "timestamp": "2022-03-03T03:42:06.199466+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/0": [
                            {
                                "path": "action/0/choose/0/sequence/0",
                                "timestamp": "2022-03-03T03:42:06.199750+00:00",
                                "result": {
                                    "choice": "default"
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/0/choose/0": [
                            {
                                "path": "action/0/choose/0/sequence/0/choose/0",
                                "timestamp": "2022-03-03T03:42:06.199797+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/0/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/0/sequence/0/choose/0/conditions/0",
                                "timestamp": "2022-03-03T03:42:06.199813+00:00",
                                "result": {
                                    "after": {
                                        "__type": "<class 'datetime.time'>",
                                        "isoformat": "21:30:00"
                                    },
                                    "now_time": {
                                        "__type": "<class 'datetime.time'>",
                                        "isoformat": "11:42:06.199822"
                                    },
                                    "before": {
                                        "__type": "<class 'datetime.time'>",
                                        "isoformat": "07:00:00"
                                    },
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/0/default/0": [
                            {
                                "path": "action/0/choose/0/sequence/0/default/0",
                                "timestamp": "2022-03-03T03:42:06.200106+00:00",
                                "result": {
                                    "params": {
                                        "domain": "light",
                                        "service": "turn_on",
                                        "service_data": {
                                            "brightness_pct": 100,
                                            "entity_id": [
                                                "light.junior_bathroom_lights"
                                            ]
                                        },
                                        "target": {
                                            "entity_id": [
                                                "light.junior_bathroom_lights"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ]
                    },
                    "config": {
                        "id": "1644147041887",
                        "alias": "Junior Bathroom Motion",
                        "description": "Control the Junior Bathroom lights with motion",
                        "trigger": [
                            {
                                "platform": "state",
                                "entity_id": "binary_sensor.junior_bathroom_motion",
                                "id": "motion",
                                "to": "on"
                            },
                            {
                                "platform": "state",
                                "entity_id": "binary_sensor.junior_bathroom_motion",
                                "id": "no_motion",
                                "to": "off",
                                "for": {
                                    "hours": 0,
                                    "minutes": 15,
                                    "seconds": 0
                                }
                            }
                        ],
                        "condition": [],
                        "action": [
                            {
                                "choose": [
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "motion"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [
                                                            {
                                                                "condition": "time",
                                                                "after": "input_datetime.elenas_bedtime",
                                                                "before": "input_datetime.lights_auto_control_end"
                                                            }
                                                        ],
                                                        "sequence": [
                                                            {
                                                                "service": "light.turn_on",
                                                                "target": {
                                                                    "entity_id": "light.junior_bathroom_lights"
                                                                },
                                                                "data": {
                                                                    "brightness_pct": 5
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.junior_bathroom_lights"
                                                        },
                                                        "data": {
                                                            "brightness_pct": 100
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "no_motion"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "light.turn_off",
                                                "target": {
                                                    "entity_id": "light.junior_bathroom_lights"
                                                }
                                            }
                                        ]
                                    }
                                ],
                                "default": []
                            }
                        ],
                        "mode": "single"
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "82f1c8ebe79ef56620993cdd116b8f6f",
                        "parent_id": "3e15759bc08fd803c4c0c352e56880db",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/0/choose/0/sequence/0/default/0",
                    "run_id": "604e88e83614236e9bbe853775fe660d",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T03:42:06.198840+00:00",
                        "finish": "2022-03-03T03:42:06.267038+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1644147041887",
                    "trigger": "state of binary_sensor.junior_bathroom_motion"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/0/choose/1/sequence/0",
                    "run_id": "a2e806ad09cb0a6653492e4c4c509c56",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T03:58:52.943903+00:00",
                        "finish": "2022-03-03T03:58:53.053315+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1644147041887",
                    "trigger": "state of binary_sensor.junior_bathroom_motion",
                    "trace": {
                        "trigger/1": [
                            {
                                "path": "trigger/1",
                                "timestamp": "2022-03-03T03:58:52.944015+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.junior_bathroom_motion",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T03:42:06.199020+00:00",
                                            "mode": "single",
                                            "current": 0,
                                            "id": "1644147041887",
                                            "friendly_name": "Junior Bathroom Motion"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.800378+00:00",
                                        "last_updated": "2022-03-03T03:42:06.266741+00:00",
                                        "context": {
                                            "id": "82f1c8ebe79ef56620993cdd116b8f6f",
                                            "parent_id": "3e15759bc08fd803c4c0c352e56880db",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "no_motion",
                                        "idx": "1",
                                        "platform": "state",
                                        "entity_id": "binary_sensor.junior_bathroom_motion",
                                        "from_state": {
                                            "entity_id": "binary_sensor.junior_bathroom_motion",
                                            "state": "on",
                                            "attributes": {
                                                "device_class": "motion",
                                                "friendly_name": "Junior Bathroom Motion"
                                            },
                                            "last_changed": "2022-03-03T03:42:06.198289+00:00",
                                            "last_updated": "2022-03-03T03:42:06.198289+00:00",
                                            "context": {
                                                "id": "3e15759bc08fd803c4c0c352e56880db",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "to_state": {
                                            "entity_id": "binary_sensor.junior_bathroom_motion",
                                            "state": "off",
                                            "attributes": {
                                                "device_class": "motion",
                                                "friendly_name": "Junior Bathroom Motion"
                                            },
                                            "last_changed": "2022-03-03T03:43:52.942160+00:00",
                                            "last_updated": "2022-03-03T03:43:52.942160+00:00",
                                            "context": {
                                                "id": "7de92014a753df4ef289c89f22018cb6",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "for": {
                                            "__type": "<class 'datetime.timedelta'>",
                                            "total_seconds": 900.0
                                        },
                                        "attribute": null,
                                        "description": "state of binary_sensor.junior_bathroom_motion"
                                    }
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T03:58:52.945657+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "bef4d5f65243de1df9101a30b87f3baf",
                                        "parent_id": "7de92014a753df4ef289c89f22018cb6",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "choice": 1
                                }
                            }
                        ],
                        "action/0/choose/0": [
                            {
                                "path": "action/0/choose/0",
                                "timestamp": "2022-03-03T03:58:52.945742+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/0/conditions/0",
                                "timestamp": "2022-03-03T03:58:52.945767+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/1": [
                            {
                                "path": "action/0/choose/1",
                                "timestamp": "2022-03-03T03:58:52.945804+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/1/conditions/0": [
                            {
                                "path": "action/0/choose/1/conditions/0",
                                "timestamp": "2022-03-03T03:58:52.945817+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/1/sequence/0": [
                            {
                                "path": "action/0/choose/1/sequence/0",
                                "timestamp": "2022-03-03T03:58:52.946138+00:00",
                                "result": {
                                    "params": {
                                        "domain": "light",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "light.junior_bathroom_lights"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ]
                    },
                    "config": {
                        "id": "1644147041887",
                        "alias": "Junior Bathroom Motion",
                        "description": "Control the Junior Bathroom lights with motion",
                        "trigger": [
                            {
                                "platform": "state",
                                "entity_id": "binary_sensor.junior_bathroom_motion",
                                "id": "motion",
                                "to": "on"
                            },
                            {
                                "platform": "state",
                                "entity_id": "binary_sensor.junior_bathroom_motion",
                                "id": "no_motion",
                                "to": "off",
                                "for": {
                                    "hours": 0,
                                    "minutes": 15,
                                    "seconds": 0
                                }
                            }
                        ],
                        "condition": [],
                        "action": [
                            {
                                "choose": [
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "motion"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [
                                                            {
                                                                "condition": "time",
                                                                "after": "input_datetime.elenas_bedtime",
                                                                "before": "input_datetime.lights_auto_control_end"
                                                            }
                                                        ],
                                                        "sequence": [
                                                            {
                                                                "service": "light.turn_on",
                                                                "target": {
                                                                    "entity_id": "light.junior_bathroom_lights"
                                                                },
                                                                "data": {
                                                                    "brightness_pct": 5
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.junior_bathroom_lights"
                                                        },
                                                        "data": {
                                                            "brightness_pct": 100
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "no_motion"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "light.turn_off",
                                                "target": {
                                                    "entity_id": "light.junior_bathroom_lights"
                                                }
                                            }
                                        ]
                                    }
                                ],
                                "default": []
                            }
                        ],
                        "mode": "single"
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "bef4d5f65243de1df9101a30b87f3baf",
                        "parent_id": "7de92014a753df4ef289c89f22018cb6",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/0/choose/1/sequence/0",
                    "run_id": "a2e806ad09cb0a6653492e4c4c509c56",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T03:58:52.943903+00:00",
                        "finish": "2022-03-03T03:58:53.053315+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1644147041887",
                    "trigger": "state of binary_sensor.junior_bathroom_motion"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/0/choose/0/sequence/0/default/0",
                    "run_id": "723a232e7a8894265eade9572fad56a7",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:36:00.912084+00:00",
                        "finish": "2022-03-03T05:36:01.035812+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1644147041887",
                    "trigger": "state of binary_sensor.junior_bathroom_motion",
                    "trace": {
                        "trigger/0": [
                            {
                                "path": "trigger/0",
                                "timestamp": "2022-03-03T05:36:00.912175+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.junior_bathroom_motion",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T03:58:52.944169+00:00",
                                            "mode": "single",
                                            "current": 0,
                                            "id": "1644147041887",
                                            "friendly_name": "Junior Bathroom Motion"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.800378+00:00",
                                        "last_updated": "2022-03-03T03:58:53.052925+00:00",
                                        "context": {
                                            "id": "bef4d5f65243de1df9101a30b87f3baf",
                                            "parent_id": "7de92014a753df4ef289c89f22018cb6",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "motion",
                                        "idx": "0",
                                        "platform": "state",
                                        "entity_id": "binary_sensor.junior_bathroom_motion",
                                        "from_state": {
                                            "entity_id": "binary_sensor.junior_bathroom_motion",
                                            "state": "off",
                                            "attributes": {
                                                "device_class": "motion",
                                                "friendly_name": "Junior Bathroom Motion"
                                            },
                                            "last_changed": "2022-03-03T03:43:52.942160+00:00",
                                            "last_updated": "2022-03-03T03:43:52.942160+00:00",
                                            "context": {
                                                "id": "7de92014a753df4ef289c89f22018cb6",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "to_state": {
                                            "entity_id": "binary_sensor.junior_bathroom_motion",
                                            "state": "on",
                                            "attributes": {
                                                "device_class": "motion",
                                                "friendly_name": "Junior Bathroom Motion"
                                            },
                                            "last_changed": "2022-03-03T05:36:00.911474+00:00",
                                            "last_updated": "2022-03-03T05:36:00.911474+00:00",
                                            "context": {
                                                "id": "f8c01a8fc40f50245447f3b92a3cee5a",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "for": null,
                                        "attribute": null,
                                        "description": "state of binary_sensor.junior_bathroom_motion"
                                    }
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T05:36:00.914425+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "97afa47d20184ba4b2632a391b4df9b1",
                                        "parent_id": "f8c01a8fc40f50245447f3b92a3cee5a",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "choice": 0
                                }
                            }
                        ],
                        "action/0/choose/0": [
                            {
                                "path": "action/0/choose/0",
                                "timestamp": "2022-03-03T05:36:00.914484+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/0/conditions/0",
                                "timestamp": "2022-03-03T05:36:00.914505+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/0": [
                            {
                                "path": "action/0/choose/0/sequence/0",
                                "timestamp": "2022-03-03T05:36:00.914849+00:00",
                                "result": {
                                    "choice": "default"
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/0/choose/0": [
                            {
                                "path": "action/0/choose/0/sequence/0/choose/0",
                                "timestamp": "2022-03-03T05:36:00.914907+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/0/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/0/sequence/0/choose/0/conditions/0",
                                "timestamp": "2022-03-03T05:36:00.914925+00:00",
                                "result": {
                                    "after": {
                                        "__type": "<class 'datetime.time'>",
                                        "isoformat": "21:30:00"
                                    },
                                    "now_time": {
                                        "__type": "<class 'datetime.time'>",
                                        "isoformat": "13:36:00.914934"
                                    },
                                    "before": {
                                        "__type": "<class 'datetime.time'>",
                                        "isoformat": "07:00:00"
                                    },
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/0/default/0": [
                            {
                                "path": "action/0/choose/0/sequence/0/default/0",
                                "timestamp": "2022-03-03T05:36:00.915228+00:00",
                                "result": {
                                    "params": {
                                        "domain": "light",
                                        "service": "turn_on",
                                        "service_data": {
                                            "brightness_pct": 100,
                                            "entity_id": [
                                                "light.junior_bathroom_lights"
                                            ]
                                        },
                                        "target": {
                                            "entity_id": [
                                                "light.junior_bathroom_lights"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ]
                    },
                    "config": {
                        "id": "1644147041887",
                        "alias": "Junior Bathroom Motion",
                        "description": "Control the Junior Bathroom lights with motion",
                        "trigger": [
                            {
                                "platform": "state",
                                "entity_id": "binary_sensor.junior_bathroom_motion",
                                "id": "motion",
                                "to": "on"
                            },
                            {
                                "platform": "state",
                                "entity_id": "binary_sensor.junior_bathroom_motion",
                                "id": "no_motion",
                                "to": "off",
                                "for": {
                                    "hours": 0,
                                    "minutes": 15,
                                    "seconds": 0
                                }
                            }
                        ],
                        "condition": [],
                        "action": [
                            {
                                "choose": [
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "motion"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [
                                                            {
                                                                "condition": "time",
                                                                "after": "input_datetime.elenas_bedtime",
                                                                "before": "input_datetime.lights_auto_control_end"
                                                            }
                                                        ],
                                                        "sequence": [
                                                            {
                                                                "service": "light.turn_on",
                                                                "target": {
                                                                    "entity_id": "light.junior_bathroom_lights"
                                                                },
                                                                "data": {
                                                                    "brightness_pct": 5
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.junior_bathroom_lights"
                                                        },
                                                        "data": {
                                                            "brightness_pct": 100
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "no_motion"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "light.turn_off",
                                                "target": {
                                                    "entity_id": "light.junior_bathroom_lights"
                                                }
                                            }
                                        ]
                                    }
                                ],
                                "default": []
                            }
                        ],
                        "mode": "single"
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "97afa47d20184ba4b2632a391b4df9b1",
                        "parent_id": "f8c01a8fc40f50245447f3b92a3cee5a",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/0/choose/0/sequence/0/default/0",
                    "run_id": "723a232e7a8894265eade9572fad56a7",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:36:00.912084+00:00",
                        "finish": "2022-03-03T05:36:01.035812+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1644147041887",
                    "trigger": "state of binary_sensor.junior_bathroom_motion"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/0/choose/1/sequence/0",
                    "run_id": "a68f081d9aeb476e0ae5ec66a731619c",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:52:32.810115+00:00",
                        "finish": "2022-03-03T05:52:32.905810+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1644147041887",
                    "trigger": "state of binary_sensor.junior_bathroom_motion",
                    "trace": {
                        "trigger/1": [
                            {
                                "path": "trigger/1",
                                "timestamp": "2022-03-03T05:52:32.810224+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.junior_bathroom_motion",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T05:36:00.912307+00:00",
                                            "mode": "single",
                                            "current": 0,
                                            "id": "1644147041887",
                                            "friendly_name": "Junior Bathroom Motion"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.800378+00:00",
                                        "last_updated": "2022-03-03T05:36:01.035347+00:00",
                                        "context": {
                                            "id": "97afa47d20184ba4b2632a391b4df9b1",
                                            "parent_id": "f8c01a8fc40f50245447f3b92a3cee5a",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "no_motion",
                                        "idx": "1",
                                        "platform": "state",
                                        "entity_id": "binary_sensor.junior_bathroom_motion",
                                        "from_state": {
                                            "entity_id": "binary_sensor.junior_bathroom_motion",
                                            "state": "on",
                                            "attributes": {
                                                "device_class": "motion",
                                                "friendly_name": "Junior Bathroom Motion"
                                            },
                                            "last_changed": "2022-03-03T05:36:00.911474+00:00",
                                            "last_updated": "2022-03-03T05:36:00.911474+00:00",
                                            "context": {
                                                "id": "f8c01a8fc40f50245447f3b92a3cee5a",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "to_state": {
                                            "entity_id": "binary_sensor.junior_bathroom_motion",
                                            "state": "off",
                                            "attributes": {
                                                "device_class": "motion",
                                                "friendly_name": "Junior Bathroom Motion"
                                            },
                                            "last_changed": "2022-03-03T05:37:32.808986+00:00",
                                            "last_updated": "2022-03-03T05:37:32.808986+00:00",
                                            "context": {
                                                "id": "93b36e58748a57c0c8e761b0d6464a5b",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "for": {
                                            "__type": "<class 'datetime.timedelta'>",
                                            "total_seconds": 900.0
                                        },
                                        "attribute": null,
                                        "description": "state of binary_sensor.junior_bathroom_motion"
                                    }
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T05:52:32.811080+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "ffbc57336c9ac288d5c34faaf51e65db",
                                        "parent_id": "93b36e58748a57c0c8e761b0d6464a5b",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "choice": 1
                                }
                            }
                        ],
                        "action/0/choose/0": [
                            {
                                "path": "action/0/choose/0",
                                "timestamp": "2022-03-03T05:52:32.811145+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/0/conditions/0",
                                "timestamp": "2022-03-03T05:52:32.811166+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/1": [
                            {
                                "path": "action/0/choose/1",
                                "timestamp": "2022-03-03T05:52:32.811207+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/1/conditions/0": [
                            {
                                "path": "action/0/choose/1/conditions/0",
                                "timestamp": "2022-03-03T05:52:32.811221+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/1/sequence/0": [
                            {
                                "path": "action/0/choose/1/sequence/0",
                                "timestamp": "2022-03-03T05:52:32.812120+00:00",
                                "result": {
                                    "params": {
                                        "domain": "light",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "light.junior_bathroom_lights"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ]
                    },
                    "config": {
                        "id": "1644147041887",
                        "alias": "Junior Bathroom Motion",
                        "description": "Control the Junior Bathroom lights with motion",
                        "trigger": [
                            {
                                "platform": "state",
                                "entity_id": "binary_sensor.junior_bathroom_motion",
                                "id": "motion",
                                "to": "on"
                            },
                            {
                                "platform": "state",
                                "entity_id": "binary_sensor.junior_bathroom_motion",
                                "id": "no_motion",
                                "to": "off",
                                "for": {
                                    "hours": 0,
                                    "minutes": 15,
                                    "seconds": 0
                                }
                            }
                        ],
                        "condition": [],
                        "action": [
                            {
                                "choose": [
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "motion"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [
                                                            {
                                                                "condition": "time",
                                                                "after": "input_datetime.elenas_bedtime",
                                                                "before": "input_datetime.lights_auto_control_end"
                                                            }
                                                        ],
                                                        "sequence": [
                                                            {
                                                                "service": "light.turn_on",
                                                                "target": {
                                                                    "entity_id": "light.junior_bathroom_lights"
                                                                },
                                                                "data": {
                                                                    "brightness_pct": 5
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.junior_bathroom_lights"
                                                        },
                                                        "data": {
                                                            "brightness_pct": 100
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "no_motion"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "light.turn_off",
                                                "target": {
                                                    "entity_id": "light.junior_bathroom_lights"
                                                }
                                            }
                                        ]
                                    }
                                ],
                                "default": []
                            }
                        ],
                        "mode": "single"
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "ffbc57336c9ac288d5c34faaf51e65db",
                        "parent_id": "93b36e58748a57c0c8e761b0d6464a5b",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/0/choose/1/sequence/0",
                    "run_id": "a68f081d9aeb476e0ae5ec66a731619c",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:52:32.810115+00:00",
                        "finish": "2022-03-03T05:52:32.905810+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1644147041887",
                    "trigger": "state of binary_sensor.junior_bathroom_motion"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/0/choose/0/sequence/0/default/0",
                    "run_id": "f1f1b1a2936df1c7249934d17b29aa51",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T07:53:33.100750+00:00",
                        "finish": "2022-03-03T07:53:33.212386+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1644147041887",
                    "trigger": "state of binary_sensor.junior_bathroom_motion",
                    "trace": {
                        "trigger/0": [
                            {
                                "path": "trigger/0",
                                "timestamp": "2022-03-03T07:53:33.100825+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.junior_bathroom_motion",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T05:52:32.810370+00:00",
                                            "mode": "single",
                                            "current": 0,
                                            "id": "1644147041887",
                                            "friendly_name": "Junior Bathroom Motion"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.800378+00:00",
                                        "last_updated": "2022-03-03T05:52:32.904669+00:00",
                                        "context": {
                                            "id": "ffbc57336c9ac288d5c34faaf51e65db",
                                            "parent_id": "93b36e58748a57c0c8e761b0d6464a5b",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "motion",
                                        "idx": "0",
                                        "platform": "state",
                                        "entity_id": "binary_sensor.junior_bathroom_motion",
                                        "from_state": {
                                            "entity_id": "binary_sensor.junior_bathroom_motion",
                                            "state": "off",
                                            "attributes": {
                                                "device_class": "motion",
                                                "friendly_name": "Junior Bathroom Motion"
                                            },
                                            "last_changed": "2022-03-03T05:37:32.808986+00:00",
                                            "last_updated": "2022-03-03T05:37:32.808986+00:00",
                                            "context": {
                                                "id": "93b36e58748a57c0c8e761b0d6464a5b",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "to_state": {
                                            "entity_id": "binary_sensor.junior_bathroom_motion",
                                            "state": "on",
                                            "attributes": {
                                                "device_class": "motion",
                                                "friendly_name": "Junior Bathroom Motion"
                                            },
                                            "last_changed": "2022-03-03T07:53:33.100141+00:00",
                                            "last_updated": "2022-03-03T07:53:33.100141+00:00",
                                            "context": {
                                                "id": "51184692f50ffdb2f77a72ea0f7c8bda",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "for": null,
                                        "attribute": null,
                                        "description": "state of binary_sensor.junior_bathroom_motion"
                                    }
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T07:53:33.101402+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "e6ee5f27dad12ce18bb59c8d872e3de4",
                                        "parent_id": "51184692f50ffdb2f77a72ea0f7c8bda",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "choice": 0
                                }
                            }
                        ],
                        "action/0/choose/0": [
                            {
                                "path": "action/0/choose/0",
                                "timestamp": "2022-03-03T07:53:33.102180+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/0/conditions/0",
                                "timestamp": "2022-03-03T07:53:33.102212+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/0": [
                            {
                                "path": "action/0/choose/0/sequence/0",
                                "timestamp": "2022-03-03T07:53:33.102536+00:00",
                                "result": {
                                    "choice": "default"
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/0/choose/0": [
                            {
                                "path": "action/0/choose/0/sequence/0/choose/0",
                                "timestamp": "2022-03-03T07:53:33.102595+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/0/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/0/sequence/0/choose/0/conditions/0",
                                "timestamp": "2022-03-03T07:53:33.102611+00:00",
                                "result": {
                                    "after": {
                                        "__type": "<class 'datetime.time'>",
                                        "isoformat": "21:30:00"
                                    },
                                    "now_time": {
                                        "__type": "<class 'datetime.time'>",
                                        "isoformat": "15:53:33.102620"
                                    },
                                    "before": {
                                        "__type": "<class 'datetime.time'>",
                                        "isoformat": "07:00:00"
                                    },
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/0/default/0": [
                            {
                                "path": "action/0/choose/0/sequence/0/default/0",
                                "timestamp": "2022-03-03T07:53:33.102916+00:00",
                                "result": {
                                    "params": {
                                        "domain": "light",
                                        "service": "turn_on",
                                        "service_data": {
                                            "brightness_pct": 100,
                                            "entity_id": [
                                                "light.junior_bathroom_lights"
                                            ]
                                        },
                                        "target": {
                                            "entity_id": [
                                                "light.junior_bathroom_lights"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ]
                    },
                    "config": {
                        "id": "1644147041887",
                        "alias": "Junior Bathroom Motion",
                        "description": "Control the Junior Bathroom lights with motion",
                        "trigger": [
                            {
                                "platform": "state",
                                "entity_id": "binary_sensor.junior_bathroom_motion",
                                "id": "motion",
                                "to": "on"
                            },
                            {
                                "platform": "state",
                                "entity_id": "binary_sensor.junior_bathroom_motion",
                                "id": "no_motion",
                                "to": "off",
                                "for": {
                                    "hours": 0,
                                    "minutes": 15,
                                    "seconds": 0
                                }
                            }
                        ],
                        "condition": [],
                        "action": [
                            {
                                "choose": [
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "motion"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [
                                                            {
                                                                "condition": "time",
                                                                "after": "input_datetime.elenas_bedtime",
                                                                "before": "input_datetime.lights_auto_control_end"
                                                            }
                                                        ],
                                                        "sequence": [
                                                            {
                                                                "service": "light.turn_on",
                                                                "target": {
                                                                    "entity_id": "light.junior_bathroom_lights"
                                                                },
                                                                "data": {
                                                                    "brightness_pct": 5
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.junior_bathroom_lights"
                                                        },
                                                        "data": {
                                                            "brightness_pct": 100
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "no_motion"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "light.turn_off",
                                                "target": {
                                                    "entity_id": "light.junior_bathroom_lights"
                                                }
                                            }
                                        ]
                                    }
                                ],
                                "default": []
                            }
                        ],
                        "mode": "single"
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "e6ee5f27dad12ce18bb59c8d872e3de4",
                        "parent_id": "51184692f50ffdb2f77a72ea0f7c8bda",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/0/choose/0/sequence/0/default/0",
                    "run_id": "f1f1b1a2936df1c7249934d17b29aa51",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T07:53:33.100750+00:00",
                        "finish": "2022-03-03T07:53:33.212386+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1644147041887",
                    "trigger": "state of binary_sensor.junior_bathroom_motion"
                }
            }
        ],
        "automation.1644145378905": [
            {
                "extended_dict": {
                    "last_step": "action/0/choose/1/sequence/0",
                    "run_id": "2388ea08e2556a9df51dec866f833555",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T02:59:54.800401+00:00",
                        "finish": "2022-03-03T02:59:54.869369+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1644145378905",
                    "trigger": "state of binary_sensor.powder_room_motion",
                    "trace": {
                        "trigger/1": [
                            {
                                "path": "trigger/1",
                                "timestamp": "2022-03-03T02:59:54.800505+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.powder_room_motion",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T02:43:48.990152+00:00",
                                            "mode": "single",
                                            "current": 0,
                                            "id": "1644145378905",
                                            "friendly_name": "Powder Room Motion"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.800261+00:00",
                                        "last_updated": "2022-03-03T02:43:49.056913+00:00",
                                        "context": {
                                            "id": "b38e1f41d08bbab1ce3f899227e2a772",
                                            "parent_id": "9ea10b7457298dad51fafab6c7d1ab10",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "no_motion",
                                        "idx": "1",
                                        "platform": "state",
                                        "entity_id": "binary_sensor.powder_room_motion",
                                        "from_state": {
                                            "entity_id": "binary_sensor.powder_room_motion",
                                            "state": "on",
                                            "attributes": {
                                                "icon": "mdi:walk",
                                                "friendly_name": "Powder Room Motion"
                                            },
                                            "last_changed": "2022-03-03T02:43:48.989378+00:00",
                                            "last_updated": "2022-03-03T02:43:48.989378+00:00",
                                            "context": {
                                                "id": "9ea10b7457298dad51fafab6c7d1ab10",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "to_state": {
                                            "entity_id": "binary_sensor.powder_room_motion",
                                            "state": "off",
                                            "attributes": {
                                                "icon": "mdi:walk",
                                                "friendly_name": "Powder Room Motion"
                                            },
                                            "last_changed": "2022-03-03T02:44:54.798886+00:00",
                                            "last_updated": "2022-03-03T02:44:54.798886+00:00",
                                            "context": {
                                                "id": "892dc8035cb594b12982eba1e6218a93",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "for": {
                                            "__type": "<class 'datetime.timedelta'>",
                                            "total_seconds": 900.0
                                        },
                                        "attribute": null,
                                        "description": "state of binary_sensor.powder_room_motion"
                                    }
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T02:59:54.801208+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "96538d478f729eaa91d3098e27a65eba",
                                        "parent_id": "892dc8035cb594b12982eba1e6218a93",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "choice": 1
                                }
                            }
                        ],
                        "action/0/choose/0": [
                            {
                                "path": "action/0/choose/0",
                                "timestamp": "2022-03-03T02:59:54.801275+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/0/conditions/0",
                                "timestamp": "2022-03-03T02:59:54.801305+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/1": [
                            {
                                "path": "action/0/choose/1",
                                "timestamp": "2022-03-03T02:59:54.801345+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/1/conditions/0": [
                            {
                                "path": "action/0/choose/1/conditions/0",
                                "timestamp": "2022-03-03T02:59:54.801360+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/1/sequence/0": [
                            {
                                "path": "action/0/choose/1/sequence/0",
                                "timestamp": "2022-03-03T02:59:54.801631+00:00",
                                "result": {
                                    "params": {
                                        "domain": "light",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "light.powder_room_pendant_light_entity"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ]
                    },
                    "config": {
                        "id": "1644145378905",
                        "alias": "Powder Room Motion",
                        "description": "Control the Powder Room Lights with motion",
                        "trigger": [
                            {
                                "platform": "state",
                                "entity_id": "binary_sensor.powder_room_motion",
                                "id": "motion",
                                "to": "on"
                            },
                            {
                                "platform": "state",
                                "entity_id": "binary_sensor.powder_room_motion",
                                "id": "no_motion",
                                "to": "off",
                                "for": {
                                    "hours": 0,
                                    "minutes": 15,
                                    "seconds": 0
                                }
                            }
                        ],
                        "condition": [],
                        "action": [
                            {
                                "choose": [
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "motion"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [
                                                            {
                                                                "condition": "time",
                                                                "before": "input_datetime.lights_auto_control_end",
                                                                "after": "input_datetime.sleep_hours_start"
                                                            }
                                                        ],
                                                        "sequence": [
                                                            {
                                                                "service": "light.turn_on",
                                                                "target": {
                                                                    "entity_id": "light.powder_room_pendant_light_entity"
                                                                },
                                                                "data": {
                                                                    "brightness_pct": 5
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.powder_room_pendant_light_entity"
                                                        },
                                                        "data": {
                                                            "brightness_pct": 100
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "no_motion"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "light.turn_off",
                                                "target": {
                                                    "entity_id": "light.powder_room_pendant_light_entity"
                                                }
                                            }
                                        ]
                                    }
                                ],
                                "default": []
                            }
                        ],
                        "mode": "single"
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "96538d478f729eaa91d3098e27a65eba",
                        "parent_id": "892dc8035cb594b12982eba1e6218a93",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/0/choose/1/sequence/0",
                    "run_id": "2388ea08e2556a9df51dec866f833555",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T02:59:54.800401+00:00",
                        "finish": "2022-03-03T02:59:54.869369+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1644145378905",
                    "trigger": "state of binary_sensor.powder_room_motion"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/0/choose/0/sequence/0/default/0",
                    "run_id": "3e96b0e84f6990a118d4638410fa9630",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:36:31.450703+00:00",
                        "finish": "2022-03-03T05:36:31.512584+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1644145378905",
                    "trigger": "state of binary_sensor.powder_room_motion",
                    "trace": {
                        "trigger/0": [
                            {
                                "path": "trigger/0",
                                "timestamp": "2022-03-03T05:36:31.450786+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.powder_room_motion",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T02:59:54.800665+00:00",
                                            "mode": "single",
                                            "current": 0,
                                            "id": "1644145378905",
                                            "friendly_name": "Powder Room Motion"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.800261+00:00",
                                        "last_updated": "2022-03-03T02:59:54.868993+00:00",
                                        "context": {
                                            "id": "96538d478f729eaa91d3098e27a65eba",
                                            "parent_id": "892dc8035cb594b12982eba1e6218a93",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "motion",
                                        "idx": "0",
                                        "platform": "state",
                                        "entity_id": "binary_sensor.powder_room_motion",
                                        "from_state": {
                                            "entity_id": "binary_sensor.powder_room_motion",
                                            "state": "off",
                                            "attributes": {
                                                "icon": "mdi:walk",
                                                "friendly_name": "Powder Room Motion"
                                            },
                                            "last_changed": "2022-03-03T02:44:54.798886+00:00",
                                            "last_updated": "2022-03-03T02:44:54.798886+00:00",
                                            "context": {
                                                "id": "892dc8035cb594b12982eba1e6218a93",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "to_state": {
                                            "entity_id": "binary_sensor.powder_room_motion",
                                            "state": "on",
                                            "attributes": {
                                                "icon": "mdi:walk",
                                                "friendly_name": "Powder Room Motion"
                                            },
                                            "last_changed": "2022-03-03T05:36:31.449635+00:00",
                                            "last_updated": "2022-03-03T05:36:31.449635+00:00",
                                            "context": {
                                                "id": "029ac81dde67fb8a536cd754d66447b2",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "for": null,
                                        "attribute": null,
                                        "description": "state of binary_sensor.powder_room_motion"
                                    }
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T05:36:31.451260+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "550dbf14e0dbebc94fcf3ceaec88082b",
                                        "parent_id": "029ac81dde67fb8a536cd754d66447b2",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "choice": 0
                                }
                            }
                        ],
                        "action/0/choose/0": [
                            {
                                "path": "action/0/choose/0",
                                "timestamp": "2022-03-03T05:36:31.451313+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/0/conditions/0",
                                "timestamp": "2022-03-03T05:36:31.451333+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/0": [
                            {
                                "path": "action/0/choose/0/sequence/0",
                                "timestamp": "2022-03-03T05:36:31.451607+00:00",
                                "result": {
                                    "choice": "default"
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/0/choose/0": [
                            {
                                "path": "action/0/choose/0/sequence/0/choose/0",
                                "timestamp": "2022-03-03T05:36:31.451651+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/0/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/0/sequence/0/choose/0/conditions/0",
                                "timestamp": "2022-03-03T05:36:31.451669+00:00",
                                "result": {
                                    "after": {
                                        "__type": "<class 'datetime.time'>",
                                        "isoformat": "22:00:00"
                                    },
                                    "now_time": {
                                        "__type": "<class 'datetime.time'>",
                                        "isoformat": "13:36:31.451678"
                                    },
                                    "before": {
                                        "__type": "<class 'datetime.time'>",
                                        "isoformat": "07:00:00"
                                    },
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/0/default/0": [
                            {
                                "path": "action/0/choose/0/sequence/0/default/0",
                                "timestamp": "2022-03-03T05:36:31.451970+00:00",
                                "result": {
                                    "params": {
                                        "domain": "light",
                                        "service": "turn_on",
                                        "service_data": {
                                            "brightness_pct": 100,
                                            "entity_id": [
                                                "light.powder_room_pendant_light_entity"
                                            ]
                                        },
                                        "target": {
                                            "entity_id": [
                                                "light.powder_room_pendant_light_entity"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ]
                    },
                    "config": {
                        "id": "1644145378905",
                        "alias": "Powder Room Motion",
                        "description": "Control the Powder Room Lights with motion",
                        "trigger": [
                            {
                                "platform": "state",
                                "entity_id": "binary_sensor.powder_room_motion",
                                "id": "motion",
                                "to": "on"
                            },
                            {
                                "platform": "state",
                                "entity_id": "binary_sensor.powder_room_motion",
                                "id": "no_motion",
                                "to": "off",
                                "for": {
                                    "hours": 0,
                                    "minutes": 15,
                                    "seconds": 0
                                }
                            }
                        ],
                        "condition": [],
                        "action": [
                            {
                                "choose": [
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "motion"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [
                                                            {
                                                                "condition": "time",
                                                                "before": "input_datetime.lights_auto_control_end",
                                                                "after": "input_datetime.sleep_hours_start"
                                                            }
                                                        ],
                                                        "sequence": [
                                                            {
                                                                "service": "light.turn_on",
                                                                "target": {
                                                                    "entity_id": "light.powder_room_pendant_light_entity"
                                                                },
                                                                "data": {
                                                                    "brightness_pct": 5
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.powder_room_pendant_light_entity"
                                                        },
                                                        "data": {
                                                            "brightness_pct": 100
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "no_motion"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "light.turn_off",
                                                "target": {
                                                    "entity_id": "light.powder_room_pendant_light_entity"
                                                }
                                            }
                                        ]
                                    }
                                ],
                                "default": []
                            }
                        ],
                        "mode": "single"
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "550dbf14e0dbebc94fcf3ceaec88082b",
                        "parent_id": "029ac81dde67fb8a536cd754d66447b2",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/0/choose/0/sequence/0/default/0",
                    "run_id": "3e96b0e84f6990a118d4638410fa9630",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:36:31.450703+00:00",
                        "finish": "2022-03-03T05:36:31.512584+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1644145378905",
                    "trigger": "state of binary_sensor.powder_room_motion"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/0/choose/0/sequence/0/default/0",
                    "run_id": "621d68c20f95f97231d6de9ebcc191c0",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:44:47.374073+00:00",
                        "finish": "2022-03-03T05:44:47.439665+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1644145378905",
                    "trigger": "state of binary_sensor.powder_room_motion",
                    "trace": {
                        "trigger/0": [
                            {
                                "path": "trigger/0",
                                "timestamp": "2022-03-03T05:44:47.374150+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.powder_room_motion",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T05:36:31.450895+00:00",
                                            "mode": "single",
                                            "current": 0,
                                            "id": "1644145378905",
                                            "friendly_name": "Powder Room Motion"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.800261+00:00",
                                        "last_updated": "2022-03-03T05:36:31.511842+00:00",
                                        "context": {
                                            "id": "550dbf14e0dbebc94fcf3ceaec88082b",
                                            "parent_id": "029ac81dde67fb8a536cd754d66447b2",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "motion",
                                        "idx": "0",
                                        "platform": "state",
                                        "entity_id": "binary_sensor.powder_room_motion",
                                        "from_state": {
                                            "entity_id": "binary_sensor.powder_room_motion",
                                            "state": "off",
                                            "attributes": {
                                                "icon": "mdi:walk",
                                                "friendly_name": "Powder Room Motion"
                                            },
                                            "last_changed": "2022-03-03T05:38:23.095199+00:00",
                                            "last_updated": "2022-03-03T05:38:23.095199+00:00",
                                            "context": {
                                                "id": "13a8d38d237768af3cdca33f24190091",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "to_state": {
                                            "entity_id": "binary_sensor.powder_room_motion",
                                            "state": "on",
                                            "attributes": {
                                                "icon": "mdi:walk",
                                                "friendly_name": "Powder Room Motion"
                                            },
                                            "last_changed": "2022-03-03T05:44:47.373447+00:00",
                                            "last_updated": "2022-03-03T05:44:47.373447+00:00",
                                            "context": {
                                                "id": "7eb9ec92891d6d12199c70da6061751e",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "for": null,
                                        "attribute": null,
                                        "description": "state of binary_sensor.powder_room_motion"
                                    }
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T05:44:47.374647+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "cd84f530c32e02830be7c1e52d3f5dac",
                                        "parent_id": "7eb9ec92891d6d12199c70da6061751e",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "choice": 0
                                }
                            }
                        ],
                        "action/0/choose/0": [
                            {
                                "path": "action/0/choose/0",
                                "timestamp": "2022-03-03T05:44:47.375240+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/0/conditions/0",
                                "timestamp": "2022-03-03T05:44:47.375269+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/0": [
                            {
                                "path": "action/0/choose/0/sequence/0",
                                "timestamp": "2022-03-03T05:44:47.375561+00:00",
                                "result": {
                                    "choice": "default"
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/0/choose/0": [
                            {
                                "path": "action/0/choose/0/sequence/0/choose/0",
                                "timestamp": "2022-03-03T05:44:47.375608+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/0/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/0/sequence/0/choose/0/conditions/0",
                                "timestamp": "2022-03-03T05:44:47.375624+00:00",
                                "result": {
                                    "after": {
                                        "__type": "<class 'datetime.time'>",
                                        "isoformat": "22:00:00"
                                    },
                                    "now_time": {
                                        "__type": "<class 'datetime.time'>",
                                        "isoformat": "13:44:47.375632"
                                    },
                                    "before": {
                                        "__type": "<class 'datetime.time'>",
                                        "isoformat": "07:00:00"
                                    },
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/0/default/0": [
                            {
                                "path": "action/0/choose/0/sequence/0/default/0",
                                "timestamp": "2022-03-03T05:44:47.375927+00:00",
                                "result": {
                                    "params": {
                                        "domain": "light",
                                        "service": "turn_on",
                                        "service_data": {
                                            "brightness_pct": 100,
                                            "entity_id": [
                                                "light.powder_room_pendant_light_entity"
                                            ]
                                        },
                                        "target": {
                                            "entity_id": [
                                                "light.powder_room_pendant_light_entity"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ]
                    },
                    "config": {
                        "id": "1644145378905",
                        "alias": "Powder Room Motion",
                        "description": "Control the Powder Room Lights with motion",
                        "trigger": [
                            {
                                "platform": "state",
                                "entity_id": "binary_sensor.powder_room_motion",
                                "id": "motion",
                                "to": "on"
                            },
                            {
                                "platform": "state",
                                "entity_id": "binary_sensor.powder_room_motion",
                                "id": "no_motion",
                                "to": "off",
                                "for": {
                                    "hours": 0,
                                    "minutes": 15,
                                    "seconds": 0
                                }
                            }
                        ],
                        "condition": [],
                        "action": [
                            {
                                "choose": [
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "motion"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [
                                                            {
                                                                "condition": "time",
                                                                "before": "input_datetime.lights_auto_control_end",
                                                                "after": "input_datetime.sleep_hours_start"
                                                            }
                                                        ],
                                                        "sequence": [
                                                            {
                                                                "service": "light.turn_on",
                                                                "target": {
                                                                    "entity_id": "light.powder_room_pendant_light_entity"
                                                                },
                                                                "data": {
                                                                    "brightness_pct": 5
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.powder_room_pendant_light_entity"
                                                        },
                                                        "data": {
                                                            "brightness_pct": 100
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "no_motion"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "light.turn_off",
                                                "target": {
                                                    "entity_id": "light.powder_room_pendant_light_entity"
                                                }
                                            }
                                        ]
                                    }
                                ],
                                "default": []
                            }
                        ],
                        "mode": "single"
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "cd84f530c32e02830be7c1e52d3f5dac",
                        "parent_id": "7eb9ec92891d6d12199c70da6061751e",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/0/choose/0/sequence/0/default/0",
                    "run_id": "621d68c20f95f97231d6de9ebcc191c0",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:44:47.374073+00:00",
                        "finish": "2022-03-03T05:44:47.439665+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1644145378905",
                    "trigger": "state of binary_sensor.powder_room_motion"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/0/choose/1/sequence/0",
                    "run_id": "e2e5da097dd1e4ab8017bfaf5c048d23",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T06:01:27.850675+00:00",
                        "finish": "2022-03-03T06:01:27.903763+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1644145378905",
                    "trigger": "state of binary_sensor.powder_room_motion",
                    "trace": {
                        "trigger/1": [
                            {
                                "path": "trigger/1",
                                "timestamp": "2022-03-03T06:01:27.850836+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.powder_room_motion",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T05:44:47.374263+00:00",
                                            "mode": "single",
                                            "current": 0,
                                            "id": "1644145378905",
                                            "friendly_name": "Powder Room Motion"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.800261+00:00",
                                        "last_updated": "2022-03-03T05:44:47.438767+00:00",
                                        "context": {
                                            "id": "cd84f530c32e02830be7c1e52d3f5dac",
                                            "parent_id": "7eb9ec92891d6d12199c70da6061751e",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "no_motion",
                                        "idx": "1",
                                        "platform": "state",
                                        "entity_id": "binary_sensor.powder_room_motion",
                                        "from_state": {
                                            "entity_id": "binary_sensor.powder_room_motion",
                                            "state": "on",
                                            "attributes": {
                                                "icon": "mdi:walk",
                                                "friendly_name": "Powder Room Motion"
                                            },
                                            "last_changed": "2022-03-03T05:44:47.373447+00:00",
                                            "last_updated": "2022-03-03T05:44:47.373447+00:00",
                                            "context": {
                                                "id": "7eb9ec92891d6d12199c70da6061751e",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "to_state": {
                                            "entity_id": "binary_sensor.powder_room_motion",
                                            "state": "off",
                                            "attributes": {
                                                "icon": "mdi:walk",
                                                "friendly_name": "Powder Room Motion"
                                            },
                                            "last_changed": "2022-03-03T05:46:27.848988+00:00",
                                            "last_updated": "2022-03-03T05:46:27.848988+00:00",
                                            "context": {
                                                "id": "e2d9e2314918b3c6a72706b3aa8b5dce",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "for": {
                                            "__type": "<class 'datetime.timedelta'>",
                                            "total_seconds": 900.0
                                        },
                                        "attribute": null,
                                        "description": "state of binary_sensor.powder_room_motion"
                                    }
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T06:01:27.851734+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "132dabfcf38bcb33f775f371e3558997",
                                        "parent_id": "e2d9e2314918b3c6a72706b3aa8b5dce",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "choice": 1
                                }
                            }
                        ],
                        "action/0/choose/0": [
                            {
                                "path": "action/0/choose/0",
                                "timestamp": "2022-03-03T06:01:27.851798+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/0/conditions/0",
                                "timestamp": "2022-03-03T06:01:27.851823+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/1": [
                            {
                                "path": "action/0/choose/1",
                                "timestamp": "2022-03-03T06:01:27.851866+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/1/conditions/0": [
                            {
                                "path": "action/0/choose/1/conditions/0",
                                "timestamp": "2022-03-03T06:01:27.851887+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/1/sequence/0": [
                            {
                                "path": "action/0/choose/1/sequence/0",
                                "timestamp": "2022-03-03T06:01:27.852890+00:00",
                                "result": {
                                    "params": {
                                        "domain": "light",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "light.powder_room_pendant_light_entity"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ]
                    },
                    "config": {
                        "id": "1644145378905",
                        "alias": "Powder Room Motion",
                        "description": "Control the Powder Room Lights with motion",
                        "trigger": [
                            {
                                "platform": "state",
                                "entity_id": "binary_sensor.powder_room_motion",
                                "id": "motion",
                                "to": "on"
                            },
                            {
                                "platform": "state",
                                "entity_id": "binary_sensor.powder_room_motion",
                                "id": "no_motion",
                                "to": "off",
                                "for": {
                                    "hours": 0,
                                    "minutes": 15,
                                    "seconds": 0
                                }
                            }
                        ],
                        "condition": [],
                        "action": [
                            {
                                "choose": [
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "motion"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [
                                                            {
                                                                "condition": "time",
                                                                "before": "input_datetime.lights_auto_control_end",
                                                                "after": "input_datetime.sleep_hours_start"
                                                            }
                                                        ],
                                                        "sequence": [
                                                            {
                                                                "service": "light.turn_on",
                                                                "target": {
                                                                    "entity_id": "light.powder_room_pendant_light_entity"
                                                                },
                                                                "data": {
                                                                    "brightness_pct": 5
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.powder_room_pendant_light_entity"
                                                        },
                                                        "data": {
                                                            "brightness_pct": 100
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "no_motion"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "light.turn_off",
                                                "target": {
                                                    "entity_id": "light.powder_room_pendant_light_entity"
                                                }
                                            }
                                        ]
                                    }
                                ],
                                "default": []
                            }
                        ],
                        "mode": "single"
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "132dabfcf38bcb33f775f371e3558997",
                        "parent_id": "e2d9e2314918b3c6a72706b3aa8b5dce",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/0/choose/1/sequence/0",
                    "run_id": "e2e5da097dd1e4ab8017bfaf5c048d23",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T06:01:27.850675+00:00",
                        "finish": "2022-03-03T06:01:27.903763+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1644145378905",
                    "trigger": "state of binary_sensor.powder_room_motion"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/0/choose/0/sequence/0/default/0",
                    "run_id": "e78319c76eaf358d5a1b537db0b0f73b",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T07:46:50.681874+00:00",
                        "finish": "2022-03-03T07:46:50.749002+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1644145378905",
                    "trigger": "state of binary_sensor.powder_room_motion",
                    "trace": {
                        "trigger/0": [
                            {
                                "path": "trigger/0",
                                "timestamp": "2022-03-03T07:46:50.681975+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.powder_room_motion",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T06:01:27.850986+00:00",
                                            "mode": "single",
                                            "current": 0,
                                            "id": "1644145378905",
                                            "friendly_name": "Powder Room Motion"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.800261+00:00",
                                        "last_updated": "2022-03-03T06:01:27.902635+00:00",
                                        "context": {
                                            "id": "132dabfcf38bcb33f775f371e3558997",
                                            "parent_id": "e2d9e2314918b3c6a72706b3aa8b5dce",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "motion",
                                        "idx": "0",
                                        "platform": "state",
                                        "entity_id": "binary_sensor.powder_room_motion",
                                        "from_state": {
                                            "entity_id": "binary_sensor.powder_room_motion",
                                            "state": "off",
                                            "attributes": {
                                                "icon": "mdi:walk",
                                                "friendly_name": "Powder Room Motion"
                                            },
                                            "last_changed": "2022-03-03T05:46:27.848988+00:00",
                                            "last_updated": "2022-03-03T05:46:27.848988+00:00",
                                            "context": {
                                                "id": "e2d9e2314918b3c6a72706b3aa8b5dce",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "to_state": {
                                            "entity_id": "binary_sensor.powder_room_motion",
                                            "state": "on",
                                            "attributes": {
                                                "icon": "mdi:walk",
                                                "friendly_name": "Powder Room Motion"
                                            },
                                            "last_changed": "2022-03-03T07:46:50.681066+00:00",
                                            "last_updated": "2022-03-03T07:46:50.681066+00:00",
                                            "context": {
                                                "id": "937bf34a906b53394ba09a68e6bfedfa",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "for": null,
                                        "attribute": null,
                                        "description": "state of binary_sensor.powder_room_motion"
                                    }
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T07:46:50.683398+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "12ef35d866260ebac007064b6e61206a",
                                        "parent_id": "937bf34a906b53394ba09a68e6bfedfa",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "choice": 0
                                }
                            }
                        ],
                        "action/0/choose/0": [
                            {
                                "path": "action/0/choose/0",
                                "timestamp": "2022-03-03T07:46:50.683466+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/0/conditions/0",
                                "timestamp": "2022-03-03T07:46:50.683490+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/0": [
                            {
                                "path": "action/0/choose/0/sequence/0",
                                "timestamp": "2022-03-03T07:46:50.685163+00:00",
                                "result": {
                                    "choice": "default"
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/0/choose/0": [
                            {
                                "path": "action/0/choose/0/sequence/0/choose/0",
                                "timestamp": "2022-03-03T07:46:50.685214+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/0/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/0/sequence/0/choose/0/conditions/0",
                                "timestamp": "2022-03-03T07:46:50.685231+00:00",
                                "result": {
                                    "after": {
                                        "__type": "<class 'datetime.time'>",
                                        "isoformat": "22:00:00"
                                    },
                                    "now_time": {
                                        "__type": "<class 'datetime.time'>",
                                        "isoformat": "15:46:50.685241"
                                    },
                                    "before": {
                                        "__type": "<class 'datetime.time'>",
                                        "isoformat": "07:00:00"
                                    },
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/0/sequence/0/default/0": [
                            {
                                "path": "action/0/choose/0/sequence/0/default/0",
                                "timestamp": "2022-03-03T07:46:50.685477+00:00",
                                "result": {
                                    "params": {
                                        "domain": "light",
                                        "service": "turn_on",
                                        "service_data": {
                                            "brightness_pct": 100,
                                            "entity_id": [
                                                "light.powder_room_pendant_light_entity"
                                            ]
                                        },
                                        "target": {
                                            "entity_id": [
                                                "light.powder_room_pendant_light_entity"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ]
                    },
                    "config": {
                        "id": "1644145378905",
                        "alias": "Powder Room Motion",
                        "description": "Control the Powder Room Lights with motion",
                        "trigger": [
                            {
                                "platform": "state",
                                "entity_id": "binary_sensor.powder_room_motion",
                                "id": "motion",
                                "to": "on"
                            },
                            {
                                "platform": "state",
                                "entity_id": "binary_sensor.powder_room_motion",
                                "id": "no_motion",
                                "to": "off",
                                "for": {
                                    "hours": 0,
                                    "minutes": 15,
                                    "seconds": 0
                                }
                            }
                        ],
                        "condition": [],
                        "action": [
                            {
                                "choose": [
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "motion"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [
                                                            {
                                                                "condition": "time",
                                                                "before": "input_datetime.lights_auto_control_end",
                                                                "after": "input_datetime.sleep_hours_start"
                                                            }
                                                        ],
                                                        "sequence": [
                                                            {
                                                                "service": "light.turn_on",
                                                                "target": {
                                                                    "entity_id": "light.powder_room_pendant_light_entity"
                                                                },
                                                                "data": {
                                                                    "brightness_pct": 5
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.powder_room_pendant_light_entity"
                                                        },
                                                        "data": {
                                                            "brightness_pct": 100
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "trigger",
                                                "id": "no_motion"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "light.turn_off",
                                                "target": {
                                                    "entity_id": "light.powder_room_pendant_light_entity"
                                                }
                                            }
                                        ]
                                    }
                                ],
                                "default": []
                            }
                        ],
                        "mode": "single"
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "12ef35d866260ebac007064b6e61206a",
                        "parent_id": "937bf34a906b53394ba09a68e6bfedfa",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/0/choose/0/sequence/0/default/0",
                    "run_id": "e78319c76eaf358d5a1b537db0b0f73b",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T07:46:50.681874+00:00",
                        "finish": "2022-03-03T07:46:50.749002+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1644145378905",
                    "trigger": "state of binary_sensor.powder_room_motion"
                }
            }
        ],
        "automation.1643641285314": [
            {
                "extended_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "c12c3a755e3bb6911b7c5cad41fd084b",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T03:49:30.524587+00:00",
                        "finish": "2022-03-03T03:49:30.530919+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643641285314",
                    "trigger": "event 'zha_event'",
                    "trace": {
                        "trigger/1": [
                            {
                                "path": "trigger/1",
                                "timestamp": "2022-03-03T03:49:30.525372+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.dining_room_lights_controller_2",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T02:52:43.712610+00:00",
                                            "mode": "restart",
                                            "current": 0,
                                            "id": "1643641285314",
                                            "friendly_name": "Dining Room Lights Controller 2"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.798070+00:00",
                                        "last_updated": "2022-03-03T02:52:43.717392+00:00",
                                        "context": {
                                            "id": "fc109da884bfe9fb089a456f01ceb77d",
                                            "parent_id": "bd75e83e06a1b8a49ba67cffeff7178a",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "1",
                                        "idx": "1",
                                        "platform": "event",
                                        "event": {
                                            "event_type": "zha_event",
                                            "data": {
                                                "device_ieee": "84:fd:27:ff:fe:95:bc:5c",
                                                "unique_id": "84:fd:27:ff:fe:95:bc:5c:1:0x0020",
                                                "device_id": "cea5083fc6a1972a0b57048ffa03cfd8",
                                                "endpoint_id": 1,
                                                "cluster_id": 32,
                                                "command": "checkin",
                                                "args": []
                                            },
                                            "origin": "LOCAL",
                                            "time_fired": "2022-03-03T03:49:30.523525+00:00",
                                            "context": {
                                                "id": "00a391b78569d9df061d44707597eb9e",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "description": "event 'zha_event'"
                                    },
                                    "integration": "ZHA",
                                    "button_up_long_loop": true,
                                    "button_up_long_max_loop_repeats": 50,
                                    "button_up_double_press": false,
                                    "button_down_long_loop": true,
                                    "button_down_long_max_loop_repeats": 50,
                                    "button_down_double_press": false,
                                    "helper_last_controller_event": "input_text.zz_dining_room_lights_controller_2_last_event",
                                    "helper_double_press_delay": 500,
                                    "helper_debounce_delay": 0,
                                    "integration_id": "zha",
                                    "adjusted_double_press_delay": 500,
                                    "actions_mapping": {
                                        "deconz": {
                                            "button_up_short": [
                                                "1002"
                                            ],
                                            "button_up_long": [
                                                "1001"
                                            ],
                                            "button_up_release": [
                                                "1003"
                                            ],
                                            "button_down_short": [
                                                "2002"
                                            ],
                                            "button_down_long": [
                                                "2001"
                                            ],
                                            "button_down_release": [
                                                "2003"
                                            ]
                                        },
                                        "zha": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "move_with_on_off_0_83"
                                            ],
                                            "button_up_release": [
                                                "stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "move_1_83"
                                            ],
                                            "button_down_release": [
                                                "stop"
                                            ]
                                        },
                                        "zigbee2mqtt": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "brightness_move_up"
                                            ],
                                            "button_up_release": [
                                                "brightness_stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "brightness_move_down"
                                            ],
                                            "button_down_release": [
                                                "brightness_stop"
                                            ]
                                        }
                                    },
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ],
                                    "integrations_with_prev_event_storage": [
                                        "zha",
                                        "zigbee2mqtt"
                                    ],
                                    "controller_entity": "",
                                    "controller_device": "cea5083fc6a1972a0b57048ffa03cfd8",
                                    "controller_id": "cea5083fc6a1972a0b57048ffa03cfd8"
                                }
                            }
                        ],
                        "condition/0": [
                            {
                                "path": "condition/0",
                                "timestamp": "2022-03-03T03:49:30.525404+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "condition/0/conditions/0": [
                            {
                                "path": "condition/0/conditions/0",
                                "timestamp": "2022-03-03T03:49:30.525421+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "condition/0/conditions/1": [
                            {
                                "path": "condition/0/conditions/1",
                                "timestamp": "2022-03-03T03:49:30.525561+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T03:49:30.526713+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "6e0f8cc200e49824f4fe579251fbd958",
                                        "parent_id": "00a391b78569d9df061d44707597eb9e",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "delay": 0.0,
                                    "done": true
                                }
                            }
                        ],
                        "action/1": [
                            {
                                "path": "action/1",
                                "timestamp": "2022-03-03T03:49:30.527482+00:00"
                            }
                        ],
                        "action/2": [
                            {
                                "path": "action/2",
                                "timestamp": "2022-03-03T03:49:30.528036+00:00",
                                "changed_variables": {
                                    "trigger_action": "checkin",
                                    "trigger_delta": 3406813.07888031,
                                    "last_controller_event": "checkin"
                                },
                                "result": {
                                    "params": {
                                        "domain": "input_text",
                                        "service": "set_value",
                                        "service_data": {
                                            "entity_id": "input_text.zz_dining_room_lights_controller_2_last_event",
                                            "value": {
                                                "trigger_action": "checkin",
                                                "last_triggered": "2022-03-03 11:49:30.528129+08:00"
                                            }
                                        },
                                        "target": {}
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "action/3": [
                            {
                                "path": "action/3",
                                "timestamp": "2022-03-03T03:49:30.529605+00:00"
                            }
                        ],
                        "action/3/choose/0": [
                            {
                                "path": "action/3/choose/0",
                                "timestamp": "2022-03-03T03:49:30.529661+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/0/conditions/0": [
                            {
                                "path": "action/3/choose/0/conditions/0",
                                "timestamp": "2022-03-03T03:49:30.529703+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/1": [
                            {
                                "path": "action/3/choose/1",
                                "timestamp": "2022-03-03T03:49:30.529837+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/1/conditions/0": [
                            {
                                "path": "action/3/choose/1/conditions/0",
                                "timestamp": "2022-03-03T03:49:30.529858+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/2": [
                            {
                                "path": "action/3/choose/2",
                                "timestamp": "2022-03-03T03:49:30.529936+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/2/conditions/0": [
                            {
                                "path": "action/3/choose/2/conditions/0",
                                "timestamp": "2022-03-03T03:49:30.529955+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/3": [
                            {
                                "path": "action/3/choose/3",
                                "timestamp": "2022-03-03T03:49:30.530039+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/3/conditions/0": [
                            {
                                "path": "action/3/choose/3/conditions/0",
                                "timestamp": "2022-03-03T03:49:30.530060+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/4": [
                            {
                                "path": "action/3/choose/4",
                                "timestamp": "2022-03-03T03:49:30.530130+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/4/conditions/0": [
                            {
                                "path": "action/3/choose/4/conditions/0",
                                "timestamp": "2022-03-03T03:49:30.530147+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/5": [
                            {
                                "path": "action/3/choose/5",
                                "timestamp": "2022-03-03T03:49:30.530221+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/5/conditions/0": [
                            {
                                "path": "action/3/choose/5/conditions/0",
                                "timestamp": "2022-03-03T03:49:30.530239+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ]
                    },
                    "config": {
                        "variables": {
                            "integration": "ZHA",
                            "button_up_long_loop": true,
                            "button_up_long_max_loop_repeats": 50,
                            "button_up_double_press": false,
                            "button_down_long_loop": true,
                            "button_down_long_max_loop_repeats": 50,
                            "button_down_double_press": false,
                            "helper_last_controller_event": "input_text.zz_dining_room_lights_controller_2_last_event",
                            "helper_double_press_delay": 500,
                            "helper_debounce_delay": 0,
                            "integration_id": "{{ integration | lower }}",
                            "adjusted_double_press_delay": "{{ [helper_double_press_delay - helper_debounce_delay, 100] | max }}",
                            "actions_mapping": {
                                "deconz": {
                                    "button_up_short": [
                                        "1002"
                                    ],
                                    "button_up_long": [
                                        "1001"
                                    ],
                                    "button_up_release": [
                                        "1003"
                                    ],
                                    "button_down_short": [
                                        "2002"
                                    ],
                                    "button_down_long": [
                                        "2001"
                                    ],
                                    "button_down_release": [
                                        "2003"
                                    ]
                                },
                                "zha": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ]
                                },
                                "zigbee2mqtt": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "brightness_move_up"
                                    ],
                                    "button_up_release": [
                                        "brightness_stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "brightness_move_down"
                                    ],
                                    "button_down_release": [
                                        "brightness_stop"
                                    ]
                                }
                            },
                            "button_up_short": "{{ actions_mapping[integration_id][\"button_up_short\"] }}",
                            "button_up_long": "{{ actions_mapping[integration_id][\"button_up_long\"] }}",
                            "button_up_release": "{{ actions_mapping[integration_id][\"button_up_release\"] }}",
                            "button_down_short": "{{ actions_mapping[integration_id][\"button_down_short\"] }}",
                            "button_down_long": "{{ actions_mapping[integration_id][\"button_down_long\"] }}",
                            "button_down_release": "{{ actions_mapping[integration_id][\"button_down_release\"] }}",
                            "integrations_with_prev_event_storage": [
                                "zha",
                                "zigbee2mqtt"
                            ],
                            "controller_entity": "",
                            "controller_device": "cea5083fc6a1972a0b57048ffa03cfd8",
                            "controller_id": "{% if integration_id==\"zigbee2mqtt\" %}{{controller_entity}}{% else %}{{controller_device}}{% endif %}"
                        },
                        "mode": "restart",
                        "max_exceeded": "silent",
                        "trigger": [
                            {
                                "platform": "event",
                                "event_type": "state_changed",
                                "event_data": {
                                    "entity_id": ""
                                }
                            },
                            {
                                "platform": "event",
                                "event_type": [
                                    "deconz_event",
                                    "zha_event"
                                ],
                                "event_data": {
                                    "device_id": "cea5083fc6a1972a0b57048ffa03cfd8"
                                }
                            }
                        ],
                        "condition": [
                            {
                                "condition": "and",
                                "conditions": [
                                    "{%- set trigger_action -%} {%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%} {%- endset -%} {{ trigger_action not in [\"\",\"None\"] }}",
                                    "{{ integration_id != \"zigbee2mqtt\" or trigger.event.data.new_state.state != trigger.event.data.old_state.state }}"
                                ]
                            }
                        ],
                        "action": [
                            {
                                "delay": {
                                    "milliseconds": 0
                                }
                            },
                            {
                                "variables": {
                                    "trigger_action": "{%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%}",
                                    "trigger_delta": "{{ (as_timestamp(now()) - as_timestamp((states(helper_last_controller_event) | from_json).last_triggered if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"1970-01-01 00:00:00\")) * 1000 }}",
                                    "last_controller_event": "{{ (states(helper_last_controller_event) | from_json).trigger_action if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"\" }}"
                                }
                            },
                            {
                                "service": "input_text.set_value",
                                "data": {
                                    "entity_id": "input_text.zz_dining_room_lights_controller_2_last_event",
                                    "value": "{{ {\"trigger_action\":trigger_action,\"last_triggered\":now()|string} | to_json }}"
                                }
                            },
                            {
                                "choose": [
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_dining_room_lights_controller_2_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_up_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_up_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "choose": [
                                                                                            {
                                                                                                "conditions": [
                                                                                                    {
                                                                                                        "condition": "time",
                                                                                                        "after": "input_datetime.sleep_hours_start",
                                                                                                        "before": "input_datetime.lights_auto_control_end"
                                                                                                    }
                                                                                                ],
                                                                                                "sequence": [
                                                                                                    {
                                                                                                        "service": "light.turn_on",
                                                                                                        "target": {
                                                                                                            "entity_id": "light.dining_room_lights"
                                                                                                        },
                                                                                                        "data": {
                                                                                                            "brightness_pct": 5
                                                                                                        }
                                                                                                    }
                                                                                                ]
                                                                                            }
                                                                                        ],
                                                                                        "default": [
                                                                                            {
                                                                                                "service": "light.turn_on",
                                                                                                "target": {
                                                                                                    "entity_id": "light.dining_room_lights"
                                                                                                },
                                                                                                "data": {
                                                                                                    "brightness_pct": 98
                                                                                                }
                                                                                            }
                                                                                        ]
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_up_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [
                                                                                    {
                                                                                        "condition": "time",
                                                                                        "after": "input_datetime.sleep_hours_start",
                                                                                        "before": "input_datetime.lights_auto_control_end"
                                                                                    }
                                                                                ],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "light.turn_on",
                                                                                        "target": {
                                                                                            "entity_id": "light.dining_room_lights"
                                                                                        },
                                                                                        "data": {
                                                                                            "brightness_pct": 5
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ],
                                                                        "default": [
                                                                            {
                                                                                "service": "light.turn_on",
                                                                                "target": {
                                                                                    "entity_id": "light.dining_room_lights"
                                                                                },
                                                                                "data": {
                                                                                    "brightness_pct": 98
                                                                                }
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_up_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "light.turn_on",
                                                                            "target": {
                                                                                "entity_id": "light.dining_room_lights"
                                                                            },
                                                                            "data": {
                                                                                "brightness_step_pct": 10
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.dining_room_lights"
                                                        },
                                                        "data": {
                                                            "brightness_step_pct": 10
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_up_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_up_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_dining_room_lights_controller_2_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_down_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_down_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "light.turn_off",
                                                                                        "target": {
                                                                                            "entity_id": "light.dining_room_lights"
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_down_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "light.turn_off",
                                                                        "target": {
                                                                            "entity_id": "light.dining_room_lights"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_down_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "light.turn_on",
                                                                            "target": {
                                                                                "entity_id": "light.dining_room_lights"
                                                                            },
                                                                            "data": {
                                                                                "brightness_step_pct": -10
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.dining_room_lights"
                                                        },
                                                        "data": {
                                                            "brightness_step_pct": -10
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_down_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_down_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            }
                        ],
                        "id": "1643641285314",
                        "alias": "Dining Room Lights Controller 2",
                        "description": "Control the Dining Room Lights"
                    },
                    "blueprint_inputs": {
                        "id": "1643641285314",
                        "alias": "Dining Room Lights Controller 2",
                        "description": "Control the Dining Room Lights",
                        "use_blueprint": {
                            "path": "EPMatt/ikea_e1743.yaml",
                            "input": {
                                "integration": "ZHA",
                                "controller_device": "cea5083fc6a1972a0b57048ffa03cfd8",
                                "helper_last_controller_event": "input_text.zz_dining_room_lights_controller_2_last_event",
                                "action_button_up_short": [
                                    {
                                        "choose": [
                                            {
                                                "conditions": [
                                                    {
                                                        "condition": "time",
                                                        "after": "input_datetime.sleep_hours_start",
                                                        "before": "input_datetime.lights_auto_control_end"
                                                    }
                                                ],
                                                "sequence": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.dining_room_lights"
                                                        },
                                                        "data": {
                                                            "brightness_pct": 5
                                                        }
                                                    }
                                                ]
                                            }
                                        ],
                                        "default": [
                                            {
                                                "service": "light.turn_on",
                                                "target": {
                                                    "entity_id": "light.dining_room_lights"
                                                },
                                                "data": {
                                                    "brightness_pct": 98
                                                }
                                            }
                                        ]
                                    }
                                ],
                                "action_button_up_long": [
                                    {
                                        "service": "light.turn_on",
                                        "target": {
                                            "entity_id": "light.dining_room_lights"
                                        },
                                        "data": {
                                            "brightness_step_pct": 10
                                        }
                                    }
                                ],
                                "action_button_down_short": [
                                    {
                                        "service": "light.turn_off",
                                        "target": {
                                            "entity_id": "light.dining_room_lights"
                                        }
                                    }
                                ],
                                "action_button_down_long": [
                                    {
                                        "service": "light.turn_on",
                                        "target": {
                                            "entity_id": "light.dining_room_lights"
                                        },
                                        "data": {
                                            "brightness_step_pct": -10
                                        }
                                    }
                                ],
                                "button_up_long_max_loop_repeats": 50,
                                "button_down_long_max_loop_repeats": 50,
                                "button_down_long_loop": true,
                                "button_up_long_loop": true
                            }
                        }
                    },
                    "context": {
                        "id": "6e0f8cc200e49824f4fe579251fbd958",
                        "parent_id": "00a391b78569d9df061d44707597eb9e",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "c12c3a755e3bb6911b7c5cad41fd084b",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T03:49:30.524587+00:00",
                        "finish": "2022-03-03T03:49:30.530919+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643641285314",
                    "trigger": "event 'zha_event'"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "42b9e542cbf813d018edcc8be4e3b055",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T04:46:17.293883+00:00",
                        "finish": "2022-03-03T04:46:17.299954+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643641285314",
                    "trigger": "event 'zha_event'",
                    "trace": {
                        "trigger/1": [
                            {
                                "path": "trigger/1",
                                "timestamp": "2022-03-03T04:46:17.294617+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.dining_room_lights_controller_2",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T03:49:30.525761+00:00",
                                            "mode": "restart",
                                            "current": 0,
                                            "id": "1643641285314",
                                            "friendly_name": "Dining Room Lights Controller 2"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.798070+00:00",
                                        "last_updated": "2022-03-03T03:49:30.530357+00:00",
                                        "context": {
                                            "id": "6e0f8cc200e49824f4fe579251fbd958",
                                            "parent_id": "00a391b78569d9df061d44707597eb9e",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "1",
                                        "idx": "1",
                                        "platform": "event",
                                        "event": {
                                            "event_type": "zha_event",
                                            "data": {
                                                "device_ieee": "84:fd:27:ff:fe:95:bc:5c",
                                                "unique_id": "84:fd:27:ff:fe:95:bc:5c:1:0x0020",
                                                "device_id": "cea5083fc6a1972a0b57048ffa03cfd8",
                                                "endpoint_id": 1,
                                                "cluster_id": 32,
                                                "command": "checkin",
                                                "args": []
                                            },
                                            "origin": "LOCAL",
                                            "time_fired": "2022-03-03T04:46:17.292528+00:00",
                                            "context": {
                                                "id": "98cb74bea866be5fd46644ac79117c49",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "description": "event 'zha_event'"
                                    },
                                    "integration": "ZHA",
                                    "button_up_long_loop": true,
                                    "button_up_long_max_loop_repeats": 50,
                                    "button_up_double_press": false,
                                    "button_down_long_loop": true,
                                    "button_down_long_max_loop_repeats": 50,
                                    "button_down_double_press": false,
                                    "helper_last_controller_event": "input_text.zz_dining_room_lights_controller_2_last_event",
                                    "helper_double_press_delay": 500,
                                    "helper_debounce_delay": 0,
                                    "integration_id": "zha",
                                    "adjusted_double_press_delay": 500,
                                    "actions_mapping": {
                                        "deconz": {
                                            "button_up_short": [
                                                "1002"
                                            ],
                                            "button_up_long": [
                                                "1001"
                                            ],
                                            "button_up_release": [
                                                "1003"
                                            ],
                                            "button_down_short": [
                                                "2002"
                                            ],
                                            "button_down_long": [
                                                "2001"
                                            ],
                                            "button_down_release": [
                                                "2003"
                                            ]
                                        },
                                        "zha": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "move_with_on_off_0_83"
                                            ],
                                            "button_up_release": [
                                                "stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "move_1_83"
                                            ],
                                            "button_down_release": [
                                                "stop"
                                            ]
                                        },
                                        "zigbee2mqtt": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "brightness_move_up"
                                            ],
                                            "button_up_release": [
                                                "brightness_stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "brightness_move_down"
                                            ],
                                            "button_down_release": [
                                                "brightness_stop"
                                            ]
                                        }
                                    },
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ],
                                    "integrations_with_prev_event_storage": [
                                        "zha",
                                        "zigbee2mqtt"
                                    ],
                                    "controller_entity": "",
                                    "controller_device": "cea5083fc6a1972a0b57048ffa03cfd8",
                                    "controller_id": "cea5083fc6a1972a0b57048ffa03cfd8"
                                }
                            }
                        ],
                        "condition/0": [
                            {
                                "path": "condition/0",
                                "timestamp": "2022-03-03T04:46:17.294653+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "condition/0/conditions/0": [
                            {
                                "path": "condition/0/conditions/0",
                                "timestamp": "2022-03-03T04:46:17.294671+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "condition/0/conditions/1": [
                            {
                                "path": "condition/0/conditions/1",
                                "timestamp": "2022-03-03T04:46:17.294832+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T04:46:17.295562+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "33e303a8752eaa5aadebdc5659d59602",
                                        "parent_id": "98cb74bea866be5fd46644ac79117c49",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "delay": 0.0,
                                    "done": true
                                }
                            }
                        ],
                        "action/1": [
                            {
                                "path": "action/1",
                                "timestamp": "2022-03-03T04:46:17.296537+00:00"
                            }
                        ],
                        "action/2": [
                            {
                                "path": "action/2",
                                "timestamp": "2022-03-03T04:46:17.297155+00:00",
                                "changed_variables": {
                                    "trigger_action": "checkin",
                                    "trigger_delta": 3406768.651008606,
                                    "last_controller_event": "checkin"
                                },
                                "result": {
                                    "params": {
                                        "domain": "input_text",
                                        "service": "set_value",
                                        "service_data": {
                                            "entity_id": "input_text.zz_dining_room_lights_controller_2_last_event",
                                            "value": {
                                                "trigger_action": "checkin",
                                                "last_triggered": "2022-03-03 12:46:17.297262+08:00"
                                            }
                                        },
                                        "target": {}
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "action/3": [
                            {
                                "path": "action/3",
                                "timestamp": "2022-03-03T04:46:17.298642+00:00"
                            }
                        ],
                        "action/3/choose/0": [
                            {
                                "path": "action/3/choose/0",
                                "timestamp": "2022-03-03T04:46:17.298716+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/0/conditions/0": [
                            {
                                "path": "action/3/choose/0/conditions/0",
                                "timestamp": "2022-03-03T04:46:17.298743+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/1": [
                            {
                                "path": "action/3/choose/1",
                                "timestamp": "2022-03-03T04:46:17.298849+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/1/conditions/0": [
                            {
                                "path": "action/3/choose/1/conditions/0",
                                "timestamp": "2022-03-03T04:46:17.298868+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/2": [
                            {
                                "path": "action/3/choose/2",
                                "timestamp": "2022-03-03T04:46:17.298941+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/2/conditions/0": [
                            {
                                "path": "action/3/choose/2/conditions/0",
                                "timestamp": "2022-03-03T04:46:17.298960+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/3": [
                            {
                                "path": "action/3/choose/3",
                                "timestamp": "2022-03-03T04:46:17.299034+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/3/conditions/0": [
                            {
                                "path": "action/3/choose/3/conditions/0",
                                "timestamp": "2022-03-03T04:46:17.299052+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/4": [
                            {
                                "path": "action/3/choose/4",
                                "timestamp": "2022-03-03T04:46:17.299120+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/4/conditions/0": [
                            {
                                "path": "action/3/choose/4/conditions/0",
                                "timestamp": "2022-03-03T04:46:17.299137+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/5": [
                            {
                                "path": "action/3/choose/5",
                                "timestamp": "2022-03-03T04:46:17.299208+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/5/conditions/0": [
                            {
                                "path": "action/3/choose/5/conditions/0",
                                "timestamp": "2022-03-03T04:46:17.299229+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ]
                    },
                    "config": {
                        "variables": {
                            "integration": "ZHA",
                            "button_up_long_loop": true,
                            "button_up_long_max_loop_repeats": 50,
                            "button_up_double_press": false,
                            "button_down_long_loop": true,
                            "button_down_long_max_loop_repeats": 50,
                            "button_down_double_press": false,
                            "helper_last_controller_event": "input_text.zz_dining_room_lights_controller_2_last_event",
                            "helper_double_press_delay": 500,
                            "helper_debounce_delay": 0,
                            "integration_id": "{{ integration | lower }}",
                            "adjusted_double_press_delay": "{{ [helper_double_press_delay - helper_debounce_delay, 100] | max }}",
                            "actions_mapping": {
                                "deconz": {
                                    "button_up_short": [
                                        "1002"
                                    ],
                                    "button_up_long": [
                                        "1001"
                                    ],
                                    "button_up_release": [
                                        "1003"
                                    ],
                                    "button_down_short": [
                                        "2002"
                                    ],
                                    "button_down_long": [
                                        "2001"
                                    ],
                                    "button_down_release": [
                                        "2003"
                                    ]
                                },
                                "zha": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ]
                                },
                                "zigbee2mqtt": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "brightness_move_up"
                                    ],
                                    "button_up_release": [
                                        "brightness_stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "brightness_move_down"
                                    ],
                                    "button_down_release": [
                                        "brightness_stop"
                                    ]
                                }
                            },
                            "button_up_short": "{{ actions_mapping[integration_id][\"button_up_short\"] }}",
                            "button_up_long": "{{ actions_mapping[integration_id][\"button_up_long\"] }}",
                            "button_up_release": "{{ actions_mapping[integration_id][\"button_up_release\"] }}",
                            "button_down_short": "{{ actions_mapping[integration_id][\"button_down_short\"] }}",
                            "button_down_long": "{{ actions_mapping[integration_id][\"button_down_long\"] }}",
                            "button_down_release": "{{ actions_mapping[integration_id][\"button_down_release\"] }}",
                            "integrations_with_prev_event_storage": [
                                "zha",
                                "zigbee2mqtt"
                            ],
                            "controller_entity": "",
                            "controller_device": "cea5083fc6a1972a0b57048ffa03cfd8",
                            "controller_id": "{% if integration_id==\"zigbee2mqtt\" %}{{controller_entity}}{% else %}{{controller_device}}{% endif %}"
                        },
                        "mode": "restart",
                        "max_exceeded": "silent",
                        "trigger": [
                            {
                                "platform": "event",
                                "event_type": "state_changed",
                                "event_data": {
                                    "entity_id": ""
                                }
                            },
                            {
                                "platform": "event",
                                "event_type": [
                                    "deconz_event",
                                    "zha_event"
                                ],
                                "event_data": {
                                    "device_id": "cea5083fc6a1972a0b57048ffa03cfd8"
                                }
                            }
                        ],
                        "condition": [
                            {
                                "condition": "and",
                                "conditions": [
                                    "{%- set trigger_action -%} {%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%} {%- endset -%} {{ trigger_action not in [\"\",\"None\"] }}",
                                    "{{ integration_id != \"zigbee2mqtt\" or trigger.event.data.new_state.state != trigger.event.data.old_state.state }}"
                                ]
                            }
                        ],
                        "action": [
                            {
                                "delay": {
                                    "milliseconds": 0
                                }
                            },
                            {
                                "variables": {
                                    "trigger_action": "{%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%}",
                                    "trigger_delta": "{{ (as_timestamp(now()) - as_timestamp((states(helper_last_controller_event) | from_json).last_triggered if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"1970-01-01 00:00:00\")) * 1000 }}",
                                    "last_controller_event": "{{ (states(helper_last_controller_event) | from_json).trigger_action if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"\" }}"
                                }
                            },
                            {
                                "service": "input_text.set_value",
                                "data": {
                                    "entity_id": "input_text.zz_dining_room_lights_controller_2_last_event",
                                    "value": "{{ {\"trigger_action\":trigger_action,\"last_triggered\":now()|string} | to_json }}"
                                }
                            },
                            {
                                "choose": [
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_dining_room_lights_controller_2_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_up_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_up_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "choose": [
                                                                                            {
                                                                                                "conditions": [
                                                                                                    {
                                                                                                        "condition": "time",
                                                                                                        "after": "input_datetime.sleep_hours_start",
                                                                                                        "before": "input_datetime.lights_auto_control_end"
                                                                                                    }
                                                                                                ],
                                                                                                "sequence": [
                                                                                                    {
                                                                                                        "service": "light.turn_on",
                                                                                                        "target": {
                                                                                                            "entity_id": "light.dining_room_lights"
                                                                                                        },
                                                                                                        "data": {
                                                                                                            "brightness_pct": 5
                                                                                                        }
                                                                                                    }
                                                                                                ]
                                                                                            }
                                                                                        ],
                                                                                        "default": [
                                                                                            {
                                                                                                "service": "light.turn_on",
                                                                                                "target": {
                                                                                                    "entity_id": "light.dining_room_lights"
                                                                                                },
                                                                                                "data": {
                                                                                                    "brightness_pct": 98
                                                                                                }
                                                                                            }
                                                                                        ]
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_up_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [
                                                                                    {
                                                                                        "condition": "time",
                                                                                        "after": "input_datetime.sleep_hours_start",
                                                                                        "before": "input_datetime.lights_auto_control_end"
                                                                                    }
                                                                                ],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "light.turn_on",
                                                                                        "target": {
                                                                                            "entity_id": "light.dining_room_lights"
                                                                                        },
                                                                                        "data": {
                                                                                            "brightness_pct": 5
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ],
                                                                        "default": [
                                                                            {
                                                                                "service": "light.turn_on",
                                                                                "target": {
                                                                                    "entity_id": "light.dining_room_lights"
                                                                                },
                                                                                "data": {
                                                                                    "brightness_pct": 98
                                                                                }
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_up_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "light.turn_on",
                                                                            "target": {
                                                                                "entity_id": "light.dining_room_lights"
                                                                            },
                                                                            "data": {
                                                                                "brightness_step_pct": 10
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.dining_room_lights"
                                                        },
                                                        "data": {
                                                            "brightness_step_pct": 10
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_up_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_up_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_dining_room_lights_controller_2_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_down_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_down_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "light.turn_off",
                                                                                        "target": {
                                                                                            "entity_id": "light.dining_room_lights"
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_down_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "light.turn_off",
                                                                        "target": {
                                                                            "entity_id": "light.dining_room_lights"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_down_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "light.turn_on",
                                                                            "target": {
                                                                                "entity_id": "light.dining_room_lights"
                                                                            },
                                                                            "data": {
                                                                                "brightness_step_pct": -10
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.dining_room_lights"
                                                        },
                                                        "data": {
                                                            "brightness_step_pct": -10
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_down_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_down_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            }
                        ],
                        "id": "1643641285314",
                        "alias": "Dining Room Lights Controller 2",
                        "description": "Control the Dining Room Lights"
                    },
                    "blueprint_inputs": {
                        "id": "1643641285314",
                        "alias": "Dining Room Lights Controller 2",
                        "description": "Control the Dining Room Lights",
                        "use_blueprint": {
                            "path": "EPMatt/ikea_e1743.yaml",
                            "input": {
                                "integration": "ZHA",
                                "controller_device": "cea5083fc6a1972a0b57048ffa03cfd8",
                                "helper_last_controller_event": "input_text.zz_dining_room_lights_controller_2_last_event",
                                "action_button_up_short": [
                                    {
                                        "choose": [
                                            {
                                                "conditions": [
                                                    {
                                                        "condition": "time",
                                                        "after": "input_datetime.sleep_hours_start",
                                                        "before": "input_datetime.lights_auto_control_end"
                                                    }
                                                ],
                                                "sequence": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.dining_room_lights"
                                                        },
                                                        "data": {
                                                            "brightness_pct": 5
                                                        }
                                                    }
                                                ]
                                            }
                                        ],
                                        "default": [
                                            {
                                                "service": "light.turn_on",
                                                "target": {
                                                    "entity_id": "light.dining_room_lights"
                                                },
                                                "data": {
                                                    "brightness_pct": 98
                                                }
                                            }
                                        ]
                                    }
                                ],
                                "action_button_up_long": [
                                    {
                                        "service": "light.turn_on",
                                        "target": {
                                            "entity_id": "light.dining_room_lights"
                                        },
                                        "data": {
                                            "brightness_step_pct": 10
                                        }
                                    }
                                ],
                                "action_button_down_short": [
                                    {
                                        "service": "light.turn_off",
                                        "target": {
                                            "entity_id": "light.dining_room_lights"
                                        }
                                    }
                                ],
                                "action_button_down_long": [
                                    {
                                        "service": "light.turn_on",
                                        "target": {
                                            "entity_id": "light.dining_room_lights"
                                        },
                                        "data": {
                                            "brightness_step_pct": -10
                                        }
                                    }
                                ],
                                "button_up_long_max_loop_repeats": 50,
                                "button_down_long_max_loop_repeats": 50,
                                "button_down_long_loop": true,
                                "button_up_long_loop": true
                            }
                        }
                    },
                    "context": {
                        "id": "33e303a8752eaa5aadebdc5659d59602",
                        "parent_id": "98cb74bea866be5fd46644ac79117c49",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "42b9e542cbf813d018edcc8be4e3b055",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T04:46:17.293883+00:00",
                        "finish": "2022-03-03T04:46:17.299954+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643641285314",
                    "trigger": "event 'zha_event'"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "1edb90b0da2226820c5485eb60e7599c",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:43:04.084388+00:00",
                        "finish": "2022-03-03T05:43:04.090823+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643641285314",
                    "trigger": "event 'zha_event'",
                    "trace": {
                        "trigger/1": [
                            {
                                "path": "trigger/1",
                                "timestamp": "2022-03-03T05:43:04.085174+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.dining_room_lights_controller_2",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T04:46:17.295012+00:00",
                                            "mode": "restart",
                                            "current": 0,
                                            "id": "1643641285314",
                                            "friendly_name": "Dining Room Lights Controller 2"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.798070+00:00",
                                        "last_updated": "2022-03-03T04:46:17.299626+00:00",
                                        "context": {
                                            "id": "33e303a8752eaa5aadebdc5659d59602",
                                            "parent_id": "98cb74bea866be5fd46644ac79117c49",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "1",
                                        "idx": "1",
                                        "platform": "event",
                                        "event": {
                                            "event_type": "zha_event",
                                            "data": {
                                                "device_ieee": "84:fd:27:ff:fe:95:bc:5c",
                                                "unique_id": "84:fd:27:ff:fe:95:bc:5c:1:0x0020",
                                                "device_id": "cea5083fc6a1972a0b57048ffa03cfd8",
                                                "endpoint_id": 1,
                                                "cluster_id": 32,
                                                "command": "checkin",
                                                "args": []
                                            },
                                            "origin": "LOCAL",
                                            "time_fired": "2022-03-03T05:43:04.083561+00:00",
                                            "context": {
                                                "id": "0342b4321243f79dae5efb7362f7078e",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "description": "event 'zha_event'"
                                    },
                                    "integration": "ZHA",
                                    "button_up_long_loop": true,
                                    "button_up_long_max_loop_repeats": 50,
                                    "button_up_double_press": false,
                                    "button_down_long_loop": true,
                                    "button_down_long_max_loop_repeats": 50,
                                    "button_down_double_press": false,
                                    "helper_last_controller_event": "input_text.zz_dining_room_lights_controller_2_last_event",
                                    "helper_double_press_delay": 500,
                                    "helper_debounce_delay": 0,
                                    "integration_id": "zha",
                                    "adjusted_double_press_delay": 500,
                                    "actions_mapping": {
                                        "deconz": {
                                            "button_up_short": [
                                                "1002"
                                            ],
                                            "button_up_long": [
                                                "1001"
                                            ],
                                            "button_up_release": [
                                                "1003"
                                            ],
                                            "button_down_short": [
                                                "2002"
                                            ],
                                            "button_down_long": [
                                                "2001"
                                            ],
                                            "button_down_release": [
                                                "2003"
                                            ]
                                        },
                                        "zha": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "move_with_on_off_0_83"
                                            ],
                                            "button_up_release": [
                                                "stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "move_1_83"
                                            ],
                                            "button_down_release": [
                                                "stop"
                                            ]
                                        },
                                        "zigbee2mqtt": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "brightness_move_up"
                                            ],
                                            "button_up_release": [
                                                "brightness_stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "brightness_move_down"
                                            ],
                                            "button_down_release": [
                                                "brightness_stop"
                                            ]
                                        }
                                    },
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ],
                                    "integrations_with_prev_event_storage": [
                                        "zha",
                                        "zigbee2mqtt"
                                    ],
                                    "controller_entity": "",
                                    "controller_device": "cea5083fc6a1972a0b57048ffa03cfd8",
                                    "controller_id": "cea5083fc6a1972a0b57048ffa03cfd8"
                                }
                            }
                        ],
                        "condition/0": [
                            {
                                "path": "condition/0",
                                "timestamp": "2022-03-03T05:43:04.085210+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "condition/0/conditions/0": [
                            {
                                "path": "condition/0/conditions/0",
                                "timestamp": "2022-03-03T05:43:04.085228+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "condition/0/conditions/1": [
                            {
                                "path": "condition/0/conditions/1",
                                "timestamp": "2022-03-03T05:43:04.085362+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T05:43:04.086131+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "c6f15af461506c6578c36993a854ca09",
                                        "parent_id": "0342b4321243f79dae5efb7362f7078e",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "delay": 0.0,
                                    "done": true
                                }
                            }
                        ],
                        "action/1": [
                            {
                                "path": "action/1",
                                "timestamp": "2022-03-03T05:43:04.087172+00:00"
                            }
                        ],
                        "action/2": [
                            {
                                "path": "action/2",
                                "timestamp": "2022-03-03T05:43:04.087794+00:00",
                                "changed_variables": {
                                    "trigger_action": "checkin",
                                    "trigger_delta": 3406790.150165558,
                                    "last_controller_event": "checkin"
                                },
                                "result": {
                                    "params": {
                                        "domain": "input_text",
                                        "service": "set_value",
                                        "service_data": {
                                            "entity_id": "input_text.zz_dining_room_lights_controller_2_last_event",
                                            "value": {
                                                "trigger_action": "checkin",
                                                "last_triggered": "2022-03-03 13:43:04.087904+08:00"
                                            }
                                        },
                                        "target": {}
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "action/3": [
                            {
                                "path": "action/3",
                                "timestamp": "2022-03-03T05:43:04.089799+00:00"
                            }
                        ],
                        "action/3/choose/0": [
                            {
                                "path": "action/3/choose/0",
                                "timestamp": "2022-03-03T05:43:04.089859+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/0/conditions/0": [
                            {
                                "path": "action/3/choose/0/conditions/0",
                                "timestamp": "2022-03-03T05:43:04.089879+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/1": [
                            {
                                "path": "action/3/choose/1",
                                "timestamp": "2022-03-03T05:43:04.089978+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/1/conditions/0": [
                            {
                                "path": "action/3/choose/1/conditions/0",
                                "timestamp": "2022-03-03T05:43:04.089997+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/2": [
                            {
                                "path": "action/3/choose/2",
                                "timestamp": "2022-03-03T05:43:04.090079+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/2/conditions/0": [
                            {
                                "path": "action/3/choose/2/conditions/0",
                                "timestamp": "2022-03-03T05:43:04.090097+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/3": [
                            {
                                "path": "action/3/choose/3",
                                "timestamp": "2022-03-03T05:43:04.090165+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/3/conditions/0": [
                            {
                                "path": "action/3/choose/3/conditions/0",
                                "timestamp": "2022-03-03T05:43:04.090183+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/4": [
                            {
                                "path": "action/3/choose/4",
                                "timestamp": "2022-03-03T05:43:04.090248+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/4/conditions/0": [
                            {
                                "path": "action/3/choose/4/conditions/0",
                                "timestamp": "2022-03-03T05:43:04.090264+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/5": [
                            {
                                "path": "action/3/choose/5",
                                "timestamp": "2022-03-03T05:43:04.090327+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/5/conditions/0": [
                            {
                                "path": "action/3/choose/5/conditions/0",
                                "timestamp": "2022-03-03T05:43:04.090348+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ]
                    },
                    "config": {
                        "variables": {
                            "integration": "ZHA",
                            "button_up_long_loop": true,
                            "button_up_long_max_loop_repeats": 50,
                            "button_up_double_press": false,
                            "button_down_long_loop": true,
                            "button_down_long_max_loop_repeats": 50,
                            "button_down_double_press": false,
                            "helper_last_controller_event": "input_text.zz_dining_room_lights_controller_2_last_event",
                            "helper_double_press_delay": 500,
                            "helper_debounce_delay": 0,
                            "integration_id": "{{ integration | lower }}",
                            "adjusted_double_press_delay": "{{ [helper_double_press_delay - helper_debounce_delay, 100] | max }}",
                            "actions_mapping": {
                                "deconz": {
                                    "button_up_short": [
                                        "1002"
                                    ],
                                    "button_up_long": [
                                        "1001"
                                    ],
                                    "button_up_release": [
                                        "1003"
                                    ],
                                    "button_down_short": [
                                        "2002"
                                    ],
                                    "button_down_long": [
                                        "2001"
                                    ],
                                    "button_down_release": [
                                        "2003"
                                    ]
                                },
                                "zha": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ]
                                },
                                "zigbee2mqtt": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "brightness_move_up"
                                    ],
                                    "button_up_release": [
                                        "brightness_stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "brightness_move_down"
                                    ],
                                    "button_down_release": [
                                        "brightness_stop"
                                    ]
                                }
                            },
                            "button_up_short": "{{ actions_mapping[integration_id][\"button_up_short\"] }}",
                            "button_up_long": "{{ actions_mapping[integration_id][\"button_up_long\"] }}",
                            "button_up_release": "{{ actions_mapping[integration_id][\"button_up_release\"] }}",
                            "button_down_short": "{{ actions_mapping[integration_id][\"button_down_short\"] }}",
                            "button_down_long": "{{ actions_mapping[integration_id][\"button_down_long\"] }}",
                            "button_down_release": "{{ actions_mapping[integration_id][\"button_down_release\"] }}",
                            "integrations_with_prev_event_storage": [
                                "zha",
                                "zigbee2mqtt"
                            ],
                            "controller_entity": "",
                            "controller_device": "cea5083fc6a1972a0b57048ffa03cfd8",
                            "controller_id": "{% if integration_id==\"zigbee2mqtt\" %}{{controller_entity}}{% else %}{{controller_device}}{% endif %}"
                        },
                        "mode": "restart",
                        "max_exceeded": "silent",
                        "trigger": [
                            {
                                "platform": "event",
                                "event_type": "state_changed",
                                "event_data": {
                                    "entity_id": ""
                                }
                            },
                            {
                                "platform": "event",
                                "event_type": [
                                    "deconz_event",
                                    "zha_event"
                                ],
                                "event_data": {
                                    "device_id": "cea5083fc6a1972a0b57048ffa03cfd8"
                                }
                            }
                        ],
                        "condition": [
                            {
                                "condition": "and",
                                "conditions": [
                                    "{%- set trigger_action -%} {%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%} {%- endset -%} {{ trigger_action not in [\"\",\"None\"] }}",
                                    "{{ integration_id != \"zigbee2mqtt\" or trigger.event.data.new_state.state != trigger.event.data.old_state.state }}"
                                ]
                            }
                        ],
                        "action": [
                            {
                                "delay": {
                                    "milliseconds": 0
                                }
                            },
                            {
                                "variables": {
                                    "trigger_action": "{%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%}",
                                    "trigger_delta": "{{ (as_timestamp(now()) - as_timestamp((states(helper_last_controller_event) | from_json).last_triggered if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"1970-01-01 00:00:00\")) * 1000 }}",
                                    "last_controller_event": "{{ (states(helper_last_controller_event) | from_json).trigger_action if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"\" }}"
                                }
                            },
                            {
                                "service": "input_text.set_value",
                                "data": {
                                    "entity_id": "input_text.zz_dining_room_lights_controller_2_last_event",
                                    "value": "{{ {\"trigger_action\":trigger_action,\"last_triggered\":now()|string} | to_json }}"
                                }
                            },
                            {
                                "choose": [
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_dining_room_lights_controller_2_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_up_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_up_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "choose": [
                                                                                            {
                                                                                                "conditions": [
                                                                                                    {
                                                                                                        "condition": "time",
                                                                                                        "after": "input_datetime.sleep_hours_start",
                                                                                                        "before": "input_datetime.lights_auto_control_end"
                                                                                                    }
                                                                                                ],
                                                                                                "sequence": [
                                                                                                    {
                                                                                                        "service": "light.turn_on",
                                                                                                        "target": {
                                                                                                            "entity_id": "light.dining_room_lights"
                                                                                                        },
                                                                                                        "data": {
                                                                                                            "brightness_pct": 5
                                                                                                        }
                                                                                                    }
                                                                                                ]
                                                                                            }
                                                                                        ],
                                                                                        "default": [
                                                                                            {
                                                                                                "service": "light.turn_on",
                                                                                                "target": {
                                                                                                    "entity_id": "light.dining_room_lights"
                                                                                                },
                                                                                                "data": {
                                                                                                    "brightness_pct": 98
                                                                                                }
                                                                                            }
                                                                                        ]
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_up_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [
                                                                                    {
                                                                                        "condition": "time",
                                                                                        "after": "input_datetime.sleep_hours_start",
                                                                                        "before": "input_datetime.lights_auto_control_end"
                                                                                    }
                                                                                ],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "light.turn_on",
                                                                                        "target": {
                                                                                            "entity_id": "light.dining_room_lights"
                                                                                        },
                                                                                        "data": {
                                                                                            "brightness_pct": 5
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ],
                                                                        "default": [
                                                                            {
                                                                                "service": "light.turn_on",
                                                                                "target": {
                                                                                    "entity_id": "light.dining_room_lights"
                                                                                },
                                                                                "data": {
                                                                                    "brightness_pct": 98
                                                                                }
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_up_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "light.turn_on",
                                                                            "target": {
                                                                                "entity_id": "light.dining_room_lights"
                                                                            },
                                                                            "data": {
                                                                                "brightness_step_pct": 10
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.dining_room_lights"
                                                        },
                                                        "data": {
                                                            "brightness_step_pct": 10
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_up_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_up_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_dining_room_lights_controller_2_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_down_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_down_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "light.turn_off",
                                                                                        "target": {
                                                                                            "entity_id": "light.dining_room_lights"
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_down_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "light.turn_off",
                                                                        "target": {
                                                                            "entity_id": "light.dining_room_lights"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_down_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "light.turn_on",
                                                                            "target": {
                                                                                "entity_id": "light.dining_room_lights"
                                                                            },
                                                                            "data": {
                                                                                "brightness_step_pct": -10
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.dining_room_lights"
                                                        },
                                                        "data": {
                                                            "brightness_step_pct": -10
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_down_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_down_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            }
                        ],
                        "id": "1643641285314",
                        "alias": "Dining Room Lights Controller 2",
                        "description": "Control the Dining Room Lights"
                    },
                    "blueprint_inputs": {
                        "id": "1643641285314",
                        "alias": "Dining Room Lights Controller 2",
                        "description": "Control the Dining Room Lights",
                        "use_blueprint": {
                            "path": "EPMatt/ikea_e1743.yaml",
                            "input": {
                                "integration": "ZHA",
                                "controller_device": "cea5083fc6a1972a0b57048ffa03cfd8",
                                "helper_last_controller_event": "input_text.zz_dining_room_lights_controller_2_last_event",
                                "action_button_up_short": [
                                    {
                                        "choose": [
                                            {
                                                "conditions": [
                                                    {
                                                        "condition": "time",
                                                        "after": "input_datetime.sleep_hours_start",
                                                        "before": "input_datetime.lights_auto_control_end"
                                                    }
                                                ],
                                                "sequence": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.dining_room_lights"
                                                        },
                                                        "data": {
                                                            "brightness_pct": 5
                                                        }
                                                    }
                                                ]
                                            }
                                        ],
                                        "default": [
                                            {
                                                "service": "light.turn_on",
                                                "target": {
                                                    "entity_id": "light.dining_room_lights"
                                                },
                                                "data": {
                                                    "brightness_pct": 98
                                                }
                                            }
                                        ]
                                    }
                                ],
                                "action_button_up_long": [
                                    {
                                        "service": "light.turn_on",
                                        "target": {
                                            "entity_id": "light.dining_room_lights"
                                        },
                                        "data": {
                                            "brightness_step_pct": 10
                                        }
                                    }
                                ],
                                "action_button_down_short": [
                                    {
                                        "service": "light.turn_off",
                                        "target": {
                                            "entity_id": "light.dining_room_lights"
                                        }
                                    }
                                ],
                                "action_button_down_long": [
                                    {
                                        "service": "light.turn_on",
                                        "target": {
                                            "entity_id": "light.dining_room_lights"
                                        },
                                        "data": {
                                            "brightness_step_pct": -10
                                        }
                                    }
                                ],
                                "button_up_long_max_loop_repeats": 50,
                                "button_down_long_max_loop_repeats": 50,
                                "button_down_long_loop": true,
                                "button_up_long_loop": true
                            }
                        }
                    },
                    "context": {
                        "id": "c6f15af461506c6578c36993a854ca09",
                        "parent_id": "0342b4321243f79dae5efb7362f7078e",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "1edb90b0da2226820c5485eb60e7599c",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:43:04.084388+00:00",
                        "finish": "2022-03-03T05:43:04.090823+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643641285314",
                    "trigger": "event 'zha_event'"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "62ad53ac8919a47964c4e83a0140ceeb",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T06:39:50.875867+00:00",
                        "finish": "2022-03-03T06:39:50.885809+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643641285314",
                    "trigger": "event 'zha_event'",
                    "trace": {
                        "trigger/1": [
                            {
                                "path": "trigger/1",
                                "timestamp": "2022-03-03T06:39:50.876705+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.dining_room_lights_controller_2",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T05:43:04.085531+00:00",
                                            "mode": "restart",
                                            "current": 0,
                                            "id": "1643641285314",
                                            "friendly_name": "Dining Room Lights Controller 2"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.798070+00:00",
                                        "last_updated": "2022-03-03T05:43:04.090459+00:00",
                                        "context": {
                                            "id": "c6f15af461506c6578c36993a854ca09",
                                            "parent_id": "0342b4321243f79dae5efb7362f7078e",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "1",
                                        "idx": "1",
                                        "platform": "event",
                                        "event": {
                                            "event_type": "zha_event",
                                            "data": {
                                                "device_ieee": "84:fd:27:ff:fe:95:bc:5c",
                                                "unique_id": "84:fd:27:ff:fe:95:bc:5c:1:0x0020",
                                                "device_id": "cea5083fc6a1972a0b57048ffa03cfd8",
                                                "endpoint_id": 1,
                                                "cluster_id": 32,
                                                "command": "checkin",
                                                "args": []
                                            },
                                            "origin": "LOCAL",
                                            "time_fired": "2022-03-03T06:39:50.875016+00:00",
                                            "context": {
                                                "id": "1aa6db8f19e6b733facc2130b4fd4a72",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "description": "event 'zha_event'"
                                    },
                                    "integration": "ZHA",
                                    "button_up_long_loop": true,
                                    "button_up_long_max_loop_repeats": 50,
                                    "button_up_double_press": false,
                                    "button_down_long_loop": true,
                                    "button_down_long_max_loop_repeats": 50,
                                    "button_down_double_press": false,
                                    "helper_last_controller_event": "input_text.zz_dining_room_lights_controller_2_last_event",
                                    "helper_double_press_delay": 500,
                                    "helper_debounce_delay": 0,
                                    "integration_id": "zha",
                                    "adjusted_double_press_delay": 500,
                                    "actions_mapping": {
                                        "deconz": {
                                            "button_up_short": [
                                                "1002"
                                            ],
                                            "button_up_long": [
                                                "1001"
                                            ],
                                            "button_up_release": [
                                                "1003"
                                            ],
                                            "button_down_short": [
                                                "2002"
                                            ],
                                            "button_down_long": [
                                                "2001"
                                            ],
                                            "button_down_release": [
                                                "2003"
                                            ]
                                        },
                                        "zha": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "move_with_on_off_0_83"
                                            ],
                                            "button_up_release": [
                                                "stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "move_1_83"
                                            ],
                                            "button_down_release": [
                                                "stop"
                                            ]
                                        },
                                        "zigbee2mqtt": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "brightness_move_up"
                                            ],
                                            "button_up_release": [
                                                "brightness_stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "brightness_move_down"
                                            ],
                                            "button_down_release": [
                                                "brightness_stop"
                                            ]
                                        }
                                    },
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ],
                                    "integrations_with_prev_event_storage": [
                                        "zha",
                                        "zigbee2mqtt"
                                    ],
                                    "controller_entity": "",
                                    "controller_device": "cea5083fc6a1972a0b57048ffa03cfd8",
                                    "controller_id": "cea5083fc6a1972a0b57048ffa03cfd8"
                                }
                            }
                        ],
                        "condition/0": [
                            {
                                "path": "condition/0",
                                "timestamp": "2022-03-03T06:39:50.876740+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "condition/0/conditions/0": [
                            {
                                "path": "condition/0/conditions/0",
                                "timestamp": "2022-03-03T06:39:50.876758+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "condition/0/conditions/1": [
                            {
                                "path": "condition/0/conditions/1",
                                "timestamp": "2022-03-03T06:39:50.876901+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T06:39:50.877884+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "6b28211dda1510764928d8680d0d3207",
                                        "parent_id": "1aa6db8f19e6b733facc2130b4fd4a72",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "delay": 0.0,
                                    "done": true
                                }
                            }
                        ],
                        "action/1": [
                            {
                                "path": "action/1",
                                "timestamp": "2022-03-03T06:39:50.879331+00:00"
                            }
                        ],
                        "action/2": [
                            {
                                "path": "action/2",
                                "timestamp": "2022-03-03T06:39:50.880040+00:00",
                                "changed_variables": {
                                    "trigger_action": "checkin",
                                    "trigger_delta": 3406791.738986969,
                                    "last_controller_event": "checkin"
                                },
                                "result": {
                                    "params": {
                                        "domain": "input_text",
                                        "service": "set_value",
                                        "service_data": {
                                            "entity_id": "input_text.zz_dining_room_lights_controller_2_last_event",
                                            "value": {
                                                "trigger_action": "checkin",
                                                "last_triggered": "2022-03-03 14:39:50.880156+08:00"
                                            }
                                        },
                                        "target": {}
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "action/3": [
                            {
                                "path": "action/3",
                                "timestamp": "2022-03-03T06:39:50.883835+00:00"
                            }
                        ],
                        "action/3/choose/0": [
                            {
                                "path": "action/3/choose/0",
                                "timestamp": "2022-03-03T06:39:50.883912+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/0/conditions/0": [
                            {
                                "path": "action/3/choose/0/conditions/0",
                                "timestamp": "2022-03-03T06:39:50.883939+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/1": [
                            {
                                "path": "action/3/choose/1",
                                "timestamp": "2022-03-03T06:39:50.884090+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/1/conditions/0": [
                            {
                                "path": "action/3/choose/1/conditions/0",
                                "timestamp": "2022-03-03T06:39:50.884114+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/2": [
                            {
                                "path": "action/3/choose/2",
                                "timestamp": "2022-03-03T06:39:50.884211+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/2/conditions/0": [
                            {
                                "path": "action/3/choose/2/conditions/0",
                                "timestamp": "2022-03-03T06:39:50.884237+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/3": [
                            {
                                "path": "action/3/choose/3",
                                "timestamp": "2022-03-03T06:39:50.884334+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/3/conditions/0": [
                            {
                                "path": "action/3/choose/3/conditions/0",
                                "timestamp": "2022-03-03T06:39:50.884356+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/4": [
                            {
                                "path": "action/3/choose/4",
                                "timestamp": "2022-03-03T06:39:50.884439+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/4/conditions/0": [
                            {
                                "path": "action/3/choose/4/conditions/0",
                                "timestamp": "2022-03-03T06:39:50.884460+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/5": [
                            {
                                "path": "action/3/choose/5",
                                "timestamp": "2022-03-03T06:39:50.884556+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/5/conditions/0": [
                            {
                                "path": "action/3/choose/5/conditions/0",
                                "timestamp": "2022-03-03T06:39:50.884573+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ]
                    },
                    "config": {
                        "variables": {
                            "integration": "ZHA",
                            "button_up_long_loop": true,
                            "button_up_long_max_loop_repeats": 50,
                            "button_up_double_press": false,
                            "button_down_long_loop": true,
                            "button_down_long_max_loop_repeats": 50,
                            "button_down_double_press": false,
                            "helper_last_controller_event": "input_text.zz_dining_room_lights_controller_2_last_event",
                            "helper_double_press_delay": 500,
                            "helper_debounce_delay": 0,
                            "integration_id": "{{ integration | lower }}",
                            "adjusted_double_press_delay": "{{ [helper_double_press_delay - helper_debounce_delay, 100] | max }}",
                            "actions_mapping": {
                                "deconz": {
                                    "button_up_short": [
                                        "1002"
                                    ],
                                    "button_up_long": [
                                        "1001"
                                    ],
                                    "button_up_release": [
                                        "1003"
                                    ],
                                    "button_down_short": [
                                        "2002"
                                    ],
                                    "button_down_long": [
                                        "2001"
                                    ],
                                    "button_down_release": [
                                        "2003"
                                    ]
                                },
                                "zha": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ]
                                },
                                "zigbee2mqtt": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "brightness_move_up"
                                    ],
                                    "button_up_release": [
                                        "brightness_stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "brightness_move_down"
                                    ],
                                    "button_down_release": [
                                        "brightness_stop"
                                    ]
                                }
                            },
                            "button_up_short": "{{ actions_mapping[integration_id][\"button_up_short\"] }}",
                            "button_up_long": "{{ actions_mapping[integration_id][\"button_up_long\"] }}",
                            "button_up_release": "{{ actions_mapping[integration_id][\"button_up_release\"] }}",
                            "button_down_short": "{{ actions_mapping[integration_id][\"button_down_short\"] }}",
                            "button_down_long": "{{ actions_mapping[integration_id][\"button_down_long\"] }}",
                            "button_down_release": "{{ actions_mapping[integration_id][\"button_down_release\"] }}",
                            "integrations_with_prev_event_storage": [
                                "zha",
                                "zigbee2mqtt"
                            ],
                            "controller_entity": "",
                            "controller_device": "cea5083fc6a1972a0b57048ffa03cfd8",
                            "controller_id": "{% if integration_id==\"zigbee2mqtt\" %}{{controller_entity}}{% else %}{{controller_device}}{% endif %}"
                        },
                        "mode": "restart",
                        "max_exceeded": "silent",
                        "trigger": [
                            {
                                "platform": "event",
                                "event_type": "state_changed",
                                "event_data": {
                                    "entity_id": ""
                                }
                            },
                            {
                                "platform": "event",
                                "event_type": [
                                    "deconz_event",
                                    "zha_event"
                                ],
                                "event_data": {
                                    "device_id": "cea5083fc6a1972a0b57048ffa03cfd8"
                                }
                            }
                        ],
                        "condition": [
                            {
                                "condition": "and",
                                "conditions": [
                                    "{%- set trigger_action -%} {%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%} {%- endset -%} {{ trigger_action not in [\"\",\"None\"] }}",
                                    "{{ integration_id != \"zigbee2mqtt\" or trigger.event.data.new_state.state != trigger.event.data.old_state.state }}"
                                ]
                            }
                        ],
                        "action": [
                            {
                                "delay": {
                                    "milliseconds": 0
                                }
                            },
                            {
                                "variables": {
                                    "trigger_action": "{%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%}",
                                    "trigger_delta": "{{ (as_timestamp(now()) - as_timestamp((states(helper_last_controller_event) | from_json).last_triggered if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"1970-01-01 00:00:00\")) * 1000 }}",
                                    "last_controller_event": "{{ (states(helper_last_controller_event) | from_json).trigger_action if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"\" }}"
                                }
                            },
                            {
                                "service": "input_text.set_value",
                                "data": {
                                    "entity_id": "input_text.zz_dining_room_lights_controller_2_last_event",
                                    "value": "{{ {\"trigger_action\":trigger_action,\"last_triggered\":now()|string} | to_json }}"
                                }
                            },
                            {
                                "choose": [
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_dining_room_lights_controller_2_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_up_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_up_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "choose": [
                                                                                            {
                                                                                                "conditions": [
                                                                                                    {
                                                                                                        "condition": "time",
                                                                                                        "after": "input_datetime.sleep_hours_start",
                                                                                                        "before": "input_datetime.lights_auto_control_end"
                                                                                                    }
                                                                                                ],
                                                                                                "sequence": [
                                                                                                    {
                                                                                                        "service": "light.turn_on",
                                                                                                        "target": {
                                                                                                            "entity_id": "light.dining_room_lights"
                                                                                                        },
                                                                                                        "data": {
                                                                                                            "brightness_pct": 5
                                                                                                        }
                                                                                                    }
                                                                                                ]
                                                                                            }
                                                                                        ],
                                                                                        "default": [
                                                                                            {
                                                                                                "service": "light.turn_on",
                                                                                                "target": {
                                                                                                    "entity_id": "light.dining_room_lights"
                                                                                                },
                                                                                                "data": {
                                                                                                    "brightness_pct": 98
                                                                                                }
                                                                                            }
                                                                                        ]
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_up_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [
                                                                                    {
                                                                                        "condition": "time",
                                                                                        "after": "input_datetime.sleep_hours_start",
                                                                                        "before": "input_datetime.lights_auto_control_end"
                                                                                    }
                                                                                ],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "light.turn_on",
                                                                                        "target": {
                                                                                            "entity_id": "light.dining_room_lights"
                                                                                        },
                                                                                        "data": {
                                                                                            "brightness_pct": 5
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ],
                                                                        "default": [
                                                                            {
                                                                                "service": "light.turn_on",
                                                                                "target": {
                                                                                    "entity_id": "light.dining_room_lights"
                                                                                },
                                                                                "data": {
                                                                                    "brightness_pct": 98
                                                                                }
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_up_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "light.turn_on",
                                                                            "target": {
                                                                                "entity_id": "light.dining_room_lights"
                                                                            },
                                                                            "data": {
                                                                                "brightness_step_pct": 10
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.dining_room_lights"
                                                        },
                                                        "data": {
                                                            "brightness_step_pct": 10
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_up_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_up_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_dining_room_lights_controller_2_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_down_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_down_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "light.turn_off",
                                                                                        "target": {
                                                                                            "entity_id": "light.dining_room_lights"
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_down_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "light.turn_off",
                                                                        "target": {
                                                                            "entity_id": "light.dining_room_lights"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_down_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "light.turn_on",
                                                                            "target": {
                                                                                "entity_id": "light.dining_room_lights"
                                                                            },
                                                                            "data": {
                                                                                "brightness_step_pct": -10
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.dining_room_lights"
                                                        },
                                                        "data": {
                                                            "brightness_step_pct": -10
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_down_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_down_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            }
                        ],
                        "id": "1643641285314",
                        "alias": "Dining Room Lights Controller 2",
                        "description": "Control the Dining Room Lights"
                    },
                    "blueprint_inputs": {
                        "id": "1643641285314",
                        "alias": "Dining Room Lights Controller 2",
                        "description": "Control the Dining Room Lights",
                        "use_blueprint": {
                            "path": "EPMatt/ikea_e1743.yaml",
                            "input": {
                                "integration": "ZHA",
                                "controller_device": "cea5083fc6a1972a0b57048ffa03cfd8",
                                "helper_last_controller_event": "input_text.zz_dining_room_lights_controller_2_last_event",
                                "action_button_up_short": [
                                    {
                                        "choose": [
                                            {
                                                "conditions": [
                                                    {
                                                        "condition": "time",
                                                        "after": "input_datetime.sleep_hours_start",
                                                        "before": "input_datetime.lights_auto_control_end"
                                                    }
                                                ],
                                                "sequence": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.dining_room_lights"
                                                        },
                                                        "data": {
                                                            "brightness_pct": 5
                                                        }
                                                    }
                                                ]
                                            }
                                        ],
                                        "default": [
                                            {
                                                "service": "light.turn_on",
                                                "target": {
                                                    "entity_id": "light.dining_room_lights"
                                                },
                                                "data": {
                                                    "brightness_pct": 98
                                                }
                                            }
                                        ]
                                    }
                                ],
                                "action_button_up_long": [
                                    {
                                        "service": "light.turn_on",
                                        "target": {
                                            "entity_id": "light.dining_room_lights"
                                        },
                                        "data": {
                                            "brightness_step_pct": 10
                                        }
                                    }
                                ],
                                "action_button_down_short": [
                                    {
                                        "service": "light.turn_off",
                                        "target": {
                                            "entity_id": "light.dining_room_lights"
                                        }
                                    }
                                ],
                                "action_button_down_long": [
                                    {
                                        "service": "light.turn_on",
                                        "target": {
                                            "entity_id": "light.dining_room_lights"
                                        },
                                        "data": {
                                            "brightness_step_pct": -10
                                        }
                                    }
                                ],
                                "button_up_long_max_loop_repeats": 50,
                                "button_down_long_max_loop_repeats": 50,
                                "button_down_long_loop": true,
                                "button_up_long_loop": true
                            }
                        }
                    },
                    "context": {
                        "id": "6b28211dda1510764928d8680d0d3207",
                        "parent_id": "1aa6db8f19e6b733facc2130b4fd4a72",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "62ad53ac8919a47964c4e83a0140ceeb",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T06:39:50.875867+00:00",
                        "finish": "2022-03-03T06:39:50.885809+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643641285314",
                    "trigger": "event 'zha_event'"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "2ebfc4e3fefaff65468ab53daa43cb60",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T07:36:37.620844+00:00",
                        "finish": "2022-03-03T07:36:37.628043+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643641285314",
                    "trigger": "event 'zha_event'",
                    "trace": {
                        "trigger/1": [
                            {
                                "path": "trigger/1",
                                "timestamp": "2022-03-03T07:36:37.621667+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.dining_room_lights_controller_2",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T06:39:50.877104+00:00",
                                            "mode": "restart",
                                            "current": 0,
                                            "id": "1643641285314",
                                            "friendly_name": "Dining Room Lights Controller 2"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.798070+00:00",
                                        "last_updated": "2022-03-03T06:39:50.884746+00:00",
                                        "context": {
                                            "id": "6b28211dda1510764928d8680d0d3207",
                                            "parent_id": "1aa6db8f19e6b733facc2130b4fd4a72",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "1",
                                        "idx": "1",
                                        "platform": "event",
                                        "event": {
                                            "event_type": "zha_event",
                                            "data": {
                                                "device_ieee": "84:fd:27:ff:fe:95:bc:5c",
                                                "unique_id": "84:fd:27:ff:fe:95:bc:5c:1:0x0020",
                                                "device_id": "cea5083fc6a1972a0b57048ffa03cfd8",
                                                "endpoint_id": 1,
                                                "cluster_id": 32,
                                                "command": "checkin",
                                                "args": []
                                            },
                                            "origin": "LOCAL",
                                            "time_fired": "2022-03-03T07:36:37.619449+00:00",
                                            "context": {
                                                "id": "9b825d0adf65dcae8b6405fe8ccadd47",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "description": "event 'zha_event'"
                                    },
                                    "integration": "ZHA",
                                    "button_up_long_loop": true,
                                    "button_up_long_max_loop_repeats": 50,
                                    "button_up_double_press": false,
                                    "button_down_long_loop": true,
                                    "button_down_long_max_loop_repeats": 50,
                                    "button_down_double_press": false,
                                    "helper_last_controller_event": "input_text.zz_dining_room_lights_controller_2_last_event",
                                    "helper_double_press_delay": 500,
                                    "helper_debounce_delay": 0,
                                    "integration_id": "zha",
                                    "adjusted_double_press_delay": 500,
                                    "actions_mapping": {
                                        "deconz": {
                                            "button_up_short": [
                                                "1002"
                                            ],
                                            "button_up_long": [
                                                "1001"
                                            ],
                                            "button_up_release": [
                                                "1003"
                                            ],
                                            "button_down_short": [
                                                "2002"
                                            ],
                                            "button_down_long": [
                                                "2001"
                                            ],
                                            "button_down_release": [
                                                "2003"
                                            ]
                                        },
                                        "zha": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "move_with_on_off_0_83"
                                            ],
                                            "button_up_release": [
                                                "stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "move_1_83"
                                            ],
                                            "button_down_release": [
                                                "stop"
                                            ]
                                        },
                                        "zigbee2mqtt": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "brightness_move_up"
                                            ],
                                            "button_up_release": [
                                                "brightness_stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "brightness_move_down"
                                            ],
                                            "button_down_release": [
                                                "brightness_stop"
                                            ]
                                        }
                                    },
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ],
                                    "integrations_with_prev_event_storage": [
                                        "zha",
                                        "zigbee2mqtt"
                                    ],
                                    "controller_entity": "",
                                    "controller_device": "cea5083fc6a1972a0b57048ffa03cfd8",
                                    "controller_id": "cea5083fc6a1972a0b57048ffa03cfd8"
                                }
                            }
                        ],
                        "condition/0": [
                            {
                                "path": "condition/0",
                                "timestamp": "2022-03-03T07:36:37.621723+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "condition/0/conditions/0": [
                            {
                                "path": "condition/0/conditions/0",
                                "timestamp": "2022-03-03T07:36:37.621744+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "condition/0/conditions/1": [
                            {
                                "path": "condition/0/conditions/1",
                                "timestamp": "2022-03-03T07:36:37.621878+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T07:36:37.622628+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "1f1bcfb5d608a00179d500da94962930",
                                        "parent_id": "9b825d0adf65dcae8b6405fe8ccadd47",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "delay": 0.0,
                                    "done": true
                                }
                            }
                        ],
                        "action/1": [
                            {
                                "path": "action/1",
                                "timestamp": "2022-03-03T07:36:37.623666+00:00"
                            }
                        ],
                        "action/2": [
                            {
                                "path": "action/2",
                                "timestamp": "2022-03-03T07:36:37.624396+00:00",
                                "changed_variables": {
                                    "trigger_action": "checkin",
                                    "trigger_delta": 3406743.856906891,
                                    "last_controller_event": "checkin"
                                },
                                "result": {
                                    "params": {
                                        "domain": "input_text",
                                        "service": "set_value",
                                        "service_data": {
                                            "entity_id": "input_text.zz_dining_room_lights_controller_2_last_event",
                                            "value": {
                                                "trigger_action": "checkin",
                                                "last_triggered": "2022-03-03 15:36:37.624512+08:00"
                                            }
                                        },
                                        "target": {}
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "action/3": [
                            {
                                "path": "action/3",
                                "timestamp": "2022-03-03T07:36:37.626425+00:00"
                            }
                        ],
                        "action/3/choose/0": [
                            {
                                "path": "action/3/choose/0",
                                "timestamp": "2022-03-03T07:36:37.626486+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/0/conditions/0": [
                            {
                                "path": "action/3/choose/0/conditions/0",
                                "timestamp": "2022-03-03T07:36:37.626518+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/1": [
                            {
                                "path": "action/3/choose/1",
                                "timestamp": "2022-03-03T07:36:37.626651+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/1/conditions/0": [
                            {
                                "path": "action/3/choose/1/conditions/0",
                                "timestamp": "2022-03-03T07:36:37.626675+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/2": [
                            {
                                "path": "action/3/choose/2",
                                "timestamp": "2022-03-03T07:36:37.626820+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/2/conditions/0": [
                            {
                                "path": "action/3/choose/2/conditions/0",
                                "timestamp": "2022-03-03T07:36:37.626845+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/3": [
                            {
                                "path": "action/3/choose/3",
                                "timestamp": "2022-03-03T07:36:37.626946+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/3/conditions/0": [
                            {
                                "path": "action/3/choose/3/conditions/0",
                                "timestamp": "2022-03-03T07:36:37.626969+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/4": [
                            {
                                "path": "action/3/choose/4",
                                "timestamp": "2022-03-03T07:36:37.627052+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/4/conditions/0": [
                            {
                                "path": "action/3/choose/4/conditions/0",
                                "timestamp": "2022-03-03T07:36:37.627073+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/5": [
                            {
                                "path": "action/3/choose/5",
                                "timestamp": "2022-03-03T07:36:37.627161+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/5/conditions/0": [
                            {
                                "path": "action/3/choose/5/conditions/0",
                                "timestamp": "2022-03-03T07:36:37.627184+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ]
                    },
                    "config": {
                        "variables": {
                            "integration": "ZHA",
                            "button_up_long_loop": true,
                            "button_up_long_max_loop_repeats": 50,
                            "button_up_double_press": false,
                            "button_down_long_loop": true,
                            "button_down_long_max_loop_repeats": 50,
                            "button_down_double_press": false,
                            "helper_last_controller_event": "input_text.zz_dining_room_lights_controller_2_last_event",
                            "helper_double_press_delay": 500,
                            "helper_debounce_delay": 0,
                            "integration_id": "{{ integration | lower }}",
                            "adjusted_double_press_delay": "{{ [helper_double_press_delay - helper_debounce_delay, 100] | max }}",
                            "actions_mapping": {
                                "deconz": {
                                    "button_up_short": [
                                        "1002"
                                    ],
                                    "button_up_long": [
                                        "1001"
                                    ],
                                    "button_up_release": [
                                        "1003"
                                    ],
                                    "button_down_short": [
                                        "2002"
                                    ],
                                    "button_down_long": [
                                        "2001"
                                    ],
                                    "button_down_release": [
                                        "2003"
                                    ]
                                },
                                "zha": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ]
                                },
                                "zigbee2mqtt": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "brightness_move_up"
                                    ],
                                    "button_up_release": [
                                        "brightness_stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "brightness_move_down"
                                    ],
                                    "button_down_release": [
                                        "brightness_stop"
                                    ]
                                }
                            },
                            "button_up_short": "{{ actions_mapping[integration_id][\"button_up_short\"] }}",
                            "button_up_long": "{{ actions_mapping[integration_id][\"button_up_long\"] }}",
                            "button_up_release": "{{ actions_mapping[integration_id][\"button_up_release\"] }}",
                            "button_down_short": "{{ actions_mapping[integration_id][\"button_down_short\"] }}",
                            "button_down_long": "{{ actions_mapping[integration_id][\"button_down_long\"] }}",
                            "button_down_release": "{{ actions_mapping[integration_id][\"button_down_release\"] }}",
                            "integrations_with_prev_event_storage": [
                                "zha",
                                "zigbee2mqtt"
                            ],
                            "controller_entity": "",
                            "controller_device": "cea5083fc6a1972a0b57048ffa03cfd8",
                            "controller_id": "{% if integration_id==\"zigbee2mqtt\" %}{{controller_entity}}{% else %}{{controller_device}}{% endif %}"
                        },
                        "mode": "restart",
                        "max_exceeded": "silent",
                        "trigger": [
                            {
                                "platform": "event",
                                "event_type": "state_changed",
                                "event_data": {
                                    "entity_id": ""
                                }
                            },
                            {
                                "platform": "event",
                                "event_type": [
                                    "deconz_event",
                                    "zha_event"
                                ],
                                "event_data": {
                                    "device_id": "cea5083fc6a1972a0b57048ffa03cfd8"
                                }
                            }
                        ],
                        "condition": [
                            {
                                "condition": "and",
                                "conditions": [
                                    "{%- set trigger_action -%} {%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%} {%- endset -%} {{ trigger_action not in [\"\",\"None\"] }}",
                                    "{{ integration_id != \"zigbee2mqtt\" or trigger.event.data.new_state.state != trigger.event.data.old_state.state }}"
                                ]
                            }
                        ],
                        "action": [
                            {
                                "delay": {
                                    "milliseconds": 0
                                }
                            },
                            {
                                "variables": {
                                    "trigger_action": "{%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%}",
                                    "trigger_delta": "{{ (as_timestamp(now()) - as_timestamp((states(helper_last_controller_event) | from_json).last_triggered if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"1970-01-01 00:00:00\")) * 1000 }}",
                                    "last_controller_event": "{{ (states(helper_last_controller_event) | from_json).trigger_action if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"\" }}"
                                }
                            },
                            {
                                "service": "input_text.set_value",
                                "data": {
                                    "entity_id": "input_text.zz_dining_room_lights_controller_2_last_event",
                                    "value": "{{ {\"trigger_action\":trigger_action,\"last_triggered\":now()|string} | to_json }}"
                                }
                            },
                            {
                                "choose": [
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_dining_room_lights_controller_2_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_up_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_up_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "choose": [
                                                                                            {
                                                                                                "conditions": [
                                                                                                    {
                                                                                                        "condition": "time",
                                                                                                        "after": "input_datetime.sleep_hours_start",
                                                                                                        "before": "input_datetime.lights_auto_control_end"
                                                                                                    }
                                                                                                ],
                                                                                                "sequence": [
                                                                                                    {
                                                                                                        "service": "light.turn_on",
                                                                                                        "target": {
                                                                                                            "entity_id": "light.dining_room_lights"
                                                                                                        },
                                                                                                        "data": {
                                                                                                            "brightness_pct": 5
                                                                                                        }
                                                                                                    }
                                                                                                ]
                                                                                            }
                                                                                        ],
                                                                                        "default": [
                                                                                            {
                                                                                                "service": "light.turn_on",
                                                                                                "target": {
                                                                                                    "entity_id": "light.dining_room_lights"
                                                                                                },
                                                                                                "data": {
                                                                                                    "brightness_pct": 98
                                                                                                }
                                                                                            }
                                                                                        ]
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_up_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [
                                                                                    {
                                                                                        "condition": "time",
                                                                                        "after": "input_datetime.sleep_hours_start",
                                                                                        "before": "input_datetime.lights_auto_control_end"
                                                                                    }
                                                                                ],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "light.turn_on",
                                                                                        "target": {
                                                                                            "entity_id": "light.dining_room_lights"
                                                                                        },
                                                                                        "data": {
                                                                                            "brightness_pct": 5
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ],
                                                                        "default": [
                                                                            {
                                                                                "service": "light.turn_on",
                                                                                "target": {
                                                                                    "entity_id": "light.dining_room_lights"
                                                                                },
                                                                                "data": {
                                                                                    "brightness_pct": 98
                                                                                }
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_up_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "light.turn_on",
                                                                            "target": {
                                                                                "entity_id": "light.dining_room_lights"
                                                                            },
                                                                            "data": {
                                                                                "brightness_step_pct": 10
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.dining_room_lights"
                                                        },
                                                        "data": {
                                                            "brightness_step_pct": 10
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_up_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_up_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_dining_room_lights_controller_2_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_down_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_down_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "light.turn_off",
                                                                                        "target": {
                                                                                            "entity_id": "light.dining_room_lights"
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_down_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "light.turn_off",
                                                                        "target": {
                                                                            "entity_id": "light.dining_room_lights"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_down_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "light.turn_on",
                                                                            "target": {
                                                                                "entity_id": "light.dining_room_lights"
                                                                            },
                                                                            "data": {
                                                                                "brightness_step_pct": -10
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.dining_room_lights"
                                                        },
                                                        "data": {
                                                            "brightness_step_pct": -10
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_down_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_down_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            }
                        ],
                        "id": "1643641285314",
                        "alias": "Dining Room Lights Controller 2",
                        "description": "Control the Dining Room Lights"
                    },
                    "blueprint_inputs": {
                        "id": "1643641285314",
                        "alias": "Dining Room Lights Controller 2",
                        "description": "Control the Dining Room Lights",
                        "use_blueprint": {
                            "path": "EPMatt/ikea_e1743.yaml",
                            "input": {
                                "integration": "ZHA",
                                "controller_device": "cea5083fc6a1972a0b57048ffa03cfd8",
                                "helper_last_controller_event": "input_text.zz_dining_room_lights_controller_2_last_event",
                                "action_button_up_short": [
                                    {
                                        "choose": [
                                            {
                                                "conditions": [
                                                    {
                                                        "condition": "time",
                                                        "after": "input_datetime.sleep_hours_start",
                                                        "before": "input_datetime.lights_auto_control_end"
                                                    }
                                                ],
                                                "sequence": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.dining_room_lights"
                                                        },
                                                        "data": {
                                                            "brightness_pct": 5
                                                        }
                                                    }
                                                ]
                                            }
                                        ],
                                        "default": [
                                            {
                                                "service": "light.turn_on",
                                                "target": {
                                                    "entity_id": "light.dining_room_lights"
                                                },
                                                "data": {
                                                    "brightness_pct": 98
                                                }
                                            }
                                        ]
                                    }
                                ],
                                "action_button_up_long": [
                                    {
                                        "service": "light.turn_on",
                                        "target": {
                                            "entity_id": "light.dining_room_lights"
                                        },
                                        "data": {
                                            "brightness_step_pct": 10
                                        }
                                    }
                                ],
                                "action_button_down_short": [
                                    {
                                        "service": "light.turn_off",
                                        "target": {
                                            "entity_id": "light.dining_room_lights"
                                        }
                                    }
                                ],
                                "action_button_down_long": [
                                    {
                                        "service": "light.turn_on",
                                        "target": {
                                            "entity_id": "light.dining_room_lights"
                                        },
                                        "data": {
                                            "brightness_step_pct": -10
                                        }
                                    }
                                ],
                                "button_up_long_max_loop_repeats": 50,
                                "button_down_long_max_loop_repeats": 50,
                                "button_down_long_loop": true,
                                "button_up_long_loop": true
                            }
                        }
                    },
                    "context": {
                        "id": "1f1bcfb5d608a00179d500da94962930",
                        "parent_id": "9b825d0adf65dcae8b6405fe8ccadd47",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "2ebfc4e3fefaff65468ab53daa43cb60",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T07:36:37.620844+00:00",
                        "finish": "2022-03-03T07:36:37.628043+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643641285314",
                    "trigger": "event 'zha_event'"
                }
            }
        ],
        "automation.1643644997118": [
            {
                "extended_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "69f9e4dd03331e139b24a89b54b6bb4a",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T04:02:18.012631+00:00",
                        "finish": "2022-03-03T04:02:18.019910+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643644997118",
                    "trigger": "event 'zha_event'",
                    "trace": {
                        "trigger/1": [
                            {
                                "path": "trigger/1",
                                "timestamp": "2022-03-03T04:02:18.013484+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.elis_room_fan_controller",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T03:05:40.106627+00:00",
                                            "mode": "restart",
                                            "current": 0,
                                            "id": "1643644997118",
                                            "friendly_name": "Eli's Room Fan Controller"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.798870+00:00",
                                        "last_updated": "2022-03-03T03:05:40.111062+00:00",
                                        "context": {
                                            "id": "8d8993be1f6561da5be1d409406af9e3",
                                            "parent_id": "3d7056d5ed1888e3df51492f16a19fc1",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "1",
                                        "idx": "1",
                                        "platform": "event",
                                        "event": {
                                            "event_type": "zha_event",
                                            "data": {
                                                "device_ieee": "84:fd:27:ff:fe:9c:06:da",
                                                "unique_id": "84:fd:27:ff:fe:9c:06:da:1:0x0020",
                                                "device_id": "f70176647fea31ee95539e565e16e9be",
                                                "endpoint_id": 1,
                                                "cluster_id": 32,
                                                "command": "checkin",
                                                "args": []
                                            },
                                            "origin": "LOCAL",
                                            "time_fired": "2022-03-03T04:02:18.011678+00:00",
                                            "context": {
                                                "id": "b921ec57dc30bdc1382be0fee444c2ea",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "description": "event 'zha_event'"
                                    },
                                    "integration": "ZHA",
                                    "button_up_long_loop": false,
                                    "button_up_long_max_loop_repeats": 500,
                                    "button_up_double_press": false,
                                    "button_down_long_loop": false,
                                    "button_down_long_max_loop_repeats": 500,
                                    "button_down_double_press": false,
                                    "helper_last_controller_event": "input_text.zz_eli_s_room_fan_controller_last_event",
                                    "helper_double_press_delay": 500,
                                    "helper_debounce_delay": 0,
                                    "integration_id": "zha",
                                    "adjusted_double_press_delay": 500,
                                    "actions_mapping": {
                                        "deconz": {
                                            "button_up_short": [
                                                "1002"
                                            ],
                                            "button_up_long": [
                                                "1001"
                                            ],
                                            "button_up_release": [
                                                "1003"
                                            ],
                                            "button_down_short": [
                                                "2002"
                                            ],
                                            "button_down_long": [
                                                "2001"
                                            ],
                                            "button_down_release": [
                                                "2003"
                                            ]
                                        },
                                        "zha": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "move_with_on_off_0_83"
                                            ],
                                            "button_up_release": [
                                                "stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "move_1_83"
                                            ],
                                            "button_down_release": [
                                                "stop"
                                            ]
                                        },
                                        "zigbee2mqtt": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "brightness_move_up"
                                            ],
                                            "button_up_release": [
                                                "brightness_stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "brightness_move_down"
                                            ],
                                            "button_down_release": [
                                                "brightness_stop"
                                            ]
                                        }
                                    },
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ],
                                    "integrations_with_prev_event_storage": [
                                        "zha",
                                        "zigbee2mqtt"
                                    ],
                                    "controller_entity": "",
                                    "controller_device": "f70176647fea31ee95539e565e16e9be",
                                    "controller_id": "f70176647fea31ee95539e565e16e9be"
                                }
                            }
                        ],
                        "condition/0": [
                            {
                                "path": "condition/0",
                                "timestamp": "2022-03-03T04:02:18.013519+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "condition/0/conditions/0": [
                            {
                                "path": "condition/0/conditions/0",
                                "timestamp": "2022-03-03T04:02:18.013538+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "condition/0/conditions/1": [
                            {
                                "path": "condition/0/conditions/1",
                                "timestamp": "2022-03-03T04:02:18.013707+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T04:02:18.015155+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "944ace5cff7db46dc4c57698436535d1",
                                        "parent_id": "b921ec57dc30bdc1382be0fee444c2ea",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "delay": 0.0,
                                    "done": true
                                }
                            }
                        ],
                        "action/1": [
                            {
                                "path": "action/1",
                                "timestamp": "2022-03-03T04:02:18.016092+00:00"
                            }
                        ],
                        "action/2": [
                            {
                                "path": "action/2",
                                "timestamp": "2022-03-03T04:02:18.016673+00:00",
                                "changed_variables": {
                                    "trigger_action": "checkin",
                                    "trigger_delta": 3397907.688140869,
                                    "last_controller_event": "checkin"
                                },
                                "result": {
                                    "params": {
                                        "domain": "input_text",
                                        "service": "set_value",
                                        "service_data": {
                                            "entity_id": "input_text.zz_eli_s_room_fan_controller_last_event",
                                            "value": {
                                                "trigger_action": "checkin",
                                                "last_triggered": "2022-03-03 12:02:18.016828+08:00"
                                            }
                                        },
                                        "target": {}
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "action/3": [
                            {
                                "path": "action/3",
                                "timestamp": "2022-03-03T04:02:18.018656+00:00"
                            }
                        ],
                        "action/3/choose/0": [
                            {
                                "path": "action/3/choose/0",
                                "timestamp": "2022-03-03T04:02:18.018747+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/0/conditions/0": [
                            {
                                "path": "action/3/choose/0/conditions/0",
                                "timestamp": "2022-03-03T04:02:18.018775+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/1": [
                            {
                                "path": "action/3/choose/1",
                                "timestamp": "2022-03-03T04:02:18.018903+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/1/conditions/0": [
                            {
                                "path": "action/3/choose/1/conditions/0",
                                "timestamp": "2022-03-03T04:02:18.018925+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/2": [
                            {
                                "path": "action/3/choose/2",
                                "timestamp": "2022-03-03T04:02:18.019018+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/2/conditions/0": [
                            {
                                "path": "action/3/choose/2/conditions/0",
                                "timestamp": "2022-03-03T04:02:18.019038+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/3": [
                            {
                                "path": "action/3/choose/3",
                                "timestamp": "2022-03-03T04:02:18.019144+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/3/conditions/0": [
                            {
                                "path": "action/3/choose/3/conditions/0",
                                "timestamp": "2022-03-03T04:02:18.019164+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/4": [
                            {
                                "path": "action/3/choose/4",
                                "timestamp": "2022-03-03T04:02:18.019247+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/4/conditions/0": [
                            {
                                "path": "action/3/choose/4/conditions/0",
                                "timestamp": "2022-03-03T04:02:18.019267+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/5": [
                            {
                                "path": "action/3/choose/5",
                                "timestamp": "2022-03-03T04:02:18.019346+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/5/conditions/0": [
                            {
                                "path": "action/3/choose/5/conditions/0",
                                "timestamp": "2022-03-03T04:02:18.019364+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ]
                    },
                    "config": {
                        "variables": {
                            "integration": "ZHA",
                            "button_up_long_loop": false,
                            "button_up_long_max_loop_repeats": 500,
                            "button_up_double_press": false,
                            "button_down_long_loop": false,
                            "button_down_long_max_loop_repeats": 500,
                            "button_down_double_press": false,
                            "helper_last_controller_event": "input_text.zz_eli_s_room_fan_controller_last_event",
                            "helper_double_press_delay": 500,
                            "helper_debounce_delay": 0,
                            "integration_id": "{{ integration | lower }}",
                            "adjusted_double_press_delay": "{{ [helper_double_press_delay - helper_debounce_delay, 100] | max }}",
                            "actions_mapping": {
                                "deconz": {
                                    "button_up_short": [
                                        "1002"
                                    ],
                                    "button_up_long": [
                                        "1001"
                                    ],
                                    "button_up_release": [
                                        "1003"
                                    ],
                                    "button_down_short": [
                                        "2002"
                                    ],
                                    "button_down_long": [
                                        "2001"
                                    ],
                                    "button_down_release": [
                                        "2003"
                                    ]
                                },
                                "zha": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ]
                                },
                                "zigbee2mqtt": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "brightness_move_up"
                                    ],
                                    "button_up_release": [
                                        "brightness_stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "brightness_move_down"
                                    ],
                                    "button_down_release": [
                                        "brightness_stop"
                                    ]
                                }
                            },
                            "button_up_short": "{{ actions_mapping[integration_id][\"button_up_short\"] }}",
                            "button_up_long": "{{ actions_mapping[integration_id][\"button_up_long\"] }}",
                            "button_up_release": "{{ actions_mapping[integration_id][\"button_up_release\"] }}",
                            "button_down_short": "{{ actions_mapping[integration_id][\"button_down_short\"] }}",
                            "button_down_long": "{{ actions_mapping[integration_id][\"button_down_long\"] }}",
                            "button_down_release": "{{ actions_mapping[integration_id][\"button_down_release\"] }}",
                            "integrations_with_prev_event_storage": [
                                "zha",
                                "zigbee2mqtt"
                            ],
                            "controller_entity": "",
                            "controller_device": "f70176647fea31ee95539e565e16e9be",
                            "controller_id": "{% if integration_id==\"zigbee2mqtt\" %}{{controller_entity}}{% else %}{{controller_device}}{% endif %}"
                        },
                        "mode": "restart",
                        "max_exceeded": "silent",
                        "trigger": [
                            {
                                "platform": "event",
                                "event_type": "state_changed",
                                "event_data": {
                                    "entity_id": ""
                                }
                            },
                            {
                                "platform": "event",
                                "event_type": [
                                    "deconz_event",
                                    "zha_event"
                                ],
                                "event_data": {
                                    "device_id": "f70176647fea31ee95539e565e16e9be"
                                }
                            }
                        ],
                        "condition": [
                            {
                                "condition": "and",
                                "conditions": [
                                    "{%- set trigger_action -%} {%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%} {%- endset -%} {{ trigger_action not in [\"\",\"None\"] }}",
                                    "{{ integration_id != \"zigbee2mqtt\" or trigger.event.data.new_state.state != trigger.event.data.old_state.state }}"
                                ]
                            }
                        ],
                        "action": [
                            {
                                "delay": {
                                    "milliseconds": 0
                                }
                            },
                            {
                                "variables": {
                                    "trigger_action": "{%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%}",
                                    "trigger_delta": "{{ (as_timestamp(now()) - as_timestamp((states(helper_last_controller_event) | from_json).last_triggered if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"1970-01-01 00:00:00\")) * 1000 }}",
                                    "last_controller_event": "{{ (states(helper_last_controller_event) | from_json).trigger_action if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"\" }}"
                                }
                            },
                            {
                                "service": "input_text.set_value",
                                "data": {
                                    "entity_id": "input_text.zz_eli_s_room_fan_controller_last_event",
                                    "value": "{{ {\"trigger_action\":trigger_action,\"last_triggered\":now()|string} | to_json }}"
                                }
                            },
                            {
                                "choose": [
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_eli_s_room_fan_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_up_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_up_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "fan.turn_on",
                                                                                        "target": {
                                                                                            "entity_id": "fan.elis_room_fan"
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_up_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "fan.turn_on",
                                                                        "target": {
                                                                            "entity_id": "fan.elis_room_fan"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_up_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "fan.increase_speed",
                                                                            "target": {
                                                                                "entity_id": "fan.elis_room_fan"
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "fan.increase_speed",
                                                        "target": {
                                                            "entity_id": "fan.elis_room_fan"
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_up_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_up_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_eli_s_room_fan_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_down_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_down_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "fan.turn_off",
                                                                                        "target": {
                                                                                            "entity_id": "fan.elis_room_fan"
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_down_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "fan.turn_off",
                                                                        "target": {
                                                                            "entity_id": "fan.elis_room_fan"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_down_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "fan.decrease_speed",
                                                                            "target": {
                                                                                "entity_id": "fan.elis_room_fan"
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "fan.decrease_speed",
                                                        "target": {
                                                            "entity_id": "fan.elis_room_fan"
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_down_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_down_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            }
                        ],
                        "id": "1643644997118",
                        "alias": "Eli's Room Fan Controller",
                        "description": "Control Eli's Room Fan"
                    },
                    "blueprint_inputs": {
                        "id": "1643644997118",
                        "alias": "Eli's Room Fan Controller",
                        "description": "Control Eli's Room Fan",
                        "use_blueprint": {
                            "path": "EPMatt/ikea_e1743.yaml",
                            "input": {
                                "integration": "ZHA",
                                "controller_device": "f70176647fea31ee95539e565e16e9be",
                                "helper_last_controller_event": "input_text.zz_eli_s_room_fan_controller_last_event",
                                "action_button_up_short": [
                                    {
                                        "service": "fan.turn_on",
                                        "target": {
                                            "entity_id": "fan.elis_room_fan"
                                        }
                                    }
                                ],
                                "action_button_up_long": [
                                    {
                                        "service": "fan.increase_speed",
                                        "target": {
                                            "entity_id": "fan.elis_room_fan"
                                        }
                                    }
                                ],
                                "action_button_down_short": [
                                    {
                                        "service": "fan.turn_off",
                                        "target": {
                                            "entity_id": "fan.elis_room_fan"
                                        }
                                    }
                                ],
                                "action_button_down_long": [
                                    {
                                        "service": "fan.decrease_speed",
                                        "target": {
                                            "entity_id": "fan.elis_room_fan"
                                        }
                                    }
                                ]
                            }
                        }
                    },
                    "context": {
                        "id": "944ace5cff7db46dc4c57698436535d1",
                        "parent_id": "b921ec57dc30bdc1382be0fee444c2ea",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "69f9e4dd03331e139b24a89b54b6bb4a",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T04:02:18.012631+00:00",
                        "finish": "2022-03-03T04:02:18.019910+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643644997118",
                    "trigger": "event 'zha_event'"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "eaa651048aa63041480bd1c639e5b3bb",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T04:58:55.929089+00:00",
                        "finish": "2022-03-03T04:58:55.935348+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643644997118",
                    "trigger": "event 'zha_event'",
                    "trace": {
                        "trigger/1": [
                            {
                                "path": "trigger/1",
                                "timestamp": "2022-03-03T04:58:55.929839+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.elis_room_fan_controller",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T04:02:18.013916+00:00",
                                            "mode": "restart",
                                            "current": 0,
                                            "id": "1643644997118",
                                            "friendly_name": "Eli's Room Fan Controller"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.798870+00:00",
                                        "last_updated": "2022-03-03T04:02:18.019503+00:00",
                                        "context": {
                                            "id": "944ace5cff7db46dc4c57698436535d1",
                                            "parent_id": "b921ec57dc30bdc1382be0fee444c2ea",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "1",
                                        "idx": "1",
                                        "platform": "event",
                                        "event": {
                                            "event_type": "zha_event",
                                            "data": {
                                                "device_ieee": "84:fd:27:ff:fe:9c:06:da",
                                                "unique_id": "84:fd:27:ff:fe:9c:06:da:1:0x0020",
                                                "device_id": "f70176647fea31ee95539e565e16e9be",
                                                "endpoint_id": 1,
                                                "cluster_id": 32,
                                                "command": "checkin",
                                                "args": []
                                            },
                                            "origin": "LOCAL",
                                            "time_fired": "2022-03-03T04:58:55.927588+00:00",
                                            "context": {
                                                "id": "8f97b6b5e1f5d5f4bdd7c8f8687f98f6",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "description": "event 'zha_event'"
                                    },
                                    "integration": "ZHA",
                                    "button_up_long_loop": false,
                                    "button_up_long_max_loop_repeats": 500,
                                    "button_up_double_press": false,
                                    "button_down_long_loop": false,
                                    "button_down_long_max_loop_repeats": 500,
                                    "button_down_double_press": false,
                                    "helper_last_controller_event": "input_text.zz_eli_s_room_fan_controller_last_event",
                                    "helper_double_press_delay": 500,
                                    "helper_debounce_delay": 0,
                                    "integration_id": "zha",
                                    "adjusted_double_press_delay": 500,
                                    "actions_mapping": {
                                        "deconz": {
                                            "button_up_short": [
                                                "1002"
                                            ],
                                            "button_up_long": [
                                                "1001"
                                            ],
                                            "button_up_release": [
                                                "1003"
                                            ],
                                            "button_down_short": [
                                                "2002"
                                            ],
                                            "button_down_long": [
                                                "2001"
                                            ],
                                            "button_down_release": [
                                                "2003"
                                            ]
                                        },
                                        "zha": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "move_with_on_off_0_83"
                                            ],
                                            "button_up_release": [
                                                "stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "move_1_83"
                                            ],
                                            "button_down_release": [
                                                "stop"
                                            ]
                                        },
                                        "zigbee2mqtt": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "brightness_move_up"
                                            ],
                                            "button_up_release": [
                                                "brightness_stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "brightness_move_down"
                                            ],
                                            "button_down_release": [
                                                "brightness_stop"
                                            ]
                                        }
                                    },
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ],
                                    "integrations_with_prev_event_storage": [
                                        "zha",
                                        "zigbee2mqtt"
                                    ],
                                    "controller_entity": "",
                                    "controller_device": "f70176647fea31ee95539e565e16e9be",
                                    "controller_id": "f70176647fea31ee95539e565e16e9be"
                                }
                            }
                        ],
                        "condition/0": [
                            {
                                "path": "condition/0",
                                "timestamp": "2022-03-03T04:58:55.929873+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "condition/0/conditions/0": [
                            {
                                "path": "condition/0/conditions/0",
                                "timestamp": "2022-03-03T04:58:55.929895+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "condition/0/conditions/1": [
                            {
                                "path": "condition/0/conditions/1",
                                "timestamp": "2022-03-03T04:58:55.930042+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T04:58:55.930740+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "6b3a8d2773a54557dbd727586619e003",
                                        "parent_id": "8f97b6b5e1f5d5f4bdd7c8f8687f98f6",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "delay": 0.0,
                                    "done": true
                                }
                            }
                        ],
                        "action/1": [
                            {
                                "path": "action/1",
                                "timestamp": "2022-03-03T04:58:55.931514+00:00"
                            }
                        ],
                        "action/2": [
                            {
                                "path": "action/2",
                                "timestamp": "2022-03-03T04:58:55.932101+00:00",
                                "changed_variables": {
                                    "trigger_action": "checkin",
                                    "trigger_delta": 3397914.9668216705,
                                    "last_controller_event": "checkin"
                                },
                                "result": {
                                    "params": {
                                        "domain": "input_text",
                                        "service": "set_value",
                                        "service_data": {
                                            "entity_id": "input_text.zz_eli_s_room_fan_controller_last_event",
                                            "value": {
                                                "trigger_action": "checkin",
                                                "last_triggered": "2022-03-03 12:58:55.932190+08:00"
                                            }
                                        },
                                        "target": {}
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "action/3": [
                            {
                                "path": "action/3",
                                "timestamp": "2022-03-03T04:58:55.933790+00:00"
                            }
                        ],
                        "action/3/choose/0": [
                            {
                                "path": "action/3/choose/0",
                                "timestamp": "2022-03-03T04:58:55.933840+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/0/conditions/0": [
                            {
                                "path": "action/3/choose/0/conditions/0",
                                "timestamp": "2022-03-03T04:58:55.933861+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/1": [
                            {
                                "path": "action/3/choose/1",
                                "timestamp": "2022-03-03T04:58:55.933971+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/1/conditions/0": [
                            {
                                "path": "action/3/choose/1/conditions/0",
                                "timestamp": "2022-03-03T04:58:55.933991+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/2": [
                            {
                                "path": "action/3/choose/2",
                                "timestamp": "2022-03-03T04:58:55.934070+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/2/conditions/0": [
                            {
                                "path": "action/3/choose/2/conditions/0",
                                "timestamp": "2022-03-03T04:58:55.934087+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/3": [
                            {
                                "path": "action/3/choose/3",
                                "timestamp": "2022-03-03T04:58:55.934165+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/3/conditions/0": [
                            {
                                "path": "action/3/choose/3/conditions/0",
                                "timestamp": "2022-03-03T04:58:55.934183+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/4": [
                            {
                                "path": "action/3/choose/4",
                                "timestamp": "2022-03-03T04:58:55.934249+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/4/conditions/0": [
                            {
                                "path": "action/3/choose/4/conditions/0",
                                "timestamp": "2022-03-03T04:58:55.934266+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/5": [
                            {
                                "path": "action/3/choose/5",
                                "timestamp": "2022-03-03T04:58:55.934642+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/5/conditions/0": [
                            {
                                "path": "action/3/choose/5/conditions/0",
                                "timestamp": "2022-03-03T04:58:55.934664+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ]
                    },
                    "config": {
                        "variables": {
                            "integration": "ZHA",
                            "button_up_long_loop": false,
                            "button_up_long_max_loop_repeats": 500,
                            "button_up_double_press": false,
                            "button_down_long_loop": false,
                            "button_down_long_max_loop_repeats": 500,
                            "button_down_double_press": false,
                            "helper_last_controller_event": "input_text.zz_eli_s_room_fan_controller_last_event",
                            "helper_double_press_delay": 500,
                            "helper_debounce_delay": 0,
                            "integration_id": "{{ integration | lower }}",
                            "adjusted_double_press_delay": "{{ [helper_double_press_delay - helper_debounce_delay, 100] | max }}",
                            "actions_mapping": {
                                "deconz": {
                                    "button_up_short": [
                                        "1002"
                                    ],
                                    "button_up_long": [
                                        "1001"
                                    ],
                                    "button_up_release": [
                                        "1003"
                                    ],
                                    "button_down_short": [
                                        "2002"
                                    ],
                                    "button_down_long": [
                                        "2001"
                                    ],
                                    "button_down_release": [
                                        "2003"
                                    ]
                                },
                                "zha": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ]
                                },
                                "zigbee2mqtt": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "brightness_move_up"
                                    ],
                                    "button_up_release": [
                                        "brightness_stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "brightness_move_down"
                                    ],
                                    "button_down_release": [
                                        "brightness_stop"
                                    ]
                                }
                            },
                            "button_up_short": "{{ actions_mapping[integration_id][\"button_up_short\"] }}",
                            "button_up_long": "{{ actions_mapping[integration_id][\"button_up_long\"] }}",
                            "button_up_release": "{{ actions_mapping[integration_id][\"button_up_release\"] }}",
                            "button_down_short": "{{ actions_mapping[integration_id][\"button_down_short\"] }}",
                            "button_down_long": "{{ actions_mapping[integration_id][\"button_down_long\"] }}",
                            "button_down_release": "{{ actions_mapping[integration_id][\"button_down_release\"] }}",
                            "integrations_with_prev_event_storage": [
                                "zha",
                                "zigbee2mqtt"
                            ],
                            "controller_entity": "",
                            "controller_device": "f70176647fea31ee95539e565e16e9be",
                            "controller_id": "{% if integration_id==\"zigbee2mqtt\" %}{{controller_entity}}{% else %}{{controller_device}}{% endif %}"
                        },
                        "mode": "restart",
                        "max_exceeded": "silent",
                        "trigger": [
                            {
                                "platform": "event",
                                "event_type": "state_changed",
                                "event_data": {
                                    "entity_id": ""
                                }
                            },
                            {
                                "platform": "event",
                                "event_type": [
                                    "deconz_event",
                                    "zha_event"
                                ],
                                "event_data": {
                                    "device_id": "f70176647fea31ee95539e565e16e9be"
                                }
                            }
                        ],
                        "condition": [
                            {
                                "condition": "and",
                                "conditions": [
                                    "{%- set trigger_action -%} {%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%} {%- endset -%} {{ trigger_action not in [\"\",\"None\"] }}",
                                    "{{ integration_id != \"zigbee2mqtt\" or trigger.event.data.new_state.state != trigger.event.data.old_state.state }}"
                                ]
                            }
                        ],
                        "action": [
                            {
                                "delay": {
                                    "milliseconds": 0
                                }
                            },
                            {
                                "variables": {
                                    "trigger_action": "{%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%}",
                                    "trigger_delta": "{{ (as_timestamp(now()) - as_timestamp((states(helper_last_controller_event) | from_json).last_triggered if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"1970-01-01 00:00:00\")) * 1000 }}",
                                    "last_controller_event": "{{ (states(helper_last_controller_event) | from_json).trigger_action if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"\" }}"
                                }
                            },
                            {
                                "service": "input_text.set_value",
                                "data": {
                                    "entity_id": "input_text.zz_eli_s_room_fan_controller_last_event",
                                    "value": "{{ {\"trigger_action\":trigger_action,\"last_triggered\":now()|string} | to_json }}"
                                }
                            },
                            {
                                "choose": [
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_eli_s_room_fan_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_up_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_up_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "fan.turn_on",
                                                                                        "target": {
                                                                                            "entity_id": "fan.elis_room_fan"
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_up_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "fan.turn_on",
                                                                        "target": {
                                                                            "entity_id": "fan.elis_room_fan"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_up_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "fan.increase_speed",
                                                                            "target": {
                                                                                "entity_id": "fan.elis_room_fan"
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "fan.increase_speed",
                                                        "target": {
                                                            "entity_id": "fan.elis_room_fan"
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_up_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_up_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_eli_s_room_fan_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_down_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_down_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "fan.turn_off",
                                                                                        "target": {
                                                                                            "entity_id": "fan.elis_room_fan"
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_down_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "fan.turn_off",
                                                                        "target": {
                                                                            "entity_id": "fan.elis_room_fan"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_down_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "fan.decrease_speed",
                                                                            "target": {
                                                                                "entity_id": "fan.elis_room_fan"
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "fan.decrease_speed",
                                                        "target": {
                                                            "entity_id": "fan.elis_room_fan"
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_down_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_down_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            }
                        ],
                        "id": "1643644997118",
                        "alias": "Eli's Room Fan Controller",
                        "description": "Control Eli's Room Fan"
                    },
                    "blueprint_inputs": {
                        "id": "1643644997118",
                        "alias": "Eli's Room Fan Controller",
                        "description": "Control Eli's Room Fan",
                        "use_blueprint": {
                            "path": "EPMatt/ikea_e1743.yaml",
                            "input": {
                                "integration": "ZHA",
                                "controller_device": "f70176647fea31ee95539e565e16e9be",
                                "helper_last_controller_event": "input_text.zz_eli_s_room_fan_controller_last_event",
                                "action_button_up_short": [
                                    {
                                        "service": "fan.turn_on",
                                        "target": {
                                            "entity_id": "fan.elis_room_fan"
                                        }
                                    }
                                ],
                                "action_button_up_long": [
                                    {
                                        "service": "fan.increase_speed",
                                        "target": {
                                            "entity_id": "fan.elis_room_fan"
                                        }
                                    }
                                ],
                                "action_button_down_short": [
                                    {
                                        "service": "fan.turn_off",
                                        "target": {
                                            "entity_id": "fan.elis_room_fan"
                                        }
                                    }
                                ],
                                "action_button_down_long": [
                                    {
                                        "service": "fan.decrease_speed",
                                        "target": {
                                            "entity_id": "fan.elis_room_fan"
                                        }
                                    }
                                ]
                            }
                        }
                    },
                    "context": {
                        "id": "6b3a8d2773a54557dbd727586619e003",
                        "parent_id": "8f97b6b5e1f5d5f4bdd7c8f8687f98f6",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "eaa651048aa63041480bd1c639e5b3bb",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T04:58:55.929089+00:00",
                        "finish": "2022-03-03T04:58:55.935348+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643644997118",
                    "trigger": "event 'zha_event'"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "25e447d5bc50b5931b0296090ab2c04b",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:55:33.792129+00:00",
                        "finish": "2022-03-03T05:55:33.801655+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643644997118",
                    "trigger": "event 'zha_event'",
                    "trace": {
                        "trigger/1": [
                            {
                                "path": "trigger/1",
                                "timestamp": "2022-03-03T05:55:33.793056+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.elis_room_fan_controller",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T04:58:55.930208+00:00",
                                            "mode": "restart",
                                            "current": 0,
                                            "id": "1643644997118",
                                            "friendly_name": "Eli's Room Fan Controller"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.798870+00:00",
                                        "last_updated": "2022-03-03T04:58:55.934836+00:00",
                                        "context": {
                                            "id": "6b3a8d2773a54557dbd727586619e003",
                                            "parent_id": "8f97b6b5e1f5d5f4bdd7c8f8687f98f6",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "1",
                                        "idx": "1",
                                        "platform": "event",
                                        "event": {
                                            "event_type": "zha_event",
                                            "data": {
                                                "device_ieee": "84:fd:27:ff:fe:9c:06:da",
                                                "unique_id": "84:fd:27:ff:fe:9c:06:da:1:0x0020",
                                                "device_id": "f70176647fea31ee95539e565e16e9be",
                                                "endpoint_id": 1,
                                                "cluster_id": 32,
                                                "command": "checkin",
                                                "args": []
                                            },
                                            "origin": "LOCAL",
                                            "time_fired": "2022-03-03T05:55:33.791179+00:00",
                                            "context": {
                                                "id": "8f83b2742a09b0a936bbf4cda39e9ee7",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "description": "event 'zha_event'"
                                    },
                                    "integration": "ZHA",
                                    "button_up_long_loop": false,
                                    "button_up_long_max_loop_repeats": 500,
                                    "button_up_double_press": false,
                                    "button_down_long_loop": false,
                                    "button_down_long_max_loop_repeats": 500,
                                    "button_down_double_press": false,
                                    "helper_last_controller_event": "input_text.zz_eli_s_room_fan_controller_last_event",
                                    "helper_double_press_delay": 500,
                                    "helper_debounce_delay": 0,
                                    "integration_id": "zha",
                                    "adjusted_double_press_delay": 500,
                                    "actions_mapping": {
                                        "deconz": {
                                            "button_up_short": [
                                                "1002"
                                            ],
                                            "button_up_long": [
                                                "1001"
                                            ],
                                            "button_up_release": [
                                                "1003"
                                            ],
                                            "button_down_short": [
                                                "2002"
                                            ],
                                            "button_down_long": [
                                                "2001"
                                            ],
                                            "button_down_release": [
                                                "2003"
                                            ]
                                        },
                                        "zha": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "move_with_on_off_0_83"
                                            ],
                                            "button_up_release": [
                                                "stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "move_1_83"
                                            ],
                                            "button_down_release": [
                                                "stop"
                                            ]
                                        },
                                        "zigbee2mqtt": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "brightness_move_up"
                                            ],
                                            "button_up_release": [
                                                "brightness_stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "brightness_move_down"
                                            ],
                                            "button_down_release": [
                                                "brightness_stop"
                                            ]
                                        }
                                    },
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ],
                                    "integrations_with_prev_event_storage": [
                                        "zha",
                                        "zigbee2mqtt"
                                    ],
                                    "controller_entity": "",
                                    "controller_device": "f70176647fea31ee95539e565e16e9be",
                                    "controller_id": "f70176647fea31ee95539e565e16e9be"
                                }
                            }
                        ],
                        "condition/0": [
                            {
                                "path": "condition/0",
                                "timestamp": "2022-03-03T05:55:33.793089+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "condition/0/conditions/0": [
                            {
                                "path": "condition/0/conditions/0",
                                "timestamp": "2022-03-03T05:55:33.793110+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "condition/0/conditions/1": [
                            {
                                "path": "condition/0/conditions/1",
                                "timestamp": "2022-03-03T05:55:33.793285+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T05:55:33.794275+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "9649956a052f5044b812aba60fda7f0b",
                                        "parent_id": "8f83b2742a09b0a936bbf4cda39e9ee7",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "delay": 0.0,
                                    "done": true
                                }
                            }
                        ],
                        "action/1": [
                            {
                                "path": "action/1",
                                "timestamp": "2022-03-03T05:55:33.796569+00:00"
                            }
                        ],
                        "action/2": [
                            {
                                "path": "action/2",
                                "timestamp": "2022-03-03T05:55:33.797321+00:00",
                                "changed_variables": {
                                    "trigger_action": "checkin",
                                    "trigger_delta": 3397864.701986313,
                                    "last_controller_event": "checkin"
                                },
                                "result": {
                                    "params": {
                                        "domain": "input_text",
                                        "service": "set_value",
                                        "service_data": {
                                            "entity_id": "input_text.zz_eli_s_room_fan_controller_last_event",
                                            "value": {
                                                "trigger_action": "checkin",
                                                "last_triggered": "2022-03-03 13:55:33.797564+08:00"
                                            }
                                        },
                                        "target": {}
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "action/3": [
                            {
                                "path": "action/3",
                                "timestamp": "2022-03-03T05:55:33.799752+00:00"
                            }
                        ],
                        "action/3/choose/0": [
                            {
                                "path": "action/3/choose/0",
                                "timestamp": "2022-03-03T05:55:33.799815+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/0/conditions/0": [
                            {
                                "path": "action/3/choose/0/conditions/0",
                                "timestamp": "2022-03-03T05:55:33.799839+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/1": [
                            {
                                "path": "action/3/choose/1",
                                "timestamp": "2022-03-03T05:55:33.800005+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/1/conditions/0": [
                            {
                                "path": "action/3/choose/1/conditions/0",
                                "timestamp": "2022-03-03T05:55:33.800033+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/2": [
                            {
                                "path": "action/3/choose/2",
                                "timestamp": "2022-03-03T05:55:33.800138+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/2/conditions/0": [
                            {
                                "path": "action/3/choose/2/conditions/0",
                                "timestamp": "2022-03-03T05:55:33.800161+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/3": [
                            {
                                "path": "action/3/choose/3",
                                "timestamp": "2022-03-03T05:55:33.800247+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/3/conditions/0": [
                            {
                                "path": "action/3/choose/3/conditions/0",
                                "timestamp": "2022-03-03T05:55:33.800268+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/4": [
                            {
                                "path": "action/3/choose/4",
                                "timestamp": "2022-03-03T05:55:33.800350+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/4/conditions/0": [
                            {
                                "path": "action/3/choose/4/conditions/0",
                                "timestamp": "2022-03-03T05:55:33.800371+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/5": [
                            {
                                "path": "action/3/choose/5",
                                "timestamp": "2022-03-03T05:55:33.800458+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/5/conditions/0": [
                            {
                                "path": "action/3/choose/5/conditions/0",
                                "timestamp": "2022-03-03T05:55:33.800480+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ]
                    },
                    "config": {
                        "variables": {
                            "integration": "ZHA",
                            "button_up_long_loop": false,
                            "button_up_long_max_loop_repeats": 500,
                            "button_up_double_press": false,
                            "button_down_long_loop": false,
                            "button_down_long_max_loop_repeats": 500,
                            "button_down_double_press": false,
                            "helper_last_controller_event": "input_text.zz_eli_s_room_fan_controller_last_event",
                            "helper_double_press_delay": 500,
                            "helper_debounce_delay": 0,
                            "integration_id": "{{ integration | lower }}",
                            "adjusted_double_press_delay": "{{ [helper_double_press_delay - helper_debounce_delay, 100] | max }}",
                            "actions_mapping": {
                                "deconz": {
                                    "button_up_short": [
                                        "1002"
                                    ],
                                    "button_up_long": [
                                        "1001"
                                    ],
                                    "button_up_release": [
                                        "1003"
                                    ],
                                    "button_down_short": [
                                        "2002"
                                    ],
                                    "button_down_long": [
                                        "2001"
                                    ],
                                    "button_down_release": [
                                        "2003"
                                    ]
                                },
                                "zha": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ]
                                },
                                "zigbee2mqtt": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "brightness_move_up"
                                    ],
                                    "button_up_release": [
                                        "brightness_stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "brightness_move_down"
                                    ],
                                    "button_down_release": [
                                        "brightness_stop"
                                    ]
                                }
                            },
                            "button_up_short": "{{ actions_mapping[integration_id][\"button_up_short\"] }}",
                            "button_up_long": "{{ actions_mapping[integration_id][\"button_up_long\"] }}",
                            "button_up_release": "{{ actions_mapping[integration_id][\"button_up_release\"] }}",
                            "button_down_short": "{{ actions_mapping[integration_id][\"button_down_short\"] }}",
                            "button_down_long": "{{ actions_mapping[integration_id][\"button_down_long\"] }}",
                            "button_down_release": "{{ actions_mapping[integration_id][\"button_down_release\"] }}",
                            "integrations_with_prev_event_storage": [
                                "zha",
                                "zigbee2mqtt"
                            ],
                            "controller_entity": "",
                            "controller_device": "f70176647fea31ee95539e565e16e9be",
                            "controller_id": "{% if integration_id==\"zigbee2mqtt\" %}{{controller_entity}}{% else %}{{controller_device}}{% endif %}"
                        },
                        "mode": "restart",
                        "max_exceeded": "silent",
                        "trigger": [
                            {
                                "platform": "event",
                                "event_type": "state_changed",
                                "event_data": {
                                    "entity_id": ""
                                }
                            },
                            {
                                "platform": "event",
                                "event_type": [
                                    "deconz_event",
                                    "zha_event"
                                ],
                                "event_data": {
                                    "device_id": "f70176647fea31ee95539e565e16e9be"
                                }
                            }
                        ],
                        "condition": [
                            {
                                "condition": "and",
                                "conditions": [
                                    "{%- set trigger_action -%} {%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%} {%- endset -%} {{ trigger_action not in [\"\",\"None\"] }}",
                                    "{{ integration_id != \"zigbee2mqtt\" or trigger.event.data.new_state.state != trigger.event.data.old_state.state }}"
                                ]
                            }
                        ],
                        "action": [
                            {
                                "delay": {
                                    "milliseconds": 0
                                }
                            },
                            {
                                "variables": {
                                    "trigger_action": "{%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%}",
                                    "trigger_delta": "{{ (as_timestamp(now()) - as_timestamp((states(helper_last_controller_event) | from_json).last_triggered if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"1970-01-01 00:00:00\")) * 1000 }}",
                                    "last_controller_event": "{{ (states(helper_last_controller_event) | from_json).trigger_action if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"\" }}"
                                }
                            },
                            {
                                "service": "input_text.set_value",
                                "data": {
                                    "entity_id": "input_text.zz_eli_s_room_fan_controller_last_event",
                                    "value": "{{ {\"trigger_action\":trigger_action,\"last_triggered\":now()|string} | to_json }}"
                                }
                            },
                            {
                                "choose": [
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_eli_s_room_fan_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_up_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_up_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "fan.turn_on",
                                                                                        "target": {
                                                                                            "entity_id": "fan.elis_room_fan"
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_up_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "fan.turn_on",
                                                                        "target": {
                                                                            "entity_id": "fan.elis_room_fan"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_up_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "fan.increase_speed",
                                                                            "target": {
                                                                                "entity_id": "fan.elis_room_fan"
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "fan.increase_speed",
                                                        "target": {
                                                            "entity_id": "fan.elis_room_fan"
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_up_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_up_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_eli_s_room_fan_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_down_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_down_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "fan.turn_off",
                                                                                        "target": {
                                                                                            "entity_id": "fan.elis_room_fan"
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_down_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "fan.turn_off",
                                                                        "target": {
                                                                            "entity_id": "fan.elis_room_fan"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_down_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "fan.decrease_speed",
                                                                            "target": {
                                                                                "entity_id": "fan.elis_room_fan"
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "fan.decrease_speed",
                                                        "target": {
                                                            "entity_id": "fan.elis_room_fan"
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_down_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_down_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            }
                        ],
                        "id": "1643644997118",
                        "alias": "Eli's Room Fan Controller",
                        "description": "Control Eli's Room Fan"
                    },
                    "blueprint_inputs": {
                        "id": "1643644997118",
                        "alias": "Eli's Room Fan Controller",
                        "description": "Control Eli's Room Fan",
                        "use_blueprint": {
                            "path": "EPMatt/ikea_e1743.yaml",
                            "input": {
                                "integration": "ZHA",
                                "controller_device": "f70176647fea31ee95539e565e16e9be",
                                "helper_last_controller_event": "input_text.zz_eli_s_room_fan_controller_last_event",
                                "action_button_up_short": [
                                    {
                                        "service": "fan.turn_on",
                                        "target": {
                                            "entity_id": "fan.elis_room_fan"
                                        }
                                    }
                                ],
                                "action_button_up_long": [
                                    {
                                        "service": "fan.increase_speed",
                                        "target": {
                                            "entity_id": "fan.elis_room_fan"
                                        }
                                    }
                                ],
                                "action_button_down_short": [
                                    {
                                        "service": "fan.turn_off",
                                        "target": {
                                            "entity_id": "fan.elis_room_fan"
                                        }
                                    }
                                ],
                                "action_button_down_long": [
                                    {
                                        "service": "fan.decrease_speed",
                                        "target": {
                                            "entity_id": "fan.elis_room_fan"
                                        }
                                    }
                                ]
                            }
                        }
                    },
                    "context": {
                        "id": "9649956a052f5044b812aba60fda7f0b",
                        "parent_id": "8f83b2742a09b0a936bbf4cda39e9ee7",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "25e447d5bc50b5931b0296090ab2c04b",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:55:33.792129+00:00",
                        "finish": "2022-03-03T05:55:33.801655+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643644997118",
                    "trigger": "event 'zha_event'"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "a6ae173f22d85a70e1ac0f339e4e8cc0",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T06:52:11.610652+00:00",
                        "finish": "2022-03-03T06:52:11.617371+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643644997118",
                    "trigger": "event 'zha_event'",
                    "trace": {
                        "trigger/1": [
                            {
                                "path": "trigger/1",
                                "timestamp": "2022-03-03T06:52:11.611461+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.elis_room_fan_controller",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T05:55:33.793477+00:00",
                                            "mode": "restart",
                                            "current": 0,
                                            "id": "1643644997118",
                                            "friendly_name": "Eli's Room Fan Controller"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.798870+00:00",
                                        "last_updated": "2022-03-03T05:55:33.800640+00:00",
                                        "context": {
                                            "id": "9649956a052f5044b812aba60fda7f0b",
                                            "parent_id": "8f83b2742a09b0a936bbf4cda39e9ee7",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "1",
                                        "idx": "1",
                                        "platform": "event",
                                        "event": {
                                            "event_type": "zha_event",
                                            "data": {
                                                "device_ieee": "84:fd:27:ff:fe:9c:06:da",
                                                "unique_id": "84:fd:27:ff:fe:9c:06:da:1:0x0020",
                                                "device_id": "f70176647fea31ee95539e565e16e9be",
                                                "endpoint_id": 1,
                                                "cluster_id": 32,
                                                "command": "checkin",
                                                "args": []
                                            },
                                            "origin": "LOCAL",
                                            "time_fired": "2022-03-03T06:52:11.609774+00:00",
                                            "context": {
                                                "id": "1e15bb5b570aab9b851ab68b8872a51b",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "description": "event 'zha_event'"
                                    },
                                    "integration": "ZHA",
                                    "button_up_long_loop": false,
                                    "button_up_long_max_loop_repeats": 500,
                                    "button_up_double_press": false,
                                    "button_down_long_loop": false,
                                    "button_down_long_max_loop_repeats": 500,
                                    "button_down_double_press": false,
                                    "helper_last_controller_event": "input_text.zz_eli_s_room_fan_controller_last_event",
                                    "helper_double_press_delay": 500,
                                    "helper_debounce_delay": 0,
                                    "integration_id": "zha",
                                    "adjusted_double_press_delay": 500,
                                    "actions_mapping": {
                                        "deconz": {
                                            "button_up_short": [
                                                "1002"
                                            ],
                                            "button_up_long": [
                                                "1001"
                                            ],
                                            "button_up_release": [
                                                "1003"
                                            ],
                                            "button_down_short": [
                                                "2002"
                                            ],
                                            "button_down_long": [
                                                "2001"
                                            ],
                                            "button_down_release": [
                                                "2003"
                                            ]
                                        },
                                        "zha": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "move_with_on_off_0_83"
                                            ],
                                            "button_up_release": [
                                                "stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "move_1_83"
                                            ],
                                            "button_down_release": [
                                                "stop"
                                            ]
                                        },
                                        "zigbee2mqtt": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "brightness_move_up"
                                            ],
                                            "button_up_release": [
                                                "brightness_stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "brightness_move_down"
                                            ],
                                            "button_down_release": [
                                                "brightness_stop"
                                            ]
                                        }
                                    },
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ],
                                    "integrations_with_prev_event_storage": [
                                        "zha",
                                        "zigbee2mqtt"
                                    ],
                                    "controller_entity": "",
                                    "controller_device": "f70176647fea31ee95539e565e16e9be",
                                    "controller_id": "f70176647fea31ee95539e565e16e9be"
                                }
                            }
                        ],
                        "condition/0": [
                            {
                                "path": "condition/0",
                                "timestamp": "2022-03-03T06:52:11.611497+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "condition/0/conditions/0": [
                            {
                                "path": "condition/0/conditions/0",
                                "timestamp": "2022-03-03T06:52:11.611519+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "condition/0/conditions/1": [
                            {
                                "path": "condition/0/conditions/1",
                                "timestamp": "2022-03-03T06:52:11.611660+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T06:52:11.612455+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "44f277adcee190ae3d2645df7c765494",
                                        "parent_id": "1e15bb5b570aab9b851ab68b8872a51b",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "delay": 0.0,
                                    "done": true
                                }
                            }
                        ],
                        "action/1": [
                            {
                                "path": "action/1",
                                "timestamp": "2022-03-03T06:52:11.613553+00:00"
                            }
                        ],
                        "action/2": [
                            {
                                "path": "action/2",
                                "timestamp": "2022-03-03T06:52:11.614272+00:00",
                                "changed_variables": {
                                    "trigger_action": "checkin",
                                    "trigger_delta": 3397816.2939548492,
                                    "last_controller_event": "checkin"
                                },
                                "result": {
                                    "params": {
                                        "domain": "input_text",
                                        "service": "set_value",
                                        "service_data": {
                                            "entity_id": "input_text.zz_eli_s_room_fan_controller_last_event",
                                            "value": {
                                                "trigger_action": "checkin",
                                                "last_triggered": "2022-03-03 14:52:11.614380+08:00"
                                            }
                                        },
                                        "target": {}
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "action/3": [
                            {
                                "path": "action/3",
                                "timestamp": "2022-03-03T06:52:11.616261+00:00"
                            }
                        ],
                        "action/3/choose/0": [
                            {
                                "path": "action/3/choose/0",
                                "timestamp": "2022-03-03T06:52:11.616318+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/0/conditions/0": [
                            {
                                "path": "action/3/choose/0/conditions/0",
                                "timestamp": "2022-03-03T06:52:11.616342+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/1": [
                            {
                                "path": "action/3/choose/1",
                                "timestamp": "2022-03-03T06:52:11.616449+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/1/conditions/0": [
                            {
                                "path": "action/3/choose/1/conditions/0",
                                "timestamp": "2022-03-03T06:52:11.616469+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/2": [
                            {
                                "path": "action/3/choose/2",
                                "timestamp": "2022-03-03T06:52:11.616547+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/2/conditions/0": [
                            {
                                "path": "action/3/choose/2/conditions/0",
                                "timestamp": "2022-03-03T06:52:11.616602+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/3": [
                            {
                                "path": "action/3/choose/3",
                                "timestamp": "2022-03-03T06:52:11.616677+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/3/conditions/0": [
                            {
                                "path": "action/3/choose/3/conditions/0",
                                "timestamp": "2022-03-03T06:52:11.616718+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/4": [
                            {
                                "path": "action/3/choose/4",
                                "timestamp": "2022-03-03T06:52:11.616801+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/4/conditions/0": [
                            {
                                "path": "action/3/choose/4/conditions/0",
                                "timestamp": "2022-03-03T06:52:11.616820+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/5": [
                            {
                                "path": "action/3/choose/5",
                                "timestamp": "2022-03-03T06:52:11.616896+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/5/conditions/0": [
                            {
                                "path": "action/3/choose/5/conditions/0",
                                "timestamp": "2022-03-03T06:52:11.616914+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ]
                    },
                    "config": {
                        "variables": {
                            "integration": "ZHA",
                            "button_up_long_loop": false,
                            "button_up_long_max_loop_repeats": 500,
                            "button_up_double_press": false,
                            "button_down_long_loop": false,
                            "button_down_long_max_loop_repeats": 500,
                            "button_down_double_press": false,
                            "helper_last_controller_event": "input_text.zz_eli_s_room_fan_controller_last_event",
                            "helper_double_press_delay": 500,
                            "helper_debounce_delay": 0,
                            "integration_id": "{{ integration | lower }}",
                            "adjusted_double_press_delay": "{{ [helper_double_press_delay - helper_debounce_delay, 100] | max }}",
                            "actions_mapping": {
                                "deconz": {
                                    "button_up_short": [
                                        "1002"
                                    ],
                                    "button_up_long": [
                                        "1001"
                                    ],
                                    "button_up_release": [
                                        "1003"
                                    ],
                                    "button_down_short": [
                                        "2002"
                                    ],
                                    "button_down_long": [
                                        "2001"
                                    ],
                                    "button_down_release": [
                                        "2003"
                                    ]
                                },
                                "zha": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ]
                                },
                                "zigbee2mqtt": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "brightness_move_up"
                                    ],
                                    "button_up_release": [
                                        "brightness_stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "brightness_move_down"
                                    ],
                                    "button_down_release": [
                                        "brightness_stop"
                                    ]
                                }
                            },
                            "button_up_short": "{{ actions_mapping[integration_id][\"button_up_short\"] }}",
                            "button_up_long": "{{ actions_mapping[integration_id][\"button_up_long\"] }}",
                            "button_up_release": "{{ actions_mapping[integration_id][\"button_up_release\"] }}",
                            "button_down_short": "{{ actions_mapping[integration_id][\"button_down_short\"] }}",
                            "button_down_long": "{{ actions_mapping[integration_id][\"button_down_long\"] }}",
                            "button_down_release": "{{ actions_mapping[integration_id][\"button_down_release\"] }}",
                            "integrations_with_prev_event_storage": [
                                "zha",
                                "zigbee2mqtt"
                            ],
                            "controller_entity": "",
                            "controller_device": "f70176647fea31ee95539e565e16e9be",
                            "controller_id": "{% if integration_id==\"zigbee2mqtt\" %}{{controller_entity}}{% else %}{{controller_device}}{% endif %}"
                        },
                        "mode": "restart",
                        "max_exceeded": "silent",
                        "trigger": [
                            {
                                "platform": "event",
                                "event_type": "state_changed",
                                "event_data": {
                                    "entity_id": ""
                                }
                            },
                            {
                                "platform": "event",
                                "event_type": [
                                    "deconz_event",
                                    "zha_event"
                                ],
                                "event_data": {
                                    "device_id": "f70176647fea31ee95539e565e16e9be"
                                }
                            }
                        ],
                        "condition": [
                            {
                                "condition": "and",
                                "conditions": [
                                    "{%- set trigger_action -%} {%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%} {%- endset -%} {{ trigger_action not in [\"\",\"None\"] }}",
                                    "{{ integration_id != \"zigbee2mqtt\" or trigger.event.data.new_state.state != trigger.event.data.old_state.state }}"
                                ]
                            }
                        ],
                        "action": [
                            {
                                "delay": {
                                    "milliseconds": 0
                                }
                            },
                            {
                                "variables": {
                                    "trigger_action": "{%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%}",
                                    "trigger_delta": "{{ (as_timestamp(now()) - as_timestamp((states(helper_last_controller_event) | from_json).last_triggered if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"1970-01-01 00:00:00\")) * 1000 }}",
                                    "last_controller_event": "{{ (states(helper_last_controller_event) | from_json).trigger_action if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"\" }}"
                                }
                            },
                            {
                                "service": "input_text.set_value",
                                "data": {
                                    "entity_id": "input_text.zz_eli_s_room_fan_controller_last_event",
                                    "value": "{{ {\"trigger_action\":trigger_action,\"last_triggered\":now()|string} | to_json }}"
                                }
                            },
                            {
                                "choose": [
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_eli_s_room_fan_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_up_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_up_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "fan.turn_on",
                                                                                        "target": {
                                                                                            "entity_id": "fan.elis_room_fan"
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_up_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "fan.turn_on",
                                                                        "target": {
                                                                            "entity_id": "fan.elis_room_fan"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_up_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "fan.increase_speed",
                                                                            "target": {
                                                                                "entity_id": "fan.elis_room_fan"
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "fan.increase_speed",
                                                        "target": {
                                                            "entity_id": "fan.elis_room_fan"
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_up_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_up_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_eli_s_room_fan_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_down_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_down_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "fan.turn_off",
                                                                                        "target": {
                                                                                            "entity_id": "fan.elis_room_fan"
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_down_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "fan.turn_off",
                                                                        "target": {
                                                                            "entity_id": "fan.elis_room_fan"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_down_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "fan.decrease_speed",
                                                                            "target": {
                                                                                "entity_id": "fan.elis_room_fan"
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "fan.decrease_speed",
                                                        "target": {
                                                            "entity_id": "fan.elis_room_fan"
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_down_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_down_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            }
                        ],
                        "id": "1643644997118",
                        "alias": "Eli's Room Fan Controller",
                        "description": "Control Eli's Room Fan"
                    },
                    "blueprint_inputs": {
                        "id": "1643644997118",
                        "alias": "Eli's Room Fan Controller",
                        "description": "Control Eli's Room Fan",
                        "use_blueprint": {
                            "path": "EPMatt/ikea_e1743.yaml",
                            "input": {
                                "integration": "ZHA",
                                "controller_device": "f70176647fea31ee95539e565e16e9be",
                                "helper_last_controller_event": "input_text.zz_eli_s_room_fan_controller_last_event",
                                "action_button_up_short": [
                                    {
                                        "service": "fan.turn_on",
                                        "target": {
                                            "entity_id": "fan.elis_room_fan"
                                        }
                                    }
                                ],
                                "action_button_up_long": [
                                    {
                                        "service": "fan.increase_speed",
                                        "target": {
                                            "entity_id": "fan.elis_room_fan"
                                        }
                                    }
                                ],
                                "action_button_down_short": [
                                    {
                                        "service": "fan.turn_off",
                                        "target": {
                                            "entity_id": "fan.elis_room_fan"
                                        }
                                    }
                                ],
                                "action_button_down_long": [
                                    {
                                        "service": "fan.decrease_speed",
                                        "target": {
                                            "entity_id": "fan.elis_room_fan"
                                        }
                                    }
                                ]
                            }
                        }
                    },
                    "context": {
                        "id": "44f277adcee190ae3d2645df7c765494",
                        "parent_id": "1e15bb5b570aab9b851ab68b8872a51b",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "a6ae173f22d85a70e1ac0f339e4e8cc0",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T06:52:11.610652+00:00",
                        "finish": "2022-03-03T06:52:11.617371+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643644997118",
                    "trigger": "event 'zha_event'"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "e55920f73b71e4a23e0c03ff79f445d5",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T07:48:49.465476+00:00",
                        "finish": "2022-03-03T07:48:49.471573+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643644997118",
                    "trigger": "event 'zha_event'",
                    "trace": {
                        "trigger/1": [
                            {
                                "path": "trigger/1",
                                "timestamp": "2022-03-03T07:48:49.466246+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.elis_room_fan_controller",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T06:52:11.611859+00:00",
                                            "mode": "restart",
                                            "current": 0,
                                            "id": "1643644997118",
                                            "friendly_name": "Eli's Room Fan Controller"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.798870+00:00",
                                        "last_updated": "2022-03-03T06:52:11.617026+00:00",
                                        "context": {
                                            "id": "44f277adcee190ae3d2645df7c765494",
                                            "parent_id": "1e15bb5b570aab9b851ab68b8872a51b",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "1",
                                        "idx": "1",
                                        "platform": "event",
                                        "event": {
                                            "event_type": "zha_event",
                                            "data": {
                                                "device_ieee": "84:fd:27:ff:fe:9c:06:da",
                                                "unique_id": "84:fd:27:ff:fe:9c:06:da:1:0x0020",
                                                "device_id": "f70176647fea31ee95539e565e16e9be",
                                                "endpoint_id": 1,
                                                "cluster_id": 32,
                                                "command": "checkin",
                                                "args": []
                                            },
                                            "origin": "LOCAL",
                                            "time_fired": "2022-03-03T07:48:49.464417+00:00",
                                            "context": {
                                                "id": "9aa02675d3691ebcf4760ff471147c56",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "description": "event 'zha_event'"
                                    },
                                    "integration": "ZHA",
                                    "button_up_long_loop": false,
                                    "button_up_long_max_loop_repeats": 500,
                                    "button_up_double_press": false,
                                    "button_down_long_loop": false,
                                    "button_down_long_max_loop_repeats": 500,
                                    "button_down_double_press": false,
                                    "helper_last_controller_event": "input_text.zz_eli_s_room_fan_controller_last_event",
                                    "helper_double_press_delay": 500,
                                    "helper_debounce_delay": 0,
                                    "integration_id": "zha",
                                    "adjusted_double_press_delay": 500,
                                    "actions_mapping": {
                                        "deconz": {
                                            "button_up_short": [
                                                "1002"
                                            ],
                                            "button_up_long": [
                                                "1001"
                                            ],
                                            "button_up_release": [
                                                "1003"
                                            ],
                                            "button_down_short": [
                                                "2002"
                                            ],
                                            "button_down_long": [
                                                "2001"
                                            ],
                                            "button_down_release": [
                                                "2003"
                                            ]
                                        },
                                        "zha": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "move_with_on_off_0_83"
                                            ],
                                            "button_up_release": [
                                                "stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "move_1_83"
                                            ],
                                            "button_down_release": [
                                                "stop"
                                            ]
                                        },
                                        "zigbee2mqtt": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "brightness_move_up"
                                            ],
                                            "button_up_release": [
                                                "brightness_stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "brightness_move_down"
                                            ],
                                            "button_down_release": [
                                                "brightness_stop"
                                            ]
                                        }
                                    },
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ],
                                    "integrations_with_prev_event_storage": [
                                        "zha",
                                        "zigbee2mqtt"
                                    ],
                                    "controller_entity": "",
                                    "controller_device": "f70176647fea31ee95539e565e16e9be",
                                    "controller_id": "f70176647fea31ee95539e565e16e9be"
                                }
                            }
                        ],
                        "condition/0": [
                            {
                                "path": "condition/0",
                                "timestamp": "2022-03-03T07:48:49.466276+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "condition/0/conditions/0": [
                            {
                                "path": "condition/0/conditions/0",
                                "timestamp": "2022-03-03T07:48:49.466294+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "condition/0/conditions/1": [
                            {
                                "path": "condition/0/conditions/1",
                                "timestamp": "2022-03-03T07:48:49.466430+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T07:48:49.467155+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "5b7e725dc93da2fa45bdc96f8c358934",
                                        "parent_id": "9aa02675d3691ebcf4760ff471147c56",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "delay": 0.0,
                                    "done": true
                                }
                            }
                        ],
                        "action/1": [
                            {
                                "path": "action/1",
                                "timestamp": "2022-03-03T07:48:49.467881+00:00"
                            }
                        ],
                        "action/2": [
                            {
                                "path": "action/2",
                                "timestamp": "2022-03-03T07:48:49.468427+00:00",
                                "changed_variables": {
                                    "trigger_action": "checkin",
                                    "trigger_delta": 3397853.763103485,
                                    "last_controller_event": "checkin"
                                },
                                "result": {
                                    "params": {
                                        "domain": "input_text",
                                        "service": "set_value",
                                        "service_data": {
                                            "entity_id": "input_text.zz_eli_s_room_fan_controller_last_event",
                                            "value": {
                                                "trigger_action": "checkin",
                                                "last_triggered": "2022-03-03 15:48:49.468515+08:00"
                                            }
                                        },
                                        "target": {}
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "action/3": [
                            {
                                "path": "action/3",
                                "timestamp": "2022-03-03T07:48:49.470396+00:00"
                            }
                        ],
                        "action/3/choose/0": [
                            {
                                "path": "action/3/choose/0",
                                "timestamp": "2022-03-03T07:48:49.470446+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/0/conditions/0": [
                            {
                                "path": "action/3/choose/0/conditions/0",
                                "timestamp": "2022-03-03T07:48:49.470467+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/1": [
                            {
                                "path": "action/3/choose/1",
                                "timestamp": "2022-03-03T07:48:49.470570+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/1/conditions/0": [
                            {
                                "path": "action/3/choose/1/conditions/0",
                                "timestamp": "2022-03-03T07:48:49.470591+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/2": [
                            {
                                "path": "action/3/choose/2",
                                "timestamp": "2022-03-03T07:48:49.470668+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/2/conditions/0": [
                            {
                                "path": "action/3/choose/2/conditions/0",
                                "timestamp": "2022-03-03T07:48:49.470711+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/3": [
                            {
                                "path": "action/3/choose/3",
                                "timestamp": "2022-03-03T07:48:49.470794+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/3/conditions/0": [
                            {
                                "path": "action/3/choose/3/conditions/0",
                                "timestamp": "2022-03-03T07:48:49.470812+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/4": [
                            {
                                "path": "action/3/choose/4",
                                "timestamp": "2022-03-03T07:48:49.470893+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/4/conditions/0": [
                            {
                                "path": "action/3/choose/4/conditions/0",
                                "timestamp": "2022-03-03T07:48:49.470921+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/5": [
                            {
                                "path": "action/3/choose/5",
                                "timestamp": "2022-03-03T07:48:49.470994+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/5/conditions/0": [
                            {
                                "path": "action/3/choose/5/conditions/0",
                                "timestamp": "2022-03-03T07:48:49.471012+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ]
                    },
                    "config": {
                        "variables": {
                            "integration": "ZHA",
                            "button_up_long_loop": false,
                            "button_up_long_max_loop_repeats": 500,
                            "button_up_double_press": false,
                            "button_down_long_loop": false,
                            "button_down_long_max_loop_repeats": 500,
                            "button_down_double_press": false,
                            "helper_last_controller_event": "input_text.zz_eli_s_room_fan_controller_last_event",
                            "helper_double_press_delay": 500,
                            "helper_debounce_delay": 0,
                            "integration_id": "{{ integration | lower }}",
                            "adjusted_double_press_delay": "{{ [helper_double_press_delay - helper_debounce_delay, 100] | max }}",
                            "actions_mapping": {
                                "deconz": {
                                    "button_up_short": [
                                        "1002"
                                    ],
                                    "button_up_long": [
                                        "1001"
                                    ],
                                    "button_up_release": [
                                        "1003"
                                    ],
                                    "button_down_short": [
                                        "2002"
                                    ],
                                    "button_down_long": [
                                        "2001"
                                    ],
                                    "button_down_release": [
                                        "2003"
                                    ]
                                },
                                "zha": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ]
                                },
                                "zigbee2mqtt": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "brightness_move_up"
                                    ],
                                    "button_up_release": [
                                        "brightness_stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "brightness_move_down"
                                    ],
                                    "button_down_release": [
                                        "brightness_stop"
                                    ]
                                }
                            },
                            "button_up_short": "{{ actions_mapping[integration_id][\"button_up_short\"] }}",
                            "button_up_long": "{{ actions_mapping[integration_id][\"button_up_long\"] }}",
                            "button_up_release": "{{ actions_mapping[integration_id][\"button_up_release\"] }}",
                            "button_down_short": "{{ actions_mapping[integration_id][\"button_down_short\"] }}",
                            "button_down_long": "{{ actions_mapping[integration_id][\"button_down_long\"] }}",
                            "button_down_release": "{{ actions_mapping[integration_id][\"button_down_release\"] }}",
                            "integrations_with_prev_event_storage": [
                                "zha",
                                "zigbee2mqtt"
                            ],
                            "controller_entity": "",
                            "controller_device": "f70176647fea31ee95539e565e16e9be",
                            "controller_id": "{% if integration_id==\"zigbee2mqtt\" %}{{controller_entity}}{% else %}{{controller_device}}{% endif %}"
                        },
                        "mode": "restart",
                        "max_exceeded": "silent",
                        "trigger": [
                            {
                                "platform": "event",
                                "event_type": "state_changed",
                                "event_data": {
                                    "entity_id": ""
                                }
                            },
                            {
                                "platform": "event",
                                "event_type": [
                                    "deconz_event",
                                    "zha_event"
                                ],
                                "event_data": {
                                    "device_id": "f70176647fea31ee95539e565e16e9be"
                                }
                            }
                        ],
                        "condition": [
                            {
                                "condition": "and",
                                "conditions": [
                                    "{%- set trigger_action -%} {%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%} {%- endset -%} {{ trigger_action not in [\"\",\"None\"] }}",
                                    "{{ integration_id != \"zigbee2mqtt\" or trigger.event.data.new_state.state != trigger.event.data.old_state.state }}"
                                ]
                            }
                        ],
                        "action": [
                            {
                                "delay": {
                                    "milliseconds": 0
                                }
                            },
                            {
                                "variables": {
                                    "trigger_action": "{%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%}",
                                    "trigger_delta": "{{ (as_timestamp(now()) - as_timestamp((states(helper_last_controller_event) | from_json).last_triggered if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"1970-01-01 00:00:00\")) * 1000 }}",
                                    "last_controller_event": "{{ (states(helper_last_controller_event) | from_json).trigger_action if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"\" }}"
                                }
                            },
                            {
                                "service": "input_text.set_value",
                                "data": {
                                    "entity_id": "input_text.zz_eli_s_room_fan_controller_last_event",
                                    "value": "{{ {\"trigger_action\":trigger_action,\"last_triggered\":now()|string} | to_json }}"
                                }
                            },
                            {
                                "choose": [
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_eli_s_room_fan_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_up_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_up_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "fan.turn_on",
                                                                                        "target": {
                                                                                            "entity_id": "fan.elis_room_fan"
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_up_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "fan.turn_on",
                                                                        "target": {
                                                                            "entity_id": "fan.elis_room_fan"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_up_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "fan.increase_speed",
                                                                            "target": {
                                                                                "entity_id": "fan.elis_room_fan"
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "fan.increase_speed",
                                                        "target": {
                                                            "entity_id": "fan.elis_room_fan"
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_up_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_up_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_eli_s_room_fan_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_down_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_down_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "fan.turn_off",
                                                                                        "target": {
                                                                                            "entity_id": "fan.elis_room_fan"
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_down_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "fan.turn_off",
                                                                        "target": {
                                                                            "entity_id": "fan.elis_room_fan"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_down_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "fan.decrease_speed",
                                                                            "target": {
                                                                                "entity_id": "fan.elis_room_fan"
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "fan.decrease_speed",
                                                        "target": {
                                                            "entity_id": "fan.elis_room_fan"
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_down_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_down_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            }
                        ],
                        "id": "1643644997118",
                        "alias": "Eli's Room Fan Controller",
                        "description": "Control Eli's Room Fan"
                    },
                    "blueprint_inputs": {
                        "id": "1643644997118",
                        "alias": "Eli's Room Fan Controller",
                        "description": "Control Eli's Room Fan",
                        "use_blueprint": {
                            "path": "EPMatt/ikea_e1743.yaml",
                            "input": {
                                "integration": "ZHA",
                                "controller_device": "f70176647fea31ee95539e565e16e9be",
                                "helper_last_controller_event": "input_text.zz_eli_s_room_fan_controller_last_event",
                                "action_button_up_short": [
                                    {
                                        "service": "fan.turn_on",
                                        "target": {
                                            "entity_id": "fan.elis_room_fan"
                                        }
                                    }
                                ],
                                "action_button_up_long": [
                                    {
                                        "service": "fan.increase_speed",
                                        "target": {
                                            "entity_id": "fan.elis_room_fan"
                                        }
                                    }
                                ],
                                "action_button_down_short": [
                                    {
                                        "service": "fan.turn_off",
                                        "target": {
                                            "entity_id": "fan.elis_room_fan"
                                        }
                                    }
                                ],
                                "action_button_down_long": [
                                    {
                                        "service": "fan.decrease_speed",
                                        "target": {
                                            "entity_id": "fan.elis_room_fan"
                                        }
                                    }
                                ]
                            }
                        }
                    },
                    "context": {
                        "id": "5b7e725dc93da2fa45bdc96f8c358934",
                        "parent_id": "9aa02675d3691ebcf4760ff471147c56",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "e55920f73b71e4a23e0c03ff79f445d5",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T07:48:49.465476+00:00",
                        "finish": "2022-03-03T07:48:49.471573+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643644997118",
                    "trigger": "event 'zha_event'"
                }
            }
        ],
        "automation.1643645804516": [
            {
                "extended_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "77340232aab9aedbeee5c1fcb72e8a47",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T04:09:09.681626+00:00",
                        "finish": "2022-03-03T04:09:09.687899+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643645804516",
                    "trigger": "event 'zha_event'",
                    "trace": {
                        "trigger/1": [
                            {
                                "path": "trigger/1",
                                "timestamp": "2022-03-03T04:09:09.682380+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.elenas_room_fan_controller",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T03:12:31.522715+00:00",
                                            "mode": "restart",
                                            "current": 0,
                                            "id": "1643645804516",
                                            "friendly_name": "Elena's Room Fan Controller"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.799214+00:00",
                                        "last_updated": "2022-03-03T03:12:31.527996+00:00",
                                        "context": {
                                            "id": "e57a9655036a82d3ce27e7e53c6e60f4",
                                            "parent_id": "2fb2c34d278e448b7f7a0e96abc1437b",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "1",
                                        "idx": "1",
                                        "platform": "event",
                                        "event": {
                                            "event_type": "zha_event",
                                            "data": {
                                                "device_ieee": "84:fd:27:ff:fe:3b:78:94",
                                                "unique_id": "84:fd:27:ff:fe:3b:78:94:1:0x0020",
                                                "device_id": "ea611248af61d7f5dc06e3a824288132",
                                                "endpoint_id": 1,
                                                "cluster_id": 32,
                                                "command": "checkin",
                                                "args": []
                                            },
                                            "origin": "LOCAL",
                                            "time_fired": "2022-03-03T04:09:09.680237+00:00",
                                            "context": {
                                                "id": "ac0f2be16be7680aacbae8ed1f678f64",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "description": "event 'zha_event'"
                                    },
                                    "integration": "ZHA",
                                    "button_up_long_loop": false,
                                    "button_up_long_max_loop_repeats": 500,
                                    "button_up_double_press": false,
                                    "button_down_long_loop": false,
                                    "button_down_long_max_loop_repeats": 500,
                                    "button_down_double_press": false,
                                    "helper_last_controller_event": "input_text.zz_elena_s_room_fan_controller_last_event",
                                    "helper_double_press_delay": 500,
                                    "helper_debounce_delay": 0,
                                    "integration_id": "zha",
                                    "adjusted_double_press_delay": 500,
                                    "actions_mapping": {
                                        "deconz": {
                                            "button_up_short": [
                                                "1002"
                                            ],
                                            "button_up_long": [
                                                "1001"
                                            ],
                                            "button_up_release": [
                                                "1003"
                                            ],
                                            "button_down_short": [
                                                "2002"
                                            ],
                                            "button_down_long": [
                                                "2001"
                                            ],
                                            "button_down_release": [
                                                "2003"
                                            ]
                                        },
                                        "zha": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "move_with_on_off_0_83"
                                            ],
                                            "button_up_release": [
                                                "stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "move_1_83"
                                            ],
                                            "button_down_release": [
                                                "stop"
                                            ]
                                        },
                                        "zigbee2mqtt": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "brightness_move_up"
                                            ],
                                            "button_up_release": [
                                                "brightness_stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "brightness_move_down"
                                            ],
                                            "button_down_release": [
                                                "brightness_stop"
                                            ]
                                        }
                                    },
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ],
                                    "integrations_with_prev_event_storage": [
                                        "zha",
                                        "zigbee2mqtt"
                                    ],
                                    "controller_entity": "",
                                    "controller_device": "ea611248af61d7f5dc06e3a824288132",
                                    "controller_id": "ea611248af61d7f5dc06e3a824288132"
                                }
                            }
                        ],
                        "condition/0": [
                            {
                                "path": "condition/0",
                                "timestamp": "2022-03-03T04:09:09.682415+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "condition/0/conditions/0": [
                            {
                                "path": "condition/0/conditions/0",
                                "timestamp": "2022-03-03T04:09:09.682436+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "condition/0/conditions/1": [
                            {
                                "path": "condition/0/conditions/1",
                                "timestamp": "2022-03-03T04:09:09.682584+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T04:09:09.683338+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "759d7e9b50762b9f9f40c149eb1d1e81",
                                        "parent_id": "ac0f2be16be7680aacbae8ed1f678f64",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "delay": 0.0,
                                    "done": true
                                }
                            }
                        ],
                        "action/1": [
                            {
                                "path": "action/1",
                                "timestamp": "2022-03-03T04:09:09.684316+00:00"
                            }
                        ],
                        "action/2": [
                            {
                                "path": "action/2",
                                "timestamp": "2022-03-03T04:09:09.685014+00:00",
                                "changed_variables": {
                                    "trigger_action": "checkin",
                                    "trigger_delta": 3398158.9620113373,
                                    "last_controller_event": "checkin"
                                },
                                "result": {
                                    "params": {
                                        "domain": "input_text",
                                        "service": "set_value",
                                        "service_data": {
                                            "entity_id": "input_text.zz_elena_s_room_fan_controller_last_event",
                                            "value": {
                                                "trigger_action": "checkin",
                                                "last_triggered": "2022-03-03 12:09:09.685130+08:00"
                                            }
                                        },
                                        "target": {}
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "action/3": [
                            {
                                "path": "action/3",
                                "timestamp": "2022-03-03T04:09:09.686837+00:00"
                            }
                        ],
                        "action/3/choose/0": [
                            {
                                "path": "action/3/choose/0",
                                "timestamp": "2022-03-03T04:09:09.686908+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/0/conditions/0": [
                            {
                                "path": "action/3/choose/0/conditions/0",
                                "timestamp": "2022-03-03T04:09:09.686945+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/1": [
                            {
                                "path": "action/3/choose/1",
                                "timestamp": "2022-03-03T04:09:09.687055+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/1/conditions/0": [
                            {
                                "path": "action/3/choose/1/conditions/0",
                                "timestamp": "2022-03-03T04:09:09.687074+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/2": [
                            {
                                "path": "action/3/choose/2",
                                "timestamp": "2022-03-03T04:09:09.687152+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/2/conditions/0": [
                            {
                                "path": "action/3/choose/2/conditions/0",
                                "timestamp": "2022-03-03T04:09:09.687171+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/3": [
                            {
                                "path": "action/3/choose/3",
                                "timestamp": "2022-03-03T04:09:09.687251+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/3/conditions/0": [
                            {
                                "path": "action/3/choose/3/conditions/0",
                                "timestamp": "2022-03-03T04:09:09.687269+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/4": [
                            {
                                "path": "action/3/choose/4",
                                "timestamp": "2022-03-03T04:09:09.687346+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/4/conditions/0": [
                            {
                                "path": "action/3/choose/4/conditions/0",
                                "timestamp": "2022-03-03T04:09:09.687364+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/5": [
                            {
                                "path": "action/3/choose/5",
                                "timestamp": "2022-03-03T04:09:09.687429+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/5/conditions/0": [
                            {
                                "path": "action/3/choose/5/conditions/0",
                                "timestamp": "2022-03-03T04:09:09.687445+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ]
                    },
                    "config": {
                        "variables": {
                            "integration": "ZHA",
                            "button_up_long_loop": false,
                            "button_up_long_max_loop_repeats": 500,
                            "button_up_double_press": false,
                            "button_down_long_loop": false,
                            "button_down_long_max_loop_repeats": 500,
                            "button_down_double_press": false,
                            "helper_last_controller_event": "input_text.zz_elena_s_room_fan_controller_last_event",
                            "helper_double_press_delay": 500,
                            "helper_debounce_delay": 0,
                            "integration_id": "{{ integration | lower }}",
                            "adjusted_double_press_delay": "{{ [helper_double_press_delay - helper_debounce_delay, 100] | max }}",
                            "actions_mapping": {
                                "deconz": {
                                    "button_up_short": [
                                        "1002"
                                    ],
                                    "button_up_long": [
                                        "1001"
                                    ],
                                    "button_up_release": [
                                        "1003"
                                    ],
                                    "button_down_short": [
                                        "2002"
                                    ],
                                    "button_down_long": [
                                        "2001"
                                    ],
                                    "button_down_release": [
                                        "2003"
                                    ]
                                },
                                "zha": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ]
                                },
                                "zigbee2mqtt": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "brightness_move_up"
                                    ],
                                    "button_up_release": [
                                        "brightness_stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "brightness_move_down"
                                    ],
                                    "button_down_release": [
                                        "brightness_stop"
                                    ]
                                }
                            },
                            "button_up_short": "{{ actions_mapping[integration_id][\"button_up_short\"] }}",
                            "button_up_long": "{{ actions_mapping[integration_id][\"button_up_long\"] }}",
                            "button_up_release": "{{ actions_mapping[integration_id][\"button_up_release\"] }}",
                            "button_down_short": "{{ actions_mapping[integration_id][\"button_down_short\"] }}",
                            "button_down_long": "{{ actions_mapping[integration_id][\"button_down_long\"] }}",
                            "button_down_release": "{{ actions_mapping[integration_id][\"button_down_release\"] }}",
                            "integrations_with_prev_event_storage": [
                                "zha",
                                "zigbee2mqtt"
                            ],
                            "controller_entity": "",
                            "controller_device": "ea611248af61d7f5dc06e3a824288132",
                            "controller_id": "{% if integration_id==\"zigbee2mqtt\" %}{{controller_entity}}{% else %}{{controller_device}}{% endif %}"
                        },
                        "mode": "restart",
                        "max_exceeded": "silent",
                        "trigger": [
                            {
                                "platform": "event",
                                "event_type": "state_changed",
                                "event_data": {
                                    "entity_id": ""
                                }
                            },
                            {
                                "platform": "event",
                                "event_type": [
                                    "deconz_event",
                                    "zha_event"
                                ],
                                "event_data": {
                                    "device_id": "ea611248af61d7f5dc06e3a824288132"
                                }
                            }
                        ],
                        "condition": [
                            {
                                "condition": "and",
                                "conditions": [
                                    "{%- set trigger_action -%} {%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%} {%- endset -%} {{ trigger_action not in [\"\",\"None\"] }}",
                                    "{{ integration_id != \"zigbee2mqtt\" or trigger.event.data.new_state.state != trigger.event.data.old_state.state }}"
                                ]
                            }
                        ],
                        "action": [
                            {
                                "delay": {
                                    "milliseconds": 0
                                }
                            },
                            {
                                "variables": {
                                    "trigger_action": "{%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%}",
                                    "trigger_delta": "{{ (as_timestamp(now()) - as_timestamp((states(helper_last_controller_event) | from_json).last_triggered if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"1970-01-01 00:00:00\")) * 1000 }}",
                                    "last_controller_event": "{{ (states(helper_last_controller_event) | from_json).trigger_action if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"\" }}"
                                }
                            },
                            {
                                "service": "input_text.set_value",
                                "data": {
                                    "entity_id": "input_text.zz_elena_s_room_fan_controller_last_event",
                                    "value": "{{ {\"trigger_action\":trigger_action,\"last_triggered\":now()|string} | to_json }}"
                                }
                            },
                            {
                                "choose": [
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_elena_s_room_fan_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_up_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_up_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "fan.turn_on",
                                                                                        "target": {
                                                                                            "entity_id": "fan.elenas_room_fan"
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_up_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "fan.turn_on",
                                                                        "target": {
                                                                            "entity_id": "fan.elenas_room_fan"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_up_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "fan.increase_speed",
                                                                            "target": {
                                                                                "entity_id": "fan.elenas_room_fan"
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "fan.increase_speed",
                                                        "target": {
                                                            "entity_id": "fan.elenas_room_fan"
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_up_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_up_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_elena_s_room_fan_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_down_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_down_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "fan.turn_off",
                                                                                        "target": {
                                                                                            "entity_id": "fan.elenas_room_fan"
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_down_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "fan.turn_off",
                                                                        "target": {
                                                                            "entity_id": "fan.elenas_room_fan"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_down_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "fan.decrease_speed",
                                                                            "target": {
                                                                                "entity_id": "fan.elenas_room_fan"
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "fan.decrease_speed",
                                                        "target": {
                                                            "entity_id": "fan.elenas_room_fan"
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_down_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_down_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            }
                        ],
                        "id": "1643645804516",
                        "alias": "Elena's Room Fan Controller",
                        "description": "Control Elena's Room Fan"
                    },
                    "blueprint_inputs": {
                        "id": "1643645804516",
                        "alias": "Elena's Room Fan Controller",
                        "description": "Control Elena's Room Fan",
                        "use_blueprint": {
                            "path": "EPMatt/ikea_e1743.yaml",
                            "input": {
                                "integration": "ZHA",
                                "controller_device": "ea611248af61d7f5dc06e3a824288132",
                                "helper_last_controller_event": "input_text.zz_elena_s_room_fan_controller_last_event",
                                "action_button_up_short": [
                                    {
                                        "service": "fan.turn_on",
                                        "target": {
                                            "entity_id": "fan.elenas_room_fan"
                                        }
                                    }
                                ],
                                "action_button_up_long": [
                                    {
                                        "service": "fan.increase_speed",
                                        "target": {
                                            "entity_id": "fan.elenas_room_fan"
                                        }
                                    }
                                ],
                                "action_button_down_short": [
                                    {
                                        "service": "fan.turn_off",
                                        "target": {
                                            "entity_id": "fan.elenas_room_fan"
                                        }
                                    }
                                ],
                                "action_button_down_long": [
                                    {
                                        "service": "fan.decrease_speed",
                                        "target": {
                                            "entity_id": "fan.elenas_room_fan"
                                        }
                                    }
                                ]
                            }
                        }
                    },
                    "context": {
                        "id": "759d7e9b50762b9f9f40c149eb1d1e81",
                        "parent_id": "ac0f2be16be7680aacbae8ed1f678f64",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "77340232aab9aedbeee5c1fcb72e8a47",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T04:09:09.681626+00:00",
                        "finish": "2022-03-03T04:09:09.687899+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643645804516",
                    "trigger": "event 'zha_event'"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "413eac527a370d44a69008296a5bb555",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:05:47.766371+00:00",
                        "finish": "2022-03-03T05:05:47.775155+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643645804516",
                    "trigger": "event 'zha_event'",
                    "trace": {
                        "trigger/1": [
                            {
                                "path": "trigger/1",
                                "timestamp": "2022-03-03T05:05:47.767189+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.elenas_room_fan_controller",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T04:09:09.682771+00:00",
                                            "mode": "restart",
                                            "current": 0,
                                            "id": "1643645804516",
                                            "friendly_name": "Elena's Room Fan Controller"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.799214+00:00",
                                        "last_updated": "2022-03-03T04:09:09.687559+00:00",
                                        "context": {
                                            "id": "759d7e9b50762b9f9f40c149eb1d1e81",
                                            "parent_id": "ac0f2be16be7680aacbae8ed1f678f64",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "1",
                                        "idx": "1",
                                        "platform": "event",
                                        "event": {
                                            "event_type": "zha_event",
                                            "data": {
                                                "device_ieee": "84:fd:27:ff:fe:3b:78:94",
                                                "unique_id": "84:fd:27:ff:fe:3b:78:94:1:0x0020",
                                                "device_id": "ea611248af61d7f5dc06e3a824288132",
                                                "endpoint_id": 1,
                                                "cluster_id": 32,
                                                "command": "checkin",
                                                "args": []
                                            },
                                            "origin": "LOCAL",
                                            "time_fired": "2022-03-03T05:05:47.764906+00:00",
                                            "context": {
                                                "id": "6407e6f17340338c4c8dfc24f913dece",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "description": "event 'zha_event'"
                                    },
                                    "integration": "ZHA",
                                    "button_up_long_loop": false,
                                    "button_up_long_max_loop_repeats": 500,
                                    "button_up_double_press": false,
                                    "button_down_long_loop": false,
                                    "button_down_long_max_loop_repeats": 500,
                                    "button_down_double_press": false,
                                    "helper_last_controller_event": "input_text.zz_elena_s_room_fan_controller_last_event",
                                    "helper_double_press_delay": 500,
                                    "helper_debounce_delay": 0,
                                    "integration_id": "zha",
                                    "adjusted_double_press_delay": 500,
                                    "actions_mapping": {
                                        "deconz": {
                                            "button_up_short": [
                                                "1002"
                                            ],
                                            "button_up_long": [
                                                "1001"
                                            ],
                                            "button_up_release": [
                                                "1003"
                                            ],
                                            "button_down_short": [
                                                "2002"
                                            ],
                                            "button_down_long": [
                                                "2001"
                                            ],
                                            "button_down_release": [
                                                "2003"
                                            ]
                                        },
                                        "zha": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "move_with_on_off_0_83"
                                            ],
                                            "button_up_release": [
                                                "stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "move_1_83"
                                            ],
                                            "button_down_release": [
                                                "stop"
                                            ]
                                        },
                                        "zigbee2mqtt": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "brightness_move_up"
                                            ],
                                            "button_up_release": [
                                                "brightness_stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "brightness_move_down"
                                            ],
                                            "button_down_release": [
                                                "brightness_stop"
                                            ]
                                        }
                                    },
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ],
                                    "integrations_with_prev_event_storage": [
                                        "zha",
                                        "zigbee2mqtt"
                                    ],
                                    "controller_entity": "",
                                    "controller_device": "ea611248af61d7f5dc06e3a824288132",
                                    "controller_id": "ea611248af61d7f5dc06e3a824288132"
                                }
                            }
                        ],
                        "condition/0": [
                            {
                                "path": "condition/0",
                                "timestamp": "2022-03-03T05:05:47.767231+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "condition/0/conditions/0": [
                            {
                                "path": "condition/0/conditions/0",
                                "timestamp": "2022-03-03T05:05:47.767254+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "condition/0/conditions/1": [
                            {
                                "path": "condition/0/conditions/1",
                                "timestamp": "2022-03-03T05:05:47.767433+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T05:05:47.768444+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "2e311e930977a0deef38b052697cadb2",
                                        "parent_id": "6407e6f17340338c4c8dfc24f913dece",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "delay": 0.0,
                                    "done": true
                                }
                            }
                        ],
                        "action/1": [
                            {
                                "path": "action/1",
                                "timestamp": "2022-03-03T05:05:47.769872+00:00"
                            }
                        ],
                        "action/2": [
                            {
                                "path": "action/2",
                                "timestamp": "2022-03-03T05:05:47.770552+00:00",
                                "changed_variables": {
                                    "trigger_action": "checkin",
                                    "trigger_delta": 3398085.023164749,
                                    "last_controller_event": "checkin"
                                },
                                "result": {
                                    "params": {
                                        "domain": "input_text",
                                        "service": "set_value",
                                        "service_data": {
                                            "entity_id": "input_text.zz_elena_s_room_fan_controller_last_event",
                                            "value": {
                                                "trigger_action": "checkin",
                                                "last_triggered": "2022-03-03 13:05:47.770664+08:00"
                                            }
                                        },
                                        "target": {}
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "action/3": [
                            {
                                "path": "action/3",
                                "timestamp": "2022-03-03T05:05:47.772893+00:00"
                            }
                        ],
                        "action/3/choose/0": [
                            {
                                "path": "action/3/choose/0",
                                "timestamp": "2022-03-03T05:05:47.772964+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/0/conditions/0": [
                            {
                                "path": "action/3/choose/0/conditions/0",
                                "timestamp": "2022-03-03T05:05:47.772991+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/1": [
                            {
                                "path": "action/3/choose/1",
                                "timestamp": "2022-03-03T05:05:47.773119+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/1/conditions/0": [
                            {
                                "path": "action/3/choose/1/conditions/0",
                                "timestamp": "2022-03-03T05:05:47.773147+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/2": [
                            {
                                "path": "action/3/choose/2",
                                "timestamp": "2022-03-03T05:05:47.773247+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/2/conditions/0": [
                            {
                                "path": "action/3/choose/2/conditions/0",
                                "timestamp": "2022-03-03T05:05:47.773271+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/3": [
                            {
                                "path": "action/3/choose/3",
                                "timestamp": "2022-03-03T05:05:47.773361+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/3/conditions/0": [
                            {
                                "path": "action/3/choose/3/conditions/0",
                                "timestamp": "2022-03-03T05:05:47.773383+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/4": [
                            {
                                "path": "action/3/choose/4",
                                "timestamp": "2022-03-03T05:05:47.773475+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/4/conditions/0": [
                            {
                                "path": "action/3/choose/4/conditions/0",
                                "timestamp": "2022-03-03T05:05:47.773496+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/5": [
                            {
                                "path": "action/3/choose/5",
                                "timestamp": "2022-03-03T05:05:47.773575+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/5/conditions/0": [
                            {
                                "path": "action/3/choose/5/conditions/0",
                                "timestamp": "2022-03-03T05:05:47.773592+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ]
                    },
                    "config": {
                        "variables": {
                            "integration": "ZHA",
                            "button_up_long_loop": false,
                            "button_up_long_max_loop_repeats": 500,
                            "button_up_double_press": false,
                            "button_down_long_loop": false,
                            "button_down_long_max_loop_repeats": 500,
                            "button_down_double_press": false,
                            "helper_last_controller_event": "input_text.zz_elena_s_room_fan_controller_last_event",
                            "helper_double_press_delay": 500,
                            "helper_debounce_delay": 0,
                            "integration_id": "{{ integration | lower }}",
                            "adjusted_double_press_delay": "{{ [helper_double_press_delay - helper_debounce_delay, 100] | max }}",
                            "actions_mapping": {
                                "deconz": {
                                    "button_up_short": [
                                        "1002"
                                    ],
                                    "button_up_long": [
                                        "1001"
                                    ],
                                    "button_up_release": [
                                        "1003"
                                    ],
                                    "button_down_short": [
                                        "2002"
                                    ],
                                    "button_down_long": [
                                        "2001"
                                    ],
                                    "button_down_release": [
                                        "2003"
                                    ]
                                },
                                "zha": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ]
                                },
                                "zigbee2mqtt": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "brightness_move_up"
                                    ],
                                    "button_up_release": [
                                        "brightness_stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "brightness_move_down"
                                    ],
                                    "button_down_release": [
                                        "brightness_stop"
                                    ]
                                }
                            },
                            "button_up_short": "{{ actions_mapping[integration_id][\"button_up_short\"] }}",
                            "button_up_long": "{{ actions_mapping[integration_id][\"button_up_long\"] }}",
                            "button_up_release": "{{ actions_mapping[integration_id][\"button_up_release\"] }}",
                            "button_down_short": "{{ actions_mapping[integration_id][\"button_down_short\"] }}",
                            "button_down_long": "{{ actions_mapping[integration_id][\"button_down_long\"] }}",
                            "button_down_release": "{{ actions_mapping[integration_id][\"button_down_release\"] }}",
                            "integrations_with_prev_event_storage": [
                                "zha",
                                "zigbee2mqtt"
                            ],
                            "controller_entity": "",
                            "controller_device": "ea611248af61d7f5dc06e3a824288132",
                            "controller_id": "{% if integration_id==\"zigbee2mqtt\" %}{{controller_entity}}{% else %}{{controller_device}}{% endif %}"
                        },
                        "mode": "restart",
                        "max_exceeded": "silent",
                        "trigger": [
                            {
                                "platform": "event",
                                "event_type": "state_changed",
                                "event_data": {
                                    "entity_id": ""
                                }
                            },
                            {
                                "platform": "event",
                                "event_type": [
                                    "deconz_event",
                                    "zha_event"
                                ],
                                "event_data": {
                                    "device_id": "ea611248af61d7f5dc06e3a824288132"
                                }
                            }
                        ],
                        "condition": [
                            {
                                "condition": "and",
                                "conditions": [
                                    "{%- set trigger_action -%} {%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%} {%- endset -%} {{ trigger_action not in [\"\",\"None\"] }}",
                                    "{{ integration_id != \"zigbee2mqtt\" or trigger.event.data.new_state.state != trigger.event.data.old_state.state }}"
                                ]
                            }
                        ],
                        "action": [
                            {
                                "delay": {
                                    "milliseconds": 0
                                }
                            },
                            {
                                "variables": {
                                    "trigger_action": "{%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%}",
                                    "trigger_delta": "{{ (as_timestamp(now()) - as_timestamp((states(helper_last_controller_event) | from_json).last_triggered if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"1970-01-01 00:00:00\")) * 1000 }}",
                                    "last_controller_event": "{{ (states(helper_last_controller_event) | from_json).trigger_action if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"\" }}"
                                }
                            },
                            {
                                "service": "input_text.set_value",
                                "data": {
                                    "entity_id": "input_text.zz_elena_s_room_fan_controller_last_event",
                                    "value": "{{ {\"trigger_action\":trigger_action,\"last_triggered\":now()|string} | to_json }}"
                                }
                            },
                            {
                                "choose": [
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_elena_s_room_fan_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_up_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_up_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "fan.turn_on",
                                                                                        "target": {
                                                                                            "entity_id": "fan.elenas_room_fan"
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_up_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "fan.turn_on",
                                                                        "target": {
                                                                            "entity_id": "fan.elenas_room_fan"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_up_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "fan.increase_speed",
                                                                            "target": {
                                                                                "entity_id": "fan.elenas_room_fan"
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "fan.increase_speed",
                                                        "target": {
                                                            "entity_id": "fan.elenas_room_fan"
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_up_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_up_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_elena_s_room_fan_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_down_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_down_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "fan.turn_off",
                                                                                        "target": {
                                                                                            "entity_id": "fan.elenas_room_fan"
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_down_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "fan.turn_off",
                                                                        "target": {
                                                                            "entity_id": "fan.elenas_room_fan"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_down_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "fan.decrease_speed",
                                                                            "target": {
                                                                                "entity_id": "fan.elenas_room_fan"
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "fan.decrease_speed",
                                                        "target": {
                                                            "entity_id": "fan.elenas_room_fan"
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_down_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_down_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            }
                        ],
                        "id": "1643645804516",
                        "alias": "Elena's Room Fan Controller",
                        "description": "Control Elena's Room Fan"
                    },
                    "blueprint_inputs": {
                        "id": "1643645804516",
                        "alias": "Elena's Room Fan Controller",
                        "description": "Control Elena's Room Fan",
                        "use_blueprint": {
                            "path": "EPMatt/ikea_e1743.yaml",
                            "input": {
                                "integration": "ZHA",
                                "controller_device": "ea611248af61d7f5dc06e3a824288132",
                                "helper_last_controller_event": "input_text.zz_elena_s_room_fan_controller_last_event",
                                "action_button_up_short": [
                                    {
                                        "service": "fan.turn_on",
                                        "target": {
                                            "entity_id": "fan.elenas_room_fan"
                                        }
                                    }
                                ],
                                "action_button_up_long": [
                                    {
                                        "service": "fan.increase_speed",
                                        "target": {
                                            "entity_id": "fan.elenas_room_fan"
                                        }
                                    }
                                ],
                                "action_button_down_short": [
                                    {
                                        "service": "fan.turn_off",
                                        "target": {
                                            "entity_id": "fan.elenas_room_fan"
                                        }
                                    }
                                ],
                                "action_button_down_long": [
                                    {
                                        "service": "fan.decrease_speed",
                                        "target": {
                                            "entity_id": "fan.elenas_room_fan"
                                        }
                                    }
                                ]
                            }
                        }
                    },
                    "context": {
                        "id": "2e311e930977a0deef38b052697cadb2",
                        "parent_id": "6407e6f17340338c4c8dfc24f913dece",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "413eac527a370d44a69008296a5bb555",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:05:47.766371+00:00",
                        "finish": "2022-03-03T05:05:47.775155+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643645804516",
                    "trigger": "event 'zha_event'"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "3eaa1a1130749b1aaae2f205f4d08abf",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T06:02:25.800515+00:00",
                        "finish": "2022-03-03T06:02:25.809548+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643645804516",
                    "trigger": "event 'zha_event'",
                    "trace": {
                        "trigger/1": [
                            {
                                "path": "trigger/1",
                                "timestamp": "2022-03-03T06:02:25.801285+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.elenas_room_fan_controller",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T05:05:47.767649+00:00",
                                            "mode": "restart",
                                            "current": 0,
                                            "id": "1643645804516",
                                            "friendly_name": "Elena's Room Fan Controller"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.799214+00:00",
                                        "last_updated": "2022-03-03T05:05:47.774155+00:00",
                                        "context": {
                                            "id": "2e311e930977a0deef38b052697cadb2",
                                            "parent_id": "6407e6f17340338c4c8dfc24f913dece",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "1",
                                        "idx": "1",
                                        "platform": "event",
                                        "event": {
                                            "event_type": "zha_event",
                                            "data": {
                                                "device_ieee": "84:fd:27:ff:fe:3b:78:94",
                                                "unique_id": "84:fd:27:ff:fe:3b:78:94:1:0x0020",
                                                "device_id": "ea611248af61d7f5dc06e3a824288132",
                                                "endpoint_id": 1,
                                                "cluster_id": 32,
                                                "command": "checkin",
                                                "args": []
                                            },
                                            "origin": "LOCAL",
                                            "time_fired": "2022-03-03T06:02:25.799647+00:00",
                                            "context": {
                                                "id": "2096033fc5dfa1d9957c8dc0b2edb6f3",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "description": "event 'zha_event'"
                                    },
                                    "integration": "ZHA",
                                    "button_up_long_loop": false,
                                    "button_up_long_max_loop_repeats": 500,
                                    "button_up_double_press": false,
                                    "button_down_long_loop": false,
                                    "button_down_long_max_loop_repeats": 500,
                                    "button_down_double_press": false,
                                    "helper_last_controller_event": "input_text.zz_elena_s_room_fan_controller_last_event",
                                    "helper_double_press_delay": 500,
                                    "helper_debounce_delay": 0,
                                    "integration_id": "zha",
                                    "adjusted_double_press_delay": 500,
                                    "actions_mapping": {
                                        "deconz": {
                                            "button_up_short": [
                                                "1002"
                                            ],
                                            "button_up_long": [
                                                "1001"
                                            ],
                                            "button_up_release": [
                                                "1003"
                                            ],
                                            "button_down_short": [
                                                "2002"
                                            ],
                                            "button_down_long": [
                                                "2001"
                                            ],
                                            "button_down_release": [
                                                "2003"
                                            ]
                                        },
                                        "zha": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "move_with_on_off_0_83"
                                            ],
                                            "button_up_release": [
                                                "stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "move_1_83"
                                            ],
                                            "button_down_release": [
                                                "stop"
                                            ]
                                        },
                                        "zigbee2mqtt": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "brightness_move_up"
                                            ],
                                            "button_up_release": [
                                                "brightness_stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "brightness_move_down"
                                            ],
                                            "button_down_release": [
                                                "brightness_stop"
                                            ]
                                        }
                                    },
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ],
                                    "integrations_with_prev_event_storage": [
                                        "zha",
                                        "zigbee2mqtt"
                                    ],
                                    "controller_entity": "",
                                    "controller_device": "ea611248af61d7f5dc06e3a824288132",
                                    "controller_id": "ea611248af61d7f5dc06e3a824288132"
                                }
                            }
                        ],
                        "condition/0": [
                            {
                                "path": "condition/0",
                                "timestamp": "2022-03-03T06:02:25.801320+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "condition/0/conditions/0": [
                            {
                                "path": "condition/0/conditions/0",
                                "timestamp": "2022-03-03T06:02:25.801338+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "condition/0/conditions/1": [
                            {
                                "path": "condition/0/conditions/1",
                                "timestamp": "2022-03-03T06:02:25.801480+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T06:02:25.802425+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "bcdbb2f72f602b3d003556be8755d74d",
                                        "parent_id": "2096033fc5dfa1d9957c8dc0b2edb6f3",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "delay": 0.0,
                                    "done": true
                                }
                            }
                        ],
                        "action/1": [
                            {
                                "path": "action/1",
                                "timestamp": "2022-03-03T06:02:25.803792+00:00"
                            }
                        ],
                        "action/2": [
                            {
                                "path": "action/2",
                                "timestamp": "2022-03-03T06:02:25.804391+00:00",
                                "changed_variables": {
                                    "trigger_action": "checkin",
                                    "trigger_delta": 3398033.385038376,
                                    "last_controller_event": "checkin"
                                },
                                "result": {
                                    "params": {
                                        "domain": "input_text",
                                        "service": "set_value",
                                        "service_data": {
                                            "entity_id": "input_text.zz_elena_s_room_fan_controller_last_event",
                                            "value": {
                                                "trigger_action": "checkin",
                                                "last_triggered": "2022-03-03 14:02:25.804491+08:00"
                                            }
                                        },
                                        "target": {}
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "action/3": [
                            {
                                "path": "action/3",
                                "timestamp": "2022-03-03T06:02:25.807767+00:00"
                            }
                        ],
                        "action/3/choose/0": [
                            {
                                "path": "action/3/choose/0",
                                "timestamp": "2022-03-03T06:02:25.807842+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/0/conditions/0": [
                            {
                                "path": "action/3/choose/0/conditions/0",
                                "timestamp": "2022-03-03T06:02:25.807869+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/1": [
                            {
                                "path": "action/3/choose/1",
                                "timestamp": "2022-03-03T06:02:25.808015+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/1/conditions/0": [
                            {
                                "path": "action/3/choose/1/conditions/0",
                                "timestamp": "2022-03-03T06:02:25.808044+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/2": [
                            {
                                "path": "action/3/choose/2",
                                "timestamp": "2022-03-03T06:02:25.808138+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/2/conditions/0": [
                            {
                                "path": "action/3/choose/2/conditions/0",
                                "timestamp": "2022-03-03T06:02:25.808160+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/3": [
                            {
                                "path": "action/3/choose/3",
                                "timestamp": "2022-03-03T06:02:25.808245+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/3/conditions/0": [
                            {
                                "path": "action/3/choose/3/conditions/0",
                                "timestamp": "2022-03-03T06:02:25.808266+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/4": [
                            {
                                "path": "action/3/choose/4",
                                "timestamp": "2022-03-03T06:02:25.808356+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/4/conditions/0": [
                            {
                                "path": "action/3/choose/4/conditions/0",
                                "timestamp": "2022-03-03T06:02:25.808387+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/5": [
                            {
                                "path": "action/3/choose/5",
                                "timestamp": "2022-03-03T06:02:25.808461+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/5/conditions/0": [
                            {
                                "path": "action/3/choose/5/conditions/0",
                                "timestamp": "2022-03-03T06:02:25.808480+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ]
                    },
                    "config": {
                        "variables": {
                            "integration": "ZHA",
                            "button_up_long_loop": false,
                            "button_up_long_max_loop_repeats": 500,
                            "button_up_double_press": false,
                            "button_down_long_loop": false,
                            "button_down_long_max_loop_repeats": 500,
                            "button_down_double_press": false,
                            "helper_last_controller_event": "input_text.zz_elena_s_room_fan_controller_last_event",
                            "helper_double_press_delay": 500,
                            "helper_debounce_delay": 0,
                            "integration_id": "{{ integration | lower }}",
                            "adjusted_double_press_delay": "{{ [helper_double_press_delay - helper_debounce_delay, 100] | max }}",
                            "actions_mapping": {
                                "deconz": {
                                    "button_up_short": [
                                        "1002"
                                    ],
                                    "button_up_long": [
                                        "1001"
                                    ],
                                    "button_up_release": [
                                        "1003"
                                    ],
                                    "button_down_short": [
                                        "2002"
                                    ],
                                    "button_down_long": [
                                        "2001"
                                    ],
                                    "button_down_release": [
                                        "2003"
                                    ]
                                },
                                "zha": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ]
                                },
                                "zigbee2mqtt": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "brightness_move_up"
                                    ],
                                    "button_up_release": [
                                        "brightness_stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "brightness_move_down"
                                    ],
                                    "button_down_release": [
                                        "brightness_stop"
                                    ]
                                }
                            },
                            "button_up_short": "{{ actions_mapping[integration_id][\"button_up_short\"] }}",
                            "button_up_long": "{{ actions_mapping[integration_id][\"button_up_long\"] }}",
                            "button_up_release": "{{ actions_mapping[integration_id][\"button_up_release\"] }}",
                            "button_down_short": "{{ actions_mapping[integration_id][\"button_down_short\"] }}",
                            "button_down_long": "{{ actions_mapping[integration_id][\"button_down_long\"] }}",
                            "button_down_release": "{{ actions_mapping[integration_id][\"button_down_release\"] }}",
                            "integrations_with_prev_event_storage": [
                                "zha",
                                "zigbee2mqtt"
                            ],
                            "controller_entity": "",
                            "controller_device": "ea611248af61d7f5dc06e3a824288132",
                            "controller_id": "{% if integration_id==\"zigbee2mqtt\" %}{{controller_entity}}{% else %}{{controller_device}}{% endif %}"
                        },
                        "mode": "restart",
                        "max_exceeded": "silent",
                        "trigger": [
                            {
                                "platform": "event",
                                "event_type": "state_changed",
                                "event_data": {
                                    "entity_id": ""
                                }
                            },
                            {
                                "platform": "event",
                                "event_type": [
                                    "deconz_event",
                                    "zha_event"
                                ],
                                "event_data": {
                                    "device_id": "ea611248af61d7f5dc06e3a824288132"
                                }
                            }
                        ],
                        "condition": [
                            {
                                "condition": "and",
                                "conditions": [
                                    "{%- set trigger_action -%} {%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%} {%- endset -%} {{ trigger_action not in [\"\",\"None\"] }}",
                                    "{{ integration_id != \"zigbee2mqtt\" or trigger.event.data.new_state.state != trigger.event.data.old_state.state }}"
                                ]
                            }
                        ],
                        "action": [
                            {
                                "delay": {
                                    "milliseconds": 0
                                }
                            },
                            {
                                "variables": {
                                    "trigger_action": "{%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%}",
                                    "trigger_delta": "{{ (as_timestamp(now()) - as_timestamp((states(helper_last_controller_event) | from_json).last_triggered if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"1970-01-01 00:00:00\")) * 1000 }}",
                                    "last_controller_event": "{{ (states(helper_last_controller_event) | from_json).trigger_action if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"\" }}"
                                }
                            },
                            {
                                "service": "input_text.set_value",
                                "data": {
                                    "entity_id": "input_text.zz_elena_s_room_fan_controller_last_event",
                                    "value": "{{ {\"trigger_action\":trigger_action,\"last_triggered\":now()|string} | to_json }}"
                                }
                            },
                            {
                                "choose": [
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_elena_s_room_fan_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_up_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_up_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "fan.turn_on",
                                                                                        "target": {
                                                                                            "entity_id": "fan.elenas_room_fan"
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_up_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "fan.turn_on",
                                                                        "target": {
                                                                            "entity_id": "fan.elenas_room_fan"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_up_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "fan.increase_speed",
                                                                            "target": {
                                                                                "entity_id": "fan.elenas_room_fan"
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "fan.increase_speed",
                                                        "target": {
                                                            "entity_id": "fan.elenas_room_fan"
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_up_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_up_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_elena_s_room_fan_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_down_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_down_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "fan.turn_off",
                                                                                        "target": {
                                                                                            "entity_id": "fan.elenas_room_fan"
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_down_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "fan.turn_off",
                                                                        "target": {
                                                                            "entity_id": "fan.elenas_room_fan"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_down_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "fan.decrease_speed",
                                                                            "target": {
                                                                                "entity_id": "fan.elenas_room_fan"
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "fan.decrease_speed",
                                                        "target": {
                                                            "entity_id": "fan.elenas_room_fan"
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_down_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_down_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            }
                        ],
                        "id": "1643645804516",
                        "alias": "Elena's Room Fan Controller",
                        "description": "Control Elena's Room Fan"
                    },
                    "blueprint_inputs": {
                        "id": "1643645804516",
                        "alias": "Elena's Room Fan Controller",
                        "description": "Control Elena's Room Fan",
                        "use_blueprint": {
                            "path": "EPMatt/ikea_e1743.yaml",
                            "input": {
                                "integration": "ZHA",
                                "controller_device": "ea611248af61d7f5dc06e3a824288132",
                                "helper_last_controller_event": "input_text.zz_elena_s_room_fan_controller_last_event",
                                "action_button_up_short": [
                                    {
                                        "service": "fan.turn_on",
                                        "target": {
                                            "entity_id": "fan.elenas_room_fan"
                                        }
                                    }
                                ],
                                "action_button_up_long": [
                                    {
                                        "service": "fan.increase_speed",
                                        "target": {
                                            "entity_id": "fan.elenas_room_fan"
                                        }
                                    }
                                ],
                                "action_button_down_short": [
                                    {
                                        "service": "fan.turn_off",
                                        "target": {
                                            "entity_id": "fan.elenas_room_fan"
                                        }
                                    }
                                ],
                                "action_button_down_long": [
                                    {
                                        "service": "fan.decrease_speed",
                                        "target": {
                                            "entity_id": "fan.elenas_room_fan"
                                        }
                                    }
                                ]
                            }
                        }
                    },
                    "context": {
                        "id": "bcdbb2f72f602b3d003556be8755d74d",
                        "parent_id": "2096033fc5dfa1d9957c8dc0b2edb6f3",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "3eaa1a1130749b1aaae2f205f4d08abf",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T06:02:25.800515+00:00",
                        "finish": "2022-03-03T06:02:25.809548+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643645804516",
                    "trigger": "event 'zha_event'"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "eee2030b8c33149a8a2c521e6f2ee8c7",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T06:59:03.794251+00:00",
                        "finish": "2022-03-03T06:59:03.801364+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643645804516",
                    "trigger": "event 'zha_event'",
                    "trace": {
                        "trigger/1": [
                            {
                                "path": "trigger/1",
                                "timestamp": "2022-03-03T06:59:03.795190+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.elenas_room_fan_controller",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T06:02:25.801669+00:00",
                                            "mode": "restart",
                                            "current": 0,
                                            "id": "1643645804516",
                                            "friendly_name": "Elena's Room Fan Controller"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.799214+00:00",
                                        "last_updated": "2022-03-03T06:02:25.808606+00:00",
                                        "context": {
                                            "id": "bcdbb2f72f602b3d003556be8755d74d",
                                            "parent_id": "2096033fc5dfa1d9957c8dc0b2edb6f3",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "1",
                                        "idx": "1",
                                        "platform": "event",
                                        "event": {
                                            "event_type": "zha_event",
                                            "data": {
                                                "device_ieee": "84:fd:27:ff:fe:3b:78:94",
                                                "unique_id": "84:fd:27:ff:fe:3b:78:94:1:0x0020",
                                                "device_id": "ea611248af61d7f5dc06e3a824288132",
                                                "endpoint_id": 1,
                                                "cluster_id": 32,
                                                "command": "checkin",
                                                "args": []
                                            },
                                            "origin": "LOCAL",
                                            "time_fired": "2022-03-03T06:59:03.793337+00:00",
                                            "context": {
                                                "id": "d4f8538da0e51753628b64581ab06aac",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "description": "event 'zha_event'"
                                    },
                                    "integration": "ZHA",
                                    "button_up_long_loop": false,
                                    "button_up_long_max_loop_repeats": 500,
                                    "button_up_double_press": false,
                                    "button_down_long_loop": false,
                                    "button_down_long_max_loop_repeats": 500,
                                    "button_down_double_press": false,
                                    "helper_last_controller_event": "input_text.zz_elena_s_room_fan_controller_last_event",
                                    "helper_double_press_delay": 500,
                                    "helper_debounce_delay": 0,
                                    "integration_id": "zha",
                                    "adjusted_double_press_delay": 500,
                                    "actions_mapping": {
                                        "deconz": {
                                            "button_up_short": [
                                                "1002"
                                            ],
                                            "button_up_long": [
                                                "1001"
                                            ],
                                            "button_up_release": [
                                                "1003"
                                            ],
                                            "button_down_short": [
                                                "2002"
                                            ],
                                            "button_down_long": [
                                                "2001"
                                            ],
                                            "button_down_release": [
                                                "2003"
                                            ]
                                        },
                                        "zha": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "move_with_on_off_0_83"
                                            ],
                                            "button_up_release": [
                                                "stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "move_1_83"
                                            ],
                                            "button_down_release": [
                                                "stop"
                                            ]
                                        },
                                        "zigbee2mqtt": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "brightness_move_up"
                                            ],
                                            "button_up_release": [
                                                "brightness_stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "brightness_move_down"
                                            ],
                                            "button_down_release": [
                                                "brightness_stop"
                                            ]
                                        }
                                    },
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ],
                                    "integrations_with_prev_event_storage": [
                                        "zha",
                                        "zigbee2mqtt"
                                    ],
                                    "controller_entity": "",
                                    "controller_device": "ea611248af61d7f5dc06e3a824288132",
                                    "controller_id": "ea611248af61d7f5dc06e3a824288132"
                                }
                            }
                        ],
                        "condition/0": [
                            {
                                "path": "condition/0",
                                "timestamp": "2022-03-03T06:59:03.795230+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "condition/0/conditions/0": [
                            {
                                "path": "condition/0/conditions/0",
                                "timestamp": "2022-03-03T06:59:03.795248+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "condition/0/conditions/1": [
                            {
                                "path": "condition/0/conditions/1",
                                "timestamp": "2022-03-03T06:59:03.795382+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T06:59:03.796183+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "788b797d391a657005c8fd50d77bfe2f",
                                        "parent_id": "d4f8538da0e51753628b64581ab06aac",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "delay": 0.0,
                                    "done": true
                                }
                            }
                        ],
                        "action/1": [
                            {
                                "path": "action/1",
                                "timestamp": "2022-03-03T06:59:03.797228+00:00"
                            }
                        ],
                        "action/2": [
                            {
                                "path": "action/2",
                                "timestamp": "2022-03-03T06:59:03.797985+00:00",
                                "changed_variables": {
                                    "trigger_action": "checkin",
                                    "trigger_delta": 3397992.9530620575,
                                    "last_controller_event": "checkin"
                                },
                                "result": {
                                    "params": {
                                        "domain": "input_text",
                                        "service": "set_value",
                                        "service_data": {
                                            "entity_id": "input_text.zz_elena_s_room_fan_controller_last_event",
                                            "value": {
                                                "trigger_action": "checkin",
                                                "last_triggered": "2022-03-03 14:59:03.798901+08:00"
                                            }
                                        },
                                        "target": {}
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "action/3": [
                            {
                                "path": "action/3",
                                "timestamp": "2022-03-03T06:59:03.800293+00:00"
                            }
                        ],
                        "action/3/choose/0": [
                            {
                                "path": "action/3/choose/0",
                                "timestamp": "2022-03-03T06:59:03.800351+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/0/conditions/0": [
                            {
                                "path": "action/3/choose/0/conditions/0",
                                "timestamp": "2022-03-03T06:59:03.800373+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/1": [
                            {
                                "path": "action/3/choose/1",
                                "timestamp": "2022-03-03T06:59:03.800483+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/1/conditions/0": [
                            {
                                "path": "action/3/choose/1/conditions/0",
                                "timestamp": "2022-03-03T06:59:03.800503+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/2": [
                            {
                                "path": "action/3/choose/2",
                                "timestamp": "2022-03-03T06:59:03.800594+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/2/conditions/0": [
                            {
                                "path": "action/3/choose/2/conditions/0",
                                "timestamp": "2022-03-03T06:59:03.800619+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/3": [
                            {
                                "path": "action/3/choose/3",
                                "timestamp": "2022-03-03T06:59:03.800720+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/3/conditions/0": [
                            {
                                "path": "action/3/choose/3/conditions/0",
                                "timestamp": "2022-03-03T06:59:03.800741+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/4": [
                            {
                                "path": "action/3/choose/4",
                                "timestamp": "2022-03-03T06:59:03.800821+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/4/conditions/0": [
                            {
                                "path": "action/3/choose/4/conditions/0",
                                "timestamp": "2022-03-03T06:59:03.800839+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/5": [
                            {
                                "path": "action/3/choose/5",
                                "timestamp": "2022-03-03T06:59:03.800903+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/5/conditions/0": [
                            {
                                "path": "action/3/choose/5/conditions/0",
                                "timestamp": "2022-03-03T06:59:03.800920+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ]
                    },
                    "config": {
                        "variables": {
                            "integration": "ZHA",
                            "button_up_long_loop": false,
                            "button_up_long_max_loop_repeats": 500,
                            "button_up_double_press": false,
                            "button_down_long_loop": false,
                            "button_down_long_max_loop_repeats": 500,
                            "button_down_double_press": false,
                            "helper_last_controller_event": "input_text.zz_elena_s_room_fan_controller_last_event",
                            "helper_double_press_delay": 500,
                            "helper_debounce_delay": 0,
                            "integration_id": "{{ integration | lower }}",
                            "adjusted_double_press_delay": "{{ [helper_double_press_delay - helper_debounce_delay, 100] | max }}",
                            "actions_mapping": {
                                "deconz": {
                                    "button_up_short": [
                                        "1002"
                                    ],
                                    "button_up_long": [
                                        "1001"
                                    ],
                                    "button_up_release": [
                                        "1003"
                                    ],
                                    "button_down_short": [
                                        "2002"
                                    ],
                                    "button_down_long": [
                                        "2001"
                                    ],
                                    "button_down_release": [
                                        "2003"
                                    ]
                                },
                                "zha": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ]
                                },
                                "zigbee2mqtt": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "brightness_move_up"
                                    ],
                                    "button_up_release": [
                                        "brightness_stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "brightness_move_down"
                                    ],
                                    "button_down_release": [
                                        "brightness_stop"
                                    ]
                                }
                            },
                            "button_up_short": "{{ actions_mapping[integration_id][\"button_up_short\"] }}",
                            "button_up_long": "{{ actions_mapping[integration_id][\"button_up_long\"] }}",
                            "button_up_release": "{{ actions_mapping[integration_id][\"button_up_release\"] }}",
                            "button_down_short": "{{ actions_mapping[integration_id][\"button_down_short\"] }}",
                            "button_down_long": "{{ actions_mapping[integration_id][\"button_down_long\"] }}",
                            "button_down_release": "{{ actions_mapping[integration_id][\"button_down_release\"] }}",
                            "integrations_with_prev_event_storage": [
                                "zha",
                                "zigbee2mqtt"
                            ],
                            "controller_entity": "",
                            "controller_device": "ea611248af61d7f5dc06e3a824288132",
                            "controller_id": "{% if integration_id==\"zigbee2mqtt\" %}{{controller_entity}}{% else %}{{controller_device}}{% endif %}"
                        },
                        "mode": "restart",
                        "max_exceeded": "silent",
                        "trigger": [
                            {
                                "platform": "event",
                                "event_type": "state_changed",
                                "event_data": {
                                    "entity_id": ""
                                }
                            },
                            {
                                "platform": "event",
                                "event_type": [
                                    "deconz_event",
                                    "zha_event"
                                ],
                                "event_data": {
                                    "device_id": "ea611248af61d7f5dc06e3a824288132"
                                }
                            }
                        ],
                        "condition": [
                            {
                                "condition": "and",
                                "conditions": [
                                    "{%- set trigger_action -%} {%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%} {%- endset -%} {{ trigger_action not in [\"\",\"None\"] }}",
                                    "{{ integration_id != \"zigbee2mqtt\" or trigger.event.data.new_state.state != trigger.event.data.old_state.state }}"
                                ]
                            }
                        ],
                        "action": [
                            {
                                "delay": {
                                    "milliseconds": 0
                                }
                            },
                            {
                                "variables": {
                                    "trigger_action": "{%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%}",
                                    "trigger_delta": "{{ (as_timestamp(now()) - as_timestamp((states(helper_last_controller_event) | from_json).last_triggered if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"1970-01-01 00:00:00\")) * 1000 }}",
                                    "last_controller_event": "{{ (states(helper_last_controller_event) | from_json).trigger_action if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"\" }}"
                                }
                            },
                            {
                                "service": "input_text.set_value",
                                "data": {
                                    "entity_id": "input_text.zz_elena_s_room_fan_controller_last_event",
                                    "value": "{{ {\"trigger_action\":trigger_action,\"last_triggered\":now()|string} | to_json }}"
                                }
                            },
                            {
                                "choose": [
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_elena_s_room_fan_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_up_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_up_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "fan.turn_on",
                                                                                        "target": {
                                                                                            "entity_id": "fan.elenas_room_fan"
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_up_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "fan.turn_on",
                                                                        "target": {
                                                                            "entity_id": "fan.elenas_room_fan"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_up_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "fan.increase_speed",
                                                                            "target": {
                                                                                "entity_id": "fan.elenas_room_fan"
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "fan.increase_speed",
                                                        "target": {
                                                            "entity_id": "fan.elenas_room_fan"
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_up_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_up_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_elena_s_room_fan_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_down_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_down_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "fan.turn_off",
                                                                                        "target": {
                                                                                            "entity_id": "fan.elenas_room_fan"
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_down_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "fan.turn_off",
                                                                        "target": {
                                                                            "entity_id": "fan.elenas_room_fan"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_down_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "fan.decrease_speed",
                                                                            "target": {
                                                                                "entity_id": "fan.elenas_room_fan"
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "fan.decrease_speed",
                                                        "target": {
                                                            "entity_id": "fan.elenas_room_fan"
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_down_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_down_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            }
                        ],
                        "id": "1643645804516",
                        "alias": "Elena's Room Fan Controller",
                        "description": "Control Elena's Room Fan"
                    },
                    "blueprint_inputs": {
                        "id": "1643645804516",
                        "alias": "Elena's Room Fan Controller",
                        "description": "Control Elena's Room Fan",
                        "use_blueprint": {
                            "path": "EPMatt/ikea_e1743.yaml",
                            "input": {
                                "integration": "ZHA",
                                "controller_device": "ea611248af61d7f5dc06e3a824288132",
                                "helper_last_controller_event": "input_text.zz_elena_s_room_fan_controller_last_event",
                                "action_button_up_short": [
                                    {
                                        "service": "fan.turn_on",
                                        "target": {
                                            "entity_id": "fan.elenas_room_fan"
                                        }
                                    }
                                ],
                                "action_button_up_long": [
                                    {
                                        "service": "fan.increase_speed",
                                        "target": {
                                            "entity_id": "fan.elenas_room_fan"
                                        }
                                    }
                                ],
                                "action_button_down_short": [
                                    {
                                        "service": "fan.turn_off",
                                        "target": {
                                            "entity_id": "fan.elenas_room_fan"
                                        }
                                    }
                                ],
                                "action_button_down_long": [
                                    {
                                        "service": "fan.decrease_speed",
                                        "target": {
                                            "entity_id": "fan.elenas_room_fan"
                                        }
                                    }
                                ]
                            }
                        }
                    },
                    "context": {
                        "id": "788b797d391a657005c8fd50d77bfe2f",
                        "parent_id": "d4f8538da0e51753628b64581ab06aac",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "eee2030b8c33149a8a2c521e6f2ee8c7",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T06:59:03.794251+00:00",
                        "finish": "2022-03-03T06:59:03.801364+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643645804516",
                    "trigger": "event 'zha_event'"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "2df1b4b67a02f245b19e0993c5ef40f9",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T07:55:41.798089+00:00",
                        "finish": "2022-03-03T07:55:41.804590+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643645804516",
                    "trigger": "event 'zha_event'",
                    "trace": {
                        "trigger/1": [
                            {
                                "path": "trigger/1",
                                "timestamp": "2022-03-03T07:55:41.798849+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.elenas_room_fan_controller",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T06:59:03.795581+00:00",
                                            "mode": "restart",
                                            "current": 0,
                                            "id": "1643645804516",
                                            "friendly_name": "Elena's Room Fan Controller"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.799214+00:00",
                                        "last_updated": "2022-03-03T06:59:03.801046+00:00",
                                        "context": {
                                            "id": "788b797d391a657005c8fd50d77bfe2f",
                                            "parent_id": "d4f8538da0e51753628b64581ab06aac",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "1",
                                        "idx": "1",
                                        "platform": "event",
                                        "event": {
                                            "event_type": "zha_event",
                                            "data": {
                                                "device_ieee": "84:fd:27:ff:fe:3b:78:94",
                                                "unique_id": "84:fd:27:ff:fe:3b:78:94:1:0x0020",
                                                "device_id": "ea611248af61d7f5dc06e3a824288132",
                                                "endpoint_id": 1,
                                                "cluster_id": 32,
                                                "command": "checkin",
                                                "args": []
                                            },
                                            "origin": "LOCAL",
                                            "time_fired": "2022-03-03T07:55:41.796622+00:00",
                                            "context": {
                                                "id": "864c269bf4fb13d23c6e39112c3bfb41",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "description": "event 'zha_event'"
                                    },
                                    "integration": "ZHA",
                                    "button_up_long_loop": false,
                                    "button_up_long_max_loop_repeats": 500,
                                    "button_up_double_press": false,
                                    "button_down_long_loop": false,
                                    "button_down_long_max_loop_repeats": 500,
                                    "button_down_double_press": false,
                                    "helper_last_controller_event": "input_text.zz_elena_s_room_fan_controller_last_event",
                                    "helper_double_press_delay": 500,
                                    "helper_debounce_delay": 0,
                                    "integration_id": "zha",
                                    "adjusted_double_press_delay": 500,
                                    "actions_mapping": {
                                        "deconz": {
                                            "button_up_short": [
                                                "1002"
                                            ],
                                            "button_up_long": [
                                                "1001"
                                            ],
                                            "button_up_release": [
                                                "1003"
                                            ],
                                            "button_down_short": [
                                                "2002"
                                            ],
                                            "button_down_long": [
                                                "2001"
                                            ],
                                            "button_down_release": [
                                                "2003"
                                            ]
                                        },
                                        "zha": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "move_with_on_off_0_83"
                                            ],
                                            "button_up_release": [
                                                "stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "move_1_83"
                                            ],
                                            "button_down_release": [
                                                "stop"
                                            ]
                                        },
                                        "zigbee2mqtt": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "brightness_move_up"
                                            ],
                                            "button_up_release": [
                                                "brightness_stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "brightness_move_down"
                                            ],
                                            "button_down_release": [
                                                "brightness_stop"
                                            ]
                                        }
                                    },
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ],
                                    "integrations_with_prev_event_storage": [
                                        "zha",
                                        "zigbee2mqtt"
                                    ],
                                    "controller_entity": "",
                                    "controller_device": "ea611248af61d7f5dc06e3a824288132",
                                    "controller_id": "ea611248af61d7f5dc06e3a824288132"
                                }
                            }
                        ],
                        "condition/0": [
                            {
                                "path": "condition/0",
                                "timestamp": "2022-03-03T07:55:41.798881+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "condition/0/conditions/0": [
                            {
                                "path": "condition/0/conditions/0",
                                "timestamp": "2022-03-03T07:55:41.798899+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "condition/0/conditions/1": [
                            {
                                "path": "condition/0/conditions/1",
                                "timestamp": "2022-03-03T07:55:41.799032+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T07:55:41.799842+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "b0bb38e793613154bfb3e479748a299d",
                                        "parent_id": "864c269bf4fb13d23c6e39112c3bfb41",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "delay": 0.0,
                                    "done": true
                                }
                            }
                        ],
                        "action/1": [
                            {
                                "path": "action/1",
                                "timestamp": "2022-03-03T07:55:41.800845+00:00"
                            }
                        ],
                        "action/2": [
                            {
                                "path": "action/2",
                                "timestamp": "2022-03-03T07:55:41.801586+00:00",
                                "changed_variables": {
                                    "trigger_action": "checkin",
                                    "trigger_delta": 3398002.3279190063,
                                    "last_controller_event": "checkin"
                                },
                                "result": {
                                    "params": {
                                        "domain": "input_text",
                                        "service": "set_value",
                                        "service_data": {
                                            "entity_id": "input_text.zz_elena_s_room_fan_controller_last_event",
                                            "value": {
                                                "trigger_action": "checkin",
                                                "last_triggered": "2022-03-03 15:55:41.801739+08:00"
                                            }
                                        },
                                        "target": {}
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "action/3": [
                            {
                                "path": "action/3",
                                "timestamp": "2022-03-03T07:55:41.803127+00:00"
                            }
                        ],
                        "action/3/choose/0": [
                            {
                                "path": "action/3/choose/0",
                                "timestamp": "2022-03-03T07:55:41.803182+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/0/conditions/0": [
                            {
                                "path": "action/3/choose/0/conditions/0",
                                "timestamp": "2022-03-03T07:55:41.803204+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/1": [
                            {
                                "path": "action/3/choose/1",
                                "timestamp": "2022-03-03T07:55:41.803318+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/1/conditions/0": [
                            {
                                "path": "action/3/choose/1/conditions/0",
                                "timestamp": "2022-03-03T07:55:41.803364+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/2": [
                            {
                                "path": "action/3/choose/2",
                                "timestamp": "2022-03-03T07:55:41.803441+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/2/conditions/0": [
                            {
                                "path": "action/3/choose/2/conditions/0",
                                "timestamp": "2022-03-03T07:55:41.803460+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/3": [
                            {
                                "path": "action/3/choose/3",
                                "timestamp": "2022-03-03T07:55:41.803535+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/3/conditions/0": [
                            {
                                "path": "action/3/choose/3/conditions/0",
                                "timestamp": "2022-03-03T07:55:41.803553+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/4": [
                            {
                                "path": "action/3/choose/4",
                                "timestamp": "2022-03-03T07:55:41.803625+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/4/conditions/0": [
                            {
                                "path": "action/3/choose/4/conditions/0",
                                "timestamp": "2022-03-03T07:55:41.803643+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/5": [
                            {
                                "path": "action/3/choose/5",
                                "timestamp": "2022-03-03T07:55:41.803739+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/5/conditions/0": [
                            {
                                "path": "action/3/choose/5/conditions/0",
                                "timestamp": "2022-03-03T07:55:41.803759+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ]
                    },
                    "config": {
                        "variables": {
                            "integration": "ZHA",
                            "button_up_long_loop": false,
                            "button_up_long_max_loop_repeats": 500,
                            "button_up_double_press": false,
                            "button_down_long_loop": false,
                            "button_down_long_max_loop_repeats": 500,
                            "button_down_double_press": false,
                            "helper_last_controller_event": "input_text.zz_elena_s_room_fan_controller_last_event",
                            "helper_double_press_delay": 500,
                            "helper_debounce_delay": 0,
                            "integration_id": "{{ integration | lower }}",
                            "adjusted_double_press_delay": "{{ [helper_double_press_delay - helper_debounce_delay, 100] | max }}",
                            "actions_mapping": {
                                "deconz": {
                                    "button_up_short": [
                                        "1002"
                                    ],
                                    "button_up_long": [
                                        "1001"
                                    ],
                                    "button_up_release": [
                                        "1003"
                                    ],
                                    "button_down_short": [
                                        "2002"
                                    ],
                                    "button_down_long": [
                                        "2001"
                                    ],
                                    "button_down_release": [
                                        "2003"
                                    ]
                                },
                                "zha": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ]
                                },
                                "zigbee2mqtt": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "brightness_move_up"
                                    ],
                                    "button_up_release": [
                                        "brightness_stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "brightness_move_down"
                                    ],
                                    "button_down_release": [
                                        "brightness_stop"
                                    ]
                                }
                            },
                            "button_up_short": "{{ actions_mapping[integration_id][\"button_up_short\"] }}",
                            "button_up_long": "{{ actions_mapping[integration_id][\"button_up_long\"] }}",
                            "button_up_release": "{{ actions_mapping[integration_id][\"button_up_release\"] }}",
                            "button_down_short": "{{ actions_mapping[integration_id][\"button_down_short\"] }}",
                            "button_down_long": "{{ actions_mapping[integration_id][\"button_down_long\"] }}",
                            "button_down_release": "{{ actions_mapping[integration_id][\"button_down_release\"] }}",
                            "integrations_with_prev_event_storage": [
                                "zha",
                                "zigbee2mqtt"
                            ],
                            "controller_entity": "",
                            "controller_device": "ea611248af61d7f5dc06e3a824288132",
                            "controller_id": "{% if integration_id==\"zigbee2mqtt\" %}{{controller_entity}}{% else %}{{controller_device}}{% endif %}"
                        },
                        "mode": "restart",
                        "max_exceeded": "silent",
                        "trigger": [
                            {
                                "platform": "event",
                                "event_type": "state_changed",
                                "event_data": {
                                    "entity_id": ""
                                }
                            },
                            {
                                "platform": "event",
                                "event_type": [
                                    "deconz_event",
                                    "zha_event"
                                ],
                                "event_data": {
                                    "device_id": "ea611248af61d7f5dc06e3a824288132"
                                }
                            }
                        ],
                        "condition": [
                            {
                                "condition": "and",
                                "conditions": [
                                    "{%- set trigger_action -%} {%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%} {%- endset -%} {{ trigger_action not in [\"\",\"None\"] }}",
                                    "{{ integration_id != \"zigbee2mqtt\" or trigger.event.data.new_state.state != trigger.event.data.old_state.state }}"
                                ]
                            }
                        ],
                        "action": [
                            {
                                "delay": {
                                    "milliseconds": 0
                                }
                            },
                            {
                                "variables": {
                                    "trigger_action": "{%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%}",
                                    "trigger_delta": "{{ (as_timestamp(now()) - as_timestamp((states(helper_last_controller_event) | from_json).last_triggered if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"1970-01-01 00:00:00\")) * 1000 }}",
                                    "last_controller_event": "{{ (states(helper_last_controller_event) | from_json).trigger_action if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"\" }}"
                                }
                            },
                            {
                                "service": "input_text.set_value",
                                "data": {
                                    "entity_id": "input_text.zz_elena_s_room_fan_controller_last_event",
                                    "value": "{{ {\"trigger_action\":trigger_action,\"last_triggered\":now()|string} | to_json }}"
                                }
                            },
                            {
                                "choose": [
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_elena_s_room_fan_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_up_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_up_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "fan.turn_on",
                                                                                        "target": {
                                                                                            "entity_id": "fan.elenas_room_fan"
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_up_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "fan.turn_on",
                                                                        "target": {
                                                                            "entity_id": "fan.elenas_room_fan"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_up_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "fan.increase_speed",
                                                                            "target": {
                                                                                "entity_id": "fan.elenas_room_fan"
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "fan.increase_speed",
                                                        "target": {
                                                            "entity_id": "fan.elenas_room_fan"
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_up_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_up_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_elena_s_room_fan_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_down_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_down_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "fan.turn_off",
                                                                                        "target": {
                                                                                            "entity_id": "fan.elenas_room_fan"
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_down_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "fan.turn_off",
                                                                        "target": {
                                                                            "entity_id": "fan.elenas_room_fan"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_down_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "fan.decrease_speed",
                                                                            "target": {
                                                                                "entity_id": "fan.elenas_room_fan"
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "fan.decrease_speed",
                                                        "target": {
                                                            "entity_id": "fan.elenas_room_fan"
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_down_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_down_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            }
                        ],
                        "id": "1643645804516",
                        "alias": "Elena's Room Fan Controller",
                        "description": "Control Elena's Room Fan"
                    },
                    "blueprint_inputs": {
                        "id": "1643645804516",
                        "alias": "Elena's Room Fan Controller",
                        "description": "Control Elena's Room Fan",
                        "use_blueprint": {
                            "path": "EPMatt/ikea_e1743.yaml",
                            "input": {
                                "integration": "ZHA",
                                "controller_device": "ea611248af61d7f5dc06e3a824288132",
                                "helper_last_controller_event": "input_text.zz_elena_s_room_fan_controller_last_event",
                                "action_button_up_short": [
                                    {
                                        "service": "fan.turn_on",
                                        "target": {
                                            "entity_id": "fan.elenas_room_fan"
                                        }
                                    }
                                ],
                                "action_button_up_long": [
                                    {
                                        "service": "fan.increase_speed",
                                        "target": {
                                            "entity_id": "fan.elenas_room_fan"
                                        }
                                    }
                                ],
                                "action_button_down_short": [
                                    {
                                        "service": "fan.turn_off",
                                        "target": {
                                            "entity_id": "fan.elenas_room_fan"
                                        }
                                    }
                                ],
                                "action_button_down_long": [
                                    {
                                        "service": "fan.decrease_speed",
                                        "target": {
                                            "entity_id": "fan.elenas_room_fan"
                                        }
                                    }
                                ]
                            }
                        }
                    },
                    "context": {
                        "id": "b0bb38e793613154bfb3e479748a299d",
                        "parent_id": "864c269bf4fb13d23c6e39112c3bfb41",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "2df1b4b67a02f245b19e0993c5ef40f9",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T07:55:41.798089+00:00",
                        "finish": "2022-03-03T07:55:41.804590+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643645804516",
                    "trigger": "event 'zha_event'"
                }
            }
        ],
        "automation.1643645667838": [
            {
                "extended_dict": {
                    "last_step": "action/0/choose/9/conditions/0",
                    "run_id": "522c31de8f0300af5352e57666a59363",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T03:19:00.450937+00:00",
                        "finish": "2022-03-03T03:19:00.456085+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643645667838",
                    "trigger": "event 'zha_event'",
                    "trace": {
                        "trigger/0": [
                            {
                                "path": "trigger/0",
                                "timestamp": "2022-03-03T03:19:00.450992+00:00",
                                "changed_variables": {
                                    "var_light": "light.elis_room_lights",
                                    "var_speed": 500,
                                    "this": {
                                        "entity_id": "automation.elis_room_lights_controller",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T02:22:16.620629+00:00",
                                            "mode": "restart",
                                            "current": 0,
                                            "id": "1643645667838",
                                            "friendly_name": "Eli's Room Lights Controller"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.799100+00:00",
                                        "last_updated": "2022-03-03T02:22:16.623963+00:00",
                                        "context": {
                                            "id": "5cde6abaa9aa83c7f7419e6290c0ccd0",
                                            "parent_id": "6b57674180f2de3080efeff2c002967a",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "0",
                                        "idx": "0",
                                        "platform": "event",
                                        "event": {
                                            "event_type": "zha_event",
                                            "data": {
                                                "device_ieee": "84:fd:27:ff:fe:1b:9a:43",
                                                "unique_id": "84:fd:27:ff:fe:1b:9a:43:1:0x0020",
                                                "device_id": "4f9d115057150510080b9cde7008bb35",
                                                "endpoint_id": 1,
                                                "cluster_id": 32,
                                                "command": "checkin",
                                                "args": []
                                            },
                                            "origin": "LOCAL",
                                            "time_fired": "2022-03-03T03:19:00.450006+00:00",
                                            "context": {
                                                "id": "74d55b51d20b5bd057bd10a1e05e6c48",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "description": "event 'zha_event'"
                                    }
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T03:19:00.451804+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "f45e6465cc26fe344d51e03418c082da",
                                        "parent_id": "74d55b51d20b5bd057bd10a1e05e6c48",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "choice": "default"
                                }
                            }
                        ],
                        "action/0/choose/0": [
                            {
                                "path": "action/0/choose/0",
                                "timestamp": "2022-03-03T03:19:00.451862+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/0/conditions/0",
                                "timestamp": "2022-03-03T03:19:00.453364+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0/choose/1": [
                            {
                                "path": "action/0/choose/1",
                                "timestamp": "2022-03-03T03:19:00.453558+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/1/conditions/0": [
                            {
                                "path": "action/0/choose/1/conditions/0",
                                "timestamp": "2022-03-03T03:19:00.453580+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0/choose/2": [
                            {
                                "path": "action/0/choose/2",
                                "timestamp": "2022-03-03T03:19:00.453713+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/2/conditions/0": [
                            {
                                "path": "action/0/choose/2/conditions/0",
                                "timestamp": "2022-03-03T03:19:00.453733+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0/choose/3": [
                            {
                                "path": "action/0/choose/3",
                                "timestamp": "2022-03-03T03:19:00.453832+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/3/conditions/0": [
                            {
                                "path": "action/0/choose/3/conditions/0",
                                "timestamp": "2022-03-03T03:19:00.453848+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0/choose/4": [
                            {
                                "path": "action/0/choose/4",
                                "timestamp": "2022-03-03T03:19:00.453931+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/4/conditions/0": [
                            {
                                "path": "action/0/choose/4/conditions/0",
                                "timestamp": "2022-03-03T03:19:00.453947+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0/choose/5": [
                            {
                                "path": "action/0/choose/5",
                                "timestamp": "2022-03-03T03:19:00.454029+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/5/conditions/0": [
                            {
                                "path": "action/0/choose/5/conditions/0",
                                "timestamp": "2022-03-03T03:19:00.454048+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0/choose/6": [
                            {
                                "path": "action/0/choose/6",
                                "timestamp": "2022-03-03T03:19:00.454130+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/6/conditions/0": [
                            {
                                "path": "action/0/choose/6/conditions/0",
                                "timestamp": "2022-03-03T03:19:00.454145+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0/choose/7": [
                            {
                                "path": "action/0/choose/7",
                                "timestamp": "2022-03-03T03:19:00.454216+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/7/conditions/0": [
                            {
                                "path": "action/0/choose/7/conditions/0",
                                "timestamp": "2022-03-03T03:19:00.454231+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0/choose/8": [
                            {
                                "path": "action/0/choose/8",
                                "timestamp": "2022-03-03T03:19:00.454297+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/8/conditions/0": [
                            {
                                "path": "action/0/choose/8/conditions/0",
                                "timestamp": "2022-03-03T03:19:00.454311+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0/choose/9": [
                            {
                                "path": "action/0/choose/9",
                                "timestamp": "2022-03-03T03:19:00.454374+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/9/conditions/0": [
                            {
                                "path": "action/0/choose/9/conditions/0",
                                "timestamp": "2022-03-03T03:19:00.454387+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ]
                    },
                    "config": {
                        "mode": "restart",
                        "max_exceeded": "silent",
                        "variables": {
                            "var_light": "light.elis_room_lights",
                            "var_speed": 500
                        },
                        "trigger": [
                            {
                                "platform": "event",
                                "event_type": "zha_event",
                                "event_data": {
                                    "device_id": "4f9d115057150510080b9cde7008bb35"
                                }
                            }
                        ],
                        "action": [
                            {
                                "choose": [
                                    {
                                        "conditions": [
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.command == \"toggle\" }}"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "light.toggle",
                                                "target": {
                                                    "entity_id": "light.elis_room_lights"
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.command == \"move_to_level_with_on_off\" }}"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "light.turn_on",
                                                "target": {
                                                    "entity_id": "light.elis_room_lights"
                                                },
                                                "data": {
                                                    "brightness": 254,
                                                    "color_temp": 400
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.command == \"step_with_on_off\" }}"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "light.turn_on",
                                                "target": {
                                                    "entity_id": "light.elis_room_lights"
                                                },
                                                "data": {
                                                    "brightness_step_pct": 20,
                                                    "transition": "{{ (var_speed / 1000)|float }}"
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.command == \"move_with_on_off\" }}"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "repeat": {
                                                    "while": [],
                                                    "sequence": [
                                                        {
                                                            "service": "light.turn_on",
                                                            "target": {
                                                                "entity_id": "light.elis_room_lights"
                                                            },
                                                            "data": {
                                                                "brightness_step_pct": 10,
                                                                "transition": "{{ (var_speed / 1000)|float }}"
                                                            }
                                                        },
                                                        {
                                                            "delay": {
                                                                "milliseconds": 500
                                                            }
                                                        }
                                                    ]
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.command == \"step\" }}"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "light.turn_on",
                                                "target": {
                                                    "entity_id": "light.elis_room_lights"
                                                },
                                                "data": {
                                                    "brightness_step_pct": -20,
                                                    "transition": "{{ (var_speed / 1000)|float }}"
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.command == \"move\" }}"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "repeat": {
                                                    "while": [],
                                                    "sequence": [
                                                        {
                                                            "service": "light.turn_on",
                                                            "target": {
                                                                "entity_id": "light.elis_room_lights"
                                                            },
                                                            "data": {
                                                                "brightness_step_pct": -10,
                                                                "transition": "{{ (var_speed / 1000)|float }}"
                                                            }
                                                        },
                                                        {
                                                            "delay": {
                                                                "milliseconds": 500
                                                            }
                                                        }
                                                    ]
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.command == \"press\" }}"
                                            },
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.args == [256,13,0] }}"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "light.turn_on",
                                                "target": {
                                                    "entity_id": "light.elis_room_lights"
                                                },
                                                "data": {
                                                    "color_temp": "{% if state_attr(var_light, \"color_temp\") - 18 < 153 %}\n  {{ 153 }}\n{% else %}\n  {{ state_attr(var_light, \"color_temp\") - 18 }}\n{% endif %}",
                                                    "transition": "{{ (var_speed / 1000)|float }}"
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.command == \"hold\" }}"
                                            },
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.args == [3328,0] }}"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "repeat": {
                                                    "while": [],
                                                    "sequence": [
                                                        {
                                                            "service": "light.turn_on",
                                                            "target": {
                                                                "entity_id": "light.elis_room_lights"
                                                            },
                                                            "data": {
                                                                "color_temp": "{% if state_attr(var_light, \"color_temp\") - 18 < 153 %}\n  {{ 153 }}\n{% else %}\n  {{ state_attr(var_light, \"color_temp\") - 18 }}\n{% endif %}",
                                                                "transition": "{{ (var_speed / 1000)|float }}"
                                                            }
                                                        },
                                                        {
                                                            "delay": {
                                                                "milliseconds": 500
                                                            }
                                                        }
                                                    ]
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.command == \"press\" }}"
                                            },
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.args == [257,13,0] }}"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "light.turn_on",
                                                "target": {
                                                    "entity_id": "light.elis_room_lights"
                                                },
                                                "data": {
                                                    "color_temp": "{% if state_attr(var_light, \"color_temp\") + 18 > 500 %}\n  {{ 500 }}\n{% else %}\n  {{ state_attr(var_light, \"color_temp\") + 18 }}\n{% endif %}",
                                                    "transition": "{{ (var_speed / 1000)|float }}"
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.command == \"hold\" }}"
                                            },
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.args == [3329,0] }}"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "repeat": {
                                                    "while": [],
                                                    "sequence": [
                                                        {
                                                            "service": "light.turn_on",
                                                            "target": {
                                                                "entity_id": "light.elis_room_lights"
                                                            },
                                                            "data": {
                                                                "color_temp": "{% if state_attr(var_light, \"color_temp\") + 18 > 500 %}\n  {{ 500 }}\n{% else %}\n  {{ state_attr(var_light, \"color_temp\") + 18 }}\n{% endif %}",
                                                                "transition": "{{ (var_speed / 1000)|float }}"
                                                            }
                                                        },
                                                        {
                                                            "delay": {
                                                                "milliseconds": 500
                                                            }
                                                        }
                                                    ]
                                                }
                                            }
                                        ]
                                    }
                                ],
                                "default": []
                            }
                        ],
                        "id": "1643645667838",
                        "alias": "Eli's Room Lights Controller",
                        "description": "Control Eli's Room Lights"
                    },
                    "blueprint_inputs": {
                        "id": "1643645667838",
                        "alias": "Eli's Room Lights Controller",
                        "description": "Control Eli's Room Lights",
                        "use_blueprint": {
                            "path": "niro1987/zha_ikea_tradfri_5button_remote_white.yaml",
                            "input": {
                                "remote": "4f9d115057150510080b9cde7008bb35",
                                "light": "light.elis_room_lights"
                            }
                        }
                    },
                    "context": {
                        "id": "f45e6465cc26fe344d51e03418c082da",
                        "parent_id": "74d55b51d20b5bd057bd10a1e05e6c48",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/0/choose/9/conditions/0",
                    "run_id": "522c31de8f0300af5352e57666a59363",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T03:19:00.450937+00:00",
                        "finish": "2022-03-03T03:19:00.456085+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643645667838",
                    "trigger": "event 'zha_event'"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/0/choose/9/conditions/0",
                    "run_id": "54a95f7e009fc831f7d02b84232b114b",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T04:15:44.278764+00:00",
                        "finish": "2022-03-03T04:15:44.282186+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643645667838",
                    "trigger": "event 'zha_event'",
                    "trace": {
                        "trigger/0": [
                            {
                                "path": "trigger/0",
                                "timestamp": "2022-03-03T04:15:44.278819+00:00",
                                "changed_variables": {
                                    "var_light": "light.elis_room_lights",
                                    "var_speed": 500,
                                    "this": {
                                        "entity_id": "automation.elis_room_lights_controller",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T03:19:00.451125+00:00",
                                            "mode": "restart",
                                            "current": 0,
                                            "id": "1643645667838",
                                            "friendly_name": "Eli's Room Lights Controller"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.799100+00:00",
                                        "last_updated": "2022-03-03T03:19:00.455642+00:00",
                                        "context": {
                                            "id": "f45e6465cc26fe344d51e03418c082da",
                                            "parent_id": "74d55b51d20b5bd057bd10a1e05e6c48",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "0",
                                        "idx": "0",
                                        "platform": "event",
                                        "event": {
                                            "event_type": "zha_event",
                                            "data": {
                                                "device_ieee": "84:fd:27:ff:fe:1b:9a:43",
                                                "unique_id": "84:fd:27:ff:fe:1b:9a:43:1:0x0020",
                                                "device_id": "4f9d115057150510080b9cde7008bb35",
                                                "endpoint_id": 1,
                                                "cluster_id": 32,
                                                "command": "checkin",
                                                "args": []
                                            },
                                            "origin": "LOCAL",
                                            "time_fired": "2022-03-03T04:15:44.277743+00:00",
                                            "context": {
                                                "id": "27e528cc635310bfca015da7615bf6e2",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "description": "event 'zha_event'"
                                    }
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T04:15:44.279458+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "4cda338c2c34f4fd4d89634d78cca897",
                                        "parent_id": "27e528cc635310bfca015da7615bf6e2",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "choice": "default"
                                }
                            }
                        ],
                        "action/0/choose/0": [
                            {
                                "path": "action/0/choose/0",
                                "timestamp": "2022-03-03T04:15:44.279830+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/0/conditions/0",
                                "timestamp": "2022-03-03T04:15:44.279858+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0/choose/1": [
                            {
                                "path": "action/0/choose/1",
                                "timestamp": "2022-03-03T04:15:44.280040+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/1/conditions/0": [
                            {
                                "path": "action/0/choose/1/conditions/0",
                                "timestamp": "2022-03-03T04:15:44.280058+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0/choose/2": [
                            {
                                "path": "action/0/choose/2",
                                "timestamp": "2022-03-03T04:15:44.280134+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/2/conditions/0": [
                            {
                                "path": "action/0/choose/2/conditions/0",
                                "timestamp": "2022-03-03T04:15:44.280149+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0/choose/3": [
                            {
                                "path": "action/0/choose/3",
                                "timestamp": "2022-03-03T04:15:44.280224+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/3/conditions/0": [
                            {
                                "path": "action/0/choose/3/conditions/0",
                                "timestamp": "2022-03-03T04:15:44.280239+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0/choose/4": [
                            {
                                "path": "action/0/choose/4",
                                "timestamp": "2022-03-03T04:15:44.280313+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/4/conditions/0": [
                            {
                                "path": "action/0/choose/4/conditions/0",
                                "timestamp": "2022-03-03T04:15:44.280329+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0/choose/5": [
                            {
                                "path": "action/0/choose/5",
                                "timestamp": "2022-03-03T04:15:44.280402+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/5/conditions/0": [
                            {
                                "path": "action/0/choose/5/conditions/0",
                                "timestamp": "2022-03-03T04:15:44.280421+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0/choose/6": [
                            {
                                "path": "action/0/choose/6",
                                "timestamp": "2022-03-03T04:15:44.280498+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/6/conditions/0": [
                            {
                                "path": "action/0/choose/6/conditions/0",
                                "timestamp": "2022-03-03T04:15:44.280513+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0/choose/7": [
                            {
                                "path": "action/0/choose/7",
                                "timestamp": "2022-03-03T04:15:44.280576+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/7/conditions/0": [
                            {
                                "path": "action/0/choose/7/conditions/0",
                                "timestamp": "2022-03-03T04:15:44.280590+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0/choose/8": [
                            {
                                "path": "action/0/choose/8",
                                "timestamp": "2022-03-03T04:15:44.280651+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/8/conditions/0": [
                            {
                                "path": "action/0/choose/8/conditions/0",
                                "timestamp": "2022-03-03T04:15:44.280676+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0/choose/9": [
                            {
                                "path": "action/0/choose/9",
                                "timestamp": "2022-03-03T04:15:44.280786+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/9/conditions/0": [
                            {
                                "path": "action/0/choose/9/conditions/0",
                                "timestamp": "2022-03-03T04:15:44.280802+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ]
                    },
                    "config": {
                        "mode": "restart",
                        "max_exceeded": "silent",
                        "variables": {
                            "var_light": "light.elis_room_lights",
                            "var_speed": 500
                        },
                        "trigger": [
                            {
                                "platform": "event",
                                "event_type": "zha_event",
                                "event_data": {
                                    "device_id": "4f9d115057150510080b9cde7008bb35"
                                }
                            }
                        ],
                        "action": [
                            {
                                "choose": [
                                    {
                                        "conditions": [
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.command == \"toggle\" }}"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "light.toggle",
                                                "target": {
                                                    "entity_id": "light.elis_room_lights"
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.command == \"move_to_level_with_on_off\" }}"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "light.turn_on",
                                                "target": {
                                                    "entity_id": "light.elis_room_lights"
                                                },
                                                "data": {
                                                    "brightness": 254,
                                                    "color_temp": 400
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.command == \"step_with_on_off\" }}"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "light.turn_on",
                                                "target": {
                                                    "entity_id": "light.elis_room_lights"
                                                },
                                                "data": {
                                                    "brightness_step_pct": 20,
                                                    "transition": "{{ (var_speed / 1000)|float }}"
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.command == \"move_with_on_off\" }}"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "repeat": {
                                                    "while": [],
                                                    "sequence": [
                                                        {
                                                            "service": "light.turn_on",
                                                            "target": {
                                                                "entity_id": "light.elis_room_lights"
                                                            },
                                                            "data": {
                                                                "brightness_step_pct": 10,
                                                                "transition": "{{ (var_speed / 1000)|float }}"
                                                            }
                                                        },
                                                        {
                                                            "delay": {
                                                                "milliseconds": 500
                                                            }
                                                        }
                                                    ]
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.command == \"step\" }}"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "light.turn_on",
                                                "target": {
                                                    "entity_id": "light.elis_room_lights"
                                                },
                                                "data": {
                                                    "brightness_step_pct": -20,
                                                    "transition": "{{ (var_speed / 1000)|float }}"
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.command == \"move\" }}"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "repeat": {
                                                    "while": [],
                                                    "sequence": [
                                                        {
                                                            "service": "light.turn_on",
                                                            "target": {
                                                                "entity_id": "light.elis_room_lights"
                                                            },
                                                            "data": {
                                                                "brightness_step_pct": -10,
                                                                "transition": "{{ (var_speed / 1000)|float }}"
                                                            }
                                                        },
                                                        {
                                                            "delay": {
                                                                "milliseconds": 500
                                                            }
                                                        }
                                                    ]
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.command == \"press\" }}"
                                            },
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.args == [256,13,0] }}"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "light.turn_on",
                                                "target": {
                                                    "entity_id": "light.elis_room_lights"
                                                },
                                                "data": {
                                                    "color_temp": "{% if state_attr(var_light, \"color_temp\") - 18 < 153 %}\n  {{ 153 }}\n{% else %}\n  {{ state_attr(var_light, \"color_temp\") - 18 }}\n{% endif %}",
                                                    "transition": "{{ (var_speed / 1000)|float }}"
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.command == \"hold\" }}"
                                            },
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.args == [3328,0] }}"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "repeat": {
                                                    "while": [],
                                                    "sequence": [
                                                        {
                                                            "service": "light.turn_on",
                                                            "target": {
                                                                "entity_id": "light.elis_room_lights"
                                                            },
                                                            "data": {
                                                                "color_temp": "{% if state_attr(var_light, \"color_temp\") - 18 < 153 %}\n  {{ 153 }}\n{% else %}\n  {{ state_attr(var_light, \"color_temp\") - 18 }}\n{% endif %}",
                                                                "transition": "{{ (var_speed / 1000)|float }}"
                                                            }
                                                        },
                                                        {
                                                            "delay": {
                                                                "milliseconds": 500
                                                            }
                                                        }
                                                    ]
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.command == \"press\" }}"
                                            },
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.args == [257,13,0] }}"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "light.turn_on",
                                                "target": {
                                                    "entity_id": "light.elis_room_lights"
                                                },
                                                "data": {
                                                    "color_temp": "{% if state_attr(var_light, \"color_temp\") + 18 > 500 %}\n  {{ 500 }}\n{% else %}\n  {{ state_attr(var_light, \"color_temp\") + 18 }}\n{% endif %}",
                                                    "transition": "{{ (var_speed / 1000)|float }}"
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.command == \"hold\" }}"
                                            },
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.args == [3329,0] }}"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "repeat": {
                                                    "while": [],
                                                    "sequence": [
                                                        {
                                                            "service": "light.turn_on",
                                                            "target": {
                                                                "entity_id": "light.elis_room_lights"
                                                            },
                                                            "data": {
                                                                "color_temp": "{% if state_attr(var_light, \"color_temp\") + 18 > 500 %}\n  {{ 500 }}\n{% else %}\n  {{ state_attr(var_light, \"color_temp\") + 18 }}\n{% endif %}",
                                                                "transition": "{{ (var_speed / 1000)|float }}"
                                                            }
                                                        },
                                                        {
                                                            "delay": {
                                                                "milliseconds": 500
                                                            }
                                                        }
                                                    ]
                                                }
                                            }
                                        ]
                                    }
                                ],
                                "default": []
                            }
                        ],
                        "id": "1643645667838",
                        "alias": "Eli's Room Lights Controller",
                        "description": "Control Eli's Room Lights"
                    },
                    "blueprint_inputs": {
                        "id": "1643645667838",
                        "alias": "Eli's Room Lights Controller",
                        "description": "Control Eli's Room Lights",
                        "use_blueprint": {
                            "path": "niro1987/zha_ikea_tradfri_5button_remote_white.yaml",
                            "input": {
                                "remote": "4f9d115057150510080b9cde7008bb35",
                                "light": "light.elis_room_lights"
                            }
                        }
                    },
                    "context": {
                        "id": "4cda338c2c34f4fd4d89634d78cca897",
                        "parent_id": "27e528cc635310bfca015da7615bf6e2",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/0/choose/9/conditions/0",
                    "run_id": "54a95f7e009fc831f7d02b84232b114b",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T04:15:44.278764+00:00",
                        "finish": "2022-03-03T04:15:44.282186+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643645667838",
                    "trigger": "event 'zha_event'"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/0/choose/9/conditions/0",
                    "run_id": "11e3dce10ae8a151cbff0f1483c5a9da",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:12:27.962442+00:00",
                        "finish": "2022-03-03T05:12:27.966445+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643645667838",
                    "trigger": "event 'zha_event'",
                    "trace": {
                        "trigger/0": [
                            {
                                "path": "trigger/0",
                                "timestamp": "2022-03-03T05:12:27.962501+00:00",
                                "changed_variables": {
                                    "var_light": "light.elis_room_lights",
                                    "var_speed": 500,
                                    "this": {
                                        "entity_id": "automation.elis_room_lights_controller",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T04:15:44.278944+00:00",
                                            "mode": "restart",
                                            "current": 0,
                                            "id": "1643645667838",
                                            "friendly_name": "Eli's Room Lights Controller"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.799100+00:00",
                                        "last_updated": "2022-03-03T04:15:44.281660+00:00",
                                        "context": {
                                            "id": "4cda338c2c34f4fd4d89634d78cca897",
                                            "parent_id": "27e528cc635310bfca015da7615bf6e2",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "0",
                                        "idx": "0",
                                        "platform": "event",
                                        "event": {
                                            "event_type": "zha_event",
                                            "data": {
                                                "device_ieee": "84:fd:27:ff:fe:1b:9a:43",
                                                "unique_id": "84:fd:27:ff:fe:1b:9a:43:1:0x0020",
                                                "device_id": "4f9d115057150510080b9cde7008bb35",
                                                "endpoint_id": 1,
                                                "cluster_id": 32,
                                                "command": "checkin",
                                                "args": []
                                            },
                                            "origin": "LOCAL",
                                            "time_fired": "2022-03-03T05:12:27.961637+00:00",
                                            "context": {
                                                "id": "489f2f6bdfe3789348df934569df0c14",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "description": "event 'zha_event'"
                                    }
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T05:12:27.963455+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "38895242e9567f596e49af0c373212a8",
                                        "parent_id": "489f2f6bdfe3789348df934569df0c14",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "choice": "default"
                                }
                            }
                        ],
                        "action/0/choose/0": [
                            {
                                "path": "action/0/choose/0",
                                "timestamp": "2022-03-03T05:12:27.963506+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/0/conditions/0",
                                "timestamp": "2022-03-03T05:12:27.963527+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0/choose/1": [
                            {
                                "path": "action/0/choose/1",
                                "timestamp": "2022-03-03T05:12:27.963678+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/1/conditions/0": [
                            {
                                "path": "action/0/choose/1/conditions/0",
                                "timestamp": "2022-03-03T05:12:27.963720+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0/choose/2": [
                            {
                                "path": "action/0/choose/2",
                                "timestamp": "2022-03-03T05:12:27.963834+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/2/conditions/0": [
                            {
                                "path": "action/0/choose/2/conditions/0",
                                "timestamp": "2022-03-03T05:12:27.963850+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0/choose/3": [
                            {
                                "path": "action/0/choose/3",
                                "timestamp": "2022-03-03T05:12:27.963929+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/3/conditions/0": [
                            {
                                "path": "action/0/choose/3/conditions/0",
                                "timestamp": "2022-03-03T05:12:27.963945+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0/choose/4": [
                            {
                                "path": "action/0/choose/4",
                                "timestamp": "2022-03-03T05:12:27.964015+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/4/conditions/0": [
                            {
                                "path": "action/0/choose/4/conditions/0",
                                "timestamp": "2022-03-03T05:12:27.964030+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0/choose/5": [
                            {
                                "path": "action/0/choose/5",
                                "timestamp": "2022-03-03T05:12:27.964099+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/5/conditions/0": [
                            {
                                "path": "action/0/choose/5/conditions/0",
                                "timestamp": "2022-03-03T05:12:27.964119+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0/choose/6": [
                            {
                                "path": "action/0/choose/6",
                                "timestamp": "2022-03-03T05:12:27.964190+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/6/conditions/0": [
                            {
                                "path": "action/0/choose/6/conditions/0",
                                "timestamp": "2022-03-03T05:12:27.964205+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0/choose/7": [
                            {
                                "path": "action/0/choose/7",
                                "timestamp": "2022-03-03T05:12:27.964268+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/7/conditions/0": [
                            {
                                "path": "action/0/choose/7/conditions/0",
                                "timestamp": "2022-03-03T05:12:27.964283+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0/choose/8": [
                            {
                                "path": "action/0/choose/8",
                                "timestamp": "2022-03-03T05:12:27.964344+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/8/conditions/0": [
                            {
                                "path": "action/0/choose/8/conditions/0",
                                "timestamp": "2022-03-03T05:12:27.964358+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0/choose/9": [
                            {
                                "path": "action/0/choose/9",
                                "timestamp": "2022-03-03T05:12:27.964419+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/9/conditions/0": [
                            {
                                "path": "action/0/choose/9/conditions/0",
                                "timestamp": "2022-03-03T05:12:27.964433+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ]
                    },
                    "config": {
                        "mode": "restart",
                        "max_exceeded": "silent",
                        "variables": {
                            "var_light": "light.elis_room_lights",
                            "var_speed": 500
                        },
                        "trigger": [
                            {
                                "platform": "event",
                                "event_type": "zha_event",
                                "event_data": {
                                    "device_id": "4f9d115057150510080b9cde7008bb35"
                                }
                            }
                        ],
                        "action": [
                            {
                                "choose": [
                                    {
                                        "conditions": [
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.command == \"toggle\" }}"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "light.toggle",
                                                "target": {
                                                    "entity_id": "light.elis_room_lights"
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.command == \"move_to_level_with_on_off\" }}"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "light.turn_on",
                                                "target": {
                                                    "entity_id": "light.elis_room_lights"
                                                },
                                                "data": {
                                                    "brightness": 254,
                                                    "color_temp": 400
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.command == \"step_with_on_off\" }}"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "light.turn_on",
                                                "target": {
                                                    "entity_id": "light.elis_room_lights"
                                                },
                                                "data": {
                                                    "brightness_step_pct": 20,
                                                    "transition": "{{ (var_speed / 1000)|float }}"
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.command == \"move_with_on_off\" }}"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "repeat": {
                                                    "while": [],
                                                    "sequence": [
                                                        {
                                                            "service": "light.turn_on",
                                                            "target": {
                                                                "entity_id": "light.elis_room_lights"
                                                            },
                                                            "data": {
                                                                "brightness_step_pct": 10,
                                                                "transition": "{{ (var_speed / 1000)|float }}"
                                                            }
                                                        },
                                                        {
                                                            "delay": {
                                                                "milliseconds": 500
                                                            }
                                                        }
                                                    ]
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.command == \"step\" }}"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "light.turn_on",
                                                "target": {
                                                    "entity_id": "light.elis_room_lights"
                                                },
                                                "data": {
                                                    "brightness_step_pct": -20,
                                                    "transition": "{{ (var_speed / 1000)|float }}"
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.command == \"move\" }}"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "repeat": {
                                                    "while": [],
                                                    "sequence": [
                                                        {
                                                            "service": "light.turn_on",
                                                            "target": {
                                                                "entity_id": "light.elis_room_lights"
                                                            },
                                                            "data": {
                                                                "brightness_step_pct": -10,
                                                                "transition": "{{ (var_speed / 1000)|float }}"
                                                            }
                                                        },
                                                        {
                                                            "delay": {
                                                                "milliseconds": 500
                                                            }
                                                        }
                                                    ]
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.command == \"press\" }}"
                                            },
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.args == [256,13,0] }}"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "light.turn_on",
                                                "target": {
                                                    "entity_id": "light.elis_room_lights"
                                                },
                                                "data": {
                                                    "color_temp": "{% if state_attr(var_light, \"color_temp\") - 18 < 153 %}\n  {{ 153 }}\n{% else %}\n  {{ state_attr(var_light, \"color_temp\") - 18 }}\n{% endif %}",
                                                    "transition": "{{ (var_speed / 1000)|float }}"
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.command == \"hold\" }}"
                                            },
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.args == [3328,0] }}"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "repeat": {
                                                    "while": [],
                                                    "sequence": [
                                                        {
                                                            "service": "light.turn_on",
                                                            "target": {
                                                                "entity_id": "light.elis_room_lights"
                                                            },
                                                            "data": {
                                                                "color_temp": "{% if state_attr(var_light, \"color_temp\") - 18 < 153 %}\n  {{ 153 }}\n{% else %}\n  {{ state_attr(var_light, \"color_temp\") - 18 }}\n{% endif %}",
                                                                "transition": "{{ (var_speed / 1000)|float }}"
                                                            }
                                                        },
                                                        {
                                                            "delay": {
                                                                "milliseconds": 500
                                                            }
                                                        }
                                                    ]
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.command == \"press\" }}"
                                            },
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.args == [257,13,0] }}"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "light.turn_on",
                                                "target": {
                                                    "entity_id": "light.elis_room_lights"
                                                },
                                                "data": {
                                                    "color_temp": "{% if state_attr(var_light, \"color_temp\") + 18 > 500 %}\n  {{ 500 }}\n{% else %}\n  {{ state_attr(var_light, \"color_temp\") + 18 }}\n{% endif %}",
                                                    "transition": "{{ (var_speed / 1000)|float }}"
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.command == \"hold\" }}"
                                            },
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.args == [3329,0] }}"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "repeat": {
                                                    "while": [],
                                                    "sequence": [
                                                        {
                                                            "service": "light.turn_on",
                                                            "target": {
                                                                "entity_id": "light.elis_room_lights"
                                                            },
                                                            "data": {
                                                                "color_temp": "{% if state_attr(var_light, \"color_temp\") + 18 > 500 %}\n  {{ 500 }}\n{% else %}\n  {{ state_attr(var_light, \"color_temp\") + 18 }}\n{% endif %}",
                                                                "transition": "{{ (var_speed / 1000)|float }}"
                                                            }
                                                        },
                                                        {
                                                            "delay": {
                                                                "milliseconds": 500
                                                            }
                                                        }
                                                    ]
                                                }
                                            }
                                        ]
                                    }
                                ],
                                "default": []
                            }
                        ],
                        "id": "1643645667838",
                        "alias": "Eli's Room Lights Controller",
                        "description": "Control Eli's Room Lights"
                    },
                    "blueprint_inputs": {
                        "id": "1643645667838",
                        "alias": "Eli's Room Lights Controller",
                        "description": "Control Eli's Room Lights",
                        "use_blueprint": {
                            "path": "niro1987/zha_ikea_tradfri_5button_remote_white.yaml",
                            "input": {
                                "remote": "4f9d115057150510080b9cde7008bb35",
                                "light": "light.elis_room_lights"
                            }
                        }
                    },
                    "context": {
                        "id": "38895242e9567f596e49af0c373212a8",
                        "parent_id": "489f2f6bdfe3789348df934569df0c14",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/0/choose/9/conditions/0",
                    "run_id": "11e3dce10ae8a151cbff0f1483c5a9da",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:12:27.962442+00:00",
                        "finish": "2022-03-03T05:12:27.966445+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643645667838",
                    "trigger": "event 'zha_event'"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/0/choose/9/conditions/0",
                    "run_id": "70cd429878d60aa284c8a088ac555c4b",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T06:09:11.683179+00:00",
                        "finish": "2022-03-03T06:09:11.688150+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643645667838",
                    "trigger": "event 'zha_event'",
                    "trace": {
                        "trigger/0": [
                            {
                                "path": "trigger/0",
                                "timestamp": "2022-03-03T06:09:11.683271+00:00",
                                "changed_variables": {
                                    "var_light": "light.elis_room_lights",
                                    "var_speed": 500,
                                    "this": {
                                        "entity_id": "automation.elis_room_lights_controller",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T05:12:27.962631+00:00",
                                            "mode": "restart",
                                            "current": 0,
                                            "id": "1643645667838",
                                            "friendly_name": "Eli's Room Lights Controller"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.799100+00:00",
                                        "last_updated": "2022-03-03T05:12:27.965524+00:00",
                                        "context": {
                                            "id": "38895242e9567f596e49af0c373212a8",
                                            "parent_id": "489f2f6bdfe3789348df934569df0c14",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "0",
                                        "idx": "0",
                                        "platform": "event",
                                        "event": {
                                            "event_type": "zha_event",
                                            "data": {
                                                "device_ieee": "84:fd:27:ff:fe:1b:9a:43",
                                                "unique_id": "84:fd:27:ff:fe:1b:9a:43:1:0x0020",
                                                "device_id": "4f9d115057150510080b9cde7008bb35",
                                                "endpoint_id": 1,
                                                "cluster_id": 32,
                                                "command": "checkin",
                                                "args": []
                                            },
                                            "origin": "LOCAL",
                                            "time_fired": "2022-03-03T06:09:11.682260+00:00",
                                            "context": {
                                                "id": "f7af2bf3135cb594c79dff0e19645329",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "description": "event 'zha_event'"
                                    }
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T06:09:11.684116+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "e8f71b54a5193b5b26e1f7c0b3c453ac",
                                        "parent_id": "f7af2bf3135cb594c79dff0e19645329",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "choice": "default"
                                }
                            }
                        ],
                        "action/0/choose/0": [
                            {
                                "path": "action/0/choose/0",
                                "timestamp": "2022-03-03T06:09:11.684653+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/0/conditions/0",
                                "timestamp": "2022-03-03T06:09:11.684678+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0/choose/1": [
                            {
                                "path": "action/0/choose/1",
                                "timestamp": "2022-03-03T06:09:11.684861+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/1/conditions/0": [
                            {
                                "path": "action/0/choose/1/conditions/0",
                                "timestamp": "2022-03-03T06:09:11.684879+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0/choose/2": [
                            {
                                "path": "action/0/choose/2",
                                "timestamp": "2022-03-03T06:09:11.684952+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/2/conditions/0": [
                            {
                                "path": "action/0/choose/2/conditions/0",
                                "timestamp": "2022-03-03T06:09:11.684967+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0/choose/3": [
                            {
                                "path": "action/0/choose/3",
                                "timestamp": "2022-03-03T06:09:11.685040+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/3/conditions/0": [
                            {
                                "path": "action/0/choose/3/conditions/0",
                                "timestamp": "2022-03-03T06:09:11.685055+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0/choose/4": [
                            {
                                "path": "action/0/choose/4",
                                "timestamp": "2022-03-03T06:09:11.685126+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/4/conditions/0": [
                            {
                                "path": "action/0/choose/4/conditions/0",
                                "timestamp": "2022-03-03T06:09:11.685142+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0/choose/5": [
                            {
                                "path": "action/0/choose/5",
                                "timestamp": "2022-03-03T06:09:11.685211+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/5/conditions/0": [
                            {
                                "path": "action/0/choose/5/conditions/0",
                                "timestamp": "2022-03-03T06:09:11.685239+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0/choose/6": [
                            {
                                "path": "action/0/choose/6",
                                "timestamp": "2022-03-03T06:09:11.685314+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/6/conditions/0": [
                            {
                                "path": "action/0/choose/6/conditions/0",
                                "timestamp": "2022-03-03T06:09:11.685329+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0/choose/7": [
                            {
                                "path": "action/0/choose/7",
                                "timestamp": "2022-03-03T06:09:11.685396+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/7/conditions/0": [
                            {
                                "path": "action/0/choose/7/conditions/0",
                                "timestamp": "2022-03-03T06:09:11.685423+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0/choose/8": [
                            {
                                "path": "action/0/choose/8",
                                "timestamp": "2022-03-03T06:09:11.685504+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/8/conditions/0": [
                            {
                                "path": "action/0/choose/8/conditions/0",
                                "timestamp": "2022-03-03T06:09:11.685519+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0/choose/9": [
                            {
                                "path": "action/0/choose/9",
                                "timestamp": "2022-03-03T06:09:11.685581+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/9/conditions/0": [
                            {
                                "path": "action/0/choose/9/conditions/0",
                                "timestamp": "2022-03-03T06:09:11.685596+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ]
                    },
                    "config": {
                        "mode": "restart",
                        "max_exceeded": "silent",
                        "variables": {
                            "var_light": "light.elis_room_lights",
                            "var_speed": 500
                        },
                        "trigger": [
                            {
                                "platform": "event",
                                "event_type": "zha_event",
                                "event_data": {
                                    "device_id": "4f9d115057150510080b9cde7008bb35"
                                }
                            }
                        ],
                        "action": [
                            {
                                "choose": [
                                    {
                                        "conditions": [
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.command == \"toggle\" }}"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "light.toggle",
                                                "target": {
                                                    "entity_id": "light.elis_room_lights"
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.command == \"move_to_level_with_on_off\" }}"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "light.turn_on",
                                                "target": {
                                                    "entity_id": "light.elis_room_lights"
                                                },
                                                "data": {
                                                    "brightness": 254,
                                                    "color_temp": 400
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.command == \"step_with_on_off\" }}"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "light.turn_on",
                                                "target": {
                                                    "entity_id": "light.elis_room_lights"
                                                },
                                                "data": {
                                                    "brightness_step_pct": 20,
                                                    "transition": "{{ (var_speed / 1000)|float }}"
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.command == \"move_with_on_off\" }}"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "repeat": {
                                                    "while": [],
                                                    "sequence": [
                                                        {
                                                            "service": "light.turn_on",
                                                            "target": {
                                                                "entity_id": "light.elis_room_lights"
                                                            },
                                                            "data": {
                                                                "brightness_step_pct": 10,
                                                                "transition": "{{ (var_speed / 1000)|float }}"
                                                            }
                                                        },
                                                        {
                                                            "delay": {
                                                                "milliseconds": 500
                                                            }
                                                        }
                                                    ]
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.command == \"step\" }}"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "light.turn_on",
                                                "target": {
                                                    "entity_id": "light.elis_room_lights"
                                                },
                                                "data": {
                                                    "brightness_step_pct": -20,
                                                    "transition": "{{ (var_speed / 1000)|float }}"
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.command == \"move\" }}"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "repeat": {
                                                    "while": [],
                                                    "sequence": [
                                                        {
                                                            "service": "light.turn_on",
                                                            "target": {
                                                                "entity_id": "light.elis_room_lights"
                                                            },
                                                            "data": {
                                                                "brightness_step_pct": -10,
                                                                "transition": "{{ (var_speed / 1000)|float }}"
                                                            }
                                                        },
                                                        {
                                                            "delay": {
                                                                "milliseconds": 500
                                                            }
                                                        }
                                                    ]
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.command == \"press\" }}"
                                            },
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.args == [256,13,0] }}"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "light.turn_on",
                                                "target": {
                                                    "entity_id": "light.elis_room_lights"
                                                },
                                                "data": {
                                                    "color_temp": "{% if state_attr(var_light, \"color_temp\") - 18 < 153 %}\n  {{ 153 }}\n{% else %}\n  {{ state_attr(var_light, \"color_temp\") - 18 }}\n{% endif %}",
                                                    "transition": "{{ (var_speed / 1000)|float }}"
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.command == \"hold\" }}"
                                            },
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.args == [3328,0] }}"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "repeat": {
                                                    "while": [],
                                                    "sequence": [
                                                        {
                                                            "service": "light.turn_on",
                                                            "target": {
                                                                "entity_id": "light.elis_room_lights"
                                                            },
                                                            "data": {
                                                                "color_temp": "{% if state_attr(var_light, \"color_temp\") - 18 < 153 %}\n  {{ 153 }}\n{% else %}\n  {{ state_attr(var_light, \"color_temp\") - 18 }}\n{% endif %}",
                                                                "transition": "{{ (var_speed / 1000)|float }}"
                                                            }
                                                        },
                                                        {
                                                            "delay": {
                                                                "milliseconds": 500
                                                            }
                                                        }
                                                    ]
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.command == \"press\" }}"
                                            },
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.args == [257,13,0] }}"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "light.turn_on",
                                                "target": {
                                                    "entity_id": "light.elis_room_lights"
                                                },
                                                "data": {
                                                    "color_temp": "{% if state_attr(var_light, \"color_temp\") + 18 > 500 %}\n  {{ 500 }}\n{% else %}\n  {{ state_attr(var_light, \"color_temp\") + 18 }}\n{% endif %}",
                                                    "transition": "{{ (var_speed / 1000)|float }}"
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.command == \"hold\" }}"
                                            },
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.args == [3329,0] }}"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "repeat": {
                                                    "while": [],
                                                    "sequence": [
                                                        {
                                                            "service": "light.turn_on",
                                                            "target": {
                                                                "entity_id": "light.elis_room_lights"
                                                            },
                                                            "data": {
                                                                "color_temp": "{% if state_attr(var_light, \"color_temp\") + 18 > 500 %}\n  {{ 500 }}\n{% else %}\n  {{ state_attr(var_light, \"color_temp\") + 18 }}\n{% endif %}",
                                                                "transition": "{{ (var_speed / 1000)|float }}"
                                                            }
                                                        },
                                                        {
                                                            "delay": {
                                                                "milliseconds": 500
                                                            }
                                                        }
                                                    ]
                                                }
                                            }
                                        ]
                                    }
                                ],
                                "default": []
                            }
                        ],
                        "id": "1643645667838",
                        "alias": "Eli's Room Lights Controller",
                        "description": "Control Eli's Room Lights"
                    },
                    "blueprint_inputs": {
                        "id": "1643645667838",
                        "alias": "Eli's Room Lights Controller",
                        "description": "Control Eli's Room Lights",
                        "use_blueprint": {
                            "path": "niro1987/zha_ikea_tradfri_5button_remote_white.yaml",
                            "input": {
                                "remote": "4f9d115057150510080b9cde7008bb35",
                                "light": "light.elis_room_lights"
                            }
                        }
                    },
                    "context": {
                        "id": "e8f71b54a5193b5b26e1f7c0b3c453ac",
                        "parent_id": "f7af2bf3135cb594c79dff0e19645329",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/0/choose/9/conditions/0",
                    "run_id": "70cd429878d60aa284c8a088ac555c4b",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T06:09:11.683179+00:00",
                        "finish": "2022-03-03T06:09:11.688150+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643645667838",
                    "trigger": "event 'zha_event'"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/0/choose/9/conditions/0",
                    "run_id": "708db58a8cee70bec028497c7ae564a6",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T07:05:55.386877+00:00",
                        "finish": "2022-03-03T07:05:55.390185+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643645667838",
                    "trigger": "event 'zha_event'",
                    "trace": {
                        "trigger/0": [
                            {
                                "path": "trigger/0",
                                "timestamp": "2022-03-03T07:05:55.387007+00:00",
                                "changed_variables": {
                                    "var_light": "light.elis_room_lights",
                                    "var_speed": 500,
                                    "this": {
                                        "entity_id": "automation.elis_room_lights_controller",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T06:09:11.683399+00:00",
                                            "mode": "restart",
                                            "current": 0,
                                            "id": "1643645667838",
                                            "friendly_name": "Eli's Room Lights Controller"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.799100+00:00",
                                        "last_updated": "2022-03-03T06:09:11.687101+00:00",
                                        "context": {
                                            "id": "e8f71b54a5193b5b26e1f7c0b3c453ac",
                                            "parent_id": "f7af2bf3135cb594c79dff0e19645329",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "0",
                                        "idx": "0",
                                        "platform": "event",
                                        "event": {
                                            "event_type": "zha_event",
                                            "data": {
                                                "device_ieee": "84:fd:27:ff:fe:1b:9a:43",
                                                "unique_id": "84:fd:27:ff:fe:1b:9a:43:1:0x0020",
                                                "device_id": "4f9d115057150510080b9cde7008bb35",
                                                "endpoint_id": 1,
                                                "cluster_id": 32,
                                                "command": "checkin",
                                                "args": []
                                            },
                                            "origin": "LOCAL",
                                            "time_fired": "2022-03-03T07:05:55.385981+00:00",
                                            "context": {
                                                "id": "04b7fe35b0232eb0b1e1da29aca3b002",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "description": "event 'zha_event'"
                                    }
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T07:05:55.387669+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "d3c9521545f06d194aa049eb85ff600e",
                                        "parent_id": "04b7fe35b0232eb0b1e1da29aca3b002",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "choice": "default"
                                }
                            }
                        ],
                        "action/0/choose/0": [
                            {
                                "path": "action/0/choose/0",
                                "timestamp": "2022-03-03T07:05:55.387756+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/0/conditions/0": [
                            {
                                "path": "action/0/choose/0/conditions/0",
                                "timestamp": "2022-03-03T07:05:55.387797+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0/choose/1": [
                            {
                                "path": "action/0/choose/1",
                                "timestamp": "2022-03-03T07:05:55.387994+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/1/conditions/0": [
                            {
                                "path": "action/0/choose/1/conditions/0",
                                "timestamp": "2022-03-03T07:05:55.388011+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0/choose/2": [
                            {
                                "path": "action/0/choose/2",
                                "timestamp": "2022-03-03T07:05:55.388086+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/2/conditions/0": [
                            {
                                "path": "action/0/choose/2/conditions/0",
                                "timestamp": "2022-03-03T07:05:55.388101+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0/choose/3": [
                            {
                                "path": "action/0/choose/3",
                                "timestamp": "2022-03-03T07:05:55.388177+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/3/conditions/0": [
                            {
                                "path": "action/0/choose/3/conditions/0",
                                "timestamp": "2022-03-03T07:05:55.388192+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0/choose/4": [
                            {
                                "path": "action/0/choose/4",
                                "timestamp": "2022-03-03T07:05:55.388269+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/4/conditions/0": [
                            {
                                "path": "action/0/choose/4/conditions/0",
                                "timestamp": "2022-03-03T07:05:55.388285+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0/choose/5": [
                            {
                                "path": "action/0/choose/5",
                                "timestamp": "2022-03-03T07:05:55.388355+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/5/conditions/0": [
                            {
                                "path": "action/0/choose/5/conditions/0",
                                "timestamp": "2022-03-03T07:05:55.388370+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0/choose/6": [
                            {
                                "path": "action/0/choose/6",
                                "timestamp": "2022-03-03T07:05:55.388445+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/6/conditions/0": [
                            {
                                "path": "action/0/choose/6/conditions/0",
                                "timestamp": "2022-03-03T07:05:55.388459+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0/choose/7": [
                            {
                                "path": "action/0/choose/7",
                                "timestamp": "2022-03-03T07:05:55.388523+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/7/conditions/0": [
                            {
                                "path": "action/0/choose/7/conditions/0",
                                "timestamp": "2022-03-03T07:05:55.388537+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0/choose/8": [
                            {
                                "path": "action/0/choose/8",
                                "timestamp": "2022-03-03T07:05:55.388603+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/8/conditions/0": [
                            {
                                "path": "action/0/choose/8/conditions/0",
                                "timestamp": "2022-03-03T07:05:55.388617+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0/choose/9": [
                            {
                                "path": "action/0/choose/9",
                                "timestamp": "2022-03-03T07:05:55.388679+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/0/choose/9/conditions/0": [
                            {
                                "path": "action/0/choose/9/conditions/0",
                                "timestamp": "2022-03-03T07:05:55.388720+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ]
                    },
                    "config": {
                        "mode": "restart",
                        "max_exceeded": "silent",
                        "variables": {
                            "var_light": "light.elis_room_lights",
                            "var_speed": 500
                        },
                        "trigger": [
                            {
                                "platform": "event",
                                "event_type": "zha_event",
                                "event_data": {
                                    "device_id": "4f9d115057150510080b9cde7008bb35"
                                }
                            }
                        ],
                        "action": [
                            {
                                "choose": [
                                    {
                                        "conditions": [
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.command == \"toggle\" }}"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "light.toggle",
                                                "target": {
                                                    "entity_id": "light.elis_room_lights"
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.command == \"move_to_level_with_on_off\" }}"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "light.turn_on",
                                                "target": {
                                                    "entity_id": "light.elis_room_lights"
                                                },
                                                "data": {
                                                    "brightness": 254,
                                                    "color_temp": 400
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.command == \"step_with_on_off\" }}"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "light.turn_on",
                                                "target": {
                                                    "entity_id": "light.elis_room_lights"
                                                },
                                                "data": {
                                                    "brightness_step_pct": 20,
                                                    "transition": "{{ (var_speed / 1000)|float }}"
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.command == \"move_with_on_off\" }}"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "repeat": {
                                                    "while": [],
                                                    "sequence": [
                                                        {
                                                            "service": "light.turn_on",
                                                            "target": {
                                                                "entity_id": "light.elis_room_lights"
                                                            },
                                                            "data": {
                                                                "brightness_step_pct": 10,
                                                                "transition": "{{ (var_speed / 1000)|float }}"
                                                            }
                                                        },
                                                        {
                                                            "delay": {
                                                                "milliseconds": 500
                                                            }
                                                        }
                                                    ]
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.command == \"step\" }}"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "light.turn_on",
                                                "target": {
                                                    "entity_id": "light.elis_room_lights"
                                                },
                                                "data": {
                                                    "brightness_step_pct": -20,
                                                    "transition": "{{ (var_speed / 1000)|float }}"
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.command == \"move\" }}"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "repeat": {
                                                    "while": [],
                                                    "sequence": [
                                                        {
                                                            "service": "light.turn_on",
                                                            "target": {
                                                                "entity_id": "light.elis_room_lights"
                                                            },
                                                            "data": {
                                                                "brightness_step_pct": -10,
                                                                "transition": "{{ (var_speed / 1000)|float }}"
                                                            }
                                                        },
                                                        {
                                                            "delay": {
                                                                "milliseconds": 500
                                                            }
                                                        }
                                                    ]
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.command == \"press\" }}"
                                            },
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.args == [256,13,0] }}"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "light.turn_on",
                                                "target": {
                                                    "entity_id": "light.elis_room_lights"
                                                },
                                                "data": {
                                                    "color_temp": "{% if state_attr(var_light, \"color_temp\") - 18 < 153 %}\n  {{ 153 }}\n{% else %}\n  {{ state_attr(var_light, \"color_temp\") - 18 }}\n{% endif %}",
                                                    "transition": "{{ (var_speed / 1000)|float }}"
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.command == \"hold\" }}"
                                            },
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.args == [3328,0] }}"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "repeat": {
                                                    "while": [],
                                                    "sequence": [
                                                        {
                                                            "service": "light.turn_on",
                                                            "target": {
                                                                "entity_id": "light.elis_room_lights"
                                                            },
                                                            "data": {
                                                                "color_temp": "{% if state_attr(var_light, \"color_temp\") - 18 < 153 %}\n  {{ 153 }}\n{% else %}\n  {{ state_attr(var_light, \"color_temp\") - 18 }}\n{% endif %}",
                                                                "transition": "{{ (var_speed / 1000)|float }}"
                                                            }
                                                        },
                                                        {
                                                            "delay": {
                                                                "milliseconds": 500
                                                            }
                                                        }
                                                    ]
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.command == \"press\" }}"
                                            },
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.args == [257,13,0] }}"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "service": "light.turn_on",
                                                "target": {
                                                    "entity_id": "light.elis_room_lights"
                                                },
                                                "data": {
                                                    "color_temp": "{% if state_attr(var_light, \"color_temp\") + 18 > 500 %}\n  {{ 500 }}\n{% else %}\n  {{ state_attr(var_light, \"color_temp\") + 18 }}\n{% endif %}",
                                                    "transition": "{{ (var_speed / 1000)|float }}"
                                                }
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.command == \"hold\" }}"
                                            },
                                            {
                                                "condition": "template",
                                                "value_template": "{{ trigger.event.data.args == [3329,0] }}"
                                            }
                                        ],
                                        "sequence": [
                                            {
                                                "repeat": {
                                                    "while": [],
                                                    "sequence": [
                                                        {
                                                            "service": "light.turn_on",
                                                            "target": {
                                                                "entity_id": "light.elis_room_lights"
                                                            },
                                                            "data": {
                                                                "color_temp": "{% if state_attr(var_light, \"color_temp\") + 18 > 500 %}\n  {{ 500 }}\n{% else %}\n  {{ state_attr(var_light, \"color_temp\") + 18 }}\n{% endif %}",
                                                                "transition": "{{ (var_speed / 1000)|float }}"
                                                            }
                                                        },
                                                        {
                                                            "delay": {
                                                                "milliseconds": 500
                                                            }
                                                        }
                                                    ]
                                                }
                                            }
                                        ]
                                    }
                                ],
                                "default": []
                            }
                        ],
                        "id": "1643645667838",
                        "alias": "Eli's Room Lights Controller",
                        "description": "Control Eli's Room Lights"
                    },
                    "blueprint_inputs": {
                        "id": "1643645667838",
                        "alias": "Eli's Room Lights Controller",
                        "description": "Control Eli's Room Lights",
                        "use_blueprint": {
                            "path": "niro1987/zha_ikea_tradfri_5button_remote_white.yaml",
                            "input": {
                                "remote": "4f9d115057150510080b9cde7008bb35",
                                "light": "light.elis_room_lights"
                            }
                        }
                    },
                    "context": {
                        "id": "d3c9521545f06d194aa049eb85ff600e",
                        "parent_id": "04b7fe35b0232eb0b1e1da29aca3b002",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/0/choose/9/conditions/0",
                    "run_id": "708db58a8cee70bec028497c7ae564a6",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T07:05:55.386877+00:00",
                        "finish": "2022-03-03T07:05:55.390185+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643645667838",
                    "trigger": "event 'zha_event'"
                }
            }
        ],
        "automation.1643640720985": [
            {
                "extended_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "dd464a817d39396ebfc9990c2a83da36",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T03:28:25.001446+00:00",
                        "finish": "2022-03-03T03:28:25.009351+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643640720985",
                    "trigger": "event 'zha_event'",
                    "trace": {
                        "trigger/1": [
                            {
                                "path": "trigger/1",
                                "timestamp": "2022-03-03T03:28:25.003226+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.dining_room_light_controller_1",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T02:31:43.778493+00:00",
                                            "mode": "restart",
                                            "current": 0,
                                            "id": "1643640720985",
                                            "friendly_name": "Dining Room Lights Controller 1"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.797944+00:00",
                                        "last_updated": "2022-03-03T02:31:43.783624+00:00",
                                        "context": {
                                            "id": "0f97313a5e77cd16b2548888eccae3d7",
                                            "parent_id": "56df0195bcfc8c58a6cc88a38bc68aaa",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "1",
                                        "idx": "1",
                                        "platform": "event",
                                        "event": {
                                            "event_type": "zha_event",
                                            "data": {
                                                "device_ieee": "84:fd:27:ff:fe:9f:0f:e0",
                                                "unique_id": "84:fd:27:ff:fe:9f:0f:e0:1:0x0020",
                                                "device_id": "0df2cd0b0fa9112188778c56db622911",
                                                "endpoint_id": 1,
                                                "cluster_id": 32,
                                                "command": "checkin",
                                                "args": []
                                            },
                                            "origin": "LOCAL",
                                            "time_fired": "2022-03-03T03:28:25.000275+00:00",
                                            "context": {
                                                "id": "e6d6e9e19371fb9ba9f99d67fa799fb7",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "description": "event 'zha_event'"
                                    },
                                    "integration": "ZHA",
                                    "button_up_long_loop": true,
                                    "button_up_long_max_loop_repeats": 50,
                                    "button_up_double_press": false,
                                    "button_down_long_loop": true,
                                    "button_down_long_max_loop_repeats": 50,
                                    "button_down_double_press": false,
                                    "helper_last_controller_event": "input_text.zz_dining_room_lights_controller_1_last_event",
                                    "helper_double_press_delay": 500,
                                    "helper_debounce_delay": 0,
                                    "integration_id": "zha",
                                    "adjusted_double_press_delay": 500,
                                    "actions_mapping": {
                                        "deconz": {
                                            "button_up_short": [
                                                "1002"
                                            ],
                                            "button_up_long": [
                                                "1001"
                                            ],
                                            "button_up_release": [
                                                "1003"
                                            ],
                                            "button_down_short": [
                                                "2002"
                                            ],
                                            "button_down_long": [
                                                "2001"
                                            ],
                                            "button_down_release": [
                                                "2003"
                                            ]
                                        },
                                        "zha": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "move_with_on_off_0_83"
                                            ],
                                            "button_up_release": [
                                                "stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "move_1_83"
                                            ],
                                            "button_down_release": [
                                                "stop"
                                            ]
                                        },
                                        "zigbee2mqtt": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "brightness_move_up"
                                            ],
                                            "button_up_release": [
                                                "brightness_stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "brightness_move_down"
                                            ],
                                            "button_down_release": [
                                                "brightness_stop"
                                            ]
                                        }
                                    },
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ],
                                    "integrations_with_prev_event_storage": [
                                        "zha",
                                        "zigbee2mqtt"
                                    ],
                                    "controller_entity": "",
                                    "controller_device": "0df2cd0b0fa9112188778c56db622911",
                                    "controller_id": "0df2cd0b0fa9112188778c56db622911"
                                }
                            }
                        ],
                        "condition/0": [
                            {
                                "path": "condition/0",
                                "timestamp": "2022-03-03T03:28:25.003286+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "condition/0/conditions/0": [
                            {
                                "path": "condition/0/conditions/0",
                                "timestamp": "2022-03-03T03:28:25.003321+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "condition/0/conditions/1": [
                            {
                                "path": "condition/0/conditions/1",
                                "timestamp": "2022-03-03T03:28:25.003473+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T03:28:25.005572+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "74065ff5a9046d9ce9fbb630de4365ca",
                                        "parent_id": "e6d6e9e19371fb9ba9f99d67fa799fb7",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "delay": 0.0,
                                    "done": true
                                }
                            }
                        ],
                        "action/1": [
                            {
                                "path": "action/1",
                                "timestamp": "2022-03-03T03:28:25.006149+00:00"
                            }
                        ],
                        "action/2": [
                            {
                                "path": "action/2",
                                "timestamp": "2022-03-03T03:28:25.006766+00:00",
                                "changed_variables": {
                                    "trigger_action": "checkin",
                                    "trigger_delta": 3401225.392103195,
                                    "last_controller_event": "checkin"
                                },
                                "result": {
                                    "params": {
                                        "domain": "input_text",
                                        "service": "set_value",
                                        "service_data": {
                                            "entity_id": "input_text.zz_dining_room_lights_controller_1_last_event",
                                            "value": {
                                                "trigger_action": "checkin",
                                                "last_triggered": "2022-03-03 11:28:25.006863+08:00"
                                            }
                                        },
                                        "target": {}
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "action/3": [
                            {
                                "path": "action/3",
                                "timestamp": "2022-03-03T03:28:25.008091+00:00"
                            }
                        ],
                        "action/3/choose/0": [
                            {
                                "path": "action/3/choose/0",
                                "timestamp": "2022-03-03T03:28:25.008143+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/0/conditions/0": [
                            {
                                "path": "action/3/choose/0/conditions/0",
                                "timestamp": "2022-03-03T03:28:25.008169+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/1": [
                            {
                                "path": "action/3/choose/1",
                                "timestamp": "2022-03-03T03:28:25.008275+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/1/conditions/0": [
                            {
                                "path": "action/3/choose/1/conditions/0",
                                "timestamp": "2022-03-03T03:28:25.008294+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/2": [
                            {
                                "path": "action/3/choose/2",
                                "timestamp": "2022-03-03T03:28:25.008364+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/2/conditions/0": [
                            {
                                "path": "action/3/choose/2/conditions/0",
                                "timestamp": "2022-03-03T03:28:25.008381+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/3": [
                            {
                                "path": "action/3/choose/3",
                                "timestamp": "2022-03-03T03:28:25.008455+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/3/conditions/0": [
                            {
                                "path": "action/3/choose/3/conditions/0",
                                "timestamp": "2022-03-03T03:28:25.008473+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/4": [
                            {
                                "path": "action/3/choose/4",
                                "timestamp": "2022-03-03T03:28:25.008555+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/4/conditions/0": [
                            {
                                "path": "action/3/choose/4/conditions/0",
                                "timestamp": "2022-03-03T03:28:25.008572+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/5": [
                            {
                                "path": "action/3/choose/5",
                                "timestamp": "2022-03-03T03:28:25.008646+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/5/conditions/0": [
                            {
                                "path": "action/3/choose/5/conditions/0",
                                "timestamp": "2022-03-03T03:28:25.008664+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ]
                    },
                    "config": {
                        "variables": {
                            "integration": "ZHA",
                            "button_up_long_loop": true,
                            "button_up_long_max_loop_repeats": 50,
                            "button_up_double_press": false,
                            "button_down_long_loop": true,
                            "button_down_long_max_loop_repeats": 50,
                            "button_down_double_press": false,
                            "helper_last_controller_event": "input_text.zz_dining_room_lights_controller_1_last_event",
                            "helper_double_press_delay": 500,
                            "helper_debounce_delay": 0,
                            "integration_id": "{{ integration | lower }}",
                            "adjusted_double_press_delay": "{{ [helper_double_press_delay - helper_debounce_delay, 100] | max }}",
                            "actions_mapping": {
                                "deconz": {
                                    "button_up_short": [
                                        "1002"
                                    ],
                                    "button_up_long": [
                                        "1001"
                                    ],
                                    "button_up_release": [
                                        "1003"
                                    ],
                                    "button_down_short": [
                                        "2002"
                                    ],
                                    "button_down_long": [
                                        "2001"
                                    ],
                                    "button_down_release": [
                                        "2003"
                                    ]
                                },
                                "zha": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ]
                                },
                                "zigbee2mqtt": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "brightness_move_up"
                                    ],
                                    "button_up_release": [
                                        "brightness_stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "brightness_move_down"
                                    ],
                                    "button_down_release": [
                                        "brightness_stop"
                                    ]
                                }
                            },
                            "button_up_short": "{{ actions_mapping[integration_id][\"button_up_short\"] }}",
                            "button_up_long": "{{ actions_mapping[integration_id][\"button_up_long\"] }}",
                            "button_up_release": "{{ actions_mapping[integration_id][\"button_up_release\"] }}",
                            "button_down_short": "{{ actions_mapping[integration_id][\"button_down_short\"] }}",
                            "button_down_long": "{{ actions_mapping[integration_id][\"button_down_long\"] }}",
                            "button_down_release": "{{ actions_mapping[integration_id][\"button_down_release\"] }}",
                            "integrations_with_prev_event_storage": [
                                "zha",
                                "zigbee2mqtt"
                            ],
                            "controller_entity": "",
                            "controller_device": "0df2cd0b0fa9112188778c56db622911",
                            "controller_id": "{% if integration_id==\"zigbee2mqtt\" %}{{controller_entity}}{% else %}{{controller_device}}{% endif %}"
                        },
                        "mode": "restart",
                        "max_exceeded": "silent",
                        "trigger": [
                            {
                                "platform": "event",
                                "event_type": "state_changed",
                                "event_data": {
                                    "entity_id": ""
                                }
                            },
                            {
                                "platform": "event",
                                "event_type": [
                                    "deconz_event",
                                    "zha_event"
                                ],
                                "event_data": {
                                    "device_id": "0df2cd0b0fa9112188778c56db622911"
                                }
                            }
                        ],
                        "condition": [
                            {
                                "condition": "and",
                                "conditions": [
                                    "{%- set trigger_action -%} {%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%} {%- endset -%} {{ trigger_action not in [\"\",\"None\"] }}",
                                    "{{ integration_id != \"zigbee2mqtt\" or trigger.event.data.new_state.state != trigger.event.data.old_state.state }}"
                                ]
                            }
                        ],
                        "action": [
                            {
                                "delay": {
                                    "milliseconds": 0
                                }
                            },
                            {
                                "variables": {
                                    "trigger_action": "{%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%}",
                                    "trigger_delta": "{{ (as_timestamp(now()) - as_timestamp((states(helper_last_controller_event) | from_json).last_triggered if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"1970-01-01 00:00:00\")) * 1000 }}",
                                    "last_controller_event": "{{ (states(helper_last_controller_event) | from_json).trigger_action if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"\" }}"
                                }
                            },
                            {
                                "service": "input_text.set_value",
                                "data": {
                                    "entity_id": "input_text.zz_dining_room_lights_controller_1_last_event",
                                    "value": "{{ {\"trigger_action\":trigger_action,\"last_triggered\":now()|string} | to_json }}"
                                }
                            },
                            {
                                "choose": [
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_dining_room_lights_controller_1_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_up_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_up_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "light.turn_on",
                                                                                        "target": {
                                                                                            "entity_id": "light.dining_room_lights"
                                                                                        },
                                                                                        "data": {
                                                                                            "brightness_pct": 100
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_up_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "light.turn_on",
                                                                        "target": {
                                                                            "entity_id": "light.dining_room_lights"
                                                                        },
                                                                        "data": {
                                                                            "brightness_pct": 100
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_up_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "light.turn_on",
                                                                            "target": {
                                                                                "entity_id": "light.dining_room_lights"
                                                                            },
                                                                            "data": {
                                                                                "brightness_step_pct": 10
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.dining_room_lights"
                                                        },
                                                        "data": {
                                                            "brightness_step_pct": 10
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_up_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_up_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_dining_room_lights_controller_1_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_down_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_down_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "light.turn_off",
                                                                                        "target": {
                                                                                            "entity_id": "light.dining_room_lights"
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_down_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "light.turn_off",
                                                                        "target": {
                                                                            "entity_id": "light.dining_room_lights"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_down_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "light.turn_on",
                                                                            "target": {
                                                                                "entity_id": "light.dining_room_lights"
                                                                            },
                                                                            "data": {
                                                                                "brightness_step_pct": -10
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.dining_room_lights"
                                                        },
                                                        "data": {
                                                            "brightness_step_pct": -10
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_down_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_down_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            }
                        ],
                        "id": "1643640720985",
                        "alias": "Dining Room Lights Controller 1",
                        "description": "Control the Dining Room Lights"
                    },
                    "blueprint_inputs": {
                        "id": "1643640720985",
                        "alias": "Dining Room Lights Controller 1",
                        "description": "Control the Dining Room Lights",
                        "use_blueprint": {
                            "path": "EPMatt/ikea_e1743.yaml",
                            "input": {
                                "integration": "ZHA",
                                "controller_device": "0df2cd0b0fa9112188778c56db622911",
                                "helper_last_controller_event": "input_text.zz_dining_room_lights_controller_1_last_event",
                                "action_button_up_short": [
                                    {
                                        "service": "light.turn_on",
                                        "target": {
                                            "entity_id": "light.dining_room_lights"
                                        },
                                        "data": {
                                            "brightness_pct": 100
                                        }
                                    }
                                ],
                                "action_button_up_long": [
                                    {
                                        "service": "light.turn_on",
                                        "target": {
                                            "entity_id": "light.dining_room_lights"
                                        },
                                        "data": {
                                            "brightness_step_pct": 10
                                        }
                                    }
                                ],
                                "action_button_down_short": [
                                    {
                                        "service": "light.turn_off",
                                        "target": {
                                            "entity_id": "light.dining_room_lights"
                                        }
                                    }
                                ],
                                "action_button_down_long": [
                                    {
                                        "service": "light.turn_on",
                                        "target": {
                                            "entity_id": "light.dining_room_lights"
                                        },
                                        "data": {
                                            "brightness_step_pct": -10
                                        }
                                    }
                                ],
                                "button_up_long_loop": true,
                                "button_up_long_max_loop_repeats": 50,
                                "button_down_long_loop": true,
                                "button_down_long_max_loop_repeats": 50
                            }
                        }
                    },
                    "context": {
                        "id": "74065ff5a9046d9ce9fbb630de4365ca",
                        "parent_id": "e6d6e9e19371fb9ba9f99d67fa799fb7",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "dd464a817d39396ebfc9990c2a83da36",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T03:28:25.001446+00:00",
                        "finish": "2022-03-03T03:28:25.009351+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643640720985",
                    "trigger": "event 'zha_event'"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "a1b18c237c3b5629a6b07208577393b8",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T04:25:06.186749+00:00",
                        "finish": "2022-03-03T04:25:06.193259+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643640720985",
                    "trigger": "event 'zha_event'",
                    "trace": {
                        "trigger/1": [
                            {
                                "path": "trigger/1",
                                "timestamp": "2022-03-03T04:25:06.187476+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.dining_room_light_controller_1",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T03:28:25.003654+00:00",
                                            "mode": "restart",
                                            "current": 0,
                                            "id": "1643640720985",
                                            "friendly_name": "Dining Room Lights Controller 1"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.797944+00:00",
                                        "last_updated": "2022-03-03T03:28:25.008818+00:00",
                                        "context": {
                                            "id": "74065ff5a9046d9ce9fbb630de4365ca",
                                            "parent_id": "e6d6e9e19371fb9ba9f99d67fa799fb7",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "1",
                                        "idx": "1",
                                        "platform": "event",
                                        "event": {
                                            "event_type": "zha_event",
                                            "data": {
                                                "device_ieee": "84:fd:27:ff:fe:9f:0f:e0",
                                                "unique_id": "84:fd:27:ff:fe:9f:0f:e0:1:0x0020",
                                                "device_id": "0df2cd0b0fa9112188778c56db622911",
                                                "endpoint_id": 1,
                                                "cluster_id": 32,
                                                "command": "checkin",
                                                "args": []
                                            },
                                            "origin": "LOCAL",
                                            "time_fired": "2022-03-03T04:25:06.185323+00:00",
                                            "context": {
                                                "id": "c1b782a1be2a41e03cde8dcda456cb15",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "description": "event 'zha_event'"
                                    },
                                    "integration": "ZHA",
                                    "button_up_long_loop": true,
                                    "button_up_long_max_loop_repeats": 50,
                                    "button_up_double_press": false,
                                    "button_down_long_loop": true,
                                    "button_down_long_max_loop_repeats": 50,
                                    "button_down_double_press": false,
                                    "helper_last_controller_event": "input_text.zz_dining_room_lights_controller_1_last_event",
                                    "helper_double_press_delay": 500,
                                    "helper_debounce_delay": 0,
                                    "integration_id": "zha",
                                    "adjusted_double_press_delay": 500,
                                    "actions_mapping": {
                                        "deconz": {
                                            "button_up_short": [
                                                "1002"
                                            ],
                                            "button_up_long": [
                                                "1001"
                                            ],
                                            "button_up_release": [
                                                "1003"
                                            ],
                                            "button_down_short": [
                                                "2002"
                                            ],
                                            "button_down_long": [
                                                "2001"
                                            ],
                                            "button_down_release": [
                                                "2003"
                                            ]
                                        },
                                        "zha": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "move_with_on_off_0_83"
                                            ],
                                            "button_up_release": [
                                                "stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "move_1_83"
                                            ],
                                            "button_down_release": [
                                                "stop"
                                            ]
                                        },
                                        "zigbee2mqtt": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "brightness_move_up"
                                            ],
                                            "button_up_release": [
                                                "brightness_stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "brightness_move_down"
                                            ],
                                            "button_down_release": [
                                                "brightness_stop"
                                            ]
                                        }
                                    },
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ],
                                    "integrations_with_prev_event_storage": [
                                        "zha",
                                        "zigbee2mqtt"
                                    ],
                                    "controller_entity": "",
                                    "controller_device": "0df2cd0b0fa9112188778c56db622911",
                                    "controller_id": "0df2cd0b0fa9112188778c56db622911"
                                }
                            }
                        ],
                        "condition/0": [
                            {
                                "path": "condition/0",
                                "timestamp": "2022-03-03T04:25:06.187511+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "condition/0/conditions/0": [
                            {
                                "path": "condition/0/conditions/0",
                                "timestamp": "2022-03-03T04:25:06.187533+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "condition/0/conditions/1": [
                            {
                                "path": "condition/0/conditions/1",
                                "timestamp": "2022-03-03T04:25:06.187719+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T04:25:06.188484+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "0b7dbf242c18633e6c05bd732e020a75",
                                        "parent_id": "c1b782a1be2a41e03cde8dcda456cb15",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "delay": 0.0,
                                    "done": true
                                }
                            }
                        ],
                        "action/1": [
                            {
                                "path": "action/1",
                                "timestamp": "2022-03-03T04:25:06.189574+00:00"
                            }
                        ],
                        "action/2": [
                            {
                                "path": "action/2",
                                "timestamp": "2022-03-03T04:25:06.190336+00:00",
                                "changed_variables": {
                                    "trigger_action": "checkin",
                                    "trigger_delta": 3401183.0949783325,
                                    "last_controller_event": "checkin"
                                },
                                "result": {
                                    "params": {
                                        "domain": "input_text",
                                        "service": "set_value",
                                        "service_data": {
                                            "entity_id": "input_text.zz_dining_room_lights_controller_1_last_event",
                                            "value": {
                                                "trigger_action": "checkin",
                                                "last_triggered": "2022-03-03 12:25:06.190452+08:00"
                                            }
                                        },
                                        "target": {}
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "action/3": [
                            {
                                "path": "action/3",
                                "timestamp": "2022-03-03T04:25:06.191845+00:00"
                            }
                        ],
                        "action/3/choose/0": [
                            {
                                "path": "action/3/choose/0",
                                "timestamp": "2022-03-03T04:25:06.191899+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/0/conditions/0": [
                            {
                                "path": "action/3/choose/0/conditions/0",
                                "timestamp": "2022-03-03T04:25:06.191928+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/1": [
                            {
                                "path": "action/3/choose/1",
                                "timestamp": "2022-03-03T04:25:06.192069+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/1/conditions/0": [
                            {
                                "path": "action/3/choose/1/conditions/0",
                                "timestamp": "2022-03-03T04:25:06.192114+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/2": [
                            {
                                "path": "action/3/choose/2",
                                "timestamp": "2022-03-03T04:25:06.192199+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/2/conditions/0": [
                            {
                                "path": "action/3/choose/2/conditions/0",
                                "timestamp": "2022-03-03T04:25:06.192218+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/3": [
                            {
                                "path": "action/3/choose/3",
                                "timestamp": "2022-03-03T04:25:06.192316+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/3/conditions/0": [
                            {
                                "path": "action/3/choose/3/conditions/0",
                                "timestamp": "2022-03-03T04:25:06.192334+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/4": [
                            {
                                "path": "action/3/choose/4",
                                "timestamp": "2022-03-03T04:25:06.192416+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/4/conditions/0": [
                            {
                                "path": "action/3/choose/4/conditions/0",
                                "timestamp": "2022-03-03T04:25:06.192433+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/5": [
                            {
                                "path": "action/3/choose/5",
                                "timestamp": "2022-03-03T04:25:06.192509+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/5/conditions/0": [
                            {
                                "path": "action/3/choose/5/conditions/0",
                                "timestamp": "2022-03-03T04:25:06.192526+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ]
                    },
                    "config": {
                        "variables": {
                            "integration": "ZHA",
                            "button_up_long_loop": true,
                            "button_up_long_max_loop_repeats": 50,
                            "button_up_double_press": false,
                            "button_down_long_loop": true,
                            "button_down_long_max_loop_repeats": 50,
                            "button_down_double_press": false,
                            "helper_last_controller_event": "input_text.zz_dining_room_lights_controller_1_last_event",
                            "helper_double_press_delay": 500,
                            "helper_debounce_delay": 0,
                            "integration_id": "{{ integration | lower }}",
                            "adjusted_double_press_delay": "{{ [helper_double_press_delay - helper_debounce_delay, 100] | max }}",
                            "actions_mapping": {
                                "deconz": {
                                    "button_up_short": [
                                        "1002"
                                    ],
                                    "button_up_long": [
                                        "1001"
                                    ],
                                    "button_up_release": [
                                        "1003"
                                    ],
                                    "button_down_short": [
                                        "2002"
                                    ],
                                    "button_down_long": [
                                        "2001"
                                    ],
                                    "button_down_release": [
                                        "2003"
                                    ]
                                },
                                "zha": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ]
                                },
                                "zigbee2mqtt": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "brightness_move_up"
                                    ],
                                    "button_up_release": [
                                        "brightness_stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "brightness_move_down"
                                    ],
                                    "button_down_release": [
                                        "brightness_stop"
                                    ]
                                }
                            },
                            "button_up_short": "{{ actions_mapping[integration_id][\"button_up_short\"] }}",
                            "button_up_long": "{{ actions_mapping[integration_id][\"button_up_long\"] }}",
                            "button_up_release": "{{ actions_mapping[integration_id][\"button_up_release\"] }}",
                            "button_down_short": "{{ actions_mapping[integration_id][\"button_down_short\"] }}",
                            "button_down_long": "{{ actions_mapping[integration_id][\"button_down_long\"] }}",
                            "button_down_release": "{{ actions_mapping[integration_id][\"button_down_release\"] }}",
                            "integrations_with_prev_event_storage": [
                                "zha",
                                "zigbee2mqtt"
                            ],
                            "controller_entity": "",
                            "controller_device": "0df2cd0b0fa9112188778c56db622911",
                            "controller_id": "{% if integration_id==\"zigbee2mqtt\" %}{{controller_entity}}{% else %}{{controller_device}}{% endif %}"
                        },
                        "mode": "restart",
                        "max_exceeded": "silent",
                        "trigger": [
                            {
                                "platform": "event",
                                "event_type": "state_changed",
                                "event_data": {
                                    "entity_id": ""
                                }
                            },
                            {
                                "platform": "event",
                                "event_type": [
                                    "deconz_event",
                                    "zha_event"
                                ],
                                "event_data": {
                                    "device_id": "0df2cd0b0fa9112188778c56db622911"
                                }
                            }
                        ],
                        "condition": [
                            {
                                "condition": "and",
                                "conditions": [
                                    "{%- set trigger_action -%} {%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%} {%- endset -%} {{ trigger_action not in [\"\",\"None\"] }}",
                                    "{{ integration_id != \"zigbee2mqtt\" or trigger.event.data.new_state.state != trigger.event.data.old_state.state }}"
                                ]
                            }
                        ],
                        "action": [
                            {
                                "delay": {
                                    "milliseconds": 0
                                }
                            },
                            {
                                "variables": {
                                    "trigger_action": "{%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%}",
                                    "trigger_delta": "{{ (as_timestamp(now()) - as_timestamp((states(helper_last_controller_event) | from_json).last_triggered if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"1970-01-01 00:00:00\")) * 1000 }}",
                                    "last_controller_event": "{{ (states(helper_last_controller_event) | from_json).trigger_action if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"\" }}"
                                }
                            },
                            {
                                "service": "input_text.set_value",
                                "data": {
                                    "entity_id": "input_text.zz_dining_room_lights_controller_1_last_event",
                                    "value": "{{ {\"trigger_action\":trigger_action,\"last_triggered\":now()|string} | to_json }}"
                                }
                            },
                            {
                                "choose": [
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_dining_room_lights_controller_1_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_up_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_up_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "light.turn_on",
                                                                                        "target": {
                                                                                            "entity_id": "light.dining_room_lights"
                                                                                        },
                                                                                        "data": {
                                                                                            "brightness_pct": 100
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_up_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "light.turn_on",
                                                                        "target": {
                                                                            "entity_id": "light.dining_room_lights"
                                                                        },
                                                                        "data": {
                                                                            "brightness_pct": 100
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_up_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "light.turn_on",
                                                                            "target": {
                                                                                "entity_id": "light.dining_room_lights"
                                                                            },
                                                                            "data": {
                                                                                "brightness_step_pct": 10
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.dining_room_lights"
                                                        },
                                                        "data": {
                                                            "brightness_step_pct": 10
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_up_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_up_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_dining_room_lights_controller_1_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_down_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_down_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "light.turn_off",
                                                                                        "target": {
                                                                                            "entity_id": "light.dining_room_lights"
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_down_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "light.turn_off",
                                                                        "target": {
                                                                            "entity_id": "light.dining_room_lights"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_down_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "light.turn_on",
                                                                            "target": {
                                                                                "entity_id": "light.dining_room_lights"
                                                                            },
                                                                            "data": {
                                                                                "brightness_step_pct": -10
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.dining_room_lights"
                                                        },
                                                        "data": {
                                                            "brightness_step_pct": -10
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_down_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_down_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            }
                        ],
                        "id": "1643640720985",
                        "alias": "Dining Room Lights Controller 1",
                        "description": "Control the Dining Room Lights"
                    },
                    "blueprint_inputs": {
                        "id": "1643640720985",
                        "alias": "Dining Room Lights Controller 1",
                        "description": "Control the Dining Room Lights",
                        "use_blueprint": {
                            "path": "EPMatt/ikea_e1743.yaml",
                            "input": {
                                "integration": "ZHA",
                                "controller_device": "0df2cd0b0fa9112188778c56db622911",
                                "helper_last_controller_event": "input_text.zz_dining_room_lights_controller_1_last_event",
                                "action_button_up_short": [
                                    {
                                        "service": "light.turn_on",
                                        "target": {
                                            "entity_id": "light.dining_room_lights"
                                        },
                                        "data": {
                                            "brightness_pct": 100
                                        }
                                    }
                                ],
                                "action_button_up_long": [
                                    {
                                        "service": "light.turn_on",
                                        "target": {
                                            "entity_id": "light.dining_room_lights"
                                        },
                                        "data": {
                                            "brightness_step_pct": 10
                                        }
                                    }
                                ],
                                "action_button_down_short": [
                                    {
                                        "service": "light.turn_off",
                                        "target": {
                                            "entity_id": "light.dining_room_lights"
                                        }
                                    }
                                ],
                                "action_button_down_long": [
                                    {
                                        "service": "light.turn_on",
                                        "target": {
                                            "entity_id": "light.dining_room_lights"
                                        },
                                        "data": {
                                            "brightness_step_pct": -10
                                        }
                                    }
                                ],
                                "button_up_long_loop": true,
                                "button_up_long_max_loop_repeats": 50,
                                "button_down_long_loop": true,
                                "button_down_long_max_loop_repeats": 50
                            }
                        }
                    },
                    "context": {
                        "id": "0b7dbf242c18633e6c05bd732e020a75",
                        "parent_id": "c1b782a1be2a41e03cde8dcda456cb15",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "a1b18c237c3b5629a6b07208577393b8",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T04:25:06.186749+00:00",
                        "finish": "2022-03-03T04:25:06.193259+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643640720985",
                    "trigger": "event 'zha_event'"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "f3c276355fb0abc4720208aae5859a57",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:21:47.316479+00:00",
                        "finish": "2022-03-03T05:21:47.324262+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643640720985",
                    "trigger": "event 'zha_event'",
                    "trace": {
                        "trigger/1": [
                            {
                                "path": "trigger/1",
                                "timestamp": "2022-03-03T05:21:47.317210+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.dining_room_light_controller_1",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T04:25:06.187909+00:00",
                                            "mode": "restart",
                                            "current": 0,
                                            "id": "1643640720985",
                                            "friendly_name": "Dining Room Lights Controller 1"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.797944+00:00",
                                        "last_updated": "2022-03-03T04:25:06.192636+00:00",
                                        "context": {
                                            "id": "0b7dbf242c18633e6c05bd732e020a75",
                                            "parent_id": "c1b782a1be2a41e03cde8dcda456cb15",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "1",
                                        "idx": "1",
                                        "platform": "event",
                                        "event": {
                                            "event_type": "zha_event",
                                            "data": {
                                                "device_ieee": "84:fd:27:ff:fe:9f:0f:e0",
                                                "unique_id": "84:fd:27:ff:fe:9f:0f:e0:1:0x0020",
                                                "device_id": "0df2cd0b0fa9112188778c56db622911",
                                                "endpoint_id": 1,
                                                "cluster_id": 32,
                                                "command": "checkin",
                                                "args": []
                                            },
                                            "origin": "LOCAL",
                                            "time_fired": "2022-03-03T05:21:47.315441+00:00",
                                            "context": {
                                                "id": "f68b80f8aeb127dfc5720bec66b02b52",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "description": "event 'zha_event'"
                                    },
                                    "integration": "ZHA",
                                    "button_up_long_loop": true,
                                    "button_up_long_max_loop_repeats": 50,
                                    "button_up_double_press": false,
                                    "button_down_long_loop": true,
                                    "button_down_long_max_loop_repeats": 50,
                                    "button_down_double_press": false,
                                    "helper_last_controller_event": "input_text.zz_dining_room_lights_controller_1_last_event",
                                    "helper_double_press_delay": 500,
                                    "helper_debounce_delay": 0,
                                    "integration_id": "zha",
                                    "adjusted_double_press_delay": 500,
                                    "actions_mapping": {
                                        "deconz": {
                                            "button_up_short": [
                                                "1002"
                                            ],
                                            "button_up_long": [
                                                "1001"
                                            ],
                                            "button_up_release": [
                                                "1003"
                                            ],
                                            "button_down_short": [
                                                "2002"
                                            ],
                                            "button_down_long": [
                                                "2001"
                                            ],
                                            "button_down_release": [
                                                "2003"
                                            ]
                                        },
                                        "zha": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "move_with_on_off_0_83"
                                            ],
                                            "button_up_release": [
                                                "stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "move_1_83"
                                            ],
                                            "button_down_release": [
                                                "stop"
                                            ]
                                        },
                                        "zigbee2mqtt": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "brightness_move_up"
                                            ],
                                            "button_up_release": [
                                                "brightness_stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "brightness_move_down"
                                            ],
                                            "button_down_release": [
                                                "brightness_stop"
                                            ]
                                        }
                                    },
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ],
                                    "integrations_with_prev_event_storage": [
                                        "zha",
                                        "zigbee2mqtt"
                                    ],
                                    "controller_entity": "",
                                    "controller_device": "0df2cd0b0fa9112188778c56db622911",
                                    "controller_id": "0df2cd0b0fa9112188778c56db622911"
                                }
                            }
                        ],
                        "condition/0": [
                            {
                                "path": "condition/0",
                                "timestamp": "2022-03-03T05:21:47.317244+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "condition/0/conditions/0": [
                            {
                                "path": "condition/0/conditions/0",
                                "timestamp": "2022-03-03T05:21:47.317269+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "condition/0/conditions/1": [
                            {
                                "path": "condition/0/conditions/1",
                                "timestamp": "2022-03-03T05:21:47.317401+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T05:21:47.318611+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "c37f5d50a5a7ff4d27eacfd57be988ed",
                                        "parent_id": "f68b80f8aeb127dfc5720bec66b02b52",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "delay": 0.0,
                                    "done": true
                                }
                            }
                        ],
                        "action/1": [
                            {
                                "path": "action/1",
                                "timestamp": "2022-03-03T05:21:47.319758+00:00"
                            }
                        ],
                        "action/2": [
                            {
                                "path": "action/2",
                                "timestamp": "2022-03-03T05:21:47.320329+00:00",
                                "changed_variables": {
                                    "trigger_action": "checkin",
                                    "trigger_delta": 3401129.584789276,
                                    "last_controller_event": "checkin"
                                },
                                "result": {
                                    "params": {
                                        "domain": "input_text",
                                        "service": "set_value",
                                        "service_data": {
                                            "entity_id": "input_text.zz_dining_room_lights_controller_1_last_event",
                                            "value": {
                                                "trigger_action": "checkin",
                                                "last_triggered": "2022-03-03 13:21:47.320425+08:00"
                                            }
                                        },
                                        "target": {}
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "action/3": [
                            {
                                "path": "action/3",
                                "timestamp": "2022-03-03T05:21:47.322566+00:00"
                            }
                        ],
                        "action/3/choose/0": [
                            {
                                "path": "action/3/choose/0",
                                "timestamp": "2022-03-03T05:21:47.322624+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/0/conditions/0": [
                            {
                                "path": "action/3/choose/0/conditions/0",
                                "timestamp": "2022-03-03T05:21:47.322645+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/1": [
                            {
                                "path": "action/3/choose/1",
                                "timestamp": "2022-03-03T05:21:47.322794+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/1/conditions/0": [
                            {
                                "path": "action/3/choose/1/conditions/0",
                                "timestamp": "2022-03-03T05:21:47.322816+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/2": [
                            {
                                "path": "action/3/choose/2",
                                "timestamp": "2022-03-03T05:21:47.322898+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/2/conditions/0": [
                            {
                                "path": "action/3/choose/2/conditions/0",
                                "timestamp": "2022-03-03T05:21:47.322916+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/3": [
                            {
                                "path": "action/3/choose/3",
                                "timestamp": "2022-03-03T05:21:47.323017+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/3/conditions/0": [
                            {
                                "path": "action/3/choose/3/conditions/0",
                                "timestamp": "2022-03-03T05:21:47.323038+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/4": [
                            {
                                "path": "action/3/choose/4",
                                "timestamp": "2022-03-03T05:21:47.323127+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/4/conditions/0": [
                            {
                                "path": "action/3/choose/4/conditions/0",
                                "timestamp": "2022-03-03T05:21:47.323145+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/5": [
                            {
                                "path": "action/3/choose/5",
                                "timestamp": "2022-03-03T05:21:47.323220+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/5/conditions/0": [
                            {
                                "path": "action/3/choose/5/conditions/0",
                                "timestamp": "2022-03-03T05:21:47.323238+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ]
                    },
                    "config": {
                        "variables": {
                            "integration": "ZHA",
                            "button_up_long_loop": true,
                            "button_up_long_max_loop_repeats": 50,
                            "button_up_double_press": false,
                            "button_down_long_loop": true,
                            "button_down_long_max_loop_repeats": 50,
                            "button_down_double_press": false,
                            "helper_last_controller_event": "input_text.zz_dining_room_lights_controller_1_last_event",
                            "helper_double_press_delay": 500,
                            "helper_debounce_delay": 0,
                            "integration_id": "{{ integration | lower }}",
                            "adjusted_double_press_delay": "{{ [helper_double_press_delay - helper_debounce_delay, 100] | max }}",
                            "actions_mapping": {
                                "deconz": {
                                    "button_up_short": [
                                        "1002"
                                    ],
                                    "button_up_long": [
                                        "1001"
                                    ],
                                    "button_up_release": [
                                        "1003"
                                    ],
                                    "button_down_short": [
                                        "2002"
                                    ],
                                    "button_down_long": [
                                        "2001"
                                    ],
                                    "button_down_release": [
                                        "2003"
                                    ]
                                },
                                "zha": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ]
                                },
                                "zigbee2mqtt": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "brightness_move_up"
                                    ],
                                    "button_up_release": [
                                        "brightness_stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "brightness_move_down"
                                    ],
                                    "button_down_release": [
                                        "brightness_stop"
                                    ]
                                }
                            },
                            "button_up_short": "{{ actions_mapping[integration_id][\"button_up_short\"] }}",
                            "button_up_long": "{{ actions_mapping[integration_id][\"button_up_long\"] }}",
                            "button_up_release": "{{ actions_mapping[integration_id][\"button_up_release\"] }}",
                            "button_down_short": "{{ actions_mapping[integration_id][\"button_down_short\"] }}",
                            "button_down_long": "{{ actions_mapping[integration_id][\"button_down_long\"] }}",
                            "button_down_release": "{{ actions_mapping[integration_id][\"button_down_release\"] }}",
                            "integrations_with_prev_event_storage": [
                                "zha",
                                "zigbee2mqtt"
                            ],
                            "controller_entity": "",
                            "controller_device": "0df2cd0b0fa9112188778c56db622911",
                            "controller_id": "{% if integration_id==\"zigbee2mqtt\" %}{{controller_entity}}{% else %}{{controller_device}}{% endif %}"
                        },
                        "mode": "restart",
                        "max_exceeded": "silent",
                        "trigger": [
                            {
                                "platform": "event",
                                "event_type": "state_changed",
                                "event_data": {
                                    "entity_id": ""
                                }
                            },
                            {
                                "platform": "event",
                                "event_type": [
                                    "deconz_event",
                                    "zha_event"
                                ],
                                "event_data": {
                                    "device_id": "0df2cd0b0fa9112188778c56db622911"
                                }
                            }
                        ],
                        "condition": [
                            {
                                "condition": "and",
                                "conditions": [
                                    "{%- set trigger_action -%} {%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%} {%- endset -%} {{ trigger_action not in [\"\",\"None\"] }}",
                                    "{{ integration_id != \"zigbee2mqtt\" or trigger.event.data.new_state.state != trigger.event.data.old_state.state }}"
                                ]
                            }
                        ],
                        "action": [
                            {
                                "delay": {
                                    "milliseconds": 0
                                }
                            },
                            {
                                "variables": {
                                    "trigger_action": "{%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%}",
                                    "trigger_delta": "{{ (as_timestamp(now()) - as_timestamp((states(helper_last_controller_event) | from_json).last_triggered if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"1970-01-01 00:00:00\")) * 1000 }}",
                                    "last_controller_event": "{{ (states(helper_last_controller_event) | from_json).trigger_action if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"\" }}"
                                }
                            },
                            {
                                "service": "input_text.set_value",
                                "data": {
                                    "entity_id": "input_text.zz_dining_room_lights_controller_1_last_event",
                                    "value": "{{ {\"trigger_action\":trigger_action,\"last_triggered\":now()|string} | to_json }}"
                                }
                            },
                            {
                                "choose": [
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_dining_room_lights_controller_1_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_up_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_up_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "light.turn_on",
                                                                                        "target": {
                                                                                            "entity_id": "light.dining_room_lights"
                                                                                        },
                                                                                        "data": {
                                                                                            "brightness_pct": 100
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_up_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "light.turn_on",
                                                                        "target": {
                                                                            "entity_id": "light.dining_room_lights"
                                                                        },
                                                                        "data": {
                                                                            "brightness_pct": 100
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_up_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "light.turn_on",
                                                                            "target": {
                                                                                "entity_id": "light.dining_room_lights"
                                                                            },
                                                                            "data": {
                                                                                "brightness_step_pct": 10
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.dining_room_lights"
                                                        },
                                                        "data": {
                                                            "brightness_step_pct": 10
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_up_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_up_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_dining_room_lights_controller_1_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_down_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_down_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "light.turn_off",
                                                                                        "target": {
                                                                                            "entity_id": "light.dining_room_lights"
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_down_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "light.turn_off",
                                                                        "target": {
                                                                            "entity_id": "light.dining_room_lights"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_down_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "light.turn_on",
                                                                            "target": {
                                                                                "entity_id": "light.dining_room_lights"
                                                                            },
                                                                            "data": {
                                                                                "brightness_step_pct": -10
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.dining_room_lights"
                                                        },
                                                        "data": {
                                                            "brightness_step_pct": -10
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_down_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_down_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            }
                        ],
                        "id": "1643640720985",
                        "alias": "Dining Room Lights Controller 1",
                        "description": "Control the Dining Room Lights"
                    },
                    "blueprint_inputs": {
                        "id": "1643640720985",
                        "alias": "Dining Room Lights Controller 1",
                        "description": "Control the Dining Room Lights",
                        "use_blueprint": {
                            "path": "EPMatt/ikea_e1743.yaml",
                            "input": {
                                "integration": "ZHA",
                                "controller_device": "0df2cd0b0fa9112188778c56db622911",
                                "helper_last_controller_event": "input_text.zz_dining_room_lights_controller_1_last_event",
                                "action_button_up_short": [
                                    {
                                        "service": "light.turn_on",
                                        "target": {
                                            "entity_id": "light.dining_room_lights"
                                        },
                                        "data": {
                                            "brightness_pct": 100
                                        }
                                    }
                                ],
                                "action_button_up_long": [
                                    {
                                        "service": "light.turn_on",
                                        "target": {
                                            "entity_id": "light.dining_room_lights"
                                        },
                                        "data": {
                                            "brightness_step_pct": 10
                                        }
                                    }
                                ],
                                "action_button_down_short": [
                                    {
                                        "service": "light.turn_off",
                                        "target": {
                                            "entity_id": "light.dining_room_lights"
                                        }
                                    }
                                ],
                                "action_button_down_long": [
                                    {
                                        "service": "light.turn_on",
                                        "target": {
                                            "entity_id": "light.dining_room_lights"
                                        },
                                        "data": {
                                            "brightness_step_pct": -10
                                        }
                                    }
                                ],
                                "button_up_long_loop": true,
                                "button_up_long_max_loop_repeats": 50,
                                "button_down_long_loop": true,
                                "button_down_long_max_loop_repeats": 50
                            }
                        }
                    },
                    "context": {
                        "id": "c37f5d50a5a7ff4d27eacfd57be988ed",
                        "parent_id": "f68b80f8aeb127dfc5720bec66b02b52",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "f3c276355fb0abc4720208aae5859a57",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:21:47.316479+00:00",
                        "finish": "2022-03-03T05:21:47.324262+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643640720985",
                    "trigger": "event 'zha_event'"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "7d5e741a343999f69fd1e677b2605b49",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T06:18:28.463680+00:00",
                        "finish": "2022-03-03T06:18:28.473403+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643640720985",
                    "trigger": "event 'zha_event'",
                    "trace": {
                        "trigger/1": [
                            {
                                "path": "trigger/1",
                                "timestamp": "2022-03-03T06:18:28.464561+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.dining_room_light_controller_1",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T05:21:47.317570+00:00",
                                            "mode": "restart",
                                            "current": 0,
                                            "id": "1643640720985",
                                            "friendly_name": "Dining Room Lights Controller 1"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.797944+00:00",
                                        "last_updated": "2022-03-03T05:21:47.323359+00:00",
                                        "context": {
                                            "id": "c37f5d50a5a7ff4d27eacfd57be988ed",
                                            "parent_id": "f68b80f8aeb127dfc5720bec66b02b52",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "1",
                                        "idx": "1",
                                        "platform": "event",
                                        "event": {
                                            "event_type": "zha_event",
                                            "data": {
                                                "device_ieee": "84:fd:27:ff:fe:9f:0f:e0",
                                                "unique_id": "84:fd:27:ff:fe:9f:0f:e0:1:0x0020",
                                                "device_id": "0df2cd0b0fa9112188778c56db622911",
                                                "endpoint_id": 1,
                                                "cluster_id": 32,
                                                "command": "checkin",
                                                "args": []
                                            },
                                            "origin": "LOCAL",
                                            "time_fired": "2022-03-03T06:18:28.462813+00:00",
                                            "context": {
                                                "id": "a04b0df929584c73f35442c6b963f6b2",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "description": "event 'zha_event'"
                                    },
                                    "integration": "ZHA",
                                    "button_up_long_loop": true,
                                    "button_up_long_max_loop_repeats": 50,
                                    "button_up_double_press": false,
                                    "button_down_long_loop": true,
                                    "button_down_long_max_loop_repeats": 50,
                                    "button_down_double_press": false,
                                    "helper_last_controller_event": "input_text.zz_dining_room_lights_controller_1_last_event",
                                    "helper_double_press_delay": 500,
                                    "helper_debounce_delay": 0,
                                    "integration_id": "zha",
                                    "adjusted_double_press_delay": 500,
                                    "actions_mapping": {
                                        "deconz": {
                                            "button_up_short": [
                                                "1002"
                                            ],
                                            "button_up_long": [
                                                "1001"
                                            ],
                                            "button_up_release": [
                                                "1003"
                                            ],
                                            "button_down_short": [
                                                "2002"
                                            ],
                                            "button_down_long": [
                                                "2001"
                                            ],
                                            "button_down_release": [
                                                "2003"
                                            ]
                                        },
                                        "zha": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "move_with_on_off_0_83"
                                            ],
                                            "button_up_release": [
                                                "stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "move_1_83"
                                            ],
                                            "button_down_release": [
                                                "stop"
                                            ]
                                        },
                                        "zigbee2mqtt": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "brightness_move_up"
                                            ],
                                            "button_up_release": [
                                                "brightness_stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "brightness_move_down"
                                            ],
                                            "button_down_release": [
                                                "brightness_stop"
                                            ]
                                        }
                                    },
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ],
                                    "integrations_with_prev_event_storage": [
                                        "zha",
                                        "zigbee2mqtt"
                                    ],
                                    "controller_entity": "",
                                    "controller_device": "0df2cd0b0fa9112188778c56db622911",
                                    "controller_id": "0df2cd0b0fa9112188778c56db622911"
                                }
                            }
                        ],
                        "condition/0": [
                            {
                                "path": "condition/0",
                                "timestamp": "2022-03-03T06:18:28.464596+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "condition/0/conditions/0": [
                            {
                                "path": "condition/0/conditions/0",
                                "timestamp": "2022-03-03T06:18:28.464619+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "condition/0/conditions/1": [
                            {
                                "path": "condition/0/conditions/1",
                                "timestamp": "2022-03-03T06:18:28.464830+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T06:18:28.465848+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "6bf00a31df631eb71e10d0ba552dbc64",
                                        "parent_id": "a04b0df929584c73f35442c6b963f6b2",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "delay": 0.0,
                                    "done": true
                                }
                            }
                        ],
                        "action/1": [
                            {
                                "path": "action/1",
                                "timestamp": "2022-03-03T06:18:28.468235+00:00"
                            }
                        ],
                        "action/2": [
                            {
                                "path": "action/2",
                                "timestamp": "2022-03-03T06:18:28.468990+00:00",
                                "changed_variables": {
                                    "trigger_action": "checkin",
                                    "trigger_delta": 3401148.092985153,
                                    "last_controller_event": "checkin"
                                },
                                "result": {
                                    "params": {
                                        "domain": "input_text",
                                        "service": "set_value",
                                        "service_data": {
                                            "entity_id": "input_text.zz_dining_room_lights_controller_1_last_event",
                                            "value": {
                                                "trigger_action": "checkin",
                                                "last_triggered": "2022-03-03 14:18:28.469151+08:00"
                                            }
                                        },
                                        "target": {}
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "action/3": [
                            {
                                "path": "action/3",
                                "timestamp": "2022-03-03T06:18:28.471391+00:00"
                            }
                        ],
                        "action/3/choose/0": [
                            {
                                "path": "action/3/choose/0",
                                "timestamp": "2022-03-03T06:18:28.471458+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/0/conditions/0": [
                            {
                                "path": "action/3/choose/0/conditions/0",
                                "timestamp": "2022-03-03T06:18:28.471485+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/1": [
                            {
                                "path": "action/3/choose/1",
                                "timestamp": "2022-03-03T06:18:28.471632+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/1/conditions/0": [
                            {
                                "path": "action/3/choose/1/conditions/0",
                                "timestamp": "2022-03-03T06:18:28.471657+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/2": [
                            {
                                "path": "action/3/choose/2",
                                "timestamp": "2022-03-03T06:18:28.471800+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/2/conditions/0": [
                            {
                                "path": "action/3/choose/2/conditions/0",
                                "timestamp": "2022-03-03T06:18:28.471825+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/3": [
                            {
                                "path": "action/3/choose/3",
                                "timestamp": "2022-03-03T06:18:28.471922+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/3/conditions/0": [
                            {
                                "path": "action/3/choose/3/conditions/0",
                                "timestamp": "2022-03-03T06:18:28.471958+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/4": [
                            {
                                "path": "action/3/choose/4",
                                "timestamp": "2022-03-03T06:18:28.472085+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/4/conditions/0": [
                            {
                                "path": "action/3/choose/4/conditions/0",
                                "timestamp": "2022-03-03T06:18:28.472109+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/5": [
                            {
                                "path": "action/3/choose/5",
                                "timestamp": "2022-03-03T06:18:28.472201+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/5/conditions/0": [
                            {
                                "path": "action/3/choose/5/conditions/0",
                                "timestamp": "2022-03-03T06:18:28.472232+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ]
                    },
                    "config": {
                        "variables": {
                            "integration": "ZHA",
                            "button_up_long_loop": true,
                            "button_up_long_max_loop_repeats": 50,
                            "button_up_double_press": false,
                            "button_down_long_loop": true,
                            "button_down_long_max_loop_repeats": 50,
                            "button_down_double_press": false,
                            "helper_last_controller_event": "input_text.zz_dining_room_lights_controller_1_last_event",
                            "helper_double_press_delay": 500,
                            "helper_debounce_delay": 0,
                            "integration_id": "{{ integration | lower }}",
                            "adjusted_double_press_delay": "{{ [helper_double_press_delay - helper_debounce_delay, 100] | max }}",
                            "actions_mapping": {
                                "deconz": {
                                    "button_up_short": [
                                        "1002"
                                    ],
                                    "button_up_long": [
                                        "1001"
                                    ],
                                    "button_up_release": [
                                        "1003"
                                    ],
                                    "button_down_short": [
                                        "2002"
                                    ],
                                    "button_down_long": [
                                        "2001"
                                    ],
                                    "button_down_release": [
                                        "2003"
                                    ]
                                },
                                "zha": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ]
                                },
                                "zigbee2mqtt": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "brightness_move_up"
                                    ],
                                    "button_up_release": [
                                        "brightness_stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "brightness_move_down"
                                    ],
                                    "button_down_release": [
                                        "brightness_stop"
                                    ]
                                }
                            },
                            "button_up_short": "{{ actions_mapping[integration_id][\"button_up_short\"] }}",
                            "button_up_long": "{{ actions_mapping[integration_id][\"button_up_long\"] }}",
                            "button_up_release": "{{ actions_mapping[integration_id][\"button_up_release\"] }}",
                            "button_down_short": "{{ actions_mapping[integration_id][\"button_down_short\"] }}",
                            "button_down_long": "{{ actions_mapping[integration_id][\"button_down_long\"] }}",
                            "button_down_release": "{{ actions_mapping[integration_id][\"button_down_release\"] }}",
                            "integrations_with_prev_event_storage": [
                                "zha",
                                "zigbee2mqtt"
                            ],
                            "controller_entity": "",
                            "controller_device": "0df2cd0b0fa9112188778c56db622911",
                            "controller_id": "{% if integration_id==\"zigbee2mqtt\" %}{{controller_entity}}{% else %}{{controller_device}}{% endif %}"
                        },
                        "mode": "restart",
                        "max_exceeded": "silent",
                        "trigger": [
                            {
                                "platform": "event",
                                "event_type": "state_changed",
                                "event_data": {
                                    "entity_id": ""
                                }
                            },
                            {
                                "platform": "event",
                                "event_type": [
                                    "deconz_event",
                                    "zha_event"
                                ],
                                "event_data": {
                                    "device_id": "0df2cd0b0fa9112188778c56db622911"
                                }
                            }
                        ],
                        "condition": [
                            {
                                "condition": "and",
                                "conditions": [
                                    "{%- set trigger_action -%} {%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%} {%- endset -%} {{ trigger_action not in [\"\",\"None\"] }}",
                                    "{{ integration_id != \"zigbee2mqtt\" or trigger.event.data.new_state.state != trigger.event.data.old_state.state }}"
                                ]
                            }
                        ],
                        "action": [
                            {
                                "delay": {
                                    "milliseconds": 0
                                }
                            },
                            {
                                "variables": {
                                    "trigger_action": "{%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%}",
                                    "trigger_delta": "{{ (as_timestamp(now()) - as_timestamp((states(helper_last_controller_event) | from_json).last_triggered if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"1970-01-01 00:00:00\")) * 1000 }}",
                                    "last_controller_event": "{{ (states(helper_last_controller_event) | from_json).trigger_action if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"\" }}"
                                }
                            },
                            {
                                "service": "input_text.set_value",
                                "data": {
                                    "entity_id": "input_text.zz_dining_room_lights_controller_1_last_event",
                                    "value": "{{ {\"trigger_action\":trigger_action,\"last_triggered\":now()|string} | to_json }}"
                                }
                            },
                            {
                                "choose": [
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_dining_room_lights_controller_1_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_up_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_up_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "light.turn_on",
                                                                                        "target": {
                                                                                            "entity_id": "light.dining_room_lights"
                                                                                        },
                                                                                        "data": {
                                                                                            "brightness_pct": 100
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_up_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "light.turn_on",
                                                                        "target": {
                                                                            "entity_id": "light.dining_room_lights"
                                                                        },
                                                                        "data": {
                                                                            "brightness_pct": 100
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_up_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "light.turn_on",
                                                                            "target": {
                                                                                "entity_id": "light.dining_room_lights"
                                                                            },
                                                                            "data": {
                                                                                "brightness_step_pct": 10
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.dining_room_lights"
                                                        },
                                                        "data": {
                                                            "brightness_step_pct": 10
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_up_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_up_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_dining_room_lights_controller_1_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_down_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_down_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "light.turn_off",
                                                                                        "target": {
                                                                                            "entity_id": "light.dining_room_lights"
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_down_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "light.turn_off",
                                                                        "target": {
                                                                            "entity_id": "light.dining_room_lights"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_down_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "light.turn_on",
                                                                            "target": {
                                                                                "entity_id": "light.dining_room_lights"
                                                                            },
                                                                            "data": {
                                                                                "brightness_step_pct": -10
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.dining_room_lights"
                                                        },
                                                        "data": {
                                                            "brightness_step_pct": -10
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_down_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_down_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            }
                        ],
                        "id": "1643640720985",
                        "alias": "Dining Room Lights Controller 1",
                        "description": "Control the Dining Room Lights"
                    },
                    "blueprint_inputs": {
                        "id": "1643640720985",
                        "alias": "Dining Room Lights Controller 1",
                        "description": "Control the Dining Room Lights",
                        "use_blueprint": {
                            "path": "EPMatt/ikea_e1743.yaml",
                            "input": {
                                "integration": "ZHA",
                                "controller_device": "0df2cd0b0fa9112188778c56db622911",
                                "helper_last_controller_event": "input_text.zz_dining_room_lights_controller_1_last_event",
                                "action_button_up_short": [
                                    {
                                        "service": "light.turn_on",
                                        "target": {
                                            "entity_id": "light.dining_room_lights"
                                        },
                                        "data": {
                                            "brightness_pct": 100
                                        }
                                    }
                                ],
                                "action_button_up_long": [
                                    {
                                        "service": "light.turn_on",
                                        "target": {
                                            "entity_id": "light.dining_room_lights"
                                        },
                                        "data": {
                                            "brightness_step_pct": 10
                                        }
                                    }
                                ],
                                "action_button_down_short": [
                                    {
                                        "service": "light.turn_off",
                                        "target": {
                                            "entity_id": "light.dining_room_lights"
                                        }
                                    }
                                ],
                                "action_button_down_long": [
                                    {
                                        "service": "light.turn_on",
                                        "target": {
                                            "entity_id": "light.dining_room_lights"
                                        },
                                        "data": {
                                            "brightness_step_pct": -10
                                        }
                                    }
                                ],
                                "button_up_long_loop": true,
                                "button_up_long_max_loop_repeats": 50,
                                "button_down_long_loop": true,
                                "button_down_long_max_loop_repeats": 50
                            }
                        }
                    },
                    "context": {
                        "id": "6bf00a31df631eb71e10d0ba552dbc64",
                        "parent_id": "a04b0df929584c73f35442c6b963f6b2",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "7d5e741a343999f69fd1e677b2605b49",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T06:18:28.463680+00:00",
                        "finish": "2022-03-03T06:18:28.473403+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643640720985",
                    "trigger": "event 'zha_event'"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "c31f9c06be389f6f9018138099b5d0bf",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T07:15:09.684849+00:00",
                        "finish": "2022-03-03T07:15:09.691547+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643640720985",
                    "trigger": "event 'zha_event'",
                    "trace": {
                        "trigger/1": [
                            {
                                "path": "trigger/1",
                                "timestamp": "2022-03-03T07:15:09.685589+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.dining_room_light_controller_1",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T06:18:28.465040+00:00",
                                            "mode": "restart",
                                            "current": 0,
                                            "id": "1643640720985",
                                            "friendly_name": "Dining Room Lights Controller 1"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.797944+00:00",
                                        "last_updated": "2022-03-03T06:18:28.472362+00:00",
                                        "context": {
                                            "id": "6bf00a31df631eb71e10d0ba552dbc64",
                                            "parent_id": "a04b0df929584c73f35442c6b963f6b2",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "1",
                                        "idx": "1",
                                        "platform": "event",
                                        "event": {
                                            "event_type": "zha_event",
                                            "data": {
                                                "device_ieee": "84:fd:27:ff:fe:9f:0f:e0",
                                                "unique_id": "84:fd:27:ff:fe:9f:0f:e0:1:0x0020",
                                                "device_id": "0df2cd0b0fa9112188778c56db622911",
                                                "endpoint_id": 1,
                                                "cluster_id": 32,
                                                "command": "checkin",
                                                "args": []
                                            },
                                            "origin": "LOCAL",
                                            "time_fired": "2022-03-03T07:15:09.683962+00:00",
                                            "context": {
                                                "id": "394f844fe5ed01ea130299952bd826ee",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "description": "event 'zha_event'"
                                    },
                                    "integration": "ZHA",
                                    "button_up_long_loop": true,
                                    "button_up_long_max_loop_repeats": 50,
                                    "button_up_double_press": false,
                                    "button_down_long_loop": true,
                                    "button_down_long_max_loop_repeats": 50,
                                    "button_down_double_press": false,
                                    "helper_last_controller_event": "input_text.zz_dining_room_lights_controller_1_last_event",
                                    "helper_double_press_delay": 500,
                                    "helper_debounce_delay": 0,
                                    "integration_id": "zha",
                                    "adjusted_double_press_delay": 500,
                                    "actions_mapping": {
                                        "deconz": {
                                            "button_up_short": [
                                                "1002"
                                            ],
                                            "button_up_long": [
                                                "1001"
                                            ],
                                            "button_up_release": [
                                                "1003"
                                            ],
                                            "button_down_short": [
                                                "2002"
                                            ],
                                            "button_down_long": [
                                                "2001"
                                            ],
                                            "button_down_release": [
                                                "2003"
                                            ]
                                        },
                                        "zha": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "move_with_on_off_0_83"
                                            ],
                                            "button_up_release": [
                                                "stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "move_1_83"
                                            ],
                                            "button_down_release": [
                                                "stop"
                                            ]
                                        },
                                        "zigbee2mqtt": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "brightness_move_up"
                                            ],
                                            "button_up_release": [
                                                "brightness_stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "brightness_move_down"
                                            ],
                                            "button_down_release": [
                                                "brightness_stop"
                                            ]
                                        }
                                    },
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ],
                                    "integrations_with_prev_event_storage": [
                                        "zha",
                                        "zigbee2mqtt"
                                    ],
                                    "controller_entity": "",
                                    "controller_device": "0df2cd0b0fa9112188778c56db622911",
                                    "controller_id": "0df2cd0b0fa9112188778c56db622911"
                                }
                            }
                        ],
                        "condition/0": [
                            {
                                "path": "condition/0",
                                "timestamp": "2022-03-03T07:15:09.685627+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "condition/0/conditions/0": [
                            {
                                "path": "condition/0/conditions/0",
                                "timestamp": "2022-03-03T07:15:09.685659+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "condition/0/conditions/1": [
                            {
                                "path": "condition/0/conditions/1",
                                "timestamp": "2022-03-03T07:15:09.685853+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T07:15:09.687115+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "2882444aa739a2a4fc20687f4277e837",
                                        "parent_id": "394f844fe5ed01ea130299952bd826ee",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "delay": 0.0,
                                    "done": true
                                }
                            }
                        ],
                        "action/1": [
                            {
                                "path": "action/1",
                                "timestamp": "2022-03-03T07:15:09.688166+00:00"
                            }
                        ],
                        "action/2": [
                            {
                                "path": "action/2",
                                "timestamp": "2022-03-03T07:15:09.688845+00:00",
                                "changed_variables": {
                                    "trigger_action": "checkin",
                                    "trigger_delta": 3401219.32888031,
                                    "last_controller_event": "checkin"
                                },
                                "result": {
                                    "params": {
                                        "domain": "input_text",
                                        "service": "set_value",
                                        "service_data": {
                                            "entity_id": "input_text.zz_dining_room_lights_controller_1_last_event",
                                            "value": {
                                                "trigger_action": "checkin",
                                                "last_triggered": "2022-03-03 15:15:09.688946+08:00"
                                            }
                                        },
                                        "target": {}
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "action/3": [
                            {
                                "path": "action/3",
                                "timestamp": "2022-03-03T07:15:09.690481+00:00"
                            }
                        ],
                        "action/3/choose/0": [
                            {
                                "path": "action/3/choose/0",
                                "timestamp": "2022-03-03T07:15:09.690539+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/0/conditions/0": [
                            {
                                "path": "action/3/choose/0/conditions/0",
                                "timestamp": "2022-03-03T07:15:09.690562+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/1": [
                            {
                                "path": "action/3/choose/1",
                                "timestamp": "2022-03-03T07:15:09.690662+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/1/conditions/0": [
                            {
                                "path": "action/3/choose/1/conditions/0",
                                "timestamp": "2022-03-03T07:15:09.690706+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/2": [
                            {
                                "path": "action/3/choose/2",
                                "timestamp": "2022-03-03T07:15:09.690803+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/2/conditions/0": [
                            {
                                "path": "action/3/choose/2/conditions/0",
                                "timestamp": "2022-03-03T07:15:09.690824+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/3": [
                            {
                                "path": "action/3/choose/3",
                                "timestamp": "2022-03-03T07:15:09.690899+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/3/conditions/0": [
                            {
                                "path": "action/3/choose/3/conditions/0",
                                "timestamp": "2022-03-03T07:15:09.690918+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/4": [
                            {
                                "path": "action/3/choose/4",
                                "timestamp": "2022-03-03T07:15:09.691015+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/4/conditions/0": [
                            {
                                "path": "action/3/choose/4/conditions/0",
                                "timestamp": "2022-03-03T07:15:09.691033+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/5": [
                            {
                                "path": "action/3/choose/5",
                                "timestamp": "2022-03-03T07:15:09.691098+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/5/conditions/0": [
                            {
                                "path": "action/3/choose/5/conditions/0",
                                "timestamp": "2022-03-03T07:15:09.691114+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ]
                    },
                    "config": {
                        "variables": {
                            "integration": "ZHA",
                            "button_up_long_loop": true,
                            "button_up_long_max_loop_repeats": 50,
                            "button_up_double_press": false,
                            "button_down_long_loop": true,
                            "button_down_long_max_loop_repeats": 50,
                            "button_down_double_press": false,
                            "helper_last_controller_event": "input_text.zz_dining_room_lights_controller_1_last_event",
                            "helper_double_press_delay": 500,
                            "helper_debounce_delay": 0,
                            "integration_id": "{{ integration | lower }}",
                            "adjusted_double_press_delay": "{{ [helper_double_press_delay - helper_debounce_delay, 100] | max }}",
                            "actions_mapping": {
                                "deconz": {
                                    "button_up_short": [
                                        "1002"
                                    ],
                                    "button_up_long": [
                                        "1001"
                                    ],
                                    "button_up_release": [
                                        "1003"
                                    ],
                                    "button_down_short": [
                                        "2002"
                                    ],
                                    "button_down_long": [
                                        "2001"
                                    ],
                                    "button_down_release": [
                                        "2003"
                                    ]
                                },
                                "zha": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ]
                                },
                                "zigbee2mqtt": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "brightness_move_up"
                                    ],
                                    "button_up_release": [
                                        "brightness_stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "brightness_move_down"
                                    ],
                                    "button_down_release": [
                                        "brightness_stop"
                                    ]
                                }
                            },
                            "button_up_short": "{{ actions_mapping[integration_id][\"button_up_short\"] }}",
                            "button_up_long": "{{ actions_mapping[integration_id][\"button_up_long\"] }}",
                            "button_up_release": "{{ actions_mapping[integration_id][\"button_up_release\"] }}",
                            "button_down_short": "{{ actions_mapping[integration_id][\"button_down_short\"] }}",
                            "button_down_long": "{{ actions_mapping[integration_id][\"button_down_long\"] }}",
                            "button_down_release": "{{ actions_mapping[integration_id][\"button_down_release\"] }}",
                            "integrations_with_prev_event_storage": [
                                "zha",
                                "zigbee2mqtt"
                            ],
                            "controller_entity": "",
                            "controller_device": "0df2cd0b0fa9112188778c56db622911",
                            "controller_id": "{% if integration_id==\"zigbee2mqtt\" %}{{controller_entity}}{% else %}{{controller_device}}{% endif %}"
                        },
                        "mode": "restart",
                        "max_exceeded": "silent",
                        "trigger": [
                            {
                                "platform": "event",
                                "event_type": "state_changed",
                                "event_data": {
                                    "entity_id": ""
                                }
                            },
                            {
                                "platform": "event",
                                "event_type": [
                                    "deconz_event",
                                    "zha_event"
                                ],
                                "event_data": {
                                    "device_id": "0df2cd0b0fa9112188778c56db622911"
                                }
                            }
                        ],
                        "condition": [
                            {
                                "condition": "and",
                                "conditions": [
                                    "{%- set trigger_action -%} {%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%} {%- endset -%} {{ trigger_action not in [\"\",\"None\"] }}",
                                    "{{ integration_id != \"zigbee2mqtt\" or trigger.event.data.new_state.state != trigger.event.data.old_state.state }}"
                                ]
                            }
                        ],
                        "action": [
                            {
                                "delay": {
                                    "milliseconds": 0
                                }
                            },
                            {
                                "variables": {
                                    "trigger_action": "{%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%}",
                                    "trigger_delta": "{{ (as_timestamp(now()) - as_timestamp((states(helper_last_controller_event) | from_json).last_triggered if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"1970-01-01 00:00:00\")) * 1000 }}",
                                    "last_controller_event": "{{ (states(helper_last_controller_event) | from_json).trigger_action if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"\" }}"
                                }
                            },
                            {
                                "service": "input_text.set_value",
                                "data": {
                                    "entity_id": "input_text.zz_dining_room_lights_controller_1_last_event",
                                    "value": "{{ {\"trigger_action\":trigger_action,\"last_triggered\":now()|string} | to_json }}"
                                }
                            },
                            {
                                "choose": [
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_dining_room_lights_controller_1_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_up_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_up_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "light.turn_on",
                                                                                        "target": {
                                                                                            "entity_id": "light.dining_room_lights"
                                                                                        },
                                                                                        "data": {
                                                                                            "brightness_pct": 100
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_up_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "light.turn_on",
                                                                        "target": {
                                                                            "entity_id": "light.dining_room_lights"
                                                                        },
                                                                        "data": {
                                                                            "brightness_pct": 100
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_up_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "light.turn_on",
                                                                            "target": {
                                                                                "entity_id": "light.dining_room_lights"
                                                                            },
                                                                            "data": {
                                                                                "brightness_step_pct": 10
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.dining_room_lights"
                                                        },
                                                        "data": {
                                                            "brightness_step_pct": 10
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_up_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_up_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_dining_room_lights_controller_1_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_down_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_down_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "light.turn_off",
                                                                                        "target": {
                                                                                            "entity_id": "light.dining_room_lights"
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_down_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "light.turn_off",
                                                                        "target": {
                                                                            "entity_id": "light.dining_room_lights"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_down_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "light.turn_on",
                                                                            "target": {
                                                                                "entity_id": "light.dining_room_lights"
                                                                            },
                                                                            "data": {
                                                                                "brightness_step_pct": -10
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.dining_room_lights"
                                                        },
                                                        "data": {
                                                            "brightness_step_pct": -10
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_down_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_down_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            }
                        ],
                        "id": "1643640720985",
                        "alias": "Dining Room Lights Controller 1",
                        "description": "Control the Dining Room Lights"
                    },
                    "blueprint_inputs": {
                        "id": "1643640720985",
                        "alias": "Dining Room Lights Controller 1",
                        "description": "Control the Dining Room Lights",
                        "use_blueprint": {
                            "path": "EPMatt/ikea_e1743.yaml",
                            "input": {
                                "integration": "ZHA",
                                "controller_device": "0df2cd0b0fa9112188778c56db622911",
                                "helper_last_controller_event": "input_text.zz_dining_room_lights_controller_1_last_event",
                                "action_button_up_short": [
                                    {
                                        "service": "light.turn_on",
                                        "target": {
                                            "entity_id": "light.dining_room_lights"
                                        },
                                        "data": {
                                            "brightness_pct": 100
                                        }
                                    }
                                ],
                                "action_button_up_long": [
                                    {
                                        "service": "light.turn_on",
                                        "target": {
                                            "entity_id": "light.dining_room_lights"
                                        },
                                        "data": {
                                            "brightness_step_pct": 10
                                        }
                                    }
                                ],
                                "action_button_down_short": [
                                    {
                                        "service": "light.turn_off",
                                        "target": {
                                            "entity_id": "light.dining_room_lights"
                                        }
                                    }
                                ],
                                "action_button_down_long": [
                                    {
                                        "service": "light.turn_on",
                                        "target": {
                                            "entity_id": "light.dining_room_lights"
                                        },
                                        "data": {
                                            "brightness_step_pct": -10
                                        }
                                    }
                                ],
                                "button_up_long_loop": true,
                                "button_up_long_max_loop_repeats": 50,
                                "button_down_long_loop": true,
                                "button_down_long_max_loop_repeats": 50
                            }
                        }
                    },
                    "context": {
                        "id": "2882444aa739a2a4fc20687f4277e837",
                        "parent_id": "394f844fe5ed01ea130299952bd826ee",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/3/choose/5/conditions/0",
                    "run_id": "c31f9c06be389f6f9018138099b5d0bf",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T07:15:09.684849+00:00",
                        "finish": "2022-03-03T07:15:09.691547+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643640720985",
                    "trigger": "event 'zha_event'"
                }
            }
        ],
        "script.turn_off_dining_room": [
            {
                "extended_dict": {
                    "last_step": "sequence/2",
                    "run_id": "5f48fc76415a9745ff447cc0a0b8b4cd",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T01:40:36.829774+00:00",
                        "finish": "2022-03-03T01:40:36.971251+00:00"
                    },
                    "domain": "script",
                    "item_id": "turn_off_dining_room",
                    "trace": {
                        "sequence/0": [
                            {
                                "path": "sequence/0",
                                "timestamp": "2022-03-03T01:40:36.830837+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "script.turn_off_dining_room",
                                        "state": "off",
                                        "attributes": {
                                            "last_triggered": "2022-03-02T23:34:17.979103+00:00",
                                            "mode": "single",
                                            "current": 0,
                                            "icon": "mdi:power",
                                            "friendly_name": "Turn Off Dining Room"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.573431+00:00",
                                        "last_updated": "2022-03-03T00:41:11.573431+00:00",
                                        "context": {
                                            "id": "66579c9605ae8b4690ef7b584758f767",
                                            "parent_id": null,
                                            "user_id": null
                                        }
                                    },
                                    "context": {
                                        "id": "729b8e7d842eee326c967ed25303b41c",
                                        "parent_id": null,
                                        "user_id": "ad2bcce775894550affb6dfef93a2a36"
                                    }
                                },
                                "result": {
                                    "params": {
                                        "domain": "fan",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "fan.dining_room_fan"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "sequence/0/0": [
                            {
                                "path": "sequence/0/0",
                                "timestamp": "2022-03-03T01:40:36.832303+00:00",
                                "child_id": {
                                    "domain": "automation",
                                    "item_id": "1642997460354",
                                    "run_id": "023d719e16e7fc8b89ff50398d56f12e"
                                },
                                "result": {
                                    "params": {
                                        "domain": "input_boolean",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "input_boolean.dining_room_fan_power"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "sequence/1": [
                            {
                                "path": "sequence/1",
                                "timestamp": "2022-03-03T01:40:36.839884+00:00",
                                "result": {
                                    "params": {
                                        "domain": "climate",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "climate.living_dining_room_ac"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "sequence/2": [
                            {
                                "path": "sequence/2",
                                "timestamp": "2022-03-03T01:40:36.842793+00:00",
                                "result": {
                                    "params": {
                                        "domain": "light",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "light.dining_room_lights"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ]
                    },
                    "config": {
                        "sequence": [
                            {
                                "service": "fan.turn_off",
                                "target": {
                                    "entity_id": "fan.dining_room_fan"
                                }
                            },
                            {
                                "service": "climate.turn_off",
                                "target": {
                                    "entity_id": "climate.living_dining_room_ac"
                                }
                            },
                            {
                                "service": "light.turn_off",
                                "target": {
                                    "entity_id": "light.dining_room_lights"
                                }
                            }
                        ],
                        "mode": "single",
                        "alias": "Turn Off Dining Room",
                        "icon": "mdi:power"
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "729b8e7d842eee326c967ed25303b41c",
                        "parent_id": null,
                        "user_id": "ad2bcce775894550affb6dfef93a2a36"
                    }
                },
                "short_dict": {
                    "last_step": "sequence/2",
                    "run_id": "5f48fc76415a9745ff447cc0a0b8b4cd",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T01:40:36.829774+00:00",
                        "finish": "2022-03-03T01:40:36.971251+00:00"
                    },
                    "domain": "script",
                    "item_id": "turn_off_dining_room"
                }
            },
            {
                "extended_dict": {
                    "last_step": "sequence/2",
                    "run_id": "1562abd257a3a337011f907f67c4bb3c",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:09:54.420784+00:00",
                        "finish": "2022-03-03T05:09:54.595186+00:00"
                    },
                    "domain": "script",
                    "item_id": "turn_off_dining_room",
                    "trace": {
                        "sequence/0": [
                            {
                                "path": "sequence/0",
                                "timestamp": "2022-03-03T05:09:54.421587+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "script.turn_off_dining_room",
                                        "state": "off",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T01:40:36.829862+00:00",
                                            "mode": "single",
                                            "current": 0,
                                            "icon": "mdi:power",
                                            "friendly_name": "Turn Off Dining Room"
                                        },
                                        "last_changed": "2022-03-03T01:40:36.970176+00:00",
                                        "last_updated": "2022-03-03T01:40:36.970176+00:00",
                                        "context": {
                                            "id": "729b8e7d842eee326c967ed25303b41c",
                                            "parent_id": null,
                                            "user_id": "ad2bcce775894550affb6dfef93a2a36"
                                        }
                                    },
                                    "context": {
                                        "id": "3c34ab25510e6c3602cf039455c14bd6",
                                        "parent_id": null,
                                        "user_id": "ad2bcce775894550affb6dfef93a2a36"
                                    }
                                },
                                "result": {
                                    "params": {
                                        "domain": "fan",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "fan.dining_room_fan"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "sequence/0/0": [
                            {
                                "path": "sequence/0/0",
                                "timestamp": "2022-03-03T05:09:54.423450+00:00",
                                "child_id": {
                                    "domain": "automation",
                                    "item_id": "1642997460354",
                                    "run_id": "ffe0b81da0844fb7ed6d6f25f53f65fd"
                                },
                                "result": {
                                    "params": {
                                        "domain": "input_boolean",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "input_boolean.dining_room_fan_power"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "sequence/1": [
                            {
                                "path": "sequence/1",
                                "timestamp": "2022-03-03T05:09:54.431728+00:00",
                                "result": {
                                    "params": {
                                        "domain": "climate",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "climate.living_dining_room_ac"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "sequence/2": [
                            {
                                "path": "sequence/2",
                                "timestamp": "2022-03-03T05:09:54.435076+00:00",
                                "result": {
                                    "params": {
                                        "domain": "light",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "light.dining_room_lights"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ]
                    },
                    "config": {
                        "sequence": [
                            {
                                "service": "fan.turn_off",
                                "target": {
                                    "entity_id": "fan.dining_room_fan"
                                }
                            },
                            {
                                "service": "climate.turn_off",
                                "target": {
                                    "entity_id": "climate.living_dining_room_ac"
                                }
                            },
                            {
                                "service": "light.turn_off",
                                "target": {
                                    "entity_id": "light.dining_room_lights"
                                }
                            }
                        ],
                        "mode": "single",
                        "alias": "Turn Off Dining Room",
                        "icon": "mdi:power"
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "3c34ab25510e6c3602cf039455c14bd6",
                        "parent_id": null,
                        "user_id": "ad2bcce775894550affb6dfef93a2a36"
                    }
                },
                "short_dict": {
                    "last_step": "sequence/2",
                    "run_id": "1562abd257a3a337011f907f67c4bb3c",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:09:54.420784+00:00",
                        "finish": "2022-03-03T05:09:54.595186+00:00"
                    },
                    "domain": "script",
                    "item_id": "turn_off_dining_room"
                }
            },
            {
                "extended_dict": {
                    "last_step": "sequence/2",
                    "run_id": "124cafcb24c3ac276764adad5b99d26f",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:10:14.379535+00:00",
                        "finish": "2022-03-03T05:10:14.531350+00:00"
                    },
                    "domain": "script",
                    "item_id": "turn_off_dining_room",
                    "trace": {
                        "sequence/0": [
                            {
                                "path": "sequence/0",
                                "timestamp": "2022-03-03T05:10:14.380246+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "script.turn_off_dining_room",
                                        "state": "off",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T05:09:54.420869+00:00",
                                            "mode": "single",
                                            "current": 0,
                                            "icon": "mdi:power",
                                            "friendly_name": "Turn Off Dining Room"
                                        },
                                        "last_changed": "2022-03-03T05:09:54.593913+00:00",
                                        "last_updated": "2022-03-03T05:09:54.593913+00:00",
                                        "context": {
                                            "id": "3c34ab25510e6c3602cf039455c14bd6",
                                            "parent_id": null,
                                            "user_id": "ad2bcce775894550affb6dfef93a2a36"
                                        }
                                    },
                                    "context": {
                                        "id": "d0d0684262400ebc2a65b25be2da899d",
                                        "parent_id": null,
                                        "user_id": "ad2bcce775894550affb6dfef93a2a36"
                                    }
                                },
                                "result": {
                                    "params": {
                                        "domain": "fan",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "fan.dining_room_fan"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "sequence/0/0": [
                            {
                                "path": "sequence/0/0",
                                "timestamp": "2022-03-03T05:10:14.382243+00:00",
                                "child_id": {
                                    "domain": "automation",
                                    "item_id": "1642997460354",
                                    "run_id": "69bd19f07c605061813ff62f8fa4c30c"
                                },
                                "result": {
                                    "params": {
                                        "domain": "input_boolean",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "input_boolean.dining_room_fan_power"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "sequence/1": [
                            {
                                "path": "sequence/1",
                                "timestamp": "2022-03-03T05:10:14.388771+00:00",
                                "result": {
                                    "params": {
                                        "domain": "climate",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "climate.living_dining_room_ac"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "sequence/2": [
                            {
                                "path": "sequence/2",
                                "timestamp": "2022-03-03T05:10:14.391245+00:00",
                                "result": {
                                    "params": {
                                        "domain": "light",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "light.dining_room_lights"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ]
                    },
                    "config": {
                        "sequence": [
                            {
                                "service": "fan.turn_off",
                                "target": {
                                    "entity_id": "fan.dining_room_fan"
                                }
                            },
                            {
                                "service": "climate.turn_off",
                                "target": {
                                    "entity_id": "climate.living_dining_room_ac"
                                }
                            },
                            {
                                "service": "light.turn_off",
                                "target": {
                                    "entity_id": "light.dining_room_lights"
                                }
                            }
                        ],
                        "mode": "single",
                        "alias": "Turn Off Dining Room",
                        "icon": "mdi:power"
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "d0d0684262400ebc2a65b25be2da899d",
                        "parent_id": null,
                        "user_id": "ad2bcce775894550affb6dfef93a2a36"
                    }
                },
                "short_dict": {
                    "last_step": "sequence/2",
                    "run_id": "124cafcb24c3ac276764adad5b99d26f",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:10:14.379535+00:00",
                        "finish": "2022-03-03T05:10:14.531350+00:00"
                    },
                    "domain": "script",
                    "item_id": "turn_off_dining_room"
                }
            }
        ],
        "script.turn_off_powder_room": [
            {
                "extended_dict": {
                    "last_step": "sequence/0",
                    "run_id": "6deea4773b1221da1b24c8d09a4f1f38",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T01:40:38.042028+00:00",
                        "finish": "2022-03-03T01:40:38.166077+00:00"
                    },
                    "domain": "script",
                    "item_id": "turn_off_powder_room",
                    "trace": {
                        "sequence/0": [
                            {
                                "path": "sequence/0",
                                "timestamp": "2022-03-03T01:40:38.042768+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "script.turn_off_powder_room",
                                        "state": "off",
                                        "attributes": {
                                            "last_triggered": "2022-03-02T23:34:16.713279+00:00",
                                            "mode": "single",
                                            "current": 0,
                                            "icon": "mdi:power",
                                            "friendly_name": "Turn Off Powder Room"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.573603+00:00",
                                        "last_updated": "2022-03-03T00:41:11.573603+00:00",
                                        "context": {
                                            "id": "33e7b47fbd69d099a2b2bff47be19ea8",
                                            "parent_id": null,
                                            "user_id": null
                                        }
                                    },
                                    "context": {
                                        "id": "a92796880331a24fb2f7ff2ade41ef14",
                                        "parent_id": null,
                                        "user_id": "ad2bcce775894550affb6dfef93a2a36"
                                    }
                                },
                                "result": {
                                    "params": {
                                        "domain": "light",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "light.powder_room_pendant_light_entity"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ]
                    },
                    "config": {
                        "sequence": [
                            {
                                "service": "light.turn_off",
                                "target": {
                                    "entity_id": "light.powder_room_pendant_light_entity"
                                }
                            }
                        ],
                        "mode": "single",
                        "alias": "Turn Off Powder Room",
                        "icon": "mdi:power"
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "a92796880331a24fb2f7ff2ade41ef14",
                        "parent_id": null,
                        "user_id": "ad2bcce775894550affb6dfef93a2a36"
                    }
                },
                "short_dict": {
                    "last_step": "sequence/0",
                    "run_id": "6deea4773b1221da1b24c8d09a4f1f38",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T01:40:38.042028+00:00",
                        "finish": "2022-03-03T01:40:38.166077+00:00"
                    },
                    "domain": "script",
                    "item_id": "turn_off_powder_room"
                }
            },
            {
                "extended_dict": {
                    "last_step": "sequence/0",
                    "run_id": "bbe09a250980531bfd8db6a89c001685",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:09:53.207169+00:00",
                        "finish": "2022-03-03T05:09:53.298013+00:00"
                    },
                    "domain": "script",
                    "item_id": "turn_off_powder_room",
                    "trace": {
                        "sequence/0": [
                            {
                                "path": "sequence/0",
                                "timestamp": "2022-03-03T05:09:53.208021+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "script.turn_off_powder_room",
                                        "state": "off",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T01:40:38.042103+00:00",
                                            "mode": "single",
                                            "current": 0,
                                            "icon": "mdi:power",
                                            "friendly_name": "Turn Off Powder Room"
                                        },
                                        "last_changed": "2022-03-03T01:40:38.164814+00:00",
                                        "last_updated": "2022-03-03T01:40:38.164814+00:00",
                                        "context": {
                                            "id": "a92796880331a24fb2f7ff2ade41ef14",
                                            "parent_id": null,
                                            "user_id": "ad2bcce775894550affb6dfef93a2a36"
                                        }
                                    },
                                    "context": {
                                        "id": "3c34ab25510e6c3602cf039455c14bd6",
                                        "parent_id": null,
                                        "user_id": "ad2bcce775894550affb6dfef93a2a36"
                                    }
                                },
                                "result": {
                                    "params": {
                                        "domain": "light",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "light.powder_room_pendant_light_entity"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ]
                    },
                    "config": {
                        "sequence": [
                            {
                                "service": "light.turn_off",
                                "target": {
                                    "entity_id": "light.powder_room_pendant_light_entity"
                                }
                            }
                        ],
                        "mode": "single",
                        "alias": "Turn Off Powder Room",
                        "icon": "mdi:power"
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "3c34ab25510e6c3602cf039455c14bd6",
                        "parent_id": null,
                        "user_id": "ad2bcce775894550affb6dfef93a2a36"
                    }
                },
                "short_dict": {
                    "last_step": "sequence/0",
                    "run_id": "bbe09a250980531bfd8db6a89c001685",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:09:53.207169+00:00",
                        "finish": "2022-03-03T05:09:53.298013+00:00"
                    },
                    "domain": "script",
                    "item_id": "turn_off_powder_room"
                }
            }
        ],
        "script.turn_off_junior_bathroom": [
            {
                "extended_dict": {
                    "last_step": "sequence/0",
                    "run_id": "e394b423c920a7a8850b8c40d266b83f",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T01:40:38.662576+00:00",
                        "finish": "2022-03-03T01:40:38.772561+00:00"
                    },
                    "domain": "script",
                    "item_id": "turn_off_junior_bathroom",
                    "trace": {
                        "sequence/0": [
                            {
                                "path": "sequence/0",
                                "timestamp": "2022-03-03T01:40:38.663367+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "script.turn_off_junior_bathroom",
                                        "state": "off",
                                        "attributes": {
                                            "last_triggered": "2022-03-02T23:34:10.764470+00:00",
                                            "mode": "single",
                                            "current": 0,
                                            "icon": "mdi:power",
                                            "friendly_name": "Turn Off Junior Bathroom"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.573543+00:00",
                                        "last_updated": "2022-03-03T00:41:11.573543+00:00",
                                        "context": {
                                            "id": "a8fd199185a3018ce272fb0bb5a68b3f",
                                            "parent_id": null,
                                            "user_id": null
                                        }
                                    },
                                    "context": {
                                        "id": "60f737625beab88243481b0bcf55b493",
                                        "parent_id": null,
                                        "user_id": "ad2bcce775894550affb6dfef93a2a36"
                                    }
                                },
                                "result": {
                                    "params": {
                                        "domain": "light",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "light.junior_bathroom_lights"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ]
                    },
                    "config": {
                        "sequence": [
                            {
                                "service": "light.turn_off",
                                "target": {
                                    "entity_id": "light.junior_bathroom_lights"
                                }
                            }
                        ],
                        "mode": "single",
                        "alias": "Turn Off Junior Bathroom",
                        "icon": "mdi:power"
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "60f737625beab88243481b0bcf55b493",
                        "parent_id": null,
                        "user_id": "ad2bcce775894550affb6dfef93a2a36"
                    }
                },
                "short_dict": {
                    "last_step": "sequence/0",
                    "run_id": "e394b423c920a7a8850b8c40d266b83f",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T01:40:38.662576+00:00",
                        "finish": "2022-03-03T01:40:38.772561+00:00"
                    },
                    "domain": "script",
                    "item_id": "turn_off_junior_bathroom"
                }
            },
            {
                "extended_dict": {
                    "last_step": "sequence/0",
                    "run_id": "07af63a6c63e98d5bc936a05e392fb11",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T02:14:08.754745+00:00",
                        "finish": "2022-03-03T02:14:08.871464+00:00"
                    },
                    "domain": "script",
                    "item_id": "turn_off_junior_bathroom",
                    "trace": {
                        "sequence/0": [
                            {
                                "path": "sequence/0",
                                "timestamp": "2022-03-03T02:14:08.755497+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "script.turn_off_junior_bathroom",
                                        "state": "off",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T01:40:38.662661+00:00",
                                            "mode": "single",
                                            "current": 0,
                                            "icon": "mdi:power",
                                            "friendly_name": "Turn Off Junior Bathroom"
                                        },
                                        "last_changed": "2022-03-03T01:40:38.771461+00:00",
                                        "last_updated": "2022-03-03T01:40:38.771461+00:00",
                                        "context": {
                                            "id": "60f737625beab88243481b0bcf55b493",
                                            "parent_id": null,
                                            "user_id": "ad2bcce775894550affb6dfef93a2a36"
                                        }
                                    },
                                    "context": {
                                        "id": "436683544806bc8d3f37681ed0695aa8",
                                        "parent_id": null,
                                        "user_id": "ad2bcce775894550affb6dfef93a2a36"
                                    }
                                },
                                "result": {
                                    "params": {
                                        "domain": "light",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "light.junior_bathroom_lights"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ]
                    },
                    "config": {
                        "sequence": [
                            {
                                "service": "light.turn_off",
                                "target": {
                                    "entity_id": "light.junior_bathroom_lights"
                                }
                            }
                        ],
                        "mode": "single",
                        "alias": "Turn Off Junior Bathroom",
                        "icon": "mdi:power"
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "436683544806bc8d3f37681ed0695aa8",
                        "parent_id": null,
                        "user_id": "ad2bcce775894550affb6dfef93a2a36"
                    }
                },
                "short_dict": {
                    "last_step": "sequence/0",
                    "run_id": "07af63a6c63e98d5bc936a05e392fb11",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T02:14:08.754745+00:00",
                        "finish": "2022-03-03T02:14:08.871464+00:00"
                    },
                    "domain": "script",
                    "item_id": "turn_off_junior_bathroom"
                }
            },
            {
                "extended_dict": {
                    "last_step": "sequence/0",
                    "run_id": "651994b419c35e6d60930bb424acc336",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:09:47.237324+00:00",
                        "finish": "2022-03-03T05:09:47.360136+00:00"
                    },
                    "domain": "script",
                    "item_id": "turn_off_junior_bathroom",
                    "trace": {
                        "sequence/0": [
                            {
                                "path": "sequence/0",
                                "timestamp": "2022-03-03T05:09:47.238789+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "script.turn_off_junior_bathroom",
                                        "state": "off",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T02:14:08.754829+00:00",
                                            "mode": "single",
                                            "current": 0,
                                            "icon": "mdi:power",
                                            "friendly_name": "Turn Off Junior Bathroom"
                                        },
                                        "last_changed": "2022-03-03T02:14:08.870471+00:00",
                                        "last_updated": "2022-03-03T02:14:08.870471+00:00",
                                        "context": {
                                            "id": "436683544806bc8d3f37681ed0695aa8",
                                            "parent_id": null,
                                            "user_id": "ad2bcce775894550affb6dfef93a2a36"
                                        }
                                    },
                                    "context": {
                                        "id": "3c34ab25510e6c3602cf039455c14bd6",
                                        "parent_id": null,
                                        "user_id": "ad2bcce775894550affb6dfef93a2a36"
                                    }
                                },
                                "result": {
                                    "params": {
                                        "domain": "light",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "light.junior_bathroom_lights"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ]
                    },
                    "config": {
                        "sequence": [
                            {
                                "service": "light.turn_off",
                                "target": {
                                    "entity_id": "light.junior_bathroom_lights"
                                }
                            }
                        ],
                        "mode": "single",
                        "alias": "Turn Off Junior Bathroom",
                        "icon": "mdi:power"
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "3c34ab25510e6c3602cf039455c14bd6",
                        "parent_id": null,
                        "user_id": "ad2bcce775894550affb6dfef93a2a36"
                    }
                },
                "short_dict": {
                    "last_step": "sequence/0",
                    "run_id": "651994b419c35e6d60930bb424acc336",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:09:47.237324+00:00",
                        "finish": "2022-03-03T05:09:47.360136+00:00"
                    },
                    "domain": "script",
                    "item_id": "turn_off_junior_bathroom"
                }
            },
            {
                "extended_dict": {
                    "last_step": "sequence/0",
                    "run_id": "d0baa09bc5b1c68f07c232b873fb54b7",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:45:38.518303+00:00",
                        "finish": "2022-03-03T05:45:38.629779+00:00"
                    },
                    "domain": "script",
                    "item_id": "turn_off_junior_bathroom",
                    "trace": {
                        "sequence/0": [
                            {
                                "path": "sequence/0",
                                "timestamp": "2022-03-03T05:45:38.519054+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "script.turn_off_junior_bathroom",
                                        "state": "off",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T05:09:47.237392+00:00",
                                            "mode": "single",
                                            "current": 0,
                                            "icon": "mdi:power",
                                            "friendly_name": "Turn Off Junior Bathroom"
                                        },
                                        "last_changed": "2022-03-03T05:09:47.358947+00:00",
                                        "last_updated": "2022-03-03T05:09:47.358947+00:00",
                                        "context": {
                                            "id": "3c34ab25510e6c3602cf039455c14bd6",
                                            "parent_id": null,
                                            "user_id": "ad2bcce775894550affb6dfef93a2a36"
                                        }
                                    },
                                    "context": {
                                        "id": "9d31838008fab6b9a6312db8c863f3f7",
                                        "parent_id": null,
                                        "user_id": "ad2bcce775894550affb6dfef93a2a36"
                                    }
                                },
                                "result": {
                                    "params": {
                                        "domain": "light",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "light.junior_bathroom_lights"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ]
                    },
                    "config": {
                        "sequence": [
                            {
                                "service": "light.turn_off",
                                "target": {
                                    "entity_id": "light.junior_bathroom_lights"
                                }
                            }
                        ],
                        "mode": "single",
                        "alias": "Turn Off Junior Bathroom",
                        "icon": "mdi:power"
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "9d31838008fab6b9a6312db8c863f3f7",
                        "parent_id": null,
                        "user_id": "ad2bcce775894550affb6dfef93a2a36"
                    }
                },
                "short_dict": {
                    "last_step": "sequence/0",
                    "run_id": "d0baa09bc5b1c68f07c232b873fb54b7",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:45:38.518303+00:00",
                        "finish": "2022-03-03T05:45:38.629779+00:00"
                    },
                    "domain": "script",
                    "item_id": "turn_off_junior_bathroom"
                }
            }
        ],
        "automation.1643646541355": [
            {
                "extended_dict": {
                    "last_step": "action/3/choose/3/sequence/0/default/1/choose/0/sequence/0",
                    "run_id": "332c1675d230524daf84afe217461ea9",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T01:56:09.602610+00:00",
                        "finish": "2022-03-03T01:56:09.695282+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643646541355",
                    "trigger": "event 'zha_event'",
                    "trace": {
                        "trigger/1": [
                            {
                                "path": "trigger/1",
                                "timestamp": "2022-03-03T01:56:09.603510+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.junior_bathroom_lights_controller",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T00:34:44.528909+00:00",
                                            "mode": "restart",
                                            "current": 0,
                                            "id": "1643646541355",
                                            "friendly_name": "Junior Bathroom Lights Controller"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.799544+00:00",
                                        "last_updated": "2022-03-03T00:41:11.799544+00:00",
                                        "context": {
                                            "id": "c12106bce9ca74006d0a032152db7202",
                                            "parent_id": null,
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "1",
                                        "idx": "1",
                                        "platform": "event",
                                        "event": {
                                            "event_type": "zha_event",
                                            "data": {
                                                "device_ieee": "84:fd:27:ff:fe:34:f7:7b",
                                                "unique_id": "84:fd:27:ff:fe:34:f7:7b:1:0x0006",
                                                "device_id": "f084f2e55c0800941585a50dd83e5f47",
                                                "endpoint_id": 1,
                                                "cluster_id": 6,
                                                "command": "off",
                                                "args": []
                                            },
                                            "origin": "LOCAL",
                                            "time_fired": "2022-03-03T01:56:09.601269+00:00",
                                            "context": {
                                                "id": "efd8e343f56a4d877436b52a80588fc8",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "description": "event 'zha_event'"
                                    },
                                    "integration": "ZHA",
                                    "button_up_long_loop": true,
                                    "button_up_long_max_loop_repeats": 50,
                                    "button_up_double_press": false,
                                    "button_down_long_loop": true,
                                    "button_down_long_max_loop_repeats": 50,
                                    "button_down_double_press": false,
                                    "helper_last_controller_event": "input_text.zz_junior_bathroom_lights_controller_last_event",
                                    "helper_double_press_delay": 500,
                                    "helper_debounce_delay": 0,
                                    "integration_id": "zha",
                                    "adjusted_double_press_delay": 500,
                                    "actions_mapping": {
                                        "deconz": {
                                            "button_up_short": [
                                                "1002"
                                            ],
                                            "button_up_long": [
                                                "1001"
                                            ],
                                            "button_up_release": [
                                                "1003"
                                            ],
                                            "button_down_short": [
                                                "2002"
                                            ],
                                            "button_down_long": [
                                                "2001"
                                            ],
                                            "button_down_release": [
                                                "2003"
                                            ]
                                        },
                                        "zha": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "move_with_on_off_0_83"
                                            ],
                                            "button_up_release": [
                                                "stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "move_1_83"
                                            ],
                                            "button_down_release": [
                                                "stop"
                                            ]
                                        },
                                        "zigbee2mqtt": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "brightness_move_up"
                                            ],
                                            "button_up_release": [
                                                "brightness_stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "brightness_move_down"
                                            ],
                                            "button_down_release": [
                                                "brightness_stop"
                                            ]
                                        }
                                    },
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ],
                                    "integrations_with_prev_event_storage": [
                                        "zha",
                                        "zigbee2mqtt"
                                    ],
                                    "controller_entity": "",
                                    "controller_device": "f084f2e55c0800941585a50dd83e5f47",
                                    "controller_id": "f084f2e55c0800941585a50dd83e5f47"
                                }
                            }
                        ],
                        "condition/0": [
                            {
                                "path": "condition/0",
                                "timestamp": "2022-03-03T01:56:09.603555+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "condition/0/conditions/0": [
                            {
                                "path": "condition/0/conditions/0",
                                "timestamp": "2022-03-03T01:56:09.603577+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "condition/0/conditions/1": [
                            {
                                "path": "condition/0/conditions/1",
                                "timestamp": "2022-03-03T01:56:09.603755+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T01:56:09.604438+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "1b50277c04dd8b0ff7b9254fe22faf4e",
                                        "parent_id": "efd8e343f56a4d877436b52a80588fc8",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "delay": 0.0,
                                    "done": true
                                }
                            }
                        ],
                        "action/1": [
                            {
                                "path": "action/1",
                                "timestamp": "2022-03-03T01:56:09.605303+00:00"
                            }
                        ],
                        "action/2": [
                            {
                                "path": "action/2",
                                "timestamp": "2022-03-03T01:56:09.605909+00:00",
                                "changed_variables": {
                                    "trigger_action": "off",
                                    "trigger_delta": 4885072.4811553955,
                                    "last_controller_event": "off"
                                },
                                "result": {
                                    "params": {
                                        "domain": "input_text",
                                        "service": "set_value",
                                        "service_data": {
                                            "entity_id": "input_text.zz_junior_bathroom_lights_controller_last_event",
                                            "value": {
                                                "trigger_action": "off",
                                                "last_triggered": "2022-03-03 09:56:09.606041+08:00"
                                            }
                                        },
                                        "target": {}
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "action/3": [
                            {
                                "path": "action/3",
                                "timestamp": "2022-03-03T01:56:09.607926+00:00",
                                "result": {
                                    "choice": 3
                                }
                            }
                        ],
                        "action/3/choose/0": [
                            {
                                "path": "action/3/choose/0",
                                "timestamp": "2022-03-03T01:56:09.608535+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/0/conditions/0": [
                            {
                                "path": "action/3/choose/0/conditions/0",
                                "timestamp": "2022-03-03T01:56:09.608560+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/1": [
                            {
                                "path": "action/3/choose/1",
                                "timestamp": "2022-03-03T01:56:09.608753+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/1/conditions/0": [
                            {
                                "path": "action/3/choose/1/conditions/0",
                                "timestamp": "2022-03-03T01:56:09.608777+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/2": [
                            {
                                "path": "action/3/choose/2",
                                "timestamp": "2022-03-03T01:56:09.608880+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/2/conditions/0": [
                            {
                                "path": "action/3/choose/2/conditions/0",
                                "timestamp": "2022-03-03T01:56:09.608897+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/3": [
                            {
                                "path": "action/3/choose/3",
                                "timestamp": "2022-03-03T01:56:09.609006+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/3/choose/3/conditions/0": [
                            {
                                "path": "action/3/choose/3/conditions/0",
                                "timestamp": "2022-03-03T01:56:09.609025+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/3/sequence/0": [
                            {
                                "path": "action/3/choose/3/sequence/0",
                                "timestamp": "2022-03-03T01:56:09.609296+00:00",
                                "result": {
                                    "choice": "default"
                                }
                            }
                        ],
                        "action/3/choose/3/sequence/0/choose/0": [
                            {
                                "path": "action/3/choose/3/sequence/0/choose/0",
                                "timestamp": "2022-03-03T01:56:09.609455+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/3/sequence/0/choose/0/conditions/0": [
                            {
                                "path": "action/3/choose/3/sequence/0/choose/0/conditions/0",
                                "timestamp": "2022-03-03T01:56:09.609476+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/3/sequence/0/default/0": [
                            {
                                "path": "action/3/choose/3/sequence/0/default/0",
                                "timestamp": "2022-03-03T01:56:09.609787+00:00",
                                "result": {
                                    "event": "ahb_controller_event",
                                    "event_data": {
                                        "controller": "f084f2e55c0800941585a50dd83e5f47",
                                        "action": "button_down_short"
                                    }
                                }
                            }
                        ],
                        "action/3/choose/3/sequence/0/default/1": [
                            {
                                "path": "action/3/choose/3/sequence/0/default/1",
                                "timestamp": "2022-03-03T01:56:09.610005+00:00",
                                "result": {
                                    "choice": 0
                                }
                            }
                        ],
                        "action/3/choose/3/sequence/0/default/1/choose/0": [
                            {
                                "path": "action/3/choose/3/sequence/0/default/1/choose/0",
                                "timestamp": "2022-03-03T01:56:09.610072+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/3/choose/3/sequence/0/default/1/choose/0/sequence/0": [
                            {
                                "path": "action/3/choose/3/sequence/0/default/1/choose/0/sequence/0",
                                "timestamp": "2022-03-03T01:56:09.610405+00:00",
                                "result": {
                                    "params": {
                                        "domain": "light",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "light.junior_bathroom_lights"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ]
                    },
                    "config": {
                        "variables": {
                            "integration": "ZHA",
                            "button_up_long_loop": true,
                            "button_up_long_max_loop_repeats": 50,
                            "button_up_double_press": false,
                            "button_down_long_loop": true,
                            "button_down_long_max_loop_repeats": 50,
                            "button_down_double_press": false,
                            "helper_last_controller_event": "input_text.zz_junior_bathroom_lights_controller_last_event",
                            "helper_double_press_delay": 500,
                            "helper_debounce_delay": 0,
                            "integration_id": "{{ integration | lower }}",
                            "adjusted_double_press_delay": "{{ [helper_double_press_delay - helper_debounce_delay, 100] | max }}",
                            "actions_mapping": {
                                "deconz": {
                                    "button_up_short": [
                                        "1002"
                                    ],
                                    "button_up_long": [
                                        "1001"
                                    ],
                                    "button_up_release": [
                                        "1003"
                                    ],
                                    "button_down_short": [
                                        "2002"
                                    ],
                                    "button_down_long": [
                                        "2001"
                                    ],
                                    "button_down_release": [
                                        "2003"
                                    ]
                                },
                                "zha": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ]
                                },
                                "zigbee2mqtt": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "brightness_move_up"
                                    ],
                                    "button_up_release": [
                                        "brightness_stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "brightness_move_down"
                                    ],
                                    "button_down_release": [
                                        "brightness_stop"
                                    ]
                                }
                            },
                            "button_up_short": "{{ actions_mapping[integration_id][\"button_up_short\"] }}",
                            "button_up_long": "{{ actions_mapping[integration_id][\"button_up_long\"] }}",
                            "button_up_release": "{{ actions_mapping[integration_id][\"button_up_release\"] }}",
                            "button_down_short": "{{ actions_mapping[integration_id][\"button_down_short\"] }}",
                            "button_down_long": "{{ actions_mapping[integration_id][\"button_down_long\"] }}",
                            "button_down_release": "{{ actions_mapping[integration_id][\"button_down_release\"] }}",
                            "integrations_with_prev_event_storage": [
                                "zha",
                                "zigbee2mqtt"
                            ],
                            "controller_entity": "",
                            "controller_device": "f084f2e55c0800941585a50dd83e5f47",
                            "controller_id": "{% if integration_id==\"zigbee2mqtt\" %}{{controller_entity}}{% else %}{{controller_device}}{% endif %}"
                        },
                        "mode": "restart",
                        "max_exceeded": "silent",
                        "trigger": [
                            {
                                "platform": "event",
                                "event_type": "state_changed",
                                "event_data": {
                                    "entity_id": ""
                                }
                            },
                            {
                                "platform": "event",
                                "event_type": [
                                    "deconz_event",
                                    "zha_event"
                                ],
                                "event_data": {
                                    "device_id": "f084f2e55c0800941585a50dd83e5f47"
                                }
                            }
                        ],
                        "condition": [
                            {
                                "condition": "and",
                                "conditions": [
                                    "{%- set trigger_action -%} {%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%} {%- endset -%} {{ trigger_action not in [\"\",\"None\"] }}",
                                    "{{ integration_id != \"zigbee2mqtt\" or trigger.event.data.new_state.state != trigger.event.data.old_state.state }}"
                                ]
                            }
                        ],
                        "action": [
                            {
                                "delay": {
                                    "milliseconds": 0
                                }
                            },
                            {
                                "variables": {
                                    "trigger_action": "{%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%}",
                                    "trigger_delta": "{{ (as_timestamp(now()) - as_timestamp((states(helper_last_controller_event) | from_json).last_triggered if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"1970-01-01 00:00:00\")) * 1000 }}",
                                    "last_controller_event": "{{ (states(helper_last_controller_event) | from_json).trigger_action if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"\" }}"
                                }
                            },
                            {
                                "service": "input_text.set_value",
                                "data": {
                                    "entity_id": "input_text.zz_junior_bathroom_lights_controller_last_event",
                                    "value": "{{ {\"trigger_action\":trigger_action,\"last_triggered\":now()|string} | to_json }}"
                                }
                            },
                            {
                                "choose": [
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_junior_bathroom_lights_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_up_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_up_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "choose": [
                                                                                            {
                                                                                                "conditions": [
                                                                                                    {
                                                                                                        "condition": "time",
                                                                                                        "after": "input_datetime.elenas_bedtime",
                                                                                                        "before": "input_datetime.lights_auto_control_end"
                                                                                                    }
                                                                                                ],
                                                                                                "sequence": [
                                                                                                    {
                                                                                                        "service": "light.turn_on",
                                                                                                        "target": {
                                                                                                            "entity_id": "light.junior_bathroom_lights"
                                                                                                        },
                                                                                                        "data": {
                                                                                                            "brightness_pct": 5
                                                                                                        }
                                                                                                    }
                                                                                                ]
                                                                                            }
                                                                                        ],
                                                                                        "default": [
                                                                                            {
                                                                                                "service": "light.turn_on",
                                                                                                "target": {
                                                                                                    "entity_id": "light.junior_bathroom_lights"
                                                                                                },
                                                                                                "data": {
                                                                                                    "brightness_pct": 100
                                                                                                }
                                                                                            }
                                                                                        ]
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_up_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [
                                                                                    {
                                                                                        "condition": "time",
                                                                                        "after": "input_datetime.elenas_bedtime",
                                                                                        "before": "input_datetime.lights_auto_control_end"
                                                                                    }
                                                                                ],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "light.turn_on",
                                                                                        "target": {
                                                                                            "entity_id": "light.junior_bathroom_lights"
                                                                                        },
                                                                                        "data": {
                                                                                            "brightness_pct": 5
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ],
                                                                        "default": [
                                                                            {
                                                                                "service": "light.turn_on",
                                                                                "target": {
                                                                                    "entity_id": "light.junior_bathroom_lights"
                                                                                },
                                                                                "data": {
                                                                                    "brightness_pct": 100
                                                                                }
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_up_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "light.turn_on",
                                                                            "target": {
                                                                                "entity_id": "light.junior_bathroom_lights"
                                                                            },
                                                                            "data": {
                                                                                "brightness_step_pct": 10
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.junior_bathroom_lights"
                                                        },
                                                        "data": {
                                                            "brightness_step_pct": 10
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_up_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_up_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_junior_bathroom_lights_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_down_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_down_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "light.turn_off",
                                                                                        "target": {
                                                                                            "entity_id": "light.junior_bathroom_lights"
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_down_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "light.turn_off",
                                                                        "target": {
                                                                            "entity_id": "light.junior_bathroom_lights"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_down_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "light.turn_on",
                                                                            "target": {
                                                                                "entity_id": "light.junior_bathroom_lights"
                                                                            },
                                                                            "data": {
                                                                                "brightness_step_pct": -10
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.junior_bathroom_lights"
                                                        },
                                                        "data": {
                                                            "brightness_step_pct": -10
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_down_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_down_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            }
                        ],
                        "id": "1643646541355",
                        "alias": "Junior Bathroom Lights Controller",
                        "description": "Control the Junior Bathroom Lights"
                    },
                    "blueprint_inputs": {
                        "id": "1643646541355",
                        "alias": "Junior Bathroom Lights Controller",
                        "description": "Control the Junior Bathroom Lights",
                        "use_blueprint": {
                            "path": "EPMatt/ikea_e1743.yaml",
                            "input": {
                                "integration": "ZHA",
                                "controller_device": "f084f2e55c0800941585a50dd83e5f47",
                                "helper_last_controller_event": "input_text.zz_junior_bathroom_lights_controller_last_event",
                                "action_button_up_short": [
                                    {
                                        "choose": [
                                            {
                                                "conditions": [
                                                    {
                                                        "condition": "time",
                                                        "after": "input_datetime.elenas_bedtime",
                                                        "before": "input_datetime.lights_auto_control_end"
                                                    }
                                                ],
                                                "sequence": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.junior_bathroom_lights"
                                                        },
                                                        "data": {
                                                            "brightness_pct": 5
                                                        }
                                                    }
                                                ]
                                            }
                                        ],
                                        "default": [
                                            {
                                                "service": "light.turn_on",
                                                "target": {
                                                    "entity_id": "light.junior_bathroom_lights"
                                                },
                                                "data": {
                                                    "brightness_pct": 100
                                                }
                                            }
                                        ]
                                    }
                                ],
                                "action_button_up_long": [
                                    {
                                        "service": "light.turn_on",
                                        "target": {
                                            "entity_id": "light.junior_bathroom_lights"
                                        },
                                        "data": {
                                            "brightness_step_pct": 10
                                        }
                                    }
                                ],
                                "action_button_down_short": [
                                    {
                                        "service": "light.turn_off",
                                        "target": {
                                            "entity_id": "light.junior_bathroom_lights"
                                        }
                                    }
                                ],
                                "action_button_down_long": [
                                    {
                                        "service": "light.turn_on",
                                        "target": {
                                            "entity_id": "light.junior_bathroom_lights"
                                        },
                                        "data": {
                                            "brightness_step_pct": -10
                                        }
                                    }
                                ],
                                "button_up_long_loop": true,
                                "button_up_long_max_loop_repeats": 50,
                                "button_down_long_loop": true,
                                "button_down_long_max_loop_repeats": 50
                            }
                        }
                    },
                    "context": {
                        "id": "1b50277c04dd8b0ff7b9254fe22faf4e",
                        "parent_id": "efd8e343f56a4d877436b52a80588fc8",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/3/choose/3/sequence/0/default/1/choose/0/sequence/0",
                    "run_id": "332c1675d230524daf84afe217461ea9",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T01:56:09.602610+00:00",
                        "finish": "2022-03-03T01:56:09.695282+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643646541355",
                    "trigger": "event 'zha_event'"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/3/choose/3/sequence/0/default/1/choose/0/sequence/0",
                    "run_id": "9db01c4b22ac85128da25049ae3a94f5",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T02:00:19.556297+00:00",
                        "finish": "2022-03-03T02:00:19.689415+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643646541355",
                    "trigger": "event 'zha_event'",
                    "trace": {
                        "trigger/1": [
                            {
                                "path": "trigger/1",
                                "timestamp": "2022-03-03T02:00:19.557002+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.junior_bathroom_lights_controller",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T01:56:09.603943+00:00",
                                            "mode": "restart",
                                            "current": 0,
                                            "id": "1643646541355",
                                            "friendly_name": "Junior Bathroom Lights Controller"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.799544+00:00",
                                        "last_updated": "2022-03-03T01:56:09.694589+00:00",
                                        "context": {
                                            "id": "1b50277c04dd8b0ff7b9254fe22faf4e",
                                            "parent_id": "efd8e343f56a4d877436b52a80588fc8",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "1",
                                        "idx": "1",
                                        "platform": "event",
                                        "event": {
                                            "event_type": "zha_event",
                                            "data": {
                                                "device_ieee": "84:fd:27:ff:fe:34:f7:7b",
                                                "unique_id": "84:fd:27:ff:fe:34:f7:7b:1:0x0006",
                                                "device_id": "f084f2e55c0800941585a50dd83e5f47",
                                                "endpoint_id": 1,
                                                "cluster_id": 6,
                                                "command": "off",
                                                "args": []
                                            },
                                            "origin": "LOCAL",
                                            "time_fired": "2022-03-03T02:00:19.555640+00:00",
                                            "context": {
                                                "id": "de8df624de453efc93dd9ddc32243e00",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "description": "event 'zha_event'"
                                    },
                                    "integration": "ZHA",
                                    "button_up_long_loop": true,
                                    "button_up_long_max_loop_repeats": 50,
                                    "button_up_double_press": false,
                                    "button_down_long_loop": true,
                                    "button_down_long_max_loop_repeats": 50,
                                    "button_down_double_press": false,
                                    "helper_last_controller_event": "input_text.zz_junior_bathroom_lights_controller_last_event",
                                    "helper_double_press_delay": 500,
                                    "helper_debounce_delay": 0,
                                    "integration_id": "zha",
                                    "adjusted_double_press_delay": 500,
                                    "actions_mapping": {
                                        "deconz": {
                                            "button_up_short": [
                                                "1002"
                                            ],
                                            "button_up_long": [
                                                "1001"
                                            ],
                                            "button_up_release": [
                                                "1003"
                                            ],
                                            "button_down_short": [
                                                "2002"
                                            ],
                                            "button_down_long": [
                                                "2001"
                                            ],
                                            "button_down_release": [
                                                "2003"
                                            ]
                                        },
                                        "zha": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "move_with_on_off_0_83"
                                            ],
                                            "button_up_release": [
                                                "stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "move_1_83"
                                            ],
                                            "button_down_release": [
                                                "stop"
                                            ]
                                        },
                                        "zigbee2mqtt": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "brightness_move_up"
                                            ],
                                            "button_up_release": [
                                                "brightness_stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "brightness_move_down"
                                            ],
                                            "button_down_release": [
                                                "brightness_stop"
                                            ]
                                        }
                                    },
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ],
                                    "integrations_with_prev_event_storage": [
                                        "zha",
                                        "zigbee2mqtt"
                                    ],
                                    "controller_entity": "",
                                    "controller_device": "f084f2e55c0800941585a50dd83e5f47",
                                    "controller_id": "f084f2e55c0800941585a50dd83e5f47"
                                }
                            }
                        ],
                        "condition/0": [
                            {
                                "path": "condition/0",
                                "timestamp": "2022-03-03T02:00:19.557029+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "condition/0/conditions/0": [
                            {
                                "path": "condition/0/conditions/0",
                                "timestamp": "2022-03-03T02:00:19.557047+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "condition/0/conditions/1": [
                            {
                                "path": "condition/0/conditions/1",
                                "timestamp": "2022-03-03T02:00:19.557198+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T02:00:19.557913+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "79f891f0315fc213a3160ceb1611e9e7",
                                        "parent_id": "de8df624de453efc93dd9ddc32243e00",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "delay": 0.0,
                                    "done": true
                                }
                            }
                        ],
                        "action/1": [
                            {
                                "path": "action/1",
                                "timestamp": "2022-03-03T02:00:19.559003+00:00"
                            }
                        ],
                        "action/2": [
                            {
                                "path": "action/2",
                                "timestamp": "2022-03-03T02:00:19.559496+00:00",
                                "changed_variables": {
                                    "trigger_action": "off",
                                    "trigger_delta": 249953.16004753113,
                                    "last_controller_event": "off"
                                },
                                "result": {
                                    "params": {
                                        "domain": "input_text",
                                        "service": "set_value",
                                        "service_data": {
                                            "entity_id": "input_text.zz_junior_bathroom_lights_controller_last_event",
                                            "value": {
                                                "trigger_action": "off",
                                                "last_triggered": "2022-03-03 10:00:19.559585+08:00"
                                            }
                                        },
                                        "target": {}
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "action/3": [
                            {
                                "path": "action/3",
                                "timestamp": "2022-03-03T02:00:19.561616+00:00",
                                "result": {
                                    "choice": 3
                                }
                            }
                        ],
                        "action/3/choose/0": [
                            {
                                "path": "action/3/choose/0",
                                "timestamp": "2022-03-03T02:00:19.561668+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/0/conditions/0": [
                            {
                                "path": "action/3/choose/0/conditions/0",
                                "timestamp": "2022-03-03T02:00:19.561689+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/1": [
                            {
                                "path": "action/3/choose/1",
                                "timestamp": "2022-03-03T02:00:19.561818+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/1/conditions/0": [
                            {
                                "path": "action/3/choose/1/conditions/0",
                                "timestamp": "2022-03-03T02:00:19.561838+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/2": [
                            {
                                "path": "action/3/choose/2",
                                "timestamp": "2022-03-03T02:00:19.561909+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/2/conditions/0": [
                            {
                                "path": "action/3/choose/2/conditions/0",
                                "timestamp": "2022-03-03T02:00:19.561926+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/3": [
                            {
                                "path": "action/3/choose/3",
                                "timestamp": "2022-03-03T02:00:19.561993+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/3/choose/3/conditions/0": [
                            {
                                "path": "action/3/choose/3/conditions/0",
                                "timestamp": "2022-03-03T02:00:19.562011+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/3/sequence/0": [
                            {
                                "path": "action/3/choose/3/sequence/0",
                                "timestamp": "2022-03-03T02:00:19.562265+00:00",
                                "result": {
                                    "choice": "default"
                                }
                            }
                        ],
                        "action/3/choose/3/sequence/0/choose/0": [
                            {
                                "path": "action/3/choose/3/sequence/0/choose/0",
                                "timestamp": "2022-03-03T02:00:19.562302+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/3/sequence/0/choose/0/conditions/0": [
                            {
                                "path": "action/3/choose/3/sequence/0/choose/0/conditions/0",
                                "timestamp": "2022-03-03T02:00:19.562321+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/3/sequence/0/default/0": [
                            {
                                "path": "action/3/choose/3/sequence/0/default/0",
                                "timestamp": "2022-03-03T02:00:19.562602+00:00",
                                "result": {
                                    "event": "ahb_controller_event",
                                    "event_data": {
                                        "controller": "f084f2e55c0800941585a50dd83e5f47",
                                        "action": "button_down_short"
                                    }
                                }
                            }
                        ],
                        "action/3/choose/3/sequence/0/default/1": [
                            {
                                "path": "action/3/choose/3/sequence/0/default/1",
                                "timestamp": "2022-03-03T02:00:19.562778+00:00",
                                "result": {
                                    "choice": 0
                                }
                            }
                        ],
                        "action/3/choose/3/sequence/0/default/1/choose/0": [
                            {
                                "path": "action/3/choose/3/sequence/0/default/1/choose/0",
                                "timestamp": "2022-03-03T02:00:19.562813+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/3/choose/3/sequence/0/default/1/choose/0/sequence/0": [
                            {
                                "path": "action/3/choose/3/sequence/0/default/1/choose/0/sequence/0",
                                "timestamp": "2022-03-03T02:00:19.563085+00:00",
                                "result": {
                                    "params": {
                                        "domain": "light",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "light.junior_bathroom_lights"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ]
                    },
                    "config": {
                        "variables": {
                            "integration": "ZHA",
                            "button_up_long_loop": true,
                            "button_up_long_max_loop_repeats": 50,
                            "button_up_double_press": false,
                            "button_down_long_loop": true,
                            "button_down_long_max_loop_repeats": 50,
                            "button_down_double_press": false,
                            "helper_last_controller_event": "input_text.zz_junior_bathroom_lights_controller_last_event",
                            "helper_double_press_delay": 500,
                            "helper_debounce_delay": 0,
                            "integration_id": "{{ integration | lower }}",
                            "adjusted_double_press_delay": "{{ [helper_double_press_delay - helper_debounce_delay, 100] | max }}",
                            "actions_mapping": {
                                "deconz": {
                                    "button_up_short": [
                                        "1002"
                                    ],
                                    "button_up_long": [
                                        "1001"
                                    ],
                                    "button_up_release": [
                                        "1003"
                                    ],
                                    "button_down_short": [
                                        "2002"
                                    ],
                                    "button_down_long": [
                                        "2001"
                                    ],
                                    "button_down_release": [
                                        "2003"
                                    ]
                                },
                                "zha": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ]
                                },
                                "zigbee2mqtt": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "brightness_move_up"
                                    ],
                                    "button_up_release": [
                                        "brightness_stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "brightness_move_down"
                                    ],
                                    "button_down_release": [
                                        "brightness_stop"
                                    ]
                                }
                            },
                            "button_up_short": "{{ actions_mapping[integration_id][\"button_up_short\"] }}",
                            "button_up_long": "{{ actions_mapping[integration_id][\"button_up_long\"] }}",
                            "button_up_release": "{{ actions_mapping[integration_id][\"button_up_release\"] }}",
                            "button_down_short": "{{ actions_mapping[integration_id][\"button_down_short\"] }}",
                            "button_down_long": "{{ actions_mapping[integration_id][\"button_down_long\"] }}",
                            "button_down_release": "{{ actions_mapping[integration_id][\"button_down_release\"] }}",
                            "integrations_with_prev_event_storage": [
                                "zha",
                                "zigbee2mqtt"
                            ],
                            "controller_entity": "",
                            "controller_device": "f084f2e55c0800941585a50dd83e5f47",
                            "controller_id": "{% if integration_id==\"zigbee2mqtt\" %}{{controller_entity}}{% else %}{{controller_device}}{% endif %}"
                        },
                        "mode": "restart",
                        "max_exceeded": "silent",
                        "trigger": [
                            {
                                "platform": "event",
                                "event_type": "state_changed",
                                "event_data": {
                                    "entity_id": ""
                                }
                            },
                            {
                                "platform": "event",
                                "event_type": [
                                    "deconz_event",
                                    "zha_event"
                                ],
                                "event_data": {
                                    "device_id": "f084f2e55c0800941585a50dd83e5f47"
                                }
                            }
                        ],
                        "condition": [
                            {
                                "condition": "and",
                                "conditions": [
                                    "{%- set trigger_action -%} {%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%} {%- endset -%} {{ trigger_action not in [\"\",\"None\"] }}",
                                    "{{ integration_id != \"zigbee2mqtt\" or trigger.event.data.new_state.state != trigger.event.data.old_state.state }}"
                                ]
                            }
                        ],
                        "action": [
                            {
                                "delay": {
                                    "milliseconds": 0
                                }
                            },
                            {
                                "variables": {
                                    "trigger_action": "{%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%}",
                                    "trigger_delta": "{{ (as_timestamp(now()) - as_timestamp((states(helper_last_controller_event) | from_json).last_triggered if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"1970-01-01 00:00:00\")) * 1000 }}",
                                    "last_controller_event": "{{ (states(helper_last_controller_event) | from_json).trigger_action if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"\" }}"
                                }
                            },
                            {
                                "service": "input_text.set_value",
                                "data": {
                                    "entity_id": "input_text.zz_junior_bathroom_lights_controller_last_event",
                                    "value": "{{ {\"trigger_action\":trigger_action,\"last_triggered\":now()|string} | to_json }}"
                                }
                            },
                            {
                                "choose": [
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_junior_bathroom_lights_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_up_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_up_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "choose": [
                                                                                            {
                                                                                                "conditions": [
                                                                                                    {
                                                                                                        "condition": "time",
                                                                                                        "after": "input_datetime.elenas_bedtime",
                                                                                                        "before": "input_datetime.lights_auto_control_end"
                                                                                                    }
                                                                                                ],
                                                                                                "sequence": [
                                                                                                    {
                                                                                                        "service": "light.turn_on",
                                                                                                        "target": {
                                                                                                            "entity_id": "light.junior_bathroom_lights"
                                                                                                        },
                                                                                                        "data": {
                                                                                                            "brightness_pct": 5
                                                                                                        }
                                                                                                    }
                                                                                                ]
                                                                                            }
                                                                                        ],
                                                                                        "default": [
                                                                                            {
                                                                                                "service": "light.turn_on",
                                                                                                "target": {
                                                                                                    "entity_id": "light.junior_bathroom_lights"
                                                                                                },
                                                                                                "data": {
                                                                                                    "brightness_pct": 100
                                                                                                }
                                                                                            }
                                                                                        ]
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_up_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [
                                                                                    {
                                                                                        "condition": "time",
                                                                                        "after": "input_datetime.elenas_bedtime",
                                                                                        "before": "input_datetime.lights_auto_control_end"
                                                                                    }
                                                                                ],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "light.turn_on",
                                                                                        "target": {
                                                                                            "entity_id": "light.junior_bathroom_lights"
                                                                                        },
                                                                                        "data": {
                                                                                            "brightness_pct": 5
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ],
                                                                        "default": [
                                                                            {
                                                                                "service": "light.turn_on",
                                                                                "target": {
                                                                                    "entity_id": "light.junior_bathroom_lights"
                                                                                },
                                                                                "data": {
                                                                                    "brightness_pct": 100
                                                                                }
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_up_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "light.turn_on",
                                                                            "target": {
                                                                                "entity_id": "light.junior_bathroom_lights"
                                                                            },
                                                                            "data": {
                                                                                "brightness_step_pct": 10
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.junior_bathroom_lights"
                                                        },
                                                        "data": {
                                                            "brightness_step_pct": 10
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_up_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_up_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_junior_bathroom_lights_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_down_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_down_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "light.turn_off",
                                                                                        "target": {
                                                                                            "entity_id": "light.junior_bathroom_lights"
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_down_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "light.turn_off",
                                                                        "target": {
                                                                            "entity_id": "light.junior_bathroom_lights"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_down_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "light.turn_on",
                                                                            "target": {
                                                                                "entity_id": "light.junior_bathroom_lights"
                                                                            },
                                                                            "data": {
                                                                                "brightness_step_pct": -10
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.junior_bathroom_lights"
                                                        },
                                                        "data": {
                                                            "brightness_step_pct": -10
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_down_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_down_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            }
                        ],
                        "id": "1643646541355",
                        "alias": "Junior Bathroom Lights Controller",
                        "description": "Control the Junior Bathroom Lights"
                    },
                    "blueprint_inputs": {
                        "id": "1643646541355",
                        "alias": "Junior Bathroom Lights Controller",
                        "description": "Control the Junior Bathroom Lights",
                        "use_blueprint": {
                            "path": "EPMatt/ikea_e1743.yaml",
                            "input": {
                                "integration": "ZHA",
                                "controller_device": "f084f2e55c0800941585a50dd83e5f47",
                                "helper_last_controller_event": "input_text.zz_junior_bathroom_lights_controller_last_event",
                                "action_button_up_short": [
                                    {
                                        "choose": [
                                            {
                                                "conditions": [
                                                    {
                                                        "condition": "time",
                                                        "after": "input_datetime.elenas_bedtime",
                                                        "before": "input_datetime.lights_auto_control_end"
                                                    }
                                                ],
                                                "sequence": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.junior_bathroom_lights"
                                                        },
                                                        "data": {
                                                            "brightness_pct": 5
                                                        }
                                                    }
                                                ]
                                            }
                                        ],
                                        "default": [
                                            {
                                                "service": "light.turn_on",
                                                "target": {
                                                    "entity_id": "light.junior_bathroom_lights"
                                                },
                                                "data": {
                                                    "brightness_pct": 100
                                                }
                                            }
                                        ]
                                    }
                                ],
                                "action_button_up_long": [
                                    {
                                        "service": "light.turn_on",
                                        "target": {
                                            "entity_id": "light.junior_bathroom_lights"
                                        },
                                        "data": {
                                            "brightness_step_pct": 10
                                        }
                                    }
                                ],
                                "action_button_down_short": [
                                    {
                                        "service": "light.turn_off",
                                        "target": {
                                            "entity_id": "light.junior_bathroom_lights"
                                        }
                                    }
                                ],
                                "action_button_down_long": [
                                    {
                                        "service": "light.turn_on",
                                        "target": {
                                            "entity_id": "light.junior_bathroom_lights"
                                        },
                                        "data": {
                                            "brightness_step_pct": -10
                                        }
                                    }
                                ],
                                "button_up_long_loop": true,
                                "button_up_long_max_loop_repeats": 50,
                                "button_down_long_loop": true,
                                "button_down_long_max_loop_repeats": 50
                            }
                        }
                    },
                    "context": {
                        "id": "79f891f0315fc213a3160ceb1611e9e7",
                        "parent_id": "de8df624de453efc93dd9ddc32243e00",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/3/choose/3/sequence/0/default/1/choose/0/sequence/0",
                    "run_id": "9db01c4b22ac85128da25049ae3a94f5",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T02:00:19.556297+00:00",
                        "finish": "2022-03-03T02:00:19.689415+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643646541355",
                    "trigger": "event 'zha_event'"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/3/choose/3/sequence/0/default/1/choose/0/sequence/0",
                    "run_id": "5d345f39270f751b7a5fdafbb914134c",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T03:42:47.483042+00:00",
                        "finish": "2022-03-03T03:42:47.645567+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643646541355",
                    "trigger": "event 'zha_event'",
                    "trace": {
                        "trigger/1": [
                            {
                                "path": "trigger/1",
                                "timestamp": "2022-03-03T03:42:47.483764+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.junior_bathroom_lights_controller",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T02:00:19.557366+00:00",
                                            "mode": "restart",
                                            "current": 0,
                                            "id": "1643646541355",
                                            "friendly_name": "Junior Bathroom Lights Controller"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.799544+00:00",
                                        "last_updated": "2022-03-03T02:00:19.688369+00:00",
                                        "context": {
                                            "id": "79f891f0315fc213a3160ceb1611e9e7",
                                            "parent_id": "de8df624de453efc93dd9ddc32243e00",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "1",
                                        "idx": "1",
                                        "platform": "event",
                                        "event": {
                                            "event_type": "zha_event",
                                            "data": {
                                                "device_ieee": "84:fd:27:ff:fe:34:f7:7b",
                                                "unique_id": "84:fd:27:ff:fe:34:f7:7b:1:0x0006",
                                                "device_id": "f084f2e55c0800941585a50dd83e5f47",
                                                "endpoint_id": 1,
                                                "cluster_id": 6,
                                                "command": "off",
                                                "args": []
                                            },
                                            "origin": "LOCAL",
                                            "time_fired": "2022-03-03T03:42:47.482419+00:00",
                                            "context": {
                                                "id": "addf180ef73aafe54c584036f8dd26b5",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "description": "event 'zha_event'"
                                    },
                                    "integration": "ZHA",
                                    "button_up_long_loop": true,
                                    "button_up_long_max_loop_repeats": 50,
                                    "button_up_double_press": false,
                                    "button_down_long_loop": true,
                                    "button_down_long_max_loop_repeats": 50,
                                    "button_down_double_press": false,
                                    "helper_last_controller_event": "input_text.zz_junior_bathroom_lights_controller_last_event",
                                    "helper_double_press_delay": 500,
                                    "helper_debounce_delay": 0,
                                    "integration_id": "zha",
                                    "adjusted_double_press_delay": 500,
                                    "actions_mapping": {
                                        "deconz": {
                                            "button_up_short": [
                                                "1002"
                                            ],
                                            "button_up_long": [
                                                "1001"
                                            ],
                                            "button_up_release": [
                                                "1003"
                                            ],
                                            "button_down_short": [
                                                "2002"
                                            ],
                                            "button_down_long": [
                                                "2001"
                                            ],
                                            "button_down_release": [
                                                "2003"
                                            ]
                                        },
                                        "zha": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "move_with_on_off_0_83"
                                            ],
                                            "button_up_release": [
                                                "stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "move_1_83"
                                            ],
                                            "button_down_release": [
                                                "stop"
                                            ]
                                        },
                                        "zigbee2mqtt": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "brightness_move_up"
                                            ],
                                            "button_up_release": [
                                                "brightness_stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "brightness_move_down"
                                            ],
                                            "button_down_release": [
                                                "brightness_stop"
                                            ]
                                        }
                                    },
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ],
                                    "integrations_with_prev_event_storage": [
                                        "zha",
                                        "zigbee2mqtt"
                                    ],
                                    "controller_entity": "",
                                    "controller_device": "f084f2e55c0800941585a50dd83e5f47",
                                    "controller_id": "f084f2e55c0800941585a50dd83e5f47"
                                }
                            }
                        ],
                        "condition/0": [
                            {
                                "path": "condition/0",
                                "timestamp": "2022-03-03T03:42:47.483794+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "condition/0/conditions/0": [
                            {
                                "path": "condition/0/conditions/0",
                                "timestamp": "2022-03-03T03:42:47.483812+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "condition/0/conditions/1": [
                            {
                                "path": "condition/0/conditions/1",
                                "timestamp": "2022-03-03T03:42:47.483946+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T03:42:47.484498+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "ede8ef1e278826e7ec0b548b5bf1a8ed",
                                        "parent_id": "addf180ef73aafe54c584036f8dd26b5",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "delay": 0.0,
                                    "done": true
                                }
                            }
                        ],
                        "action/1": [
                            {
                                "path": "action/1",
                                "timestamp": "2022-03-03T03:42:47.484841+00:00"
                            }
                        ],
                        "action/2": [
                            {
                                "path": "action/2",
                                "timestamp": "2022-03-03T03:42:47.485289+00:00",
                                "changed_variables": {
                                    "trigger_action": "off",
                                    "trigger_delta": 6147925.43888092,
                                    "last_controller_event": "off"
                                },
                                "result": {
                                    "params": {
                                        "domain": "input_text",
                                        "service": "set_value",
                                        "service_data": {
                                            "entity_id": "input_text.zz_junior_bathroom_lights_controller_last_event",
                                            "value": {
                                                "trigger_action": "off",
                                                "last_triggered": "2022-03-03 11:42:47.485376+08:00"
                                            }
                                        },
                                        "target": {}
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "action/3": [
                            {
                                "path": "action/3",
                                "timestamp": "2022-03-03T03:42:47.486935+00:00",
                                "result": {
                                    "choice": 3
                                }
                            }
                        ],
                        "action/3/choose/0": [
                            {
                                "path": "action/3/choose/0",
                                "timestamp": "2022-03-03T03:42:47.486987+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/0/conditions/0": [
                            {
                                "path": "action/3/choose/0/conditions/0",
                                "timestamp": "2022-03-03T03:42:47.487009+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/1": [
                            {
                                "path": "action/3/choose/1",
                                "timestamp": "2022-03-03T03:42:47.487135+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/1/conditions/0": [
                            {
                                "path": "action/3/choose/1/conditions/0",
                                "timestamp": "2022-03-03T03:42:47.487158+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/2": [
                            {
                                "path": "action/3/choose/2",
                                "timestamp": "2022-03-03T03:42:47.487235+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/2/conditions/0": [
                            {
                                "path": "action/3/choose/2/conditions/0",
                                "timestamp": "2022-03-03T03:42:47.487254+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/3": [
                            {
                                "path": "action/3/choose/3",
                                "timestamp": "2022-03-03T03:42:47.487325+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/3/choose/3/conditions/0": [
                            {
                                "path": "action/3/choose/3/conditions/0",
                                "timestamp": "2022-03-03T03:42:47.487343+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/3/sequence/0": [
                            {
                                "path": "action/3/choose/3/sequence/0",
                                "timestamp": "2022-03-03T03:42:47.487651+00:00",
                                "result": {
                                    "choice": "default"
                                }
                            }
                        ],
                        "action/3/choose/3/sequence/0/choose/0": [
                            {
                                "path": "action/3/choose/3/sequence/0/choose/0",
                                "timestamp": "2022-03-03T03:42:47.487713+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/3/sequence/0/choose/0/conditions/0": [
                            {
                                "path": "action/3/choose/3/sequence/0/choose/0/conditions/0",
                                "timestamp": "2022-03-03T03:42:47.487740+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/3/sequence/0/default/0": [
                            {
                                "path": "action/3/choose/3/sequence/0/default/0",
                                "timestamp": "2022-03-03T03:42:47.488060+00:00",
                                "result": {
                                    "event": "ahb_controller_event",
                                    "event_data": {
                                        "controller": "f084f2e55c0800941585a50dd83e5f47",
                                        "action": "button_down_short"
                                    }
                                }
                            }
                        ],
                        "action/3/choose/3/sequence/0/default/1": [
                            {
                                "path": "action/3/choose/3/sequence/0/default/1",
                                "timestamp": "2022-03-03T03:42:47.488209+00:00",
                                "result": {
                                    "choice": 0
                                }
                            }
                        ],
                        "action/3/choose/3/sequence/0/default/1/choose/0": [
                            {
                                "path": "action/3/choose/3/sequence/0/default/1/choose/0",
                                "timestamp": "2022-03-03T03:42:47.488243+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/3/choose/3/sequence/0/default/1/choose/0/sequence/0": [
                            {
                                "path": "action/3/choose/3/sequence/0/default/1/choose/0/sequence/0",
                                "timestamp": "2022-03-03T03:42:47.488536+00:00",
                                "result": {
                                    "params": {
                                        "domain": "light",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "light.junior_bathroom_lights"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ]
                    },
                    "config": {
                        "variables": {
                            "integration": "ZHA",
                            "button_up_long_loop": true,
                            "button_up_long_max_loop_repeats": 50,
                            "button_up_double_press": false,
                            "button_down_long_loop": true,
                            "button_down_long_max_loop_repeats": 50,
                            "button_down_double_press": false,
                            "helper_last_controller_event": "input_text.zz_junior_bathroom_lights_controller_last_event",
                            "helper_double_press_delay": 500,
                            "helper_debounce_delay": 0,
                            "integration_id": "{{ integration | lower }}",
                            "adjusted_double_press_delay": "{{ [helper_double_press_delay - helper_debounce_delay, 100] | max }}",
                            "actions_mapping": {
                                "deconz": {
                                    "button_up_short": [
                                        "1002"
                                    ],
                                    "button_up_long": [
                                        "1001"
                                    ],
                                    "button_up_release": [
                                        "1003"
                                    ],
                                    "button_down_short": [
                                        "2002"
                                    ],
                                    "button_down_long": [
                                        "2001"
                                    ],
                                    "button_down_release": [
                                        "2003"
                                    ]
                                },
                                "zha": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ]
                                },
                                "zigbee2mqtt": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "brightness_move_up"
                                    ],
                                    "button_up_release": [
                                        "brightness_stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "brightness_move_down"
                                    ],
                                    "button_down_release": [
                                        "brightness_stop"
                                    ]
                                }
                            },
                            "button_up_short": "{{ actions_mapping[integration_id][\"button_up_short\"] }}",
                            "button_up_long": "{{ actions_mapping[integration_id][\"button_up_long\"] }}",
                            "button_up_release": "{{ actions_mapping[integration_id][\"button_up_release\"] }}",
                            "button_down_short": "{{ actions_mapping[integration_id][\"button_down_short\"] }}",
                            "button_down_long": "{{ actions_mapping[integration_id][\"button_down_long\"] }}",
                            "button_down_release": "{{ actions_mapping[integration_id][\"button_down_release\"] }}",
                            "integrations_with_prev_event_storage": [
                                "zha",
                                "zigbee2mqtt"
                            ],
                            "controller_entity": "",
                            "controller_device": "f084f2e55c0800941585a50dd83e5f47",
                            "controller_id": "{% if integration_id==\"zigbee2mqtt\" %}{{controller_entity}}{% else %}{{controller_device}}{% endif %}"
                        },
                        "mode": "restart",
                        "max_exceeded": "silent",
                        "trigger": [
                            {
                                "platform": "event",
                                "event_type": "state_changed",
                                "event_data": {
                                    "entity_id": ""
                                }
                            },
                            {
                                "platform": "event",
                                "event_type": [
                                    "deconz_event",
                                    "zha_event"
                                ],
                                "event_data": {
                                    "device_id": "f084f2e55c0800941585a50dd83e5f47"
                                }
                            }
                        ],
                        "condition": [
                            {
                                "condition": "and",
                                "conditions": [
                                    "{%- set trigger_action -%} {%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%} {%- endset -%} {{ trigger_action not in [\"\",\"None\"] }}",
                                    "{{ integration_id != \"zigbee2mqtt\" or trigger.event.data.new_state.state != trigger.event.data.old_state.state }}"
                                ]
                            }
                        ],
                        "action": [
                            {
                                "delay": {
                                    "milliseconds": 0
                                }
                            },
                            {
                                "variables": {
                                    "trigger_action": "{%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%}",
                                    "trigger_delta": "{{ (as_timestamp(now()) - as_timestamp((states(helper_last_controller_event) | from_json).last_triggered if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"1970-01-01 00:00:00\")) * 1000 }}",
                                    "last_controller_event": "{{ (states(helper_last_controller_event) | from_json).trigger_action if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"\" }}"
                                }
                            },
                            {
                                "service": "input_text.set_value",
                                "data": {
                                    "entity_id": "input_text.zz_junior_bathroom_lights_controller_last_event",
                                    "value": "{{ {\"trigger_action\":trigger_action,\"last_triggered\":now()|string} | to_json }}"
                                }
                            },
                            {
                                "choose": [
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_junior_bathroom_lights_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_up_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_up_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "choose": [
                                                                                            {
                                                                                                "conditions": [
                                                                                                    {
                                                                                                        "condition": "time",
                                                                                                        "after": "input_datetime.elenas_bedtime",
                                                                                                        "before": "input_datetime.lights_auto_control_end"
                                                                                                    }
                                                                                                ],
                                                                                                "sequence": [
                                                                                                    {
                                                                                                        "service": "light.turn_on",
                                                                                                        "target": {
                                                                                                            "entity_id": "light.junior_bathroom_lights"
                                                                                                        },
                                                                                                        "data": {
                                                                                                            "brightness_pct": 5
                                                                                                        }
                                                                                                    }
                                                                                                ]
                                                                                            }
                                                                                        ],
                                                                                        "default": [
                                                                                            {
                                                                                                "service": "light.turn_on",
                                                                                                "target": {
                                                                                                    "entity_id": "light.junior_bathroom_lights"
                                                                                                },
                                                                                                "data": {
                                                                                                    "brightness_pct": 100
                                                                                                }
                                                                                            }
                                                                                        ]
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_up_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [
                                                                                    {
                                                                                        "condition": "time",
                                                                                        "after": "input_datetime.elenas_bedtime",
                                                                                        "before": "input_datetime.lights_auto_control_end"
                                                                                    }
                                                                                ],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "light.turn_on",
                                                                                        "target": {
                                                                                            "entity_id": "light.junior_bathroom_lights"
                                                                                        },
                                                                                        "data": {
                                                                                            "brightness_pct": 5
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ],
                                                                        "default": [
                                                                            {
                                                                                "service": "light.turn_on",
                                                                                "target": {
                                                                                    "entity_id": "light.junior_bathroom_lights"
                                                                                },
                                                                                "data": {
                                                                                    "brightness_pct": 100
                                                                                }
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_up_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "light.turn_on",
                                                                            "target": {
                                                                                "entity_id": "light.junior_bathroom_lights"
                                                                            },
                                                                            "data": {
                                                                                "brightness_step_pct": 10
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.junior_bathroom_lights"
                                                        },
                                                        "data": {
                                                            "brightness_step_pct": 10
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_up_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_up_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_junior_bathroom_lights_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_down_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_down_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "light.turn_off",
                                                                                        "target": {
                                                                                            "entity_id": "light.junior_bathroom_lights"
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_down_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "light.turn_off",
                                                                        "target": {
                                                                            "entity_id": "light.junior_bathroom_lights"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_down_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "light.turn_on",
                                                                            "target": {
                                                                                "entity_id": "light.junior_bathroom_lights"
                                                                            },
                                                                            "data": {
                                                                                "brightness_step_pct": -10
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.junior_bathroom_lights"
                                                        },
                                                        "data": {
                                                            "brightness_step_pct": -10
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_down_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_down_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            }
                        ],
                        "id": "1643646541355",
                        "alias": "Junior Bathroom Lights Controller",
                        "description": "Control the Junior Bathroom Lights"
                    },
                    "blueprint_inputs": {
                        "id": "1643646541355",
                        "alias": "Junior Bathroom Lights Controller",
                        "description": "Control the Junior Bathroom Lights",
                        "use_blueprint": {
                            "path": "EPMatt/ikea_e1743.yaml",
                            "input": {
                                "integration": "ZHA",
                                "controller_device": "f084f2e55c0800941585a50dd83e5f47",
                                "helper_last_controller_event": "input_text.zz_junior_bathroom_lights_controller_last_event",
                                "action_button_up_short": [
                                    {
                                        "choose": [
                                            {
                                                "conditions": [
                                                    {
                                                        "condition": "time",
                                                        "after": "input_datetime.elenas_bedtime",
                                                        "before": "input_datetime.lights_auto_control_end"
                                                    }
                                                ],
                                                "sequence": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.junior_bathroom_lights"
                                                        },
                                                        "data": {
                                                            "brightness_pct": 5
                                                        }
                                                    }
                                                ]
                                            }
                                        ],
                                        "default": [
                                            {
                                                "service": "light.turn_on",
                                                "target": {
                                                    "entity_id": "light.junior_bathroom_lights"
                                                },
                                                "data": {
                                                    "brightness_pct": 100
                                                }
                                            }
                                        ]
                                    }
                                ],
                                "action_button_up_long": [
                                    {
                                        "service": "light.turn_on",
                                        "target": {
                                            "entity_id": "light.junior_bathroom_lights"
                                        },
                                        "data": {
                                            "brightness_step_pct": 10
                                        }
                                    }
                                ],
                                "action_button_down_short": [
                                    {
                                        "service": "light.turn_off",
                                        "target": {
                                            "entity_id": "light.junior_bathroom_lights"
                                        }
                                    }
                                ],
                                "action_button_down_long": [
                                    {
                                        "service": "light.turn_on",
                                        "target": {
                                            "entity_id": "light.junior_bathroom_lights"
                                        },
                                        "data": {
                                            "brightness_step_pct": -10
                                        }
                                    }
                                ],
                                "button_up_long_loop": true,
                                "button_up_long_max_loop_repeats": 50,
                                "button_down_long_loop": true,
                                "button_down_long_max_loop_repeats": 50
                            }
                        }
                    },
                    "context": {
                        "id": "ede8ef1e278826e7ec0b548b5bf1a8ed",
                        "parent_id": "addf180ef73aafe54c584036f8dd26b5",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/3/choose/3/sequence/0/default/1/choose/0/sequence/0",
                    "run_id": "5d345f39270f751b7a5fdafbb914134c",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T03:42:47.483042+00:00",
                        "finish": "2022-03-03T03:42:47.645567+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643646541355",
                    "trigger": "event 'zha_event'"
                }
            },
            {
                "extended_dict": {
                    "last_step": "action/3/choose/3/sequence/0/default/1/choose/0/sequence/0",
                    "run_id": "112185b6cf47ff4d77a8e1f01ae1bcca",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T07:54:05.577469+00:00",
                        "finish": "2022-03-03T07:54:05.686969+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643646541355",
                    "trigger": "event 'zha_event'",
                    "trace": {
                        "trigger/1": [
                            {
                                "path": "trigger/1",
                                "timestamp": "2022-03-03T07:54:05.578167+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.junior_bathroom_lights_controller",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-03T03:42:47.484102+00:00",
                                            "mode": "restart",
                                            "current": 0,
                                            "id": "1643646541355",
                                            "friendly_name": "Junior Bathroom Lights Controller"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.799544+00:00",
                                        "last_updated": "2022-03-03T03:42:47.645184+00:00",
                                        "context": {
                                            "id": "ede8ef1e278826e7ec0b548b5bf1a8ed",
                                            "parent_id": "addf180ef73aafe54c584036f8dd26b5",
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "1",
                                        "idx": "1",
                                        "platform": "event",
                                        "event": {
                                            "event_type": "zha_event",
                                            "data": {
                                                "device_ieee": "84:fd:27:ff:fe:34:f7:7b",
                                                "unique_id": "84:fd:27:ff:fe:34:f7:7b:1:0x0006",
                                                "device_id": "f084f2e55c0800941585a50dd83e5f47",
                                                "endpoint_id": 1,
                                                "cluster_id": 6,
                                                "command": "off",
                                                "args": []
                                            },
                                            "origin": "LOCAL",
                                            "time_fired": "2022-03-03T07:54:05.576108+00:00",
                                            "context": {
                                                "id": "51ef9e4dfce5329ccd5debfec7f4c689",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "description": "event 'zha_event'"
                                    },
                                    "integration": "ZHA",
                                    "button_up_long_loop": true,
                                    "button_up_long_max_loop_repeats": 50,
                                    "button_up_double_press": false,
                                    "button_down_long_loop": true,
                                    "button_down_long_max_loop_repeats": 50,
                                    "button_down_double_press": false,
                                    "helper_last_controller_event": "input_text.zz_junior_bathroom_lights_controller_last_event",
                                    "helper_double_press_delay": 500,
                                    "helper_debounce_delay": 0,
                                    "integration_id": "zha",
                                    "adjusted_double_press_delay": 500,
                                    "actions_mapping": {
                                        "deconz": {
                                            "button_up_short": [
                                                "1002"
                                            ],
                                            "button_up_long": [
                                                "1001"
                                            ],
                                            "button_up_release": [
                                                "1003"
                                            ],
                                            "button_down_short": [
                                                "2002"
                                            ],
                                            "button_down_long": [
                                                "2001"
                                            ],
                                            "button_down_release": [
                                                "2003"
                                            ]
                                        },
                                        "zha": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "move_with_on_off_0_83"
                                            ],
                                            "button_up_release": [
                                                "stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "move_1_83"
                                            ],
                                            "button_down_release": [
                                                "stop"
                                            ]
                                        },
                                        "zigbee2mqtt": {
                                            "button_up_short": [
                                                "on"
                                            ],
                                            "button_up_long": [
                                                "brightness_move_up"
                                            ],
                                            "button_up_release": [
                                                "brightness_stop"
                                            ],
                                            "button_down_short": [
                                                "off"
                                            ],
                                            "button_down_long": [
                                                "brightness_move_down"
                                            ],
                                            "button_down_release": [
                                                "brightness_stop"
                                            ]
                                        }
                                    },
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ],
                                    "integrations_with_prev_event_storage": [
                                        "zha",
                                        "zigbee2mqtt"
                                    ],
                                    "controller_entity": "",
                                    "controller_device": "f084f2e55c0800941585a50dd83e5f47",
                                    "controller_id": "f084f2e55c0800941585a50dd83e5f47"
                                }
                            }
                        ],
                        "condition/0": [
                            {
                                "path": "condition/0",
                                "timestamp": "2022-03-03T07:54:05.578195+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "condition/0/conditions/0": [
                            {
                                "path": "condition/0/conditions/0",
                                "timestamp": "2022-03-03T07:54:05.578217+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "condition/0/conditions/1": [
                            {
                                "path": "condition/0/conditions/1",
                                "timestamp": "2022-03-03T07:54:05.578351+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T07:54:05.578914+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "dc48bcf1c40e3f7c98f746ed63cfcd82",
                                        "parent_id": "51ef9e4dfce5329ccd5debfec7f4c689",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "delay": 0.0,
                                    "done": true
                                }
                            }
                        ],
                        "action/1": [
                            {
                                "path": "action/1",
                                "timestamp": "2022-03-03T07:54:05.579532+00:00"
                            }
                        ],
                        "action/2": [
                            {
                                "path": "action/2",
                                "timestamp": "2022-03-03T07:54:05.580063+00:00",
                                "changed_variables": {
                                    "trigger_action": "off",
                                    "trigger_delta": 15078094.38920021,
                                    "last_controller_event": "off"
                                },
                                "result": {
                                    "params": {
                                        "domain": "input_text",
                                        "service": "set_value",
                                        "service_data": {
                                            "entity_id": "input_text.zz_junior_bathroom_lights_controller_last_event",
                                            "value": {
                                                "trigger_action": "off",
                                                "last_triggered": "2022-03-03 15:54:05.580156+08:00"
                                            }
                                        },
                                        "target": {}
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "action/3": [
                            {
                                "path": "action/3",
                                "timestamp": "2022-03-03T07:54:05.581340+00:00",
                                "result": {
                                    "choice": 3
                                }
                            }
                        ],
                        "action/3/choose/0": [
                            {
                                "path": "action/3/choose/0",
                                "timestamp": "2022-03-03T07:54:05.581386+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/0/conditions/0": [
                            {
                                "path": "action/3/choose/0/conditions/0",
                                "timestamp": "2022-03-03T07:54:05.581411+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/1": [
                            {
                                "path": "action/3/choose/1",
                                "timestamp": "2022-03-03T07:54:05.581508+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/1/conditions/0": [
                            {
                                "path": "action/3/choose/1/conditions/0",
                                "timestamp": "2022-03-03T07:54:05.581527+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/2": [
                            {
                                "path": "action/3/choose/2",
                                "timestamp": "2022-03-03T07:54:05.581600+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/2/conditions/0": [
                            {
                                "path": "action/3/choose/2/conditions/0",
                                "timestamp": "2022-03-03T07:54:05.581617+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/3": [
                            {
                                "path": "action/3/choose/3",
                                "timestamp": "2022-03-03T07:54:05.581718+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/3/choose/3/conditions/0": [
                            {
                                "path": "action/3/choose/3/conditions/0",
                                "timestamp": "2022-03-03T07:54:05.581744+00:00",
                                "result": {
                                    "result": true,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/3/sequence/0": [
                            {
                                "path": "action/3/choose/3/sequence/0",
                                "timestamp": "2022-03-03T07:54:05.582275+00:00",
                                "result": {
                                    "choice": "default"
                                }
                            }
                        ],
                        "action/3/choose/3/sequence/0/choose/0": [
                            {
                                "path": "action/3/choose/3/sequence/0/choose/0",
                                "timestamp": "2022-03-03T07:54:05.582327+00:00",
                                "result": {
                                    "result": false
                                }
                            }
                        ],
                        "action/3/choose/3/sequence/0/choose/0/conditions/0": [
                            {
                                "path": "action/3/choose/3/sequence/0/choose/0/conditions/0",
                                "timestamp": "2022-03-03T07:54:05.582347+00:00",
                                "result": {
                                    "result": false,
                                    "entities": []
                                }
                            }
                        ],
                        "action/3/choose/3/sequence/0/default/0": [
                            {
                                "path": "action/3/choose/3/sequence/0/default/0",
                                "timestamp": "2022-03-03T07:54:05.582610+00:00",
                                "result": {
                                    "event": "ahb_controller_event",
                                    "event_data": {
                                        "controller": "f084f2e55c0800941585a50dd83e5f47",
                                        "action": "button_down_short"
                                    }
                                }
                            }
                        ],
                        "action/3/choose/3/sequence/0/default/1": [
                            {
                                "path": "action/3/choose/3/sequence/0/default/1",
                                "timestamp": "2022-03-03T07:54:05.582814+00:00",
                                "result": {
                                    "choice": 0
                                }
                            }
                        ],
                        "action/3/choose/3/sequence/0/default/1/choose/0": [
                            {
                                "path": "action/3/choose/3/sequence/0/default/1/choose/0",
                                "timestamp": "2022-03-03T07:54:05.582849+00:00",
                                "result": {
                                    "result": true
                                }
                            }
                        ],
                        "action/3/choose/3/sequence/0/default/1/choose/0/sequence/0": [
                            {
                                "path": "action/3/choose/3/sequence/0/default/1/choose/0/sequence/0",
                                "timestamp": "2022-03-03T07:54:05.583170+00:00",
                                "result": {
                                    "params": {
                                        "domain": "light",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "light.junior_bathroom_lights"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ]
                    },
                    "config": {
                        "variables": {
                            "integration": "ZHA",
                            "button_up_long_loop": true,
                            "button_up_long_max_loop_repeats": 50,
                            "button_up_double_press": false,
                            "button_down_long_loop": true,
                            "button_down_long_max_loop_repeats": 50,
                            "button_down_double_press": false,
                            "helper_last_controller_event": "input_text.zz_junior_bathroom_lights_controller_last_event",
                            "helper_double_press_delay": 500,
                            "helper_debounce_delay": 0,
                            "integration_id": "{{ integration | lower }}",
                            "adjusted_double_press_delay": "{{ [helper_double_press_delay - helper_debounce_delay, 100] | max }}",
                            "actions_mapping": {
                                "deconz": {
                                    "button_up_short": [
                                        "1002"
                                    ],
                                    "button_up_long": [
                                        "1001"
                                    ],
                                    "button_up_release": [
                                        "1003"
                                    ],
                                    "button_down_short": [
                                        "2002"
                                    ],
                                    "button_down_long": [
                                        "2001"
                                    ],
                                    "button_down_release": [
                                        "2003"
                                    ]
                                },
                                "zha": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "move_with_on_off_0_83"
                                    ],
                                    "button_up_release": [
                                        "stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "move_1_83"
                                    ],
                                    "button_down_release": [
                                        "stop"
                                    ]
                                },
                                "zigbee2mqtt": {
                                    "button_up_short": [
                                        "on"
                                    ],
                                    "button_up_long": [
                                        "brightness_move_up"
                                    ],
                                    "button_up_release": [
                                        "brightness_stop"
                                    ],
                                    "button_down_short": [
                                        "off"
                                    ],
                                    "button_down_long": [
                                        "brightness_move_down"
                                    ],
                                    "button_down_release": [
                                        "brightness_stop"
                                    ]
                                }
                            },
                            "button_up_short": "{{ actions_mapping[integration_id][\"button_up_short\"] }}",
                            "button_up_long": "{{ actions_mapping[integration_id][\"button_up_long\"] }}",
                            "button_up_release": "{{ actions_mapping[integration_id][\"button_up_release\"] }}",
                            "button_down_short": "{{ actions_mapping[integration_id][\"button_down_short\"] }}",
                            "button_down_long": "{{ actions_mapping[integration_id][\"button_down_long\"] }}",
                            "button_down_release": "{{ actions_mapping[integration_id][\"button_down_release\"] }}",
                            "integrations_with_prev_event_storage": [
                                "zha",
                                "zigbee2mqtt"
                            ],
                            "controller_entity": "",
                            "controller_device": "f084f2e55c0800941585a50dd83e5f47",
                            "controller_id": "{% if integration_id==\"zigbee2mqtt\" %}{{controller_entity}}{% else %}{{controller_device}}{% endif %}"
                        },
                        "mode": "restart",
                        "max_exceeded": "silent",
                        "trigger": [
                            {
                                "platform": "event",
                                "event_type": "state_changed",
                                "event_data": {
                                    "entity_id": ""
                                }
                            },
                            {
                                "platform": "event",
                                "event_type": [
                                    "deconz_event",
                                    "zha_event"
                                ],
                                "event_data": {
                                    "device_id": "f084f2e55c0800941585a50dd83e5f47"
                                }
                            }
                        ],
                        "condition": [
                            {
                                "condition": "and",
                                "conditions": [
                                    "{%- set trigger_action -%} {%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%} {%- endset -%} {{ trigger_action not in [\"\",\"None\"] }}",
                                    "{{ integration_id != \"zigbee2mqtt\" or trigger.event.data.new_state.state != trigger.event.data.old_state.state }}"
                                ]
                            }
                        ],
                        "action": [
                            {
                                "delay": {
                                    "milliseconds": 0
                                }
                            },
                            {
                                "variables": {
                                    "trigger_action": "{%- if integration_id == \"zigbee2mqtt\" -%} {{ trigger.event.data.new_state.state }} {%- elif integration_id == \"deconz\" -%} {{ trigger.event.data.event }} {%- elif integration_id == \"zha\" -%} {{ trigger.event.data.command }}{{\"_\" if trigger.event.data.args|length > 0}}{{ trigger.event.data.args|join(\"_\") }} {%- endif -%}",
                                    "trigger_delta": "{{ (as_timestamp(now()) - as_timestamp((states(helper_last_controller_event) | from_json).last_triggered if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"1970-01-01 00:00:00\")) * 1000 }}",
                                    "last_controller_event": "{{ (states(helper_last_controller_event) | from_json).trigger_action if helper_last_controller_event is not none and (states(helper_last_controller_event) | regex_match(\"^\\{(\\\".*\\\": \\\".*\\\"(, )?)*\\}$\")) else \"\" }}"
                                }
                            },
                            {
                                "service": "input_text.set_value",
                                "data": {
                                    "entity_id": "input_text.zz_junior_bathroom_lights_controller_last_event",
                                    "value": "{{ {\"trigger_action\":trigger_action,\"last_triggered\":now()|string} | to_json }}"
                                }
                            },
                            {
                                "choose": [
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_junior_bathroom_lights_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_up_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_up_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "choose": [
                                                                                            {
                                                                                                "conditions": [
                                                                                                    {
                                                                                                        "condition": "time",
                                                                                                        "after": "input_datetime.elenas_bedtime",
                                                                                                        "before": "input_datetime.lights_auto_control_end"
                                                                                                    }
                                                                                                ],
                                                                                                "sequence": [
                                                                                                    {
                                                                                                        "service": "light.turn_on",
                                                                                                        "target": {
                                                                                                            "entity_id": "light.junior_bathroom_lights"
                                                                                                        },
                                                                                                        "data": {
                                                                                                            "brightness_pct": 5
                                                                                                        }
                                                                                                    }
                                                                                                ]
                                                                                            }
                                                                                        ],
                                                                                        "default": [
                                                                                            {
                                                                                                "service": "light.turn_on",
                                                                                                "target": {
                                                                                                    "entity_id": "light.junior_bathroom_lights"
                                                                                                },
                                                                                                "data": {
                                                                                                    "brightness_pct": 100
                                                                                                }
                                                                                            }
                                                                                        ]
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_up_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [
                                                                                    {
                                                                                        "condition": "time",
                                                                                        "after": "input_datetime.elenas_bedtime",
                                                                                        "before": "input_datetime.lights_auto_control_end"
                                                                                    }
                                                                                ],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "light.turn_on",
                                                                                        "target": {
                                                                                            "entity_id": "light.junior_bathroom_lights"
                                                                                        },
                                                                                        "data": {
                                                                                            "brightness_pct": 5
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ],
                                                                        "default": [
                                                                            {
                                                                                "service": "light.turn_on",
                                                                                "target": {
                                                                                    "entity_id": "light.junior_bathroom_lights"
                                                                                },
                                                                                "data": {
                                                                                    "brightness_pct": 100
                                                                                }
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_up_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_up_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_up_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "light.turn_on",
                                                                            "target": {
                                                                                "entity_id": "light.junior_bathroom_lights"
                                                                            },
                                                                            "data": {
                                                                                "brightness_step_pct": 10
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.junior_bathroom_lights"
                                                        },
                                                        "data": {
                                                            "brightness_step_pct": 10
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_up_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_up_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_up_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_short }}",
                                        "sequence": [
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_double_press }}",
                                                        "sequence": [
                                                            {
                                                                "choose": [
                                                                    {
                                                                        "conditions": "{{ trigger_action | string in states(helper_last_controller_event) and trigger_delta | int <= helper_double_press_delay | int }}",
                                                                        "sequence": [
                                                                            {
                                                                                "service": "input_text.set_value",
                                                                                "data": {
                                                                                    "entity_id": "input_text.zz_junior_bathroom_lights_controller_last_event",
                                                                                    "value": "{{ {\"trigger_action\":\"double_press\",\"last_triggered\":now() | string} | to_json }}"
                                                                                }
                                                                            },
                                                                            {
                                                                                "event": "ahb_controller_event",
                                                                                "event_data": {
                                                                                    "controller": "{{ controller_id }}",
                                                                                    "action": "button_down_double"
                                                                                }
                                                                            },
                                                                            {
                                                                                "choose": [
                                                                                    {
                                                                                        "conditions": [],
                                                                                        "sequence": []
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                "default": [
                                                                    {
                                                                        "delay": {
                                                                            "milliseconds": "{{ adjusted_double_press_delay }}"
                                                                        }
                                                                    },
                                                                    {
                                                                        "event": "ahb_controller_event",
                                                                        "event_data": {
                                                                            "controller": "{{ controller_id }}",
                                                                            "action": "button_down_short"
                                                                        }
                                                                    },
                                                                    {
                                                                        "choose": [
                                                                            {
                                                                                "conditions": [],
                                                                                "sequence": [
                                                                                    {
                                                                                        "service": "light.turn_off",
                                                                                        "target": {
                                                                                            "entity_id": "light.junior_bathroom_lights"
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ]
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "event": "ahb_controller_event",
                                                        "event_data": {
                                                            "controller": "{{ controller_id }}",
                                                            "action": "button_down_short"
                                                        }
                                                    },
                                                    {
                                                        "choose": [
                                                            {
                                                                "conditions": [],
                                                                "sequence": [
                                                                    {
                                                                        "service": "light.turn_off",
                                                                        "target": {
                                                                            "entity_id": "light.junior_bathroom_lights"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": "{{ trigger_action | string in button_down_long }}",
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_long"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": "{{ button_down_long_loop }}",
                                                        "sequence": [
                                                            {
                                                                "repeat": {
                                                                    "while": "{{ repeat.index < button_down_long_max_loop_repeats | int }}",
                                                                    "sequence": [
                                                                        {
                                                                            "service": "light.turn_on",
                                                                            "target": {
                                                                                "entity_id": "light.junior_bathroom_lights"
                                                                            },
                                                                            "data": {
                                                                                "brightness_step_pct": -10
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "default": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.junior_bathroom_lights"
                                                        },
                                                        "data": {
                                                            "brightness_step_pct": -10
                                                        }
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "conditions": [
                                            "{{ trigger_action | string in button_down_release }}",
                                            "{{ not integration_id in integrations_with_prev_event_storage or last_controller_event | string in button_down_long }}"
                                        ],
                                        "sequence": [
                                            {
                                                "event": "ahb_controller_event",
                                                "event_data": {
                                                    "controller": "{{ controller_id }}",
                                                    "action": "button_down_release"
                                                }
                                            },
                                            {
                                                "choose": [
                                                    {
                                                        "conditions": [],
                                                        "sequence": []
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            }
                        ],
                        "id": "1643646541355",
                        "alias": "Junior Bathroom Lights Controller",
                        "description": "Control the Junior Bathroom Lights"
                    },
                    "blueprint_inputs": {
                        "id": "1643646541355",
                        "alias": "Junior Bathroom Lights Controller",
                        "description": "Control the Junior Bathroom Lights",
                        "use_blueprint": {
                            "path": "EPMatt/ikea_e1743.yaml",
                            "input": {
                                "integration": "ZHA",
                                "controller_device": "f084f2e55c0800941585a50dd83e5f47",
                                "helper_last_controller_event": "input_text.zz_junior_bathroom_lights_controller_last_event",
                                "action_button_up_short": [
                                    {
                                        "choose": [
                                            {
                                                "conditions": [
                                                    {
                                                        "condition": "time",
                                                        "after": "input_datetime.elenas_bedtime",
                                                        "before": "input_datetime.lights_auto_control_end"
                                                    }
                                                ],
                                                "sequence": [
                                                    {
                                                        "service": "light.turn_on",
                                                        "target": {
                                                            "entity_id": "light.junior_bathroom_lights"
                                                        },
                                                        "data": {
                                                            "brightness_pct": 5
                                                        }
                                                    }
                                                ]
                                            }
                                        ],
                                        "default": [
                                            {
                                                "service": "light.turn_on",
                                                "target": {
                                                    "entity_id": "light.junior_bathroom_lights"
                                                },
                                                "data": {
                                                    "brightness_pct": 100
                                                }
                                            }
                                        ]
                                    }
                                ],
                                "action_button_up_long": [
                                    {
                                        "service": "light.turn_on",
                                        "target": {
                                            "entity_id": "light.junior_bathroom_lights"
                                        },
                                        "data": {
                                            "brightness_step_pct": 10
                                        }
                                    }
                                ],
                                "action_button_down_short": [
                                    {
                                        "service": "light.turn_off",
                                        "target": {
                                            "entity_id": "light.junior_bathroom_lights"
                                        }
                                    }
                                ],
                                "action_button_down_long": [
                                    {
                                        "service": "light.turn_on",
                                        "target": {
                                            "entity_id": "light.junior_bathroom_lights"
                                        },
                                        "data": {
                                            "brightness_step_pct": -10
                                        }
                                    }
                                ],
                                "button_up_long_loop": true,
                                "button_up_long_max_loop_repeats": 50,
                                "button_down_long_loop": true,
                                "button_down_long_max_loop_repeats": 50
                            }
                        }
                    },
                    "context": {
                        "id": "dc48bcf1c40e3f7c98f746ed63cfcd82",
                        "parent_id": "51ef9e4dfce5329ccd5debfec7f4c689",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/3/choose/3/sequence/0/default/1/choose/0/sequence/0",
                    "run_id": "112185b6cf47ff4d77a8e1f01ae1bcca",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T07:54:05.577469+00:00",
                        "finish": "2022-03-03T07:54:05.686969+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643646541355",
                    "trigger": "event 'zha_event'"
                }
            }
        ],
        "automation.1643979577174": [
            {
                "extended_dict": {
                    "last_step": "action/1",
                    "run_id": "e58fc2251381255f33a6555172535836",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T03:01:30.476212+00:00",
                        "finish": "2022-03-03T03:01:30.886042+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643979577174",
                    "trigger": "state of binary_sensor.washer_wash_completed",
                    "trace": {
                        "trigger/0": [
                            {
                                "path": "trigger/0",
                                "timestamp": "2022-03-03T03:01:30.476252+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "automation.notify_when_wash_completed",
                                        "state": "on",
                                        "attributes": {
                                            "last_triggered": "2022-03-02T01:45:30.690035+00:00",
                                            "mode": "single",
                                            "current": 0,
                                            "id": "1643979577174",
                                            "friendly_name": "Notify When Wash Completed"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.800171+00:00",
                                        "last_updated": "2022-03-03T00:41:11.800171+00:00",
                                        "context": {
                                            "id": "05750aeabf3524c8a16611341fc12608",
                                            "parent_id": null,
                                            "user_id": null
                                        }
                                    },
                                    "trigger": {
                                        "id": "0",
                                        "idx": "0",
                                        "platform": "state",
                                        "entity_id": "binary_sensor.washer_wash_completed",
                                        "from_state": {
                                            "entity_id": "binary_sensor.washer_wash_completed",
                                            "state": "off",
                                            "attributes": {
                                                "friendly_name": "Washer Wash completed"
                                            },
                                            "last_changed": "2022-03-03T01:09:48.626086+00:00",
                                            "last_updated": "2022-03-03T01:09:48.626086+00:00",
                                            "context": {
                                                "id": "52b1fe322e7b9f13edce6701837fbb3f",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "to_state": {
                                            "entity_id": "binary_sensor.washer_wash_completed",
                                            "state": "on",
                                            "attributes": {
                                                "friendly_name": "Washer Wash completed"
                                            },
                                            "last_changed": "2022-03-03T03:01:30.473604+00:00",
                                            "last_updated": "2022-03-03T03:01:30.473604+00:00",
                                            "context": {
                                                "id": "0311f2a5dae4ccdaa62e5ca022c31f08",
                                                "parent_id": null,
                                                "user_id": null
                                            }
                                        },
                                        "for": null,
                                        "attribute": null,
                                        "description": "state of binary_sensor.washer_wash_completed"
                                    }
                                }
                            }
                        ],
                        "action/0": [
                            {
                                "path": "action/0",
                                "timestamp": "2022-03-03T03:01:30.476777+00:00",
                                "changed_variables": {
                                    "context": {
                                        "id": "452d5e5cc6f7febca23d7ced06c48ae8",
                                        "parent_id": "0311f2a5dae4ccdaa62e5ca022c31f08",
                                        "user_id": null
                                    }
                                },
                                "result": {
                                    "params": {
                                        "domain": "notify",
                                        "service": "mobile_app_pixel_4a",
                                        "service_data": {
                                            "title": "Please unload laundry",
                                            "message": "Wash completed at 11:01"
                                        },
                                        "target": {}
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ],
                        "action/1": [
                            {
                                "path": "action/1",
                                "timestamp": "2022-03-03T03:01:30.883866+00:00",
                                "result": {
                                    "params": {
                                        "domain": "notify",
                                        "service": "mobile_app_grace",
                                        "service_data": {
                                            "title": "Please unload laundry",
                                            "message": "Wash completed at 11:01"
                                        },
                                        "target": {}
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ]
                    },
                    "config": {
                        "id": "1643979577174",
                        "alias": "Notify When Wash Completed",
                        "description": "Send notification when washer is finished",
                        "trigger": [
                            {
                                "platform": "state",
                                "entity_id": "binary_sensor.washer_wash_completed",
                                "from": "off",
                                "to": "on"
                            }
                        ],
                        "condition": [],
                        "action": [
                            {
                                "service": "notify.mobile_app_pixel_4a",
                                "data": {
                                    "title": "Please unload laundry",
                                    "message": "Wash completed at {{ (now() | string)[11:16] }}"
                                }
                            },
                            {
                                "service": "notify.mobile_app_grace",
                                "data": {
                                    "title": "Please unload laundry",
                                    "message": "Wash completed at {{ (now() | string)[11:16] }}"
                                }
                            }
                        ],
                        "mode": "single"
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "452d5e5cc6f7febca23d7ced06c48ae8",
                        "parent_id": "0311f2a5dae4ccdaa62e5ca022c31f08",
                        "user_id": null
                    }
                },
                "short_dict": {
                    "last_step": "action/1",
                    "run_id": "e58fc2251381255f33a6555172535836",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T03:01:30.476212+00:00",
                        "finish": "2022-03-03T03:01:30.886042+00:00"
                    },
                    "domain": "automation",
                    "item_id": "1643979577174",
                    "trigger": "state of binary_sensor.washer_wash_completed"
                }
            }
        ],
        "script.turn_off_all": [
            {
                "extended_dict": {
                    "last_step": "sequence/12",
                    "run_id": "67abdfb4f4cde085448ddc2b8719cab3",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:09:46.789741+00:00",
                        "finish": "2022-03-03T05:09:54.596750+00:00"
                    },
                    "domain": "script",
                    "item_id": "turn_off_all",
                    "trace": {
                        "sequence/0": [
                            {
                                "path": "sequence/0",
                                "timestamp": "2022-03-03T05:09:46.790944+00:00",
                                "child_id": {
                                    "domain": "script",
                                    "item_id": "turn_off_elenas_room",
                                    "run_id": "0aac537bcaf43e071bbaa2013461724b"
                                },
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "script.turn_off_all",
                                        "state": "off",
                                        "attributes": {
                                            "last_triggered": "2022-03-02T23:34:10.314575+00:00",
                                            "mode": "single",
                                            "current": 0,
                                            "icon": "mdi:home-export-outline",
                                            "friendly_name": "Turn Off All"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.573708+00:00",
                                        "last_updated": "2022-03-03T00:41:11.573708+00:00",
                                        "context": {
                                            "id": "9cd5f7d8961da93ef55cc00673e0ce27",
                                            "parent_id": null,
                                            "user_id": null
                                        }
                                    },
                                    "context": {
                                        "id": "3c34ab25510e6c3602cf039455c14bd6",
                                        "parent_id": null,
                                        "user_id": "ad2bcce775894550affb6dfef93a2a36"
                                    }
                                },
                                "result": {
                                    "params": {
                                        "domain": "script",
                                        "service": "turn_off_elenas_room",
                                        "service_data": {},
                                        "target": {}
                                    },
                                    "running_script": true,
                                    "limit": null
                                }
                            }
                        ],
                        "sequence/1": [
                            {
                                "path": "sequence/1",
                                "timestamp": "2022-03-03T05:09:46.935954+00:00",
                                "result": {
                                    "delay": 0.3,
                                    "done": true
                                }
                            }
                        ],
                        "sequence/2": [
                            {
                                "path": "sequence/2",
                                "timestamp": "2022-03-03T05:09:47.236929+00:00",
                                "child_id": {
                                    "domain": "script",
                                    "item_id": "turn_off_junior_bathroom",
                                    "run_id": "651994b419c35e6d60930bb424acc336"
                                },
                                "result": {
                                    "params": {
                                        "domain": "script",
                                        "service": "turn_off_junior_bathroom",
                                        "service_data": {},
                                        "target": {}
                                    },
                                    "running_script": true,
                                    "limit": null
                                }
                            }
                        ],
                        "sequence/3": [
                            {
                                "path": "sequence/3",
                                "timestamp": "2022-03-03T05:09:47.360279+00:00",
                                "result": {
                                    "delay": 0.3,
                                    "done": true
                                }
                            }
                        ],
                        "sequence/4": [
                            {
                                "path": "sequence/4",
                                "timestamp": "2022-03-03T05:09:47.661327+00:00",
                                "child_id": {
                                    "domain": "script",
                                    "item_id": "turn_off_elis_room",
                                    "run_id": "8ec7f98edeb87bbd6bed8d49b3dc24b8"
                                },
                                "result": {
                                    "params": {
                                        "domain": "script",
                                        "service": "turn_off_elis_room",
                                        "service_data": {},
                                        "target": {}
                                    },
                                    "running_script": true,
                                    "limit": null
                                }
                            }
                        ],
                        "sequence/5": [
                            {
                                "path": "sequence/5",
                                "timestamp": "2022-03-03T05:09:52.904197+00:00",
                                "result": {
                                    "delay": 0.3,
                                    "done": true
                                }
                            }
                        ],
                        "sequence/6": [
                            {
                                "path": "sequence/6",
                                "timestamp": "2022-03-03T05:09:53.206642+00:00",
                                "child_id": {
                                    "domain": "script",
                                    "item_id": "turn_off_powder_room",
                                    "run_id": "bbe09a250980531bfd8db6a89c001685"
                                },
                                "result": {
                                    "params": {
                                        "domain": "script",
                                        "service": "turn_off_powder_room",
                                        "service_data": {},
                                        "target": {}
                                    },
                                    "running_script": true,
                                    "limit": null
                                }
                            }
                        ],
                        "sequence/7": [
                            {
                                "path": "sequence/7",
                                "timestamp": "2022-03-03T05:09:53.298161+00:00",
                                "result": {
                                    "delay": 0.3,
                                    "done": true
                                }
                            }
                        ],
                        "sequence/8": [
                            {
                                "path": "sequence/8",
                                "timestamp": "2022-03-03T05:09:53.598972+00:00",
                                "child_id": {
                                    "domain": "script",
                                    "item_id": "turn_off_hallway",
                                    "run_id": "25464866a817a2d3c826ae370d068bc4"
                                },
                                "result": {
                                    "params": {
                                        "domain": "script",
                                        "service": "turn_off_hallway",
                                        "service_data": {},
                                        "target": {}
                                    },
                                    "running_script": true,
                                    "limit": null
                                }
                            }
                        ],
                        "sequence/9": [
                            {
                                "path": "sequence/9",
                                "timestamp": "2022-03-03T05:09:53.670899+00:00",
                                "result": {
                                    "delay": 0.3,
                                    "done": true
                                }
                            }
                        ],
                        "sequence/10": [
                            {
                                "path": "sequence/10",
                                "timestamp": "2022-03-03T05:09:53.971876+00:00",
                                "child_id": {
                                    "domain": "script",
                                    "item_id": "turn_off_playroom",
                                    "run_id": "a07a4d94f79c1990acebc129167bdcd4"
                                },
                                "result": {
                                    "params": {
                                        "domain": "script",
                                        "service": "turn_off_playroom",
                                        "service_data": {},
                                        "target": {}
                                    },
                                    "running_script": true,
                                    "limit": null
                                }
                            }
                        ],
                        "sequence/11": [
                            {
                                "path": "sequence/11",
                                "timestamp": "2022-03-03T05:09:54.119503+00:00",
                                "result": {
                                    "delay": 0.3,
                                    "done": true
                                }
                            }
                        ],
                        "sequence/12": [
                            {
                                "path": "sequence/12",
                                "timestamp": "2022-03-03T05:09:54.420298+00:00",
                                "child_id": {
                                    "domain": "script",
                                    "item_id": "turn_off_dining_room",
                                    "run_id": "1562abd257a3a337011f907f67c4bb3c"
                                },
                                "result": {
                                    "params": {
                                        "domain": "script",
                                        "service": "turn_off_dining_room",
                                        "service_data": {},
                                        "target": {}
                                    },
                                    "running_script": true,
                                    "limit": null
                                }
                            }
                        ]
                    },
                    "config": {
                        "sequence": [
                            {
                                "service": "script.turn_off_elenas_room"
                            },
                            {
                                "delay": {
                                    "hours": 0,
                                    "minutes": 0,
                                    "seconds": 0,
                                    "milliseconds": 300
                                }
                            },
                            {
                                "service": "script.turn_off_junior_bathroom"
                            },
                            {
                                "delay": {
                                    "hours": 0,
                                    "minutes": 0,
                                    "seconds": 0,
                                    "milliseconds": 300
                                }
                            },
                            {
                                "service": "script.turn_off_elis_room"
                            },
                            {
                                "delay": {
                                    "hours": 0,
                                    "minutes": 0,
                                    "seconds": 0,
                                    "milliseconds": 300
                                }
                            },
                            {
                                "service": "script.turn_off_powder_room"
                            },
                            {
                                "delay": {
                                    "hours": 0,
                                    "minutes": 0,
                                    "seconds": 0,
                                    "milliseconds": 300
                                }
                            },
                            {
                                "service": "script.turn_off_hallway"
                            },
                            {
                                "delay": {
                                    "hours": 0,
                                    "minutes": 0,
                                    "seconds": 0,
                                    "milliseconds": 300
                                }
                            },
                            {
                                "service": "script.turn_off_playroom"
                            },
                            {
                                "delay": {
                                    "hours": 0,
                                    "minutes": 0,
                                    "seconds": 0,
                                    "milliseconds": 300
                                }
                            },
                            {
                                "service": "script.turn_off_dining_room"
                            }
                        ],
                        "mode": "single",
                        "alias": "Turn Off All",
                        "icon": "mdi:home-export-outline"
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "3c34ab25510e6c3602cf039455c14bd6",
                        "parent_id": null,
                        "user_id": "ad2bcce775894550affb6dfef93a2a36"
                    }
                },
                "short_dict": {
                    "last_step": "sequence/12",
                    "run_id": "67abdfb4f4cde085448ddc2b8719cab3",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:09:46.789741+00:00",
                        "finish": "2022-03-03T05:09:54.596750+00:00"
                    },
                    "domain": "script",
                    "item_id": "turn_off_all"
                }
            }
        ],
        "script.turn_off_hallway": [
            {
                "extended_dict": {
                    "last_step": "sequence/0",
                    "run_id": "25464866a817a2d3c826ae370d068bc4",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:09:53.599381+00:00",
                        "finish": "2022-03-03T05:09:53.670760+00:00"
                    },
                    "domain": "script",
                    "item_id": "turn_off_hallway",
                    "trace": {
                        "sequence/0": [
                            {
                                "path": "sequence/0",
                                "timestamp": "2022-03-03T05:09:53.600935+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "script.turn_off_hallway",
                                        "state": "off",
                                        "attributes": {
                                            "last_triggered": "2022-03-02T23:34:17.119937+00:00",
                                            "mode": "single",
                                            "current": 0,
                                            "icon": "mdi:power",
                                            "friendly_name": "Turn Off Hallway"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.573650+00:00",
                                        "last_updated": "2022-03-03T00:41:11.573650+00:00",
                                        "context": {
                                            "id": "ecf8c75182cd0454fca235c3b1919e4d",
                                            "parent_id": null,
                                            "user_id": null
                                        }
                                    },
                                    "context": {
                                        "id": "3c34ab25510e6c3602cf039455c14bd6",
                                        "parent_id": null,
                                        "user_id": "ad2bcce775894550affb6dfef93a2a36"
                                    }
                                },
                                "result": {
                                    "params": {
                                        "domain": "light",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "light.hallway_lights"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ]
                    },
                    "config": {
                        "sequence": [
                            {
                                "service": "light.turn_off",
                                "target": {
                                    "entity_id": "light.hallway_lights"
                                }
                            }
                        ],
                        "mode": "single",
                        "alias": "Turn Off Hallway",
                        "icon": "mdi:power"
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "3c34ab25510e6c3602cf039455c14bd6",
                        "parent_id": null,
                        "user_id": "ad2bcce775894550affb6dfef93a2a36"
                    }
                },
                "short_dict": {
                    "last_step": "sequence/0",
                    "run_id": "25464866a817a2d3c826ae370d068bc4",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:09:53.599381+00:00",
                        "finish": "2022-03-03T05:09:53.670760+00:00"
                    },
                    "domain": "script",
                    "item_id": "turn_off_hallway"
                }
            }
        ],
        "script.turn_off_playroom": [
            {
                "extended_dict": {
                    "last_step": "sequence/0",
                    "run_id": "a07a4d94f79c1990acebc129167bdcd4",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:09:53.972230+00:00",
                        "finish": "2022-03-03T05:09:54.119345+00:00"
                    },
                    "domain": "script",
                    "item_id": "turn_off_playroom",
                    "trace": {
                        "sequence/0": [
                            {
                                "path": "sequence/0",
                                "timestamp": "2022-03-03T05:09:53.973597+00:00",
                                "changed_variables": {
                                    "this": {
                                        "entity_id": "script.turn_off_playroom",
                                        "state": "off",
                                        "attributes": {
                                            "last_triggered": "2022-03-02T23:34:17.540373+00:00",
                                            "mode": "single",
                                            "current": 0,
                                            "icon": "mdi:power",
                                            "friendly_name": "Turn Off Playroom"
                                        },
                                        "last_changed": "2022-03-03T00:41:11.573480+00:00",
                                        "last_updated": "2022-03-03T00:41:11.573480+00:00",
                                        "context": {
                                            "id": "091bde60c8da4f13a6fb005f092abab3",
                                            "parent_id": null,
                                            "user_id": null
                                        }
                                    },
                                    "context": {
                                        "id": "3c34ab25510e6c3602cf039455c14bd6",
                                        "parent_id": null,
                                        "user_id": "ad2bcce775894550affb6dfef93a2a36"
                                    }
                                },
                                "result": {
                                    "params": {
                                        "domain": "light",
                                        "service": "turn_off",
                                        "service_data": {},
                                        "target": {
                                            "entity_id": [
                                                "light.playroom_lights"
                                            ]
                                        }
                                    },
                                    "running_script": false,
                                    "limit": 10
                                }
                            }
                        ]
                    },
                    "config": {
                        "sequence": [
                            {
                                "service": "light.turn_off",
                                "target": {
                                    "entity_id": "light.playroom_lights"
                                }
                            }
                        ],
                        "mode": "single",
                        "alias": "Turn Off Playroom",
                        "icon": "mdi:power"
                    },
                    "blueprint_inputs": null,
                    "context": {
                        "id": "3c34ab25510e6c3602cf039455c14bd6",
                        "parent_id": null,
                        "user_id": "ad2bcce775894550affb6dfef93a2a36"
                    }
                },
                "short_dict": {
                    "last_step": "sequence/0",
                    "run_id": "a07a4d94f79c1990acebc129167bdcd4",
                    "state": "stopped",
                    "script_execution": "finished",
                    "timestamp": {
                        "start": "2022-03-03T05:09:53.972230+00:00",
                        "finish": "2022-03-03T05:09:54.119345+00:00"
                    },
                    "domain": "script",
                    "item_id": "turn_off_playroom"
                }
            }
        ]
    }
}